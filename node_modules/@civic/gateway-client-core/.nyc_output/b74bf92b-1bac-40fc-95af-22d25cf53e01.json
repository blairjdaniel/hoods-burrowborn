{"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/config.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/config.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":65}},"2":{"start":{"line":4,"column":0},"end":{"line":10,"column":2}},"3":{"start":{"line":11,"column":29},"end":{"line":17,"column":1}},"4":{"start":{"line":12,"column":21},"end":{"line":12,"column":52}},"5":{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},"6":{"start":{"line":14,"column":8},"end":{"line":14,"column":50}},"7":{"start":{"line":16,"column":4},"end":{"line":16,"column":20}},"8":{"start":{"line":18,"column":0},"end":{"line":18,"column":52}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":11,"column":29},"end":{"line":11,"column":30}},"loc":{"start":{"line":11,"column":40},"end":{"line":17,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},"type":"if","locations":[{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},{"start":{"line":13,"column":4},"end":{"line":15,"column":5}}],"line":13}},"s":{"0":1,"1":1,"2":1,"3":1,"4":700,"5":700,"6":1,"7":699,"8":1},"f":{"0":700},"b":{"0":[1,699]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/config.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/config.ts"],"names":[],"mappings":";;;AAEa,QAAA,gBAAgB,GAAG;IAC9B,KAAK,EAAE,uBAAuB;IAC9B,IAAI,EAAE,uBAAuB;IAC7B,GAAG,EAAE,8BAA8B;IACnC,OAAO,EAAE,kCAAkC;IAC3C,IAAI,EAAE,0BAA0B;CACjC,CAAC;AAEK,MAAM,oBAAoB,GAAG,CAAC,KAAY,EAAU,EAAE;IAC3D,MAAM,QAAQ,GAAG,wBAAgB,CAAC,KAAK,CAAC,CAAC;IACzC,IAAI,CAAC,QAAQ,EAAE,CAAC;QACd,MAAM,IAAI,KAAK,CAAC,iBAAiB,KAAK,EAAE,CAAC,CAAC;IAC5C,CAAC;IACD,OAAO,QAAQ,CAAC;AAClB,CAAC,CAAC;AANW,QAAA,oBAAoB,wBAM/B","sourcesContent":["import { Stage } from './types/parameters';\n\nexport const IFRAME_ENDPOINTS = {\n  local: 'http://localhost:3004',\n  test: 'http://localhost:3004', // for automated tests\n  dev: 'https://passv2-dev.civic.com',\n  preprod: 'https://passv2-preprod.civic.com',\n  prod: 'https://passv2.civic.com',\n};\n\nexport const getCivicPassEndpoint = (stage: Stage): string => {\n  const endpoint = IFRAME_ENDPOINTS[stage];\n  if (!endpoint) {\n    throw new Error(`Invalid stage ${stage}`);\n  }\n  return endpoint;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9bb9805484328cbc3e26f43d5227b7b0cd638399"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/gatekeeperClient.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/gatekeeperClient.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":281}},"4":{"start":{"line":7,"column":22},"end":{"line":7,"column":61}},"5":{"start":{"line":8,"column":14},"end":{"line":8,"column":36}},"6":{"start":{"line":9,"column":17},"end":{"line":9,"column":36}},"7":{"start":{"line":10,"column":24},"end":{"line":10,"column":56}},"8":{"start":{"line":11,"column":0},"end":{"line":17,"column":2}},"9":{"start":{"line":18,"column":17},"end":{"line":18,"column":69}},"10":{"start":{"line":19,"column":16},"end":{"line":19,"column":67}},"11":{"start":{"line":20,"column":17},"end":{"line":20,"column":69}},"12":{"start":{"line":21,"column":30},"end":{"line":28,"column":1}},"13":{"start":{"line":22,"column":18},"end":{"line":22,"column":58}},"14":{"start":{"line":23,"column":4},"end":{"line":26,"column":5}},"15":{"start":{"line":24,"column":8},"end":{"line":24,"column":83}},"16":{"start":{"line":25,"column":8},"end":{"line":25,"column":56}},"17":{"start":{"line":27,"column":4},"end":{"line":27,"column":46}},"18":{"start":{"line":29,"column":0},"end":{"line":29,"column":54}},"19":{"start":{"line":30,"column":34},"end":{"line":30,"column":95}},"20":{"start":{"line":30,"column":44},"end":{"line":30,"column":95}},"21":{"start":{"line":31,"column":0},"end":{"line":31,"column":62}},"22":{"start":{"line":32,"column":34},"end":{"line":32,"column":98}},"23":{"start":{"line":32,"column":44},"end":{"line":32,"column":98}},"24":{"start":{"line":33,"column":0},"end":{"line":33,"column":62}},"25":{"start":{"line":34,"column":47},"end":{"line":34,"column":129}},"26":{"start":{"line":34,"column":57},"end":{"line":34,"column":129}},"27":{"start":{"line":35,"column":0},"end":{"line":35,"column":88}},"28":{"start":{"line":36,"column":29},"end":{"line":36,"column":161}},"29":{"start":{"line":36,"column":39},"end":{"line":36,"column":161}},"30":{"start":{"line":37,"column":0},"end":{"line":37,"column":52}},"31":{"start":{"line":38,"column":25},"end":{"line":38,"column":108}},"32":{"start":{"line":38,"column":34},"end":{"line":38,"column":108}},"33":{"start":{"line":38,"column":91},"end":{"line":38,"column":106}},"34":{"start":{"line":39,"column":0},"end":{"line":39,"column":44}},"35":{"start":{"line":42,"column":8},"end":{"line":42,"column":37}},"36":{"start":{"line":43,"column":8},"end":{"line":43,"column":58}},"37":{"start":{"line":44,"column":8},"end":{"line":44,"column":120}},"38":{"start":{"line":45,"column":8},"end":{"line":45,"column":50}},"39":{"start":{"line":46,"column":8},"end":{"line":46,"column":105}},"40":{"start":{"line":47,"column":8},"end":{"line":47,"column":66}},"41":{"start":{"line":48,"column":24},"end":{"line":48,"column":45}},"42":{"start":{"line":49,"column":8},"end":{"line":73,"column":10}},"43":{"start":{"line":53,"column":29},"end":{"line":53,"column":74}},"44":{"start":{"line":54,"column":16},"end":{"line":64,"column":17}},"45":{"start":{"line":55,"column":20},"end":{"line":57,"column":21}},"46":{"start":{"line":56,"column":24},"end":{"line":56,"column":37}},"47":{"start":{"line":58,"column":20},"end":{"line":61,"column":21}},"48":{"start":{"line":59,"column":24},"end":{"line":59,"column":114}},"49":{"start":{"line":60,"column":24},"end":{"line":60,"column":36}},"50":{"start":{"line":62,"column":20},"end":{"line":62,"column":99}},"51":{"start":{"line":63,"column":20},"end":{"line":63,"column":32}},"52":{"start":{"line":65,"column":16},"end":{"line":65,"column":81}},"53":{"start":{"line":66,"column":16},"end":{"line":66,"column":29}},"54":{"start":{"line":69,"column":35},"end":{"line":69,"column":59}},"55":{"start":{"line":70,"column":16},"end":{"line":70,"column":77}},"56":{"start":{"line":71,"column":16},"end":{"line":71,"column":34}},"57":{"start":{"line":74,"column":8},"end":{"line":74,"column":108}},"58":{"start":{"line":77,"column":8},"end":{"line":77,"column":107}},"59":{"start":{"line":81,"column":8},"end":{"line":81,"column":167}},"60":{"start":{"line":85,"column":8},"end":{"line":85,"column":181}},"61":{"start":{"line":86,"column":8},"end":{"line":86,"column":37}},"62":{"start":{"line":89,"column":8},"end":{"line":90,"column":19}},"63":{"start":{"line":90,"column":12},"end":{"line":90,"column":19}},"64":{"start":{"line":91,"column":8},"end":{"line":93,"column":11}},"65":{"start":{"line":92,"column":12},"end":{"line":92,"column":48}},"66":{"start":{"line":96,"column":8},"end":{"line":96,"column":158}},"67":{"start":{"line":97,"column":8},"end":{"line":99,"column":9}},"68":{"start":{"line":98,"column":12},"end":{"line":98,"column":24}},"69":{"start":{"line":100,"column":8},"end":{"line":100,"column":20}},"70":{"start":{"line":103,"column":20},"end":{"line":103,"column":63}},"71":{"start":{"line":104,"column":8},"end":{"line":104,"column":33}},"72":{"start":{"line":105,"column":8},"end":{"line":105,"column":30}},"73":{"start":{"line":108,"column":8},"end":{"line":108,"column":193}},"74":{"start":{"line":109,"column":8},"end":{"line":124,"column":11}},"75":{"start":{"line":114,"column":50},"end":{"line":117,"column":10}},"76":{"start":{"line":114,"column":71},"end":{"line":117,"column":9}},"77":{"start":{"line":119,"column":12},"end":{"line":122,"column":13}},"78":{"start":{"line":120,"column":16},"end":{"line":120,"column":73}},"79":{"start":{"line":121,"column":16},"end":{"line":121,"column":28}},"80":{"start":{"line":123,"column":12},"end":{"line":123,"column":24}},"81":{"start":{"line":127,"column":8},"end":{"line":127,"column":141}},"82":{"start":{"line":128,"column":8},"end":{"line":141,"column":11}},"83":{"start":{"line":133,"column":50},"end":{"line":133,"column":72}},"84":{"start":{"line":133,"column":66},"end":{"line":133,"column":72}},"85":{"start":{"line":135,"column":12},"end":{"line":135,"column":51}},"86":{"start":{"line":136,"column":12},"end":{"line":139,"column":13}},"87":{"start":{"line":137,"column":16},"end":{"line":137,"column":73}},"88":{"start":{"line":138,"column":16},"end":{"line":138,"column":74}},"89":{"start":{"line":140,"column":12},"end":{"line":140,"column":24}},"90":{"start":{"line":144,"column":8},"end":{"line":147,"column":11}},"91":{"start":{"line":148,"column":21},"end":{"line":153,"column":10}},"92":{"start":{"line":154,"column":8},"end":{"line":154,"column":97}},"93":{"start":{"line":155,"column":20},"end":{"line":155,"column":41}},"94":{"start":{"line":156,"column":8},"end":{"line":156,"column":33}},"95":{"start":{"line":157,"column":8},"end":{"line":182,"column":11}},"96":{"start":{"line":166,"column":50},"end":{"line":174,"column":9}},"97":{"start":{"line":167,"column":31},"end":{"line":167,"column":35}},"98":{"start":{"line":168,"column":28},"end":{"line":168,"column":45}},"99":{"start":{"line":169,"column":12},"end":{"line":173,"column":14}},"100":{"start":{"line":176,"column":12},"end":{"line":176,"column":65}},"101":{"start":{"line":177,"column":12},"end":{"line":180,"column":13}},"102":{"start":{"line":178,"column":16},"end":{"line":178,"column":73}},"103":{"start":{"line":179,"column":16},"end":{"line":179,"column":28}},"104":{"start":{"line":181,"column":12},"end":{"line":181,"column":24}},"105":{"start":{"line":186,"column":8},"end":{"line":186,"column":330}},"106":{"start":{"line":187,"column":21},"end":{"line":192,"column":10}},"107":{"start":{"line":193,"column":8},"end":{"line":215,"column":11}},"108":{"start":{"line":200,"column":31},"end":{"line":200,"column":35}},"109":{"start":{"line":201,"column":28},"end":{"line":201,"column":45}},"110":{"start":{"line":202,"column":12},"end":{"line":206,"column":14}},"111":{"start":{"line":209,"column":12},"end":{"line":209,"column":44}},"112":{"start":{"line":210,"column":12},"end":{"line":213,"column":13}},"113":{"start":{"line":211,"column":16},"end":{"line":211,"column":73}},"114":{"start":{"line":212,"column":16},"end":{"line":212,"column":28}},"115":{"start":{"line":214,"column":12},"end":{"line":214,"column":24}},"116":{"start":{"line":219,"column":20},"end":{"line":219,"column":91}},"117":{"start":{"line":220,"column":8},"end":{"line":220,"column":33}},"118":{"start":{"line":221,"column":8},"end":{"line":221,"column":292}},"119":{"start":{"line":222,"column":21},"end":{"line":224,"column":10}},"120":{"start":{"line":225,"column":8},"end":{"line":247,"column":11}},"121":{"start":{"line":232,"column":31},"end":{"line":232,"column":35}},"122":{"start":{"line":233,"column":28},"end":{"line":233,"column":45}},"123":{"start":{"line":234,"column":12},"end":{"line":238,"column":14}},"124":{"start":{"line":241,"column":12},"end":{"line":241,"column":53}},"125":{"start":{"line":242,"column":12},"end":{"line":245,"column":13}},"126":{"start":{"line":243,"column":16},"end":{"line":243,"column":73}},"127":{"start":{"line":244,"column":16},"end":{"line":244,"column":28}},"128":{"start":{"line":246,"column":12},"end":{"line":246,"column":24}},"129":{"start":{"line":250,"column":20},"end":{"line":250,"column":99}},"130":{"start":{"line":251,"column":8},"end":{"line":251,"column":33}},"131":{"start":{"line":252,"column":21},"end":{"line":252,"column":31}},"132":{"start":{"line":253,"column":8},"end":{"line":276,"column":11}},"133":{"start":{"line":262,"column":50},"end":{"line":268,"column":9}},"134":{"start":{"line":263,"column":12},"end":{"line":267,"column":15}},"135":{"start":{"line":270,"column":12},"end":{"line":273,"column":13}},"136":{"start":{"line":271,"column":16},"end":{"line":271,"column":73}},"137":{"start":{"line":272,"column":16},"end":{"line":272,"column":28}},"138":{"start":{"line":274,"column":12},"end":{"line":274,"column":55}},"139":{"start":{"line":275,"column":12},"end":{"line":275,"column":24}},"140":{"start":{"line":279,"column":0},"end":{"line":279,"column":44}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":21,"column":30},"end":{"line":21,"column":31}},"loc":{"start":{"line":21,"column":52},"end":{"line":28,"column":1}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":30,"column":34},"end":{"line":30,"column":35}},"loc":{"start":{"line":30,"column":44},"end":{"line":30,"column":95}},"line":30},"3":{"name":"(anonymous_3)","decl":{"start":{"line":32,"column":34},"end":{"line":32,"column":35}},"loc":{"start":{"line":32,"column":44},"end":{"line":32,"column":98}},"line":32},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":47},"end":{"line":34,"column":48}},"loc":{"start":{"line":34,"column":57},"end":{"line":34,"column":129}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":36,"column":29},"end":{"line":36,"column":30}},"loc":{"start":{"line":36,"column":39},"end":{"line":36,"column":161}},"line":36},"6":{"name":"(anonymous_6)","decl":{"start":{"line":38,"column":25},"end":{"line":38,"column":26}},"loc":{"start":{"line":38,"column":34},"end":{"line":38,"column":108}},"line":38},"7":{"name":"(anonymous_7)","decl":{"start":{"line":38,"column":80},"end":{"line":38,"column":81}},"loc":{"start":{"line":38,"column":91},"end":{"line":38,"column":106}},"line":38},"8":{"name":"(anonymous_8)","decl":{"start":{"line":41,"column":4},"end":{"line":41,"column":5}},"loc":{"start":{"line":41,"column":36},"end":{"line":75,"column":5}},"line":41},"9":{"name":"(anonymous_9)","decl":{"start":{"line":51,"column":21},"end":{"line":51,"column":22}},"loc":{"start":{"line":51,"column":57},"end":{"line":67,"column":13}},"line":51},"10":{"name":"(anonymous_10)","decl":{"start":{"line":68,"column":24},"end":{"line":68,"column":25}},"loc":{"start":{"line":68,"column":37},"end":{"line":72,"column":13}},"line":68},"11":{"name":"(anonymous_11)","decl":{"start":{"line":76,"column":4},"end":{"line":76,"column":5}},"loc":{"start":{"line":76,"column":22},"end":{"line":78,"column":5}},"line":76},"12":{"name":"(anonymous_12)","decl":{"start":{"line":79,"column":4},"end":{"line":79,"column":5}},"loc":{"start":{"line":79,"column":19},"end":{"line":82,"column":5}},"line":79},"13":{"name":"(anonymous_13)","decl":{"start":{"line":83,"column":4},"end":{"line":83,"column":5}},"loc":{"start":{"line":83,"column":12},"end":{"line":87,"column":5}},"line":83},"14":{"name":"(anonymous_14)","decl":{"start":{"line":88,"column":4},"end":{"line":88,"column":5}},"loc":{"start":{"line":88,"column":24},"end":{"line":94,"column":5}},"line":88},"15":{"name":"(anonymous_15)","decl":{"start":{"line":91,"column":49},"end":{"line":91,"column":50}},"loc":{"start":{"line":91,"column":67},"end":{"line":93,"column":9}},"line":91},"16":{"name":"(anonymous_16)","decl":{"start":{"line":95,"column":4},"end":{"line":95,"column":5}},"loc":{"start":{"line":95,"column":29},"end":{"line":101,"column":5}},"line":95},"17":{"name":"(anonymous_17)","decl":{"start":{"line":102,"column":4},"end":{"line":102,"column":5}},"loc":{"start":{"line":102,"column":64},"end":{"line":106,"column":5}},"line":102},"18":{"name":"(anonymous_18)","decl":{"start":{"line":107,"column":4},"end":{"line":107,"column":5}},"loc":{"start":{"line":107,"column":88},"end":{"line":125,"column":5}},"line":107},"19":{"name":"(anonymous_19)","decl":{"start":{"line":114,"column":44},"end":{"line":114,"column":45}},"loc":{"start":{"line":114,"column":50},"end":{"line":117,"column":10}},"line":114},"20":{"name":"(anonymous_20)","decl":{"start":{"line":114,"column":50},"end":{"line":114,"column":51}},"loc":{"start":{"line":114,"column":71},"end":{"line":117,"column":9}},"line":114},"21":{"name":"(anonymous_21)","decl":{"start":{"line":118,"column":19},"end":{"line":118,"column":20}},"loc":{"start":{"line":118,"column":30},"end":{"line":124,"column":9}},"line":118},"22":{"name":"(anonymous_22)","decl":{"start":{"line":126,"column":4},"end":{"line":126,"column":5}},"loc":{"start":{"line":126,"column":77},"end":{"line":142,"column":5}},"line":126},"23":{"name":"(anonymous_23)","decl":{"start":{"line":133,"column":44},"end":{"line":133,"column":45}},"loc":{"start":{"line":133,"column":50},"end":{"line":133,"column":72}},"line":133},"24":{"name":"(anonymous_24)","decl":{"start":{"line":133,"column":50},"end":{"line":133,"column":51}},"loc":{"start":{"line":133,"column":66},"end":{"line":133,"column":72}},"line":133},"25":{"name":"(anonymous_25)","decl":{"start":{"line":134,"column":19},"end":{"line":134,"column":20}},"loc":{"start":{"line":134,"column":30},"end":{"line":141,"column":9}},"line":134},"26":{"name":"(anonymous_26)","decl":{"start":{"line":143,"column":4},"end":{"line":143,"column":5}},"loc":{"start":{"line":143,"column":72},"end":{"line":183,"column":5}},"line":143},"27":{"name":"(anonymous_27)","decl":{"start":{"line":166,"column":44},"end":{"line":166,"column":45}},"loc":{"start":{"line":166,"column":50},"end":{"line":174,"column":9}},"line":166},"28":{"name":"(anonymous_28)","decl":{"start":{"line":166,"column":50},"end":{"line":166,"column":51}},"loc":{"start":{"line":166,"column":66},"end":{"line":174,"column":9}},"line":166},"29":{"name":"(anonymous_29)","decl":{"start":{"line":175,"column":19},"end":{"line":175,"column":20}},"loc":{"start":{"line":175,"column":30},"end":{"line":182,"column":9}},"line":175},"30":{"name":"(anonymous_30)","decl":{"start":{"line":184,"column":4},"end":{"line":184,"column":5}},"loc":{"start":{"line":184,"column":50},"end":{"line":216,"column":5}},"line":184},"31":{"name":"(anonymous_31)","decl":{"start":{"line":199,"column":18},"end":{"line":199,"column":19}},"loc":{"start":{"line":199,"column":34},"end":{"line":207,"column":9}},"line":199},"32":{"name":"(anonymous_32)","decl":{"start":{"line":208,"column":19},"end":{"line":208,"column":20}},"loc":{"start":{"line":208,"column":30},"end":{"line":215,"column":9}},"line":208},"33":{"name":"(anonymous_33)","decl":{"start":{"line":217,"column":4},"end":{"line":217,"column":5}},"loc":{"start":{"line":217,"column":43},"end":{"line":248,"column":5}},"line":217},"34":{"name":"(anonymous_34)","decl":{"start":{"line":231,"column":18},"end":{"line":231,"column":19}},"loc":{"start":{"line":231,"column":34},"end":{"line":239,"column":9}},"line":231},"35":{"name":"(anonymous_35)","decl":{"start":{"line":240,"column":19},"end":{"line":240,"column":20}},"loc":{"start":{"line":240,"column":30},"end":{"line":247,"column":9}},"line":240},"36":{"name":"(anonymous_36)","decl":{"start":{"line":249,"column":4},"end":{"line":249,"column":5}},"loc":{"start":{"line":249,"column":57},"end":{"line":277,"column":5}},"line":249},"37":{"name":"(anonymous_37)","decl":{"start":{"line":262,"column":44},"end":{"line":262,"column":45}},"loc":{"start":{"line":262,"column":50},"end":{"line":268,"column":9}},"line":262},"38":{"name":"(anonymous_38)","decl":{"start":{"line":262,"column":50},"end":{"line":262,"column":51}},"loc":{"start":{"line":262,"column":62},"end":{"line":268,"column":9}},"line":262},"39":{"name":"(anonymous_39)","decl":{"start":{"line":269,"column":19},"end":{"line":269,"column":20}},"loc":{"start":{"line":269,"column":30},"end":{"line":276,"column":9}},"line":269}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":23,"column":4},"end":{"line":26,"column":5}},"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":26,"column":5}},{"start":{"line":23,"column":4},"end":{"line":26,"column":5}}],"line":23},"4":{"loc":{"start":{"line":36,"column":39},"end":{"line":36,"column":161}},"type":"binary-expr","locations":[{"start":{"line":36,"column":39},"end":{"line":36,"column":84}},{"start":{"line":36,"column":88},"end":{"line":36,"column":146}},{"start":{"line":36,"column":150},"end":{"line":36,"column":161}}],"line":36},"5":{"loc":{"start":{"line":44,"column":23},"end":{"line":44,"column":119}},"type":"binary-expr","locations":[{"start":{"line":44,"column":23},"end":{"line":44,"column":41}},{"start":{"line":44,"column":45},"end":{"line":44,"column":119}}],"line":44},"6":{"loc":{"start":{"line":53,"column":29},"end":{"line":53,"column":74}},"type":"cond-expr","locations":[{"start":{"line":53,"column":40},"end":{"line":53,"column":69}},{"start":{"line":53,"column":72},"end":{"line":53,"column":74}}],"line":53},"7":{"loc":{"start":{"line":54,"column":16},"end":{"line":64,"column":17}},"type":"if","locations":[{"start":{"line":54,"column":16},"end":{"line":64,"column":17}},{"start":{"line":54,"column":16},"end":{"line":64,"column":17}}],"line":54},"8":{"loc":{"start":{"line":54,"column":20},"end":{"line":54,"column":54}},"type":"binary-expr","locations":[{"start":{"line":54,"column":20},"end":{"line":54,"column":28}},{"start":{"line":54,"column":32},"end":{"line":54,"column":54}}],"line":54},"9":{"loc":{"start":{"line":55,"column":20},"end":{"line":57,"column":21}},"type":"if","locations":[{"start":{"line":55,"column":20},"end":{"line":57,"column":21}},{"start":{"line":55,"column":20},"end":{"line":57,"column":21}}],"line":55},"10":{"loc":{"start":{"line":55,"column":24},"end":{"line":55,"column":153}},"type":"cond-expr","locations":[{"start":{"line":55,"column":116},"end":{"line":55,"column":122}},{"start":{"line":55,"column":125},"end":{"line":55,"column":153}}],"line":55},"11":{"loc":{"start":{"line":55,"column":24},"end":{"line":55,"column":113}},"type":"binary-expr","locations":[{"start":{"line":55,"column":24},"end":{"line":55,"column":96}},{"start":{"line":55,"column":100},"end":{"line":55,"column":113}}],"line":55},"12":{"loc":{"start":{"line":55,"column":30},"end":{"line":55,"column":86}},"type":"cond-expr","locations":[{"start":{"line":55,"column":65},"end":{"line":55,"column":71}},{"start":{"line":55,"column":74},"end":{"line":55,"column":86}}],"line":55},"13":{"loc":{"start":{"line":55,"column":30},"end":{"line":55,"column":62}},"type":"binary-expr","locations":[{"start":{"line":55,"column":30},"end":{"line":55,"column":43}},{"start":{"line":55,"column":47},"end":{"line":55,"column":62}}],"line":55},"14":{"loc":{"start":{"line":58,"column":20},"end":{"line":61,"column":21}},"type":"if","locations":[{"start":{"line":58,"column":20},"end":{"line":61,"column":21}},{"start":{"line":58,"column":20},"end":{"line":61,"column":21}}],"line":58},"15":{"loc":{"start":{"line":77,"column":58},"end":{"line":77,"column":76}},"type":"binary-expr","locations":[{"start":{"line":77,"column":58},"end":{"line":77,"column":70}},{"start":{"line":77,"column":74},"end":{"line":77,"column":76}}],"line":77},"16":{"loc":{"start":{"line":81,"column":15},"end":{"line":81,"column":166}},"type":"cond-expr","locations":[{"start":{"line":81,"column":139},"end":{"line":81,"column":145}},{"start":{"line":81,"column":148},"end":{"line":81,"column":166}}],"line":81},"17":{"loc":{"start":{"line":81,"column":15},"end":{"line":81,"column":136}},"type":"binary-expr","locations":[{"start":{"line":81,"column":15},"end":{"line":81,"column":119}},{"start":{"line":81,"column":123},"end":{"line":81,"column":136}}],"line":81},"18":{"loc":{"start":{"line":81,"column":21},"end":{"line":81,"column":109}},"type":"cond-expr","locations":[{"start":{"line":81,"column":73},"end":{"line":81,"column":79}},{"start":{"line":81,"column":82},"end":{"line":81,"column":109}}],"line":81},"19":{"loc":{"start":{"line":81,"column":21},"end":{"line":81,"column":70}},"type":"binary-expr","locations":[{"start":{"line":81,"column":21},"end":{"line":81,"column":53}},{"start":{"line":81,"column":57},"end":{"line":81,"column":70}}],"line":81},"20":{"loc":{"start":{"line":85,"column":26},"end":{"line":85,"column":177}},"type":"cond-expr","locations":[{"start":{"line":85,"column":150},"end":{"line":85,"column":156}},{"start":{"line":85,"column":159},"end":{"line":85,"column":177}}],"line":85},"21":{"loc":{"start":{"line":85,"column":26},"end":{"line":85,"column":147}},"type":"binary-expr","locations":[{"start":{"line":85,"column":26},"end":{"line":85,"column":130}},{"start":{"line":85,"column":134},"end":{"line":85,"column":147}}],"line":85},"22":{"loc":{"start":{"line":85,"column":32},"end":{"line":85,"column":120}},"type":"cond-expr","locations":[{"start":{"line":85,"column":84},"end":{"line":85,"column":90}},{"start":{"line":85,"column":93},"end":{"line":85,"column":120}}],"line":85},"23":{"loc":{"start":{"line":85,"column":32},"end":{"line":85,"column":81}},"type":"binary-expr","locations":[{"start":{"line":85,"column":32},"end":{"line":85,"column":64}},{"start":{"line":85,"column":68},"end":{"line":85,"column":81}}],"line":85},"24":{"loc":{"start":{"line":89,"column":8},"end":{"line":90,"column":19}},"type":"if","locations":[{"start":{"line":89,"column":8},"end":{"line":90,"column":19}},{"start":{"line":89,"column":8},"end":{"line":90,"column":19}}],"line":89},"25":{"loc":{"start":{"line":97,"column":8},"end":{"line":99,"column":9}},"type":"if","locations":[{"start":{"line":97,"column":8},"end":{"line":99,"column":9}},{"start":{"line":97,"column":8},"end":{"line":99,"column":9}}],"line":97},"26":{"loc":{"start":{"line":102,"column":17},"end":{"line":102,"column":62}},"type":"default-arg","locations":[{"start":{"line":102,"column":33},"end":{"line":102,"column":62}}],"line":102},"27":{"loc":{"start":{"line":107,"column":41},"end":{"line":107,"column":86}},"type":"default-arg","locations":[{"start":{"line":107,"column":57},"end":{"line":107,"column":86}}],"line":107},"28":{"loc":{"start":{"line":119,"column":12},"end":{"line":122,"column":13}},"type":"if","locations":[{"start":{"line":119,"column":12},"end":{"line":122,"column":13}},{"start":{"line":119,"column":12},"end":{"line":122,"column":13}}],"line":119},"29":{"loc":{"start":{"line":126,"column":30},"end":{"line":126,"column":75}},"type":"default-arg","locations":[{"start":{"line":126,"column":46},"end":{"line":126,"column":75}}],"line":126},"30":{"loc":{"start":{"line":136,"column":12},"end":{"line":139,"column":13}},"type":"if","locations":[{"start":{"line":136,"column":12},"end":{"line":139,"column":13}},{"start":{"line":136,"column":12},"end":{"line":139,"column":13}}],"line":136},"31":{"loc":{"start":{"line":177,"column":12},"end":{"line":180,"column":13}},"type":"if","locations":[{"start":{"line":177,"column":12},"end":{"line":180,"column":13}},{"start":{"line":177,"column":12},"end":{"line":180,"column":13}}],"line":177},"32":{"loc":{"start":{"line":186,"column":85},"end":{"line":186,"column":236}},"type":"cond-expr","locations":[{"start":{"line":186,"column":209},"end":{"line":186,"column":215}},{"start":{"line":186,"column":218},"end":{"line":186,"column":236}}],"line":186},"33":{"loc":{"start":{"line":186,"column":85},"end":{"line":186,"column":206}},"type":"binary-expr","locations":[{"start":{"line":186,"column":85},"end":{"line":186,"column":189}},{"start":{"line":186,"column":193},"end":{"line":186,"column":206}}],"line":186},"34":{"loc":{"start":{"line":186,"column":91},"end":{"line":186,"column":179}},"type":"cond-expr","locations":[{"start":{"line":186,"column":143},"end":{"line":186,"column":149}},{"start":{"line":186,"column":152},"end":{"line":186,"column":179}}],"line":186},"35":{"loc":{"start":{"line":186,"column":91},"end":{"line":186,"column":140}},"type":"binary-expr","locations":[{"start":{"line":186,"column":91},"end":{"line":186,"column":123}},{"start":{"line":186,"column":127},"end":{"line":186,"column":140}}],"line":186},"36":{"loc":{"start":{"line":210,"column":12},"end":{"line":213,"column":13}},"type":"if","locations":[{"start":{"line":210,"column":12},"end":{"line":213,"column":13}},{"start":{"line":210,"column":12},"end":{"line":213,"column":13}}],"line":210},"37":{"loc":{"start":{"line":221,"column":60},"end":{"line":221,"column":211}},"type":"cond-expr","locations":[{"start":{"line":221,"column":184},"end":{"line":221,"column":190}},{"start":{"line":221,"column":193},"end":{"line":221,"column":211}}],"line":221},"38":{"loc":{"start":{"line":221,"column":60},"end":{"line":221,"column":181}},"type":"binary-expr","locations":[{"start":{"line":221,"column":60},"end":{"line":221,"column":164}},{"start":{"line":221,"column":168},"end":{"line":221,"column":181}}],"line":221},"39":{"loc":{"start":{"line":221,"column":66},"end":{"line":221,"column":154}},"type":"cond-expr","locations":[{"start":{"line":221,"column":118},"end":{"line":221,"column":124}},{"start":{"line":221,"column":127},"end":{"line":221,"column":154}}],"line":221},"40":{"loc":{"start":{"line":221,"column":66},"end":{"line":221,"column":115}},"type":"binary-expr","locations":[{"start":{"line":221,"column":66},"end":{"line":221,"column":98}},{"start":{"line":221,"column":102},"end":{"line":221,"column":115}}],"line":221},"41":{"loc":{"start":{"line":242,"column":12},"end":{"line":245,"column":13}},"type":"if","locations":[{"start":{"line":242,"column":12},"end":{"line":245,"column":13}},{"start":{"line":242,"column":12},"end":{"line":245,"column":13}}],"line":242},"42":{"loc":{"start":{"line":249,"column":40},"end":{"line":249,"column":55}},"type":"default-arg","locations":[{"start":{"line":249,"column":49},"end":{"line":249,"column":55}}],"line":249},"43":{"loc":{"start":{"line":270,"column":12},"end":{"line":273,"column":13}},"type":"if","locations":[{"start":{"line":270,"column":12},"end":{"line":273,"column":13}},{"start":{"line":270,"column":12},"end":{"line":273,"column":13}}],"line":270}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":4,"14":4,"15":1,"16":1,"17":4,"18":1,"19":1,"20":0,"21":1,"22":1,"23":4,"24":1,"25":1,"26":5,"27":1,"28":1,"29":4,"30":1,"31":1,"32":37,"33":190,"34":1,"35":251,"36":251,"37":251,"38":251,"39":251,"40":251,"41":251,"42":251,"43":229,"44":229,"45":5,"46":0,"47":5,"48":1,"49":1,"50":4,"51":4,"52":224,"53":224,"54":4,"55":4,"56":4,"57":251,"58":117,"59":452,"60":53,"61":53,"62":459,"63":19,"64":440,"65":880,"66":233,"67":233,"68":233,"69":0,"70":421,"71":421,"72":421,"73":196,"74":196,"75":196,"76":169,"77":26,"78":0,"79":0,"80":25,"81":3,"82":3,"83":3,"84":1,"85":2,"86":2,"87":1,"88":1,"89":1,"90":20,"91":20,"92":20,"93":20,"94":20,"95":20,"96":20,"97":18,"98":18,"99":18,"100":2,"101":2,"102":1,"103":1,"104":1,"105":13,"106":13,"107":13,"108":11,"109":11,"110":11,"111":2,"112":2,"113":1,"114":1,"115":1,"116":4,"117":4,"118":4,"119":4,"120":4,"121":4,"122":4,"123":4,"124":0,"125":0,"126":0,"127":0,"128":0,"129":14,"130":14,"131":14,"132":14,"133":14,"134":12,"135":2,"136":1,"137":1,"138":1,"139":1,"140":1},"f":{"0":1,"1":4,"2":0,"3":4,"4":5,"5":4,"6":37,"7":190,"8":251,"9":229,"10":4,"11":117,"12":452,"13":53,"14":459,"15":880,"16":233,"17":421,"18":196,"19":196,"20":169,"21":26,"22":3,"23":3,"24":1,"25":2,"26":20,"27":20,"28":18,"29":2,"30":13,"31":11,"32":2,"33":4,"34":4,"35":0,"36":14,"37":14,"38":12,"39":2},"b":{"0":[1,1,1],"1":[0,1],"2":[1,1],"3":[1,3],"4":[4,3,2],"5":[251,0],"6":[220,9],"7":[5,224],"8":[229,220],"9":[0,5],"10":[5,0],"11":[5,5],"12":[0,5],"13":[5,5],"14":[1,4],"15":[117,0],"16":[19,433],"17":[452,452],"18":[19,433],"19":[452,452],"20":[1,52],"21":[53,53],"22":[1,52],"23":[53,53],"24":[19,440],"25":[233,0],"26":[0],"27":[196],"28":[0,25],"29":[3],"30":[1,1],"31":[1,1],"32":[3,10],"33":[13,13],"34":[3,10],"35":[13,13],"36":[1,1],"37":[0,4],"38":[4,4],"39":[0,4],"40":[4,4],"41":[0,0],"42":[14],"43":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/gatekeeperClient.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/gatekeeperClient.ts"],"names":[],"mappings":"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","sourcesContent":["import { default as fetchBuilder } from 'fetch-retry';\nimport { RequestInitRetryParams } from 'fetch-retry';\nimport { objectToURLParams } from './utils/url';\nimport { prefixLogger } from './logger';\nimport {\n  FetchWithRetry,\n  GatekeeperAPIStatus,\n  GatekeeperClientConfig,\n  GatekeeperRecordResponse,\n  RequestTokenIssuanceResponse,\n  RequestTokenRefreshResponse,\n  TokenRequest,\n} from './types/gatekeeperApi';\nimport { ChainType } from './types/chain';\n\nexport const GATEKEEPER_BASE_ENDPOINTS: Record<string, string> = {\n  local: `http://localhost:3001/local`,\n  test: `https://dev-gatekeeper-api.civic.com`, // for automated tests\n  dev: `https://dev-gatekeeper-api.civic.com`,\n  preprod: `https://preprod-gatekeeper-api.civic.com`,\n  prod: `https://gatekeeper-api.civic.com`,\n};\n\nconst logDebug = prefixLogger('GatekeeperClient').debug;\nconst logWarn = prefixLogger('GatekeeperClient').warn;\nconst logError = prefixLogger('GatekeeperClient').error;\n\nexport const getGatekeeperEndpoint = (stage: string, chainType: ChainType): string => {\n  let baseUrl = GATEKEEPER_BASE_ENDPOINTS[stage];\n  if (!baseUrl) {\n    logWarn(`No Gatekeeper endpoint for stage ${stage} . Using dev endpoint.`);\n    baseUrl = GATEKEEPER_BASE_ENDPOINTS.dev;\n  }\n  return `${baseUrl}/v1/token/${chainType}`;\n};\n\nexport const isGkApiStatusTokenCreated = (code: number): boolean => code === GatekeeperAPIStatus.ISSUED;\nexport const isGkApiStatusTokenPending = (code: number): boolean => code === GatekeeperAPIStatus.REQUESTED;\nexport const isGkApiStatusRequestedRetriesExhausted = (code: number): boolean =>\n  code === GatekeeperAPIStatus.REQUESTED_RETRIES_EXHAUSTED;\nexport const isGkApiStatusFailure = (code: number): boolean =>\n  !isGkApiStatusTokenPending(code) && !isGkApiStatusRequestedRetriesExhausted(code) && code >= 400;\nexport const withoutUndefined = (obj: Record<string, unknown>): Record<string, unknown> =>\n  Object.fromEntries(Object.entries(obj).filter(([, v]) => v !== undefined));\n\nexport class GatekeeperClient {\n  private abortController: AbortController;\n\n  private baseUrl: string;\n\n  private queryParams: Record<string, string> | undefined;\n\n  private headers: Record<string, string> | undefined;\n\n  private defaultRetryParams: RequestInitRetryParams<typeof fetch>;\n\n  // Fetch can be overridden with a stub for unit tests\n  private fetchImplementation: (input: RequestInfo | URL, init?: RequestInit | undefined) => Promise<Response>;\n\n  private fetchWithRetry: FetchWithRetry;\n\n  constructor(public initConfig: GatekeeperClientConfig, flowId?: string) {\n    this.abortController = initConfig.abortController;\n    this.baseUrl = initConfig.baseUrl || getGatekeeperEndpoint(initConfig.stage, initConfig.chainType);\n    this.queryParams = initConfig.queryParams;\n    this.headers = objectToURLParams({ ...initConfig.headers, 'x-civic-flowid': flowId });\n    this.fetchImplementation = initConfig.fetchImplementation;\n    const retries = initConfig.numRetries;\n    // By default retry on every 5xx or other Error (e.g. network failure):\n    this.defaultRetryParams = {\n      retries,\n      retryOn: async (attempt: number, error: Error | null, response: Response | null): Promise<boolean> => {\n        const body = response ? await response.clone().json() : {};\n        if (response && response.status >= 500) {\n          if (body?.message?.includes('NO_AUTO_RETRY')) {\n            return false;\n          }\n\n          if (attempt >= retries) {\n            logError('retryOn error run out of retries', { error, attempt, retries, response, body });\n            throw error as Error;\n          }\n          logDebug('retrying on 5xx error', { error, attempt, retries, response, body });\n          return true;\n        }\n        logDebug('retryOn returning false as error was not a 5xx error');\n        return false;\n      },\n      retryDelay: (attempt: number): number => {\n        const retryDelay = 10 + 2 ** attempt * 1000; // 10 seconds is the minimum allowed retry time on the GK-API side\n        logDebug('retryDelay', { attempt: attempt + 1, retryDelay });\n        return retryDelay;\n      },\n    };\n\n    this.fetchWithRetry = fetchBuilder(this.fetchImplementation, this.defaultRetryParams);\n  }\n\n  public setFlowId(flowId: string): void {\n    this.headers = objectToURLParams({ ...(this.headers || {}), 'x-civic-flowid': flowId });\n  }\n\n  private instanceName() {\n    return this.queryParams?.gatekeeperNetworkAddress?.substring(0, 6);\n  }\n\n  public abort(): void {\n    logDebug(`abort ${this.queryParams?.gatekeeperNetworkAddress?.substring(0, 6)}`);\n    this.abortController.abort();\n  }\n\n  private addQueryParams(url: URL) {\n    if (!this.queryParams) return;\n    Object.entries(this.queryParams).forEach(([key, value]) => {\n      url.searchParams.append(key, value);\n    });\n  }\n\n  private continueIfNotAborted<T>(fn: () => T): T | null {\n    logDebug(\n      `continueIfNotAborted ${this.instanceName()} this.abortController.signal.aborted: ${\n        this.abortController.signal.aborted\n      }`,\n      this.queryParams\n    );\n    if (!this.abortController.signal.aborted) {\n      return fn();\n    }\n    return null;\n  }\n\n  private urlForWallet(walletAddress: string = this.initConfig.walletAddress): string {\n    const url = new URL(`${this.baseUrl}/${walletAddress}`);\n    this.addQueryParams(url);\n    return url.toString();\n  }\n\n  public async getGatekeeperRecordWithPayload(\n    walletAddress: string = this.initConfig.walletAddress\n  ): Promise<GatekeeperRecordResponse | null> {\n    logDebug(\n      `url: ${this.urlForWallet(\n        walletAddress\n      )} getGatekeeperRecordWithPayload: ${this.instanceName()}  this.abortController.signal.aborted: ${\n        this.abortController.signal.aborted\n      }`\n    );\n    return this.fetchWithRetry(this.urlForWallet(walletAddress), {\n      method: 'GET',\n      headers: this.headers,\n      signal: this.abortController.signal,\n    })\n      .then(\n        this.continueIfNotAborted(() => async (response) => ({\n          state: GatekeeperAPIStatus[GatekeeperAPIStatus[response.status] as keyof typeof GatekeeperAPIStatus],\n          payload: await response.json(),\n        }))\n      )\n      .catch((error) => {\n        if (error.name === 'AbortError') {\n          logDebug('error due to abort controller signal aborted');\n          return null;\n        }\n        throw error;\n      });\n  }\n\n  public async getGatekeeperStatus(\n    walletAddress: string = this.initConfig.walletAddress\n  ): Promise<GatekeeperAPIStatus> {\n    logDebug(\n      `getGatekeeperStatus: ${this.instanceName()}  this.abortController.signal.aborted: ${\n        this.abortController.signal.aborted\n      }`\n    );\n    return this.fetchWithRetry(this.urlForWallet(walletAddress), {\n      method: 'HEAD',\n      headers: this.headers,\n      signal: this.abortController.signal,\n    })\n      .then(\n        this.continueIfNotAborted(\n          () =>\n            ({ status }) =>\n              status\n        )\n      )\n      .catch((error) => {\n        logError('getGatekeeperStatus', error);\n        if (error.name === 'AbortError') {\n          logDebug('error due to abort controller signal aborted');\n          return GatekeeperAPIStatus.SERVER_FAILURE;\n        }\n        throw error;\n      });\n  }\n\n  public async requestGatewayTokenFromGatekeeper({\n    payload,\n    proof,\n    payer,\n  }: TokenRequest): Promise<RequestTokenIssuanceResponse | null> {\n    logDebug(\n      `requestGatewayTokenFromGatekeeper: ${this.instanceName()}  this.abortController.signal.aborted: ${\n        this.abortController.signal.aborted\n      }`,\n      {\n        ...payload,\n        proof,\n      }\n    );\n\n    // We only pass the wallet public key as part of the request if\n    // it was not passed as part of the presentation.\n    const body = withoutUndefined({\n      ...(payload as Record<string, unknown>),\n      proof,\n      address: this.initConfig.walletAddress,\n      payer,\n    });\n    logDebug('requestGatewayTokenFromGatekeeper Requesting a new gatekeeper token...', body);\n\n    const url = new URL(this.baseUrl);\n    this.addQueryParams(url);\n\n    return this.fetchWithRetry(url.toString(), {\n      method: 'POST',\n      headers: {\n        ...this.headers,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(body),\n      signal: this.abortController.signal,\n    })\n      .then(\n        this.continueIfNotAborted(() => async (resp) => {\n          const { status } = resp;\n          const result = (await resp.json()) as unknown as RequestTokenIssuanceResponse;\n          return {\n            ...result,\n            state: GatekeeperAPIStatus[GatekeeperAPIStatus[status] as keyof typeof GatekeeperAPIStatus],\n            status,\n          };\n        })\n      )\n      .catch((error) => {\n        logError('requestGatewayTokenFromGatekeeper', error);\n        if (error.name === 'AbortError') {\n          logDebug('error due to abort controller signal aborted');\n          return null;\n        }\n        throw error;\n      });\n  }\n\n  /**\n   * Tries to refresh a token.\n   * If it fails with a 5xx, handleFetchError will retry a number of times.\n   */\n  public async refreshToken({ payload, proof, payer }: TokenRequest): Promise<RequestTokenRefreshResponse | null> {\n    logDebug(\n      `refreshToken: ${this.urlForWallet(\n        this.initConfig.walletAddress\n      )}${this.queryParams?.gatekeeperNetworkAddress?.substring(0, 6)}  this.abortController.signal.aborted: ${\n        this.abortController.signal.aborted\n      }`,\n      { payload }\n    );\n    const body = withoutUndefined({\n      ...(payload as Record<string, unknown>),\n      proof,\n      request: 'refresh',\n      payer,\n    });\n    return this.fetchWithRetry(this.urlForWallet(this.initConfig.walletAddress), {\n      method: 'PATCH',\n      headers: { ...this.headers, 'Content-Type': 'application/json' },\n      body: JSON.stringify(body),\n      signal: this.abortController.signal,\n    })\n      .then(async (resp) => {\n        const { status } = resp;\n        const result = (await resp.json()) as unknown as RequestTokenRefreshResponse;\n        return {\n          ...result,\n          state: GatekeeperAPIStatus[GatekeeperAPIStatus[status] as keyof typeof GatekeeperAPIStatus],\n          status,\n        };\n      })\n      .catch((error) => {\n        logError('refreshToken', error);\n        if (error.name === 'AbortError') {\n          logDebug('error due to abort controller signal aborted');\n          return null;\n        }\n        throw error;\n      });\n  }\n\n  /**\n   * Tries to fetch a new transaction for any flow\n   * If it fails with a 5xx, handleFetchError will retry a number of times.\n   */\n  public async fetchFreshTransaction({ payer }: TokenRequest): Promise<RequestTokenRefreshResponse | null> {\n    const url = new URL(`${this.baseUrl}/${this.initConfig.walletAddress}/transaction`);\n    this.addQueryParams(url);\n    logDebug(\n      `fetchFreshTransaction: ${url.toString()}${this.queryParams?.gatekeeperNetworkAddress?.substring(\n        0,\n        6\n      )}  this.abortController.signal.aborted: ${this.abortController.signal.aborted}`\n    );\n    const body = withoutUndefined({\n      payer,\n    });\n    return this.fetchWithRetry(`${url.toString()}`, {\n      method: 'POST',\n      headers: { ...this.headers, 'Content-Type': 'application/json' },\n      body: JSON.stringify(body),\n      signal: this.abortController.signal,\n    })\n      .then(async (resp) => {\n        const { status } = resp;\n        const result = (await resp.json()) as unknown as RequestTokenRefreshResponse;\n        return {\n          ...result,\n          state: GatekeeperAPIStatus[GatekeeperAPIStatus[status] as keyof typeof GatekeeperAPIStatus],\n          status,\n        };\n      })\n      .catch((error) => {\n        logError('fetchFreshTransaction', error);\n        if (error.name === 'AbortError') {\n          logDebug('error due to abort controller signal aborted');\n          return null;\n        }\n        throw error;\n      });\n  }\n\n  public async updateTransactionStatus(txId: string, status = 'sent'): Promise<void | null> {\n    const url = new URL(`${this.baseUrl}/${this.initConfig.walletAddress}/transaction/${txId}`);\n    this.addQueryParams(url);\n    const body = { status };\n\n    return this.fetchWithRetry(url.toString(), {\n      method: 'PATCH',\n      headers: {\n        ...this.headers,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(body),\n      signal: this.abortController.signal,\n    })\n      .then(\n        this.continueIfNotAborted(() => async () => {\n          logDebug('updateTransactionStatus successful', {\n            txId,\n            url,\n            wallet: this.initConfig.walletAddress,\n          });\n        })\n      )\n      .catch((error) => {\n        if (error.name === 'AbortError') {\n          logDebug('error due to abort controller signal aborted');\n          return null;\n        }\n        logError('updateTransactionStatus', error);\n        throw error;\n      });\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"877476efdd828c40c1d2f0f7f9bc940ec82af208"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/url.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/url.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":35}},"2":{"start":{"line":4,"column":26},"end":{"line":15,"column":8}},"3":{"start":{"line":4,"column":35},"end":{"line":15,"column":8}},"4":{"start":{"line":6,"column":8},"end":{"line":12,"column":9}},"5":{"start":{"line":11,"column":12},"end":{"line":11,"column":21}},"6":{"start":{"line":13,"column":8},"end":{"line":13,"column":43}},"7":{"start":{"line":16,"column":0},"end":{"line":16,"column":46}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":26},"end":{"line":4,"column":27}},"loc":{"start":{"line":4,"column":35},"end":{"line":15,"column":8}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":5,"column":33},"end":{"line":5,"column":34}},"loc":{"start":{"line":5,"column":48},"end":{"line":14,"column":5}},"line":5}},"branchMap":{"0":{"loc":{"start":{"line":4,"column":35},"end":{"line":15,"column":8}},"type":"cond-expr","locations":[{"start":{"line":5,"column":6},"end":{"line":14,"column":10}},{"start":{"line":15,"column":6},"end":{"line":15,"column":8}}],"line":4},"1":{"loc":{"start":{"line":6,"column":8},"end":{"line":12,"column":9}},"type":"if","locations":[{"start":{"line":6,"column":8},"end":{"line":12,"column":9}},{"start":{"line":6,"column":8},"end":{"line":12,"column":9}}],"line":6},"2":{"loc":{"start":{"line":6,"column":12},"end":{"line":10,"column":20}},"type":"binary-expr","locations":[{"start":{"line":6,"column":12},"end":{"line":6,"column":27}},{"start":{"line":7,"column":12},"end":{"line":7,"column":22}},{"start":{"line":8,"column":13},"end":{"line":8,"column":31}},{"start":{"line":8,"column":35},"end":{"line":8,"column":49}},{"start":{"line":9,"column":13},"end":{"line":9,"column":32}},{"start":{"line":9,"column":36},"end":{"line":9,"column":63}},{"start":{"line":10,"column":12},"end":{"line":10,"column":20}}],"line":6}},"s":{"0":1,"1":1,"2":1,"3":1067,"4":14990,"5":5147,"6":9843,"7":1},"f":{"0":1067,"1":14990},"b":{"0":[1066,1],"1":[5147,9843],"2":[14990,9846,9843,1,9843,1,9843]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/url.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/url.ts"],"names":[],"mappings":";;;AAMO,MAAM,iBAAiB,GAAG,CAAC,GAAwC,EAA0B,EAAE,CACpG,GAAG;IACD,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE;QACvC,IACE,CAAC,KAAK,SAAS;YACf,CAAC,KAAK,IAAI;YACV,CAAC,CAAC,YAAY,KAAK,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC;YACtC,CAAC,CAAC,YAAY,MAAM,IAAI,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC;YACpD,CAAC,KAAK,EAAE,EACR,CAAC;YACD,OAAO,CAAC,CAAC;QACX,CAAC;QACD,OAAO,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC;IACrC,CAAC,EAAE,EAAE,CAAC;IACR,CAAC,CAAC,EAAE,CAAC;AAdI,QAAA,iBAAiB,qBAcrB","sourcesContent":["/**\n * Prepare an object to be sent as URL params, which expects a string value for any object keys\n * any null or empty values should be removed\n * @param Record<string, unknown>\n * @returns Record<string, string>\n */\nexport const objectToURLParams = (obj: Record<string, unknown> | undefined): Record<string, string> =>\n  obj\n    ? Object.entries(obj).reduce((a, [k, v]) => {\n        if (\n          v === undefined ||\n          v === null ||\n          (v instanceof Array && v.length === 0) ||\n          (v instanceof Object && Object.keys(v).length === 0) ||\n          v === ''\n        ) {\n          return a;\n        }\n        return { ...a, [k]: v.toString() }; // Convert to string as needed\n      }, {})\n    : {};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"70319d4b0625825dd207af364c9488e2b2ced2ac"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/index.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/index.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":30}},"4":{"start":{"line":7,"column":23},"end":{"line":7,"column":65}},"5":{"start":{"line":8,"column":26},"end":{"line":8,"column":54}},"6":{"start":{"line":9,"column":20},"end":{"line":9,"column":87}},"7":{"start":{"line":10,"column":20},"end":{"line":10,"column":136}},"8":{"start":{"line":10,"column":46},"end":{"line":10,"column":136}},"9":{"start":{"line":10,"column":71},"end":{"line":10,"column":136}},"10":{"start":{"line":11,"column":20},"end":{"line":11,"column":136}},"11":{"start":{"line":11,"column":46},"end":{"line":11,"column":136}},"12":{"start":{"line":11,"column":71},"end":{"line":11,"column":136}},"13":{"start":{"line":12,"column":19},"end":{"line":12,"column":134}},"14":{"start":{"line":12,"column":45},"end":{"line":12,"column":134}},"15":{"start":{"line":12,"column":70},"end":{"line":12,"column":134}},"16":{"start":{"line":13,"column":19},"end":{"line":13,"column":134}},"17":{"start":{"line":13,"column":45},"end":{"line":13,"column":134}},"18":{"start":{"line":13,"column":70},"end":{"line":13,"column":134}},"19":{"start":{"line":14,"column":21},"end":{"line":22,"column":1}},"20":{"start":{"line":15,"column":4},"end":{"line":21,"column":6}},"21":{"start":{"line":16,"column":45},"end":{"line":16,"column":209}},"22":{"start":{"line":23,"column":0},"end":{"line":23,"column":36}},"23":{"start":{"line":24,"column":0},"end":{"line":24,"column":30}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":20},"end":{"line":10,"column":21}},"loc":{"start":{"line":10,"column":46},"end":{"line":10,"column":136}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":10,"column":46},"end":{"line":10,"column":47}},"loc":{"start":{"line":10,"column":71},"end":{"line":10,"column":136}},"line":10},"3":{"name":"(anonymous_3)","decl":{"start":{"line":11,"column":20},"end":{"line":11,"column":21}},"loc":{"start":{"line":11,"column":46},"end":{"line":11,"column":136}},"line":11},"4":{"name":"(anonymous_4)","decl":{"start":{"line":11,"column":46},"end":{"line":11,"column":47}},"loc":{"start":{"line":11,"column":71},"end":{"line":11,"column":136}},"line":11},"5":{"name":"(anonymous_5)","decl":{"start":{"line":12,"column":19},"end":{"line":12,"column":20}},"loc":{"start":{"line":12,"column":45},"end":{"line":12,"column":134}},"line":12},"6":{"name":"(anonymous_6)","decl":{"start":{"line":12,"column":45},"end":{"line":12,"column":46}},"loc":{"start":{"line":12,"column":70},"end":{"line":12,"column":134}},"line":12},"7":{"name":"(anonymous_7)","decl":{"start":{"line":13,"column":19},"end":{"line":13,"column":20}},"loc":{"start":{"line":13,"column":45},"end":{"line":13,"column":134}},"line":13},"8":{"name":"(anonymous_8)","decl":{"start":{"line":13,"column":45},"end":{"line":13,"column":46}},"loc":{"start":{"line":13,"column":70},"end":{"line":13,"column":134}},"line":13},"9":{"name":"(anonymous_9)","decl":{"start":{"line":14,"column":21},"end":{"line":14,"column":22}},"loc":{"start":{"line":14,"column":69},"end":{"line":22,"column":1}},"line":14},"10":{"name":"(anonymous_10)","decl":{"start":{"line":16,"column":21},"end":{"line":16,"column":22}},"loc":{"start":{"line":16,"column":35},"end":{"line":16,"column":211}},"line":16}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":10,"column":56},"end":{"line":10,"column":66}},"type":"default-arg","locations":[{"start":{"line":10,"column":62},"end":{"line":10,"column":66}}],"line":10},"4":{"loc":{"start":{"line":11,"column":56},"end":{"line":11,"column":66}},"type":"default-arg","locations":[{"start":{"line":11,"column":62},"end":{"line":11,"column":66}}],"line":11},"5":{"loc":{"start":{"line":12,"column":55},"end":{"line":12,"column":65}},"type":"default-arg","locations":[{"start":{"line":12,"column":61},"end":{"line":12,"column":65}}],"line":12},"6":{"loc":{"start":{"line":13,"column":55},"end":{"line":13,"column":65}},"type":"default-arg","locations":[{"start":{"line":13,"column":61},"end":{"line":13,"column":65}}],"line":13},"7":{"loc":{"start":{"line":14,"column":30},"end":{"line":14,"column":64}},"type":"default-arg","locations":[{"start":{"line":14,"column":45},"end":{"line":14,"column":64}}],"line":14},"8":{"loc":{"start":{"line":16,"column":52},"end":{"line":16,"column":208}},"type":"cond-expr","locations":[{"start":{"line":16,"column":169},"end":{"line":16,"column":175}},{"start":{"line":16,"column":178},"end":{"line":16,"column":208}}],"line":16},"9":{"loc":{"start":{"line":16,"column":52},"end":{"line":16,"column":166}},"type":"binary-expr","locations":[{"start":{"line":16,"column":52},"end":{"line":16,"column":149}},{"start":{"line":16,"column":153},"end":{"line":16,"column":166}}],"line":16},"10":{"loc":{"start":{"line":16,"column":58},"end":{"line":16,"column":139}},"type":"cond-expr","locations":[{"start":{"line":16,"column":107},"end":{"line":16,"column":113}},{"start":{"line":16,"column":116},"end":{"line":16,"column":139}}],"line":16},"11":{"loc":{"start":{"line":16,"column":58},"end":{"line":16,"column":104}},"type":"binary-expr","locations":[{"start":{"line":16,"column":58},"end":{"line":16,"column":78}},{"start":{"line":16,"column":82},"end":{"line":16,"column":104}}],"line":16}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":745,"9":3715,"10":1,"11":745,"12":136,"13":1,"14":745,"15":2,"16":1,"17":745,"18":313,"19":1,"20":745,"21":104,"22":1,"23":1},"f":{"0":1,"1":745,"2":3715,"3":745,"4":136,"5":745,"6":2,"7":745,"8":313,"9":745,"10":104},"b":{"0":[1,1,1],"1":[1,0],"2":[1,1],"3":[1045],"4":[8],"5":[2],"6":[109],"7":[745],"8":[0,104],"9":[104,104],"10":[0,104],"11":[104,104]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/index.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/index.ts"],"names":[],"mappings":";;;;;;AACA,kEAAsC;AACtC,uDAAsE;AAEtE,MAAM,WAAW,GAAqB,IAAI,iCAAe,CAAC,IAAI,sBAAQ,EAAE,CAAC,CAAC;AAE1E,MAAM,WAAW,GACf,CAAC,MAAc,EAAE,YAAoB,EAAE,EAAE,CACzC,CAAC,OAAe,EAAE,MAAe,IAAI,EAAE,EAAE,CACvC,WAAW,CAAC,KAAK,CAAC,IAAI,YAAY,KAAK,MAAM,KAAK,OAAO,EAAE,EAAE,GAAG,CAAC,CAAC;AACtE,MAAM,WAAW,GACf,CAAC,MAAc,EAAE,YAAoB,EAAE,EAAE,CACzC,CAAC,OAAe,EAAE,MAAe,IAAI,EAAE,EAAE,CACvC,WAAW,CAAC,KAAK,CAAC,IAAI,YAAY,KAAK,MAAM,KAAK,OAAO,EAAE,EAAE,GAAG,CAAC,CAAC;AACtE,MAAM,UAAU,GACd,CAAC,MAAc,EAAE,YAAoB,EAAE,EAAE,CACzC,CAAC,OAAe,EAAE,MAAe,IAAI,EAAE,EAAE,CACvC,WAAW,CAAC,IAAI,CAAC,IAAI,YAAY,KAAK,MAAM,KAAK,OAAO,EAAE,EAAE,GAAG,CAAC,CAAC;AACrE,MAAM,UAAU,GACd,CAAC,MAAc,EAAE,YAAoB,EAAE,EAAE,CACzC,CAAC,OAAe,EAAE,MAAe,IAAI,EAAE,EAAE,CACvC,WAAW,CAAC,IAAI,CAAC,IAAI,YAAY,KAAK,MAAM,KAAK,OAAO,EAAE,EAAE,GAAG,CAAC,CAAC;AAE9D,MAAM,YAAY,GAAG,CAAC,MAAc,EAAE,YAAY,GAAG,mBAAmB,EAAoB,EAAE;IACnG,OAAO;QACL,WAAW,EAAE,CAAC,QAAkB,EAAE,EAAE,WAAC,OAAA,MAAA,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,WAAW,4DAAG,QAAQ,CAAC,CAAA,EAAA;QACzE,KAAK,EAAE,WAAW,CAAC,MAAM,EAAE,YAAY,CAAC;QACxC,KAAK,EAAE,WAAW,CAAC,MAAM,EAAE,YAAY,CAAC;QACxC,IAAI,EAAE,UAAU,CAAC,MAAM,EAAE,YAAY,CAAC;QACtC,IAAI,EAAE,UAAU,CAAC,MAAM,EAAE,YAAY,CAAC;KACvC,CAAC;AACJ,CAAC,CAAC;AARW,QAAA,YAAY,gBAQvB;AACF,kBAAe,WAAW,CAAC","sourcesContent":["import { LogLevel } from '../../src/types/log';\nimport LogLocal from './local.logger';\nimport { LoggingInterface, LoggingProvider } from './provider.logger';\n\nconst localLogger: LoggingInterface = new LoggingProvider(new LogLocal());\n\nconst prefixDebug =\n  (prefix: string, globalPrefix: string) =>\n  (message: string, obj: unknown = null) =>\n    localLogger.debug(`[${globalPrefix}][${prefix}] ${message}`, obj);\nconst prefixError =\n  (prefix: string, globalPrefix: string) =>\n  (message: string, obj: unknown = null) =>\n    localLogger.error(`[${globalPrefix}][${prefix}] ${message}`, obj);\nconst prefixWarn =\n  (prefix: string, globalPrefix: string) =>\n  (message: string, obj: unknown = null) =>\n    localLogger.warn(`[${globalPrefix}][${prefix}] ${message}`, obj);\nconst prefixInfo =\n  (prefix: string, globalPrefix: string) =>\n  (message: string, obj: unknown = null) =>\n    localLogger.info(`[${globalPrefix}][${prefix}] ${message}`, obj);\n\nexport const prefixLogger = (prefix: string, globalPrefix = 'GatewayClientCore'): LoggingInterface => {\n  return {\n    setLogLevel: (logLevel: LogLevel) => localLogger?.setLogLevel?.(logLevel),\n    debug: prefixDebug(prefix, globalPrefix),\n    error: prefixError(prefix, globalPrefix),\n    warn: prefixWarn(prefix, globalPrefix),\n    info: prefixInfo(prefix, globalPrefix),\n  };\n};\nexport default localLogger;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"634f2fb8ebc283e0cefdfa805bf6986c247d1b98"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/local.logger.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/local.logger.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":26},"end":{"line":3,"column":54}},"2":{"start":{"line":4,"column":34},"end":{"line":11,"column":1}},"3":{"start":{"line":5,"column":4},"end":{"line":10,"column":5}},"4":{"start":{"line":6,"column":8},"end":{"line":6,"column":32}},"5":{"start":{"line":9,"column":8},"end":{"line":9,"column":24}},"6":{"start":{"line":14,"column":8},"end":{"line":14,"column":33}},"7":{"start":{"line":17,"column":8},"end":{"line":17,"column":33}},"8":{"start":{"line":20,"column":8},"end":{"line":20,"column":70}},"9":{"start":{"line":23,"column":8},"end":{"line":23,"column":69}},"10":{"start":{"line":26,"column":8},"end":{"line":26,"column":69}},"11":{"start":{"line":29,"column":8},"end":{"line":29,"column":73}},"12":{"start":{"line":32,"column":0},"end":{"line":32,"column":27}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":34},"end":{"line":4,"column":35}},"loc":{"start":{"line":4,"column":63},"end":{"line":11,"column":1}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":64},"end":{"line":15,"column":5}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":4},"end":{"line":16,"column":5}},"loc":{"start":{"line":16,"column":26},"end":{"line":18,"column":5}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":27},"end":{"line":21,"column":5}},"line":19},"4":{"name":"(anonymous_4)","decl":{"start":{"line":22,"column":4},"end":{"line":22,"column":5}},"loc":{"start":{"line":22,"column":26},"end":{"line":24,"column":5}},"line":22},"5":{"name":"(anonymous_5)","decl":{"start":{"line":25,"column":4},"end":{"line":25,"column":5}},"loc":{"start":{"line":25,"column":26},"end":{"line":27,"column":5}},"line":25},"6":{"name":"(anonymous_6)","decl":{"start":{"line":28,"column":4},"end":{"line":28,"column":5}},"loc":{"start":{"line":28,"column":30},"end":{"line":30,"column":5}},"line":28}},"branchMap":{"0":{"loc":{"start":{"line":5,"column":4},"end":{"line":10,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":10,"column":5}},{"start":{"line":5,"column":4},"end":{"line":10,"column":5}}],"line":5},"1":{"loc":{"start":{"line":13,"column":16},"end":{"line":13,"column":62}},"type":"default-arg","locations":[{"start":{"line":13,"column":27},"end":{"line":13,"column":62}}],"line":13}},"s":{"0":1,"1":1,"2":1,"3":477,"4":336,"5":141,"6":13,"7":8,"8":3,"9":316,"10":6,"11":152,"12":1},"f":{"0":477,"1":13,"2":8,"3":3,"4":316,"5":6,"6":152},"b":{"0":[336,141],"1":[12]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/local.logger.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/local.logger.ts"],"names":[],"mappings":";;AACA,uDAAuE;AAEvE,MAAM,yBAAyB,GAAG,CAChC,MAAmD,EACnD,OAAe,EACf,MAAgB,EAChB,EAAE;IACF,IAAI,MAAM,EAAE,CAAC;QACX,MAAM,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IAC1B,CAAC;SAAM,CAAC;QACN,MAAM,CAAC,OAAO,CAAC,CAAC;IAClB,CAAC;AACH,CAAC,CAAC;AAEF,MAAM,QAAS,SAAQ,iCAAe;IACpC,YAAY,WAAqB,mCAAiB;QAChD,KAAK,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;IAC3B,CAAC;IAED,WAAW,CAAC,QAAkB;QAC5B,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;IAC3B,CAAC;IAED,KAAK,CAAC,OAAe,EAAE,MAAgB;QACrC,yBAAyB,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;IAChE,CAAC;IAED,IAAI,CAAC,OAAe,EAAE,MAAgB;QACpC,yBAAyB,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;IAC/D,CAAC;IAED,IAAI,CAAC,OAAe,EAAE,MAAgB;QACpC,yBAAyB,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;IAC/D,CAAC;IAED,KAAK,CAAC,OAAe,EAAE,SAAmB;QACxC,yBAAyB,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;IACnE,CAAC;CACF;AAED,kBAAe,QAAQ,CAAC","sourcesContent":["import { LogLevel } from '../../src/types/log';\nimport { DEFAULT_LOG_LEVEL, LoggingProvider } from './provider.logger';\n\nconst consoleWithOptionalObject = (\n  method: (message: string, object?: unknown) => void,\n  message: string,\n  object?: unknown\n) => {\n  if (object) {\n    method(message, object);\n  } else {\n    method(message);\n  }\n};\n\nclass LogLocal extends LoggingProvider {\n  constructor(logLevel: LogLevel = DEFAULT_LOG_LEVEL) {\n    super(console, logLevel);\n  }\n\n  setLogLevel(logLevel: LogLevel): void {\n    this.logLevel = logLevel;\n  }\n\n  debug(message: string, object?: unknown): void {\n    consoleWithOptionalObject(this.logger.debug, message, object);\n  }\n\n  info(message: string, object?: unknown): void {\n    consoleWithOptionalObject(this.logger.info, message, object);\n  }\n\n  warn(message: string, object?: unknown): void {\n    consoleWithOptionalObject(this.logger.warn, message, object);\n  }\n\n  error(message: string, exception?: unknown): void {\n    consoleWithOptionalObject(this.logger.error, message, exception);\n  }\n}\n\nexport default LogLocal;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"97e34b338819b49a7d70babd6530064cb7ef7627"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/provider.logger.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/provider.logger.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":84}},"2":{"start":{"line":4,"column":14},"end":{"line":4,"column":37}},"3":{"start":{"line":5,"column":18},"end":{"line":5,"column":104}},"4":{"start":{"line":6,"column":21},"end":{"line":6,"column":117}},"5":{"start":{"line":6,"column":52},"end":{"line":6,"column":117}},"6":{"start":{"line":7,"column":0},"end":{"line":7,"column":36}},"7":{"start":{"line":8,"column":0},"end":{"line":8,"column":48}},"8":{"start":{"line":11,"column":8},"end":{"line":11,"column":29}},"9":{"start":{"line":12,"column":8},"end":{"line":12,"column":33}},"10":{"start":{"line":15,"column":8},"end":{"line":15,"column":33}},"11":{"start":{"line":18,"column":8},"end":{"line":19,"column":47}},"12":{"start":{"line":19,"column":12},"end":{"line":19,"column":47}},"13":{"start":{"line":22,"column":8},"end":{"line":23,"column":46}},"14":{"start":{"line":23,"column":12},"end":{"line":23,"column":46}},"15":{"start":{"line":26,"column":8},"end":{"line":27,"column":46}},"16":{"start":{"line":27,"column":12},"end":{"line":27,"column":46}},"17":{"start":{"line":30,"column":8},"end":{"line":31,"column":50}},"18":{"start":{"line":31,"column":12},"end":{"line":31,"column":50}},"19":{"start":{"line":34,"column":0},"end":{"line":34,"column":42}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":21},"end":{"line":6,"column":22}},"loc":{"start":{"line":6,"column":52},"end":{"line":6,"column":117}},"line":6},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":4},"end":{"line":10,"column":5}},"loc":{"start":{"line":10,"column":62},"end":{"line":13,"column":5}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":26},"end":{"line":16,"column":5}},"line":14},"3":{"name":"(anonymous_3)","decl":{"start":{"line":17,"column":4},"end":{"line":17,"column":5}},"loc":{"start":{"line":17,"column":27},"end":{"line":20,"column":5}},"line":17},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":26},"end":{"line":24,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":25,"column":4},"end":{"line":25,"column":5}},"loc":{"start":{"line":25,"column":26},"end":{"line":28,"column":5}},"line":25},"6":{"name":"(anonymous_6)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":30},"end":{"line":32,"column":5}},"line":29}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":24},"end":{"line":10,"column":60}},"type":"default-arg","locations":[{"start":{"line":10,"column":35},"end":{"line":10,"column":60}}],"line":10},"1":{"loc":{"start":{"line":18,"column":8},"end":{"line":19,"column":47}},"type":"if","locations":[{"start":{"line":18,"column":8},"end":{"line":19,"column":47}},{"start":{"line":18,"column":8},"end":{"line":19,"column":47}}],"line":18},"2":{"loc":{"start":{"line":22,"column":8},"end":{"line":23,"column":46}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":23,"column":46}},{"start":{"line":22,"column":8},"end":{"line":23,"column":46}}],"line":22},"3":{"loc":{"start":{"line":26,"column":8},"end":{"line":27,"column":46}},"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":27,"column":46}},{"start":{"line":26,"column":8},"end":{"line":27,"column":46}}],"line":26},"4":{"loc":{"start":{"line":30,"column":8},"end":{"line":31,"column":50}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":31,"column":50}},{"start":{"line":30,"column":8},"end":{"line":31,"column":50}}],"line":30}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":4218,"6":1,"7":1,"8":19,"9":19,"10":112,"11":3738,"12":1,"13":319,"14":318,"15":7,"16":7,"17":154,"18":154,"19":1},"f":{"0":4218,"1":19,"2":112,"3":3738,"4":319,"5":7,"6":154},"b":{"0":[4],"1":[1,3737],"2":[318,1],"3":[7,0],"4":[154,0]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/provider.logger.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/logger/provider.logger.ts"],"names":[],"mappings":";;;AAAA,sCAAwC;AAUxC,MAAM,SAAS,GAAG,CAAC,cAAQ,CAAC,KAAK,EAAE,cAAQ,CAAC,IAAI,EAAE,cAAQ,CAAC,IAAI,EAAE,cAAQ,CAAC,KAAK,CAAC,CAAC;AAE1E,MAAM,YAAY,GAAG,CAAC,eAAyB,EAAE,QAAkB,EAAW,EAAE,CACrF,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,SAAS,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;AADvD,QAAA,YAAY,gBAC2C;AAEvD,QAAA,iBAAiB,GAAG,cAAQ,CAAC,IAAI,CAAC;AAE/C,MAAa,eAAe;IAK1B,YAAY,MAAwB,EAAE,QAAQ,GAAG,yBAAiB;QAChE,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;IAC3B,CAAC;IAED,WAAW,CAAC,QAAkB;QAC5B,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;IAC3B,CAAC;IAED,KAAK,CAAC,OAAe,EAAE,MAAgB;QACrC,IAAI,IAAA,oBAAY,EAAC,IAAI,CAAC,QAAQ,EAAE,cAAQ,CAAC,KAAK,CAAC;YAAE,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IACtF,CAAC;IAED,IAAI,CAAC,OAAe,EAAE,MAAgB;QACpC,IAAI,IAAA,oBAAY,EAAC,IAAI,CAAC,QAAQ,EAAE,cAAQ,CAAC,IAAI,CAAC;YAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IACpF,CAAC;IAED,IAAI,CAAC,OAAe,EAAE,MAAgB;QACpC,IAAI,IAAA,oBAAY,EAAC,IAAI,CAAC,QAAQ,EAAE,cAAQ,CAAC,IAAI,CAAC;YAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IACpF,CAAC;IAED,KAAK,CAAC,OAAe,EAAE,SAAmB;QACxC,IAAI,IAAA,oBAAY,EAAC,IAAI,CAAC,QAAQ,EAAE,cAAQ,CAAC,KAAK,CAAC;YAAE,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;IACzF,CAAC;CACF;AA7BD,0CA6BC","sourcesContent":["import { LogLevel } from '../types/log';\n\nexport interface LoggingInterface {\n  setLogLevel?: (logLevel: LogLevel) => void;\n  debug: (message: string, object?: unknown) => void;\n  info: (message: string, object?: unknown) => void;\n  warn: (message: string, object?: unknown) => void;\n  error: (message: string, exception?: unknown) => void;\n}\n\nconst logLevels = [LogLevel.DEBUG, LogLevel.INFO, LogLevel.WARN, LogLevel.ERROR];\n\nexport const allowLogging = (atLeastlogLevel: LogLevel, logLevel: LogLevel): boolean =>\n  logLevels.indexOf(logLevel) >= logLevels.indexOf(atLeastlogLevel);\n\nexport const DEFAULT_LOG_LEVEL = LogLevel.INFO;\n\nexport class LoggingProvider implements LoggingInterface {\n  logger: LoggingInterface;\n\n  logLevel: LogLevel;\n\n  constructor(logger: LoggingInterface, logLevel = DEFAULT_LOG_LEVEL) {\n    this.logger = logger;\n    this.logLevel = logLevel;\n  }\n\n  setLogLevel(logLevel: LogLevel): void {\n    this.logLevel = logLevel;\n  }\n\n  debug(message: string, object?: unknown): void {\n    if (allowLogging(this.logLevel, LogLevel.DEBUG)) this.logger.debug(message, object);\n  }\n\n  info(message: string, object?: unknown): void {\n    if (allowLogging(this.logLevel, LogLevel.INFO)) this.logger.info(message, object);\n  }\n\n  warn(message: string, object?: unknown): void {\n    if (allowLogging(this.logLevel, LogLevel.WARN)) this.logger.warn(message, object);\n  }\n\n  error(message: string, exception?: unknown): void {\n    if (allowLogging(this.logLevel, LogLevel.ERROR)) this.logger.error(message, exception);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"69a23ff8896e0135baf90a88e30e00b1a6c7bd0c"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/log.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/log.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":26}},"2":{"start":{"line":5,"column":0},"end":{"line":10,"column":51}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":32}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":30}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":30}},"6":{"start":{"line":9,"column":4},"end":{"line":9,"column":32}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":21},"end":{"line":10,"column":1}},"line":5}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":3},"end":{"line":10,"column":49}},"type":"binary-expr","locations":[{"start":{"line":10,"column":3},"end":{"line":10,"column":11}},{"start":{"line":10,"column":16},"end":{"line":10,"column":48}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1},"f":{"0":1},"b":{"0":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/log.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/log.ts"],"names":[],"mappings":";;;AAAA,IAAY,QAKX;AALD,WAAY,QAAQ;IAClB,2BAAe,CAAA;IACf,yBAAa,CAAA;IACb,yBAAa,CAAA;IACb,2BAAe,CAAA;AACjB,CAAC,EALW,QAAQ,wBAAR,QAAQ,QAKnB","sourcesContent":["export enum LogLevel {\n  DEBUG = 'debug',\n  INFO = 'info',\n  WARN = 'warn',\n  ERROR = 'error',\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5e2bc4ca3a2b7a828f04e3082805052b67066ae1"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/gatekeeperApi.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/gatekeeperApi.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":37}},"2":{"start":{"line":5,"column":0},"end":{"line":19,"column":84}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":78}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":86}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":78}},"6":{"start":{"line":9,"column":4},"end":{"line":9,"column":72}},"7":{"start":{"line":10,"column":4},"end":{"line":10,"column":110}},"8":{"start":{"line":11,"column":4},"end":{"line":11,"column":88}},"9":{"start":{"line":12,"column":4},"end":{"line":12,"column":104}},"10":{"start":{"line":13,"column":4},"end":{"line":13,"column":76}},"11":{"start":{"line":14,"column":4},"end":{"line":14,"column":94}},"12":{"start":{"line":15,"column":4},"end":{"line":15,"column":118}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":108}},"14":{"start":{"line":17,"column":4},"end":{"line":17,"column":88}},"15":{"start":{"line":18,"column":4},"end":{"line":18,"column":114}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":32},"end":{"line":19,"column":1}},"line":5}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":3},"end":{"line":19,"column":82}},"type":"binary-expr","locations":[{"start":{"line":19,"column":3},"end":{"line":19,"column":22}},{"start":{"line":19,"column":27},"end":{"line":19,"column":81}}],"line":19}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1},"f":{"0":1},"b":{"0":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/gatekeeperApi.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/gatekeeperApi.ts"],"names":[],"mappings":";;;AAGA,IAAY,mBAcX;AAdD,WAAY,mBAAmB;IAC7B,yEAAc,CAAA;IACd,iFAAmB,CAAA;IACnB,yEAAe,CAAA;IACf,mEAAY,CAAA;IACZ,yGAA+B,CAAA;IAC/B,mFAAoB,CAAA;IACpB,mGAA4B,CAAA;IAC5B,uEAAc,CAAA;IACd,yFAAuB,CAAA;IACvB,iHAAmC,CAAA;IACnC,uGAA8B,CAAA;IAC9B,mFAAoB,CAAA;IACpB,6GAAiC,CAAA;AACnC,CAAC,EAdW,mBAAmB,mCAAnB,mBAAmB,QAc9B","sourcesContent":["import { RequestInitRetryParams } from 'fetch-retry';\nimport { ChainType } from './chain';\n\nexport enum GatekeeperAPIStatus {\n  REQUESTING = 0,\n  NOT_REQUESTED = 404,\n  REQUESTED = 202,\n  ISSUED = 200,\n  ISSUED_EXPIRY_APPROACHING = 205,\n  ISSUED_EXPIRED = 426,\n  LOCATION_NOT_SUPPORTED = 401,\n  REJECTED = 403,\n  VPN_NOT_SUPPORTED = 421,\n  ISSUED_LOCATION_NOT_SUPPORTED = 412,\n  ISSUED_VPN_NOT_SUPPORTED = 451,\n  SERVER_FAILURE = 500,\n  REQUESTED_RETRIES_EXHAUSTED = 408,\n}\n\nexport type TokenRequest = {\n  payload: Record<string, unknown>;\n  proof?: string;\n  payer?: string;\n};\n\nexport type GatekeeperClientConfig = {\n  baseUrl?: string; // If not passed in, this will be taken from the stage-based config in gatekeeperClient.ts\n  queryParams?: Record<string, string>;\n  headers?: Record<string, string>;\n  stage: string;\n  fetchImplementation: (input: RequestInfo | URL, init?: RequestInit | undefined) => Promise<Response>;\n  numRetries: number;\n  walletAddress: string;\n  chainType: ChainType;\n  abortController: AbortController;\n};\n\nexport type PendingPayload = {\n  presentationRequestId: string;\n};\n\nexport type GatekeeperErrorResponse = {\n  errorCode?: string;\n  payload?: Record<string, unknown>;\n};\n\nexport type GatekeeperRecordResponse = GatekeeperErrorResponse & {\n  state: GatekeeperAPIStatus;\n  transaction?: string;\n  presentationRequestId?: string;\n  preApprovedTxAvailable?: boolean;\n  credentialExpired?: boolean;\n  pending?: { presentationRequestId: string };\n  feeAmountUSDCents?: number;\n};\n\nexport type RequestTokenIssuanceResponse = GatekeeperRecordResponse & {\n  status: number;\n};\n\nexport type RequestTokenRefreshResponse = RequestTokenIssuanceResponse;\n\nexport type FetchWithRetry = (\n  input: RequestInfo,\n  init?: (RequestInit & RequestInitRetryParams<typeof fetch>) | undefined\n) => Promise<Response>;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"151699a7276c4b10d03c27d300802bb73317617f"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/chain.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/chain.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":90}},"2":{"start":{"line":5,"column":0},"end":{"line":9,"column":42}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":31}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":33}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":31}},"6":{"start":{"line":11,"column":0},"end":{"line":17,"column":57}},"7":{"start":{"line":12,"column":4},"end":{"line":12,"column":42}},"8":{"start":{"line":13,"column":4},"end":{"line":13,"column":36}},"9":{"start":{"line":14,"column":4},"end":{"line":14,"column":38}},"10":{"start":{"line":15,"column":4},"end":{"line":15,"column":36}},"11":{"start":{"line":16,"column":4},"end":{"line":16,"column":40}},"12":{"start":{"line":19,"column":0},"end":{"line":24,"column":54}},"13":{"start":{"line":20,"column":4},"end":{"line":20,"column":35}},"14":{"start":{"line":21,"column":4},"end":{"line":21,"column":39}},"15":{"start":{"line":22,"column":4},"end":{"line":22,"column":35}},"16":{"start":{"line":23,"column":4},"end":{"line":23,"column":29}},"17":{"start":{"line":26,"column":0},"end":{"line":29,"column":72}},"18":{"start":{"line":27,"column":4},"end":{"line":27,"column":72}},"19":{"start":{"line":28,"column":4},"end":{"line":28,"column":64}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":18},"end":{"line":9,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":1},"end":{"line":11,"column":2}},"loc":{"start":{"line":11,"column":23},"end":{"line":17,"column":1}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":1},"end":{"line":19,"column":2}},"loc":{"start":{"line":19,"column":22},"end":{"line":24,"column":1}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":26,"column":1},"end":{"line":26,"column":2}},"loc":{"start":{"line":26,"column":28},"end":{"line":29,"column":1}},"line":26}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":3},"end":{"line":9,"column":40}},"type":"binary-expr","locations":[{"start":{"line":9,"column":3},"end":{"line":9,"column":8}},{"start":{"line":9,"column":13},"end":{"line":9,"column":39}}],"line":9},"1":{"loc":{"start":{"line":17,"column":3},"end":{"line":17,"column":55}},"type":"binary-expr","locations":[{"start":{"line":17,"column":3},"end":{"line":17,"column":13}},{"start":{"line":17,"column":18},"end":{"line":17,"column":54}}],"line":17},"2":{"loc":{"start":{"line":24,"column":3},"end":{"line":24,"column":52}},"type":"binary-expr","locations":[{"start":{"line":24,"column":3},"end":{"line":24,"column":12}},{"start":{"line":24,"column":17},"end":{"line":24,"column":51}}],"line":24},"3":{"loc":{"start":{"line":29,"column":3},"end":{"line":29,"column":70}},"type":"binary-expr","locations":[{"start":{"line":29,"column":3},"end":{"line":29,"column":18}},{"start":{"line":29,"column":23},"end":{"line":29,"column":69}}],"line":29}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1},"f":{"0":1,"1":1,"2":1,"3":1},"b":{"0":[1,1],"1":[1,1],"2":[1,1],"3":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/chain.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/chain.ts"],"names":[],"mappings":";;;AAEA,IAAY,KAIX;AAJD,WAAY,KAAK;IACf,0BAAiB,CAAA;IACjB,4BAAmB,CAAA;IACnB,0BAAiB,CAAA;AACnB,CAAC,EAJW,KAAK,qBAAL,KAAK,QAIhB;AAWD,IAAY,UAMX;AAND,WAAY,UAAU;IACpB,qCAAuB,CAAA;IACvB,+BAAiB,CAAA;IACjB,iCAAmB,CAAA;IACnB,+BAAiB,CAAA;IACjB,mCAAqB,CAAA;AACvB,CAAC,EANW,UAAU,0BAAV,UAAU,QAMrB;AAED,IAAY,SAKX;AALD,WAAY,SAAS;IACnB,8BAAiB,CAAA;IACjB,kCAAqB,CAAA;IACrB,8BAAiB,CAAA;IACjB,wBAAW,CAAA;AACb,CAAC,EALW,SAAS,yBAAT,SAAS,QAKpB;AASD,IAAY,eAGX;AAHD,WAAY,eAAe;IACzB,mEAAW,CAAA;IACX,2DAAO,CAAA;AACT,CAAC,EAHW,eAAe,+BAAf,eAAe,QAG1B","sourcesContent":["import { GatekeeperHttpConfig } from './parameters';\n\nexport enum State {\n  ACTIVE = 'ACTIVE',\n  REVOKED = 'REVOKED',\n  FROZEN = 'FROZEN',\n}\n\nexport type GatewayToken = {\n  readonly issuingGatekeeper: string;\n  readonly gatekeeperNetworkAddress: string;\n  readonly owner: string;\n  readonly state: State;\n  readonly identifier: string;\n  readonly expiryTime?: number;\n};\n\nexport enum TokenState {\n  REQUESTED = 'REQUESTED',\n  ACTIVE = 'ACTIVE',\n  REVOKED = 'REVOKED',\n  FROZEN = 'FROZEN',\n  REJECTED = 'REJECTED',\n}\n\nexport enum ChainType {\n  SOLANA = 'solana',\n  ETHEREUM = 'ethereum',\n  CASPER = 'casper',\n  ICP = 'icp',\n}\n\nexport interface ChainImplementationProps {\n  network?: string;\n  owner?: string;\n  gatekeeperNetwork?: string;\n  stage?: string;\n}\n\nexport enum SignatureMethod {\n  TRANSACTION,\n  MESSAGE,\n}\n\nexport type ProveWalletOwnershipResponse = {\n  proof: string;\n  signatureMethod: SignatureMethod;\n};\ntype DIDMethod = string;\ntype DIDIdentifier = string;\n// or string if that makes things easier\nexport type DID = `did:${DIDMethod}:${DIDIdentifier}`;\n\nexport type ChainEvent = 'TOKEN_CREATED' | 'TOKEN_CHANGED';\nexport type ChainDetails = {\n  chainType: ChainType;\n  chainNetwork: string;\n};\nexport interface ChainClientInterface {\n  on: (event: ChainEvent, listener: (GatewayToken: GatewayToken) => void) => this;\n  findGatewayToken: () => Promise<GatewayToken | undefined>;\n  proveWalletOwnership: (message?: string) => Promise<ProveWalletOwnershipResponse>;\n  handleTransaction?: (partiallySignedTx: string, frontendPollingTimeoutSeconds?: number) => Promise<string>;\n  // dids that own the passed-in address\n  ownerDids: () => Promise<DID[]>;\n  chainDetails: ChainDetails;\n  // In some cases, chain listeners have to be explicitly de-registered, for example.\n  onDestroy: () => Promise<void>;\n  // Exposed so we can emit an analytics event if the page is closed with a tx still pending.\n  pendingTransaction: string | undefined;\n  signMessage?: (message: Uint8Array) => Promise<Uint8Array>;\n}\n\nexport interface ChainLegacy {\n  addOnGatewayTokenChangeListener: (\n    gatewayToken: GatewayToken,\n    tokenDidChange: (GatewayToken: GatewayToken) => void\n  ) => Promise<number>;\n  // optional because not all chains may support having a listener for a token that hasn't been created yet\n  addOnGatewayTokenCreatedOrChangedListener?: (tokenChange: (GatewayToken: GatewayToken) => void) => number;\n  removeOnGatewayTokenChangeListener: (listenerId: number) => void;\n  findGatewayToken: () => Promise<GatewayToken | undefined>;\n  proveWalletOwnership: (message?: string) => Promise<ProveWalletOwnershipResponse>;\n  signMessage?: (message: Uint8Array) => Promise<Uint8Array>;\n  handleUserSignedTransaction: (partiallySignedTx: string) => Promise<string>;\n  did: string;\n  httpConfig: GatekeeperHttpConfig;\n  chainType: ChainType;\n  chainNetwork: string;\n  dAppHandlesTransactions: boolean;\n  initProps: ChainImplementationProps;\n  onDestroy: () => void; // used to trigger clean up when instance is being destroyed\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"de0e1d5488ef61936ead9e5cb828cf5f7d9f7403"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/gatekeeperNetworkService.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/gatekeeperNetworkService.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":74}},"2":{"start":{"line":4,"column":0},"end":{"line":10,"column":2}},"3":{"start":{"line":11,"column":33},"end":{"line":21,"column":1}},"4":{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},"5":{"start":{"line":13,"column":8},"end":{"line":13,"column":91}},"6":{"start":{"line":15,"column":20},"end":{"line":15,"column":108}},"7":{"start":{"line":16,"column":20},"end":{"line":16,"column":40}},"8":{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},"9":{"start":{"line":18,"column":8},"end":{"line":18,"column":93}},"10":{"start":{"line":20,"column":4},"end":{"line":20,"column":19}},"11":{"start":{"line":22,"column":0},"end":{"line":22,"column":60}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":11,"column":33},"end":{"line":11,"column":34}},"loc":{"start":{"line":11,"column":57},"end":{"line":21,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},{"start":{"line":12,"column":4},"end":{"line":14,"column":5}}],"line":12},"1":{"loc":{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},{"start":{"line":17,"column":4},"end":{"line":19,"column":5}}],"line":17},"2":{"loc":{"start":{"line":17,"column":9},"end":{"line":17,"column":69}},"type":"cond-expr","locations":[{"start":{"line":17,"column":50},"end":{"line":17,"column":56}},{"start":{"line":17,"column":59},"end":{"line":17,"column":69}}],"line":17},"3":{"loc":{"start":{"line":17,"column":9},"end":{"line":17,"column":47}},"type":"binary-expr","locations":[{"start":{"line":17,"column":9},"end":{"line":17,"column":25}},{"start":{"line":17,"column":29},"end":{"line":17,"column":47}}],"line":17}},"s":{"0":1,"1":1,"2":1,"3":1,"4":107,"5":1,"6":106,"7":106,"8":106,"9":105,"10":1,"11":1},"f":{"0":107},"b":{"0":[1,106],"1":[105,1],"2":[0,106],"3":[106,106]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/gatekeeperNetworkService.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/gatekeeperNetworkService.ts"],"names":[],"mappings":";;;AAEa,QAAA,qBAAqB,GAA2B;IAC3D,KAAK,EAAE,mCAAmC;IAC1C,IAAI,EAAE,mCAAmC;IACzC,GAAG,EAAE,mCAAmC;IACxC,OAAO,EAAE,uCAAuC;IAChD,IAAI,EAAE,2BAA2B;CAClC,CAAC;AAoBK,MAAM,wBAAwB,GAAG,KAAK,EAAE,KAAa,EAAE,KAAa,EAAoB,EAAE;IAC/F,IAAI,CAAC,6BAAqB,CAAC,KAAK,CAAC,EAAE,CAAC;QAClC,MAAM,IAAI,KAAK,CAAC,0DAA0D,KAAK,EAAE,CAAC,CAAC;IACrF,CAAC;IACD,MAAM,OAAO,GAAG,MAAM,KAAK,CAAC,GAAG,6BAAqB,CAAC,KAAK,CAAC,6BAA6B,KAAK,EAAE,CAAC,CAAC;IACjG,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;IACrC,IAAI,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,EAAE,MAAK,KAAK,EAAE,CAAC;QAC1B,MAAM,IAAI,KAAK,CAAC,4DAA4D,KAAK,EAAE,CAAC,CAAC;IACvF,CAAC;IACD,OAAO,OAAO,CAAC;AACjB,CAAC,CAAC;AAVW,QAAA,wBAAwB,4BAUnC","sourcesContent":["import { ChainType } from './types/chain';\n\nexport const GKN_SERVICE_ENDPOINTS: Record<string, string> = {\n  local: 'https://dev.api.civic.com/gkn-dev',\n  test: 'https://dev.api.civic.com/gkn-dev',\n  dev: 'https://dev.api.civic.com/gkn-dev',\n  preprod: `https://dev.api.civic.com/gkn-preprod`,\n  prod: 'https://api.civic.com/gkn',\n};\n\nexport type GknData = {\n  id: string;\n  chains: Partial<Record<ChainType, GknDataChain>>;\n  client?: {\n    tokenActiveDisplay?: 'default' | 'minimal' | 'hidden';\n  };\n  constraints?: {\n    expiry?: {\n      maxRefreshPeriodSeconds: number;\n    };\n  };\n};\n\nexport type GknDataChain = {\n  frontendPollingTimeoutSeconds?: number;\n  chainSpecificId?: string;\n};\n\nexport const getGatekeeperNetworkData = async (stage: string, gknId: string): Promise<GknData> => {\n  if (!GKN_SERVICE_ENDPOINTS[stage]) {\n    throw new Error(`No Gatekeeper Network Service endpoint found for stage ${stage}`);\n  }\n  const results = await fetch(`${GKN_SERVICE_ENDPOINTS[stage]}/public/gatekeeperNetwork/${gknId}`);\n  const gknData = await results.json();\n  if (gknData?.id !== gknId) {\n    throw new Error(`Could not fetch data from Gatekeeper Network Service for ${gknId}`);\n  }\n  return gknData;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2428794a494e2de8590a39c8295fa4156f1a7cc1"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/GatewayClientCore.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/GatewayClientCore.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":15},"end":{"line":4,"column":52}},"4":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"5":{"start":{"line":6,"column":6},"end":{"line":6,"column":68}},"6":{"start":{"line":6,"column":51},"end":{"line":6,"column":63}},"7":{"start":{"line":8,"column":4},"end":{"line":8,"column":39}},"8":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"9":{"start":{"line":10,"column":26},"end":{"line":10,"column":33}},"10":{"start":{"line":11,"column":4},"end":{"line":11,"column":17}},"11":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":72}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":21}},"14":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"15":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"16":{"start":{"line":19,"column":31},"end":{"line":19,"column":42}},"17":{"start":{"line":20,"column":17},"end":{"line":20,"column":19}},"18":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"19":{"start":{"line":21,"column":21},"end":{"line":21,"column":141}},"20":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"21":{"start":{"line":21,"column":109},"end":{"line":21,"column":141}},"22":{"start":{"line":22,"column":4},"end":{"line":22,"column":36}},"23":{"start":{"line":23,"column":4},"end":{"line":23,"column":18}},"24":{"start":{"line":25,"column":0},"end":{"line":25,"column":62}},"25":{"start":{"line":26,"column":0},"end":{"line":26,"column":153}},"26":{"start":{"line":27,"column":15},"end":{"line":27,"column":30}},"27":{"start":{"line":28,"column":17},"end":{"line":28,"column":36}},"28":{"start":{"line":29,"column":22},"end":{"line":29,"column":46}},"29":{"start":{"line":30,"column":16},"end":{"line":30,"column":40}},"30":{"start":{"line":31,"column":17},"end":{"line":31,"column":42}},"31":{"start":{"line":32,"column":26},"end":{"line":32,"column":60}},"32":{"start":{"line":33,"column":26},"end":{"line":33,"column":61}},"33":{"start":{"line":34,"column":13},"end":{"line":34,"column":28}},"34":{"start":{"line":35,"column":10},"end":{"line":35,"column":40}},"35":{"start":{"line":36,"column":31},"end":{"line":44,"column":1}},"36":{"start":{"line":38,"column":4},"end":{"line":43,"column":13}},"37":{"start":{"line":45,"column":0},"end":{"line":45,"column":56}},"38":{"start":{"line":46,"column":29},"end":{"line":46,"column":172}},"39":{"start":{"line":46,"column":51},"end":{"line":46,"column":172}},"40":{"start":{"line":47,"column":0},"end":{"line":47,"column":52}},"41":{"start":{"line":48,"column":26},"end":{"line":48,"column":173}},"42":{"start":{"line":48,"column":48},"end":{"line":48,"column":171}},"43":{"start":{"line":49,"column":0},"end":{"line":49,"column":46}},"44":{"start":{"line":50,"column":24},"end":{"line":53,"column":1}},"45":{"start":{"line":52,"column":4},"end":{"line":52,"column":639}},"46":{"start":{"line":54,"column":0},"end":{"line":54,"column":42}},"47":{"start":{"line":58,"column":8},"end":{"line":58,"column":29}},"48":{"start":{"line":59,"column":8},"end":{"line":59,"column":43}},"49":{"start":{"line":60,"column":8},"end":{"line":60,"column":83}},"50":{"start":{"line":61,"column":8},"end":{"line":61,"column":303}},"51":{"start":{"line":62,"column":8},"end":{"line":62,"column":63}},"52":{"start":{"line":63,"column":8},"end":{"line":66,"column":11}},"53":{"start":{"line":67,"column":8},"end":{"line":67,"column":91}},"54":{"start":{"line":68,"column":8},"end":{"line":71,"column":11}},"55":{"start":{"line":68,"column":51},"end":{"line":68,"column":63}},"56":{"start":{"line":69,"column":12},"end":{"line":69,"column":71}},"57":{"start":{"line":70,"column":12},"end":{"line":70,"column":51}},"58":{"start":{"line":72,"column":8},"end":{"line":72,"column":234}},"59":{"start":{"line":73,"column":8},"end":{"line":78,"column":11}},"60":{"start":{"line":74,"column":12},"end":{"line":74,"column":122}},"61":{"start":{"line":75,"column":12},"end":{"line":75,"column":91}},"62":{"start":{"line":76,"column":12},"end":{"line":76,"column":79}},"63":{"start":{"line":77,"column":12},"end":{"line":77,"column":56}},"64":{"start":{"line":79,"column":8},"end":{"line":79,"column":44}},"65":{"start":{"line":80,"column":8},"end":{"line":80,"column":43}},"66":{"start":{"line":81,"column":8},"end":{"line":81,"column":64}},"67":{"start":{"line":85,"column":23},"end":{"line":85,"column":88}},"68":{"start":{"line":86,"column":8},"end":{"line":91,"column":9}},"69":{"start":{"line":87,"column":12},"end":{"line":87,"column":127}},"70":{"start":{"line":88,"column":12},"end":{"line":88,"column":101}},"71":{"start":{"line":89,"column":12},"end":{"line":89,"column":58}},"72":{"start":{"line":90,"column":12},"end":{"line":90,"column":29}},"73":{"start":{"line":92,"column":8},"end":{"line":96,"column":9}},"74":{"start":{"line":93,"column":12},"end":{"line":93,"column":103}},"75":{"start":{"line":94,"column":12},"end":{"line":94,"column":101}},"76":{"start":{"line":95,"column":12},"end":{"line":95,"column":78}},"77":{"start":{"line":97,"column":8},"end":{"line":97,"column":49}},"78":{"start":{"line":100,"column":8},"end":{"line":103,"column":11}},"79":{"start":{"line":101,"column":12},"end":{"line":101,"column":57}},"80":{"start":{"line":102,"column":12},"end":{"line":102,"column":72}},"81":{"start":{"line":106,"column":8},"end":{"line":108,"column":11}},"82":{"start":{"line":107,"column":12},"end":{"line":107,"column":66}},"83":{"start":{"line":111,"column":8},"end":{"line":113,"column":11}},"84":{"start":{"line":112,"column":12},"end":{"line":112,"column":100}},"85":{"start":{"line":116,"column":8},"end":{"line":116,"column":49}},"86":{"start":{"line":117,"column":8},"end":{"line":117,"column":38}},"87":{"start":{"line":120,"column":8},"end":{"line":120,"column":52}},"88":{"start":{"line":121,"column":8},"end":{"line":121,"column":38}},"89":{"start":{"line":124,"column":8},"end":{"line":128,"column":10}},"90":{"start":{"line":125,"column":26},"end":{"line":125,"column":46}},"91":{"start":{"line":126,"column":26},"end":{"line":126,"column":46}},"92":{"start":{"line":127,"column":26},"end":{"line":127,"column":46}},"93":{"start":{"line":131,"column":0},"end":{"line":131,"column":46}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":9,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":6,"column":38},"end":{"line":6,"column":39}},"loc":{"start":{"line":6,"column":49},"end":{"line":6,"column":65}},"line":6},"2":{"name":"(anonymous_2)","decl":{"start":{"line":9,"column":6},"end":{"line":9,"column":7}},"loc":{"start":{"line":9,"column":28},"end":{"line":12,"column":1}},"line":9},"3":{"name":"(anonymous_3)","decl":{"start":{"line":13,"column":80},"end":{"line":13,"column":81}},"loc":{"start":{"line":13,"column":95},"end":{"line":15,"column":1}},"line":13},"4":{"name":"(anonymous_4)","decl":{"start":{"line":15,"column":5},"end":{"line":15,"column":6}},"loc":{"start":{"line":15,"column":20},"end":{"line":17,"column":1}},"line":15},"5":{"name":"(anonymous_5)","decl":{"start":{"line":18,"column":50},"end":{"line":18,"column":51}},"loc":{"start":{"line":18,"column":65},"end":{"line":24,"column":1}},"line":18},"6":{"name":"(anonymous_6)","decl":{"start":{"line":36,"column":31},"end":{"line":36,"column":32}},"loc":{"start":{"line":36,"column":42},"end":{"line":44,"column":1}},"line":36},"7":{"name":"(anonymous_7)","decl":{"start":{"line":46,"column":29},"end":{"line":46,"column":30}},"loc":{"start":{"line":46,"column":51},"end":{"line":46,"column":172}},"line":46},"8":{"name":"(anonymous_8)","decl":{"start":{"line":48,"column":26},"end":{"line":48,"column":27}},"loc":{"start":{"line":48,"column":38},"end":{"line":48,"column":173}},"line":48},"9":{"name":"(anonymous_9)","decl":{"start":{"line":50,"column":24},"end":{"line":50,"column":25}},"loc":{"start":{"line":50,"column":48},"end":{"line":53,"column":1}},"line":50},"10":{"name":"(anonymous_10)","decl":{"start":{"line":56,"column":4},"end":{"line":56,"column":5}},"loc":{"start":{"line":56,"column":24},"end":{"line":82,"column":5}},"line":56},"11":{"name":"(anonymous_11)","decl":{"start":{"line":68,"column":40},"end":{"line":68,"column":41}},"loc":{"start":{"line":68,"column":51},"end":{"line":68,"column":63}},"line":68},"12":{"name":"(anonymous_12)","decl":{"start":{"line":68,"column":65},"end":{"line":68,"column":66}},"loc":{"start":{"line":68,"column":77},"end":{"line":71,"column":9}},"line":68},"13":{"name":"(anonymous_13)","decl":{"start":{"line":73,"column":39},"end":{"line":73,"column":40}},"loc":{"start":{"line":73,"column":50},"end":{"line":78,"column":9}},"line":73},"14":{"name":"(anonymous_14)","decl":{"start":{"line":83,"column":4},"end":{"line":83,"column":5}},"loc":{"start":{"line":83,"column":37},"end":{"line":98,"column":5}},"line":83},"15":{"name":"(anonymous_15)","decl":{"start":{"line":99,"column":4},"end":{"line":99,"column":5}},"loc":{"start":{"line":99,"column":47},"end":{"line":104,"column":5}},"line":99},"16":{"name":"(anonymous_16)","decl":{"start":{"line":100,"column":39},"end":{"line":100,"column":40}},"loc":{"start":{"line":100,"column":50},"end":{"line":103,"column":9}},"line":100},"17":{"name":"(anonymous_17)","decl":{"start":{"line":105,"column":4},"end":{"line":105,"column":5}},"loc":{"start":{"line":105,"column":48},"end":{"line":109,"column":5}},"line":105},"18":{"name":"(anonymous_18)","decl":{"start":{"line":106,"column":39},"end":{"line":106,"column":40}},"loc":{"start":{"line":106,"column":50},"end":{"line":108,"column":9}},"line":106},"19":{"name":"(anonymous_19)","decl":{"start":{"line":110,"column":4},"end":{"line":110,"column":5}},"loc":{"start":{"line":110,"column":24},"end":{"line":114,"column":5}},"line":110},"20":{"name":"(anonymous_20)","decl":{"start":{"line":111,"column":39},"end":{"line":111,"column":40}},"loc":{"start":{"line":111,"column":50},"end":{"line":113,"column":9}},"line":111},"21":{"name":"(anonymous_21)","decl":{"start":{"line":115,"column":4},"end":{"line":115,"column":5}},"loc":{"start":{"line":115,"column":12},"end":{"line":118,"column":5}},"line":115},"22":{"name":"(anonymous_22)","decl":{"start":{"line":119,"column":4},"end":{"line":119,"column":5}},"loc":{"start":{"line":119,"column":12},"end":{"line":122,"column":5}},"line":119},"23":{"name":"(anonymous_23)","decl":{"start":{"line":123,"column":4},"end":{"line":123,"column":5}},"loc":{"start":{"line":123,"column":13},"end":{"line":129,"column":5}},"line":123},"24":{"name":"(anonymous_24)","decl":{"start":{"line":125,"column":20},"end":{"line":125,"column":21}},"loc":{"start":{"line":125,"column":26},"end":{"line":125,"column":46}},"line":125},"25":{"name":"(anonymous_25)","decl":{"start":{"line":126,"column":20},"end":{"line":126,"column":21}},"loc":{"start":{"line":126,"column":26},"end":{"line":126,"column":46}},"line":126},"26":{"name":"(anonymous_26)","decl":{"start":{"line":127,"column":20},"end":{"line":127,"column":21}},"loc":{"start":{"line":127,"column":26},"end":{"line":127,"column":46}},"line":127}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":12,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":12,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":9,"column":1}},{"start":{"line":9,"column":6},"end":{"line":12,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{"line":3,"column":4},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},{"start":{"line":5,"column":4},"end":{"line":7,"column":5}}],"line":5},"4":{"loc":{"start":{"line":5,"column":8},"end":{"line":5,"column":85}},"type":"binary-expr","locations":[{"start":{"line":5,"column":8},"end":{"line":5,"column":13}},{"start":{"line":5,"column":18},"end":{"line":5,"column":84}}],"line":5},"5":{"loc":{"start":{"line":5,"column":18},"end":{"line":5,"column":84}},"type":"cond-expr","locations":[{"start":{"line":5,"column":34},"end":{"line":5,"column":47}},{"start":{"line":5,"column":50},"end":{"line":5,"column":84}}],"line":5},"6":{"loc":{"start":{"line":5,"column":50},"end":{"line":5,"column":84}},"type":"binary-expr","locations":[{"start":{"line":5,"column":50},"end":{"line":5,"column":63}},{"start":{"line":5,"column":67},"end":{"line":5,"column":84}}],"line":5},"7":{"loc":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},{"start":{"line":10,"column":4},"end":{"line":10,"column":33}}],"line":10},"8":{"loc":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"type":"binary-expr","locations":[{"start":{"line":13,"column":26},"end":{"line":13,"column":30}},{"start":{"line":13,"column":34},"end":{"line":13,"column":57}},{"start":{"line":13,"column":63},"end":{"line":17,"column":1}}],"line":13},"9":{"loc":{"start":{"line":13,"column":63},"end":{"line":17,"column":1}},"type":"cond-expr","locations":[{"start":{"line":13,"column":80},"end":{"line":15,"column":1}},{"start":{"line":15,"column":5},"end":{"line":17,"column":1}}],"line":13},"10":{"loc":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"type":"binary-expr","locations":[{"start":{"line":18,"column":20},"end":{"line":18,"column":24}},{"start":{"line":18,"column":28},"end":{"line":18,"column":45}},{"start":{"line":18,"column":50},"end":{"line":24,"column":1}}],"line":18},"11":{"loc":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},{"start":{"line":19,"column":4},"end":{"line":19,"column":42}}],"line":19},"12":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":29}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":11}},{"start":{"line":19,"column":15},"end":{"line":19,"column":29}}],"line":19},"13":{"loc":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},{"start":{"line":21,"column":4},"end":{"line":21,"column":141}}],"line":21},"14":{"loc":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},{"start":{"line":21,"column":40},"end":{"line":21,"column":141}}],"line":21},"15":{"loc":{"start":{"line":21,"column":44},"end":{"line":21,"column":107}},"type":"binary-expr","locations":[{"start":{"line":21,"column":44},"end":{"line":21,"column":59}},{"start":{"line":21,"column":63},"end":{"line":21,"column":107}}],"line":21},"16":{"loc":{"start":{"line":38,"column":11},"end":{"line":43,"column":12}},"type":"cond-expr","locations":[{"start":{"line":39,"column":10},"end":{"line":42,"column":9}},{"start":{"line":43,"column":10},"end":{"line":43,"column":12}}],"line":38},"17":{"loc":{"start":{"line":41,"column":15},"end":{"line":41,"column":100}},"type":"cond-expr","locations":[{"start":{"line":41,"column":76},"end":{"line":41,"column":82}},{"start":{"line":41,"column":85},"end":{"line":41,"column":100}}],"line":41},"18":{"loc":{"start":{"line":41,"column":15},"end":{"line":41,"column":73}},"type":"binary-expr","locations":[{"start":{"line":41,"column":15},"end":{"line":41,"column":56}},{"start":{"line":41,"column":60},"end":{"line":41,"column":73}}],"line":41},"19":{"loc":{"start":{"line":46,"column":51},"end":{"line":46,"column":172}},"type":"binary-expr","locations":[{"start":{"line":46,"column":51},"end":{"line":46,"column":60}},{"start":{"line":46,"column":64},"end":{"line":46,"column":172}}],"line":46},"20":{"loc":{"start":{"line":48,"column":58},"end":{"line":48,"column":169}},"type":"binary-expr","locations":[{"start":{"line":48,"column":59},"end":{"line":48,"column":138}},{"start":{"line":48,"column":143},"end":{"line":48,"column":169}}],"line":48},"21":{"loc":{"start":{"line":48,"column":59},"end":{"line":48,"column":138}},"type":"cond-expr","locations":[{"start":{"line":48,"column":119},"end":{"line":48,"column":125}},{"start":{"line":48,"column":128},"end":{"line":48,"column":138}}],"line":48},"22":{"loc":{"start":{"line":48,"column":59},"end":{"line":48,"column":116}},"type":"binary-expr","locations":[{"start":{"line":48,"column":59},"end":{"line":48,"column":99}},{"start":{"line":48,"column":103},"end":{"line":48,"column":116}}],"line":48},"23":{"loc":{"start":{"line":52,"column":18},"end":{"line":52,"column":160}},"type":"cond-expr","locations":[{"start":{"line":52,"column":133},"end":{"line":52,"column":139}},{"start":{"line":52,"column":142},"end":{"line":52,"column":160}}],"line":52},"24":{"loc":{"start":{"line":52,"column":18},"end":{"line":52,"column":130}},"type":"binary-expr","locations":[{"start":{"line":52,"column":18},"end":{"line":52,"column":113}},{"start":{"line":52,"column":117},"end":{"line":52,"column":130}}],"line":52},"25":{"loc":{"start":{"line":52,"column":24},"end":{"line":52,"column":103}},"type":"cond-expr","locations":[{"start":{"line":52,"column":84},"end":{"line":52,"column":90}},{"start":{"line":52,"column":93},"end":{"line":52,"column":103}}],"line":52},"26":{"loc":{"start":{"line":52,"column":24},"end":{"line":52,"column":81}},"type":"binary-expr","locations":[{"start":{"line":52,"column":24},"end":{"line":52,"column":64}},{"start":{"line":52,"column":68},"end":{"line":52,"column":81}}],"line":52},"27":{"loc":{"start":{"line":52,"column":164},"end":{"line":52,"column":309}},"type":"cond-expr","locations":[{"start":{"line":52,"column":282},"end":{"line":52,"column":288}},{"start":{"line":52,"column":291},"end":{"line":52,"column":309}}],"line":52},"28":{"loc":{"start":{"line":52,"column":164},"end":{"line":52,"column":279}},"type":"binary-expr","locations":[{"start":{"line":52,"column":164},"end":{"line":52,"column":262}},{"start":{"line":52,"column":266},"end":{"line":52,"column":279}}],"line":52},"29":{"loc":{"start":{"line":52,"column":170},"end":{"line":52,"column":252}},"type":"cond-expr","locations":[{"start":{"line":52,"column":223},"end":{"line":52,"column":229}},{"start":{"line":52,"column":232},"end":{"line":52,"column":252}}],"line":52},"30":{"loc":{"start":{"line":52,"column":170},"end":{"line":52,"column":220}},"type":"binary-expr","locations":[{"start":{"line":52,"column":170},"end":{"line":52,"column":203}},{"start":{"line":52,"column":207},"end":{"line":52,"column":220}}],"line":52},"31":{"loc":{"start":{"line":52,"column":313},"end":{"line":52,"column":456}},"type":"cond-expr","locations":[{"start":{"line":52,"column":435},"end":{"line":52,"column":441}},{"start":{"line":52,"column":444},"end":{"line":52,"column":456}}],"line":52},"32":{"loc":{"start":{"line":52,"column":313},"end":{"line":52,"column":432}},"type":"binary-expr","locations":[{"start":{"line":52,"column":313},"end":{"line":52,"column":415}},{"start":{"line":52,"column":419},"end":{"line":52,"column":432}}],"line":52},"33":{"loc":{"start":{"line":52,"column":319},"end":{"line":52,"column":405}},"type":"cond-expr","locations":[{"start":{"line":52,"column":381},"end":{"line":52,"column":387}},{"start":{"line":52,"column":390},"end":{"line":52,"column":405}}],"line":52},"34":{"loc":{"start":{"line":52,"column":319},"end":{"line":52,"column":378}},"type":"binary-expr","locations":[{"start":{"line":52,"column":319},"end":{"line":52,"column":361}},{"start":{"line":52,"column":365},"end":{"line":52,"column":378}}],"line":52},"35":{"loc":{"start":{"line":52,"column":460},"end":{"line":52,"column":606}},"type":"cond-expr","locations":[{"start":{"line":52,"column":582},"end":{"line":52,"column":588}},{"start":{"line":52,"column":591},"end":{"line":52,"column":606}}],"line":52},"36":{"loc":{"start":{"line":52,"column":460},"end":{"line":52,"column":579}},"type":"binary-expr","locations":[{"start":{"line":52,"column":460},"end":{"line":52,"column":562}},{"start":{"line":52,"column":566},"end":{"line":52,"column":579}}],"line":52},"37":{"loc":{"start":{"line":52,"column":466},"end":{"line":52,"column":552}},"type":"cond-expr","locations":[{"start":{"line":52,"column":528},"end":{"line":52,"column":534}},{"start":{"line":52,"column":537},"end":{"line":52,"column":552}}],"line":52},"38":{"loc":{"start":{"line":52,"column":466},"end":{"line":52,"column":525}},"type":"binary-expr","locations":[{"start":{"line":52,"column":466},"end":{"line":52,"column":508}},{"start":{"line":52,"column":512},"end":{"line":52,"column":525}}],"line":52},"39":{"loc":{"start":{"line":61,"column":8},"end":{"line":61,"column":302}},"type":"cond-expr","locations":[{"start":{"line":61,"column":111},"end":{"line":61,"column":117}},{"start":{"line":61,"column":120},"end":{"line":61,"column":302}}],"line":61},"40":{"loc":{"start":{"line":61,"column":8},"end":{"line":61,"column":108}},"type":"binary-expr","locations":[{"start":{"line":61,"column":8},"end":{"line":61,"column":91}},{"start":{"line":61,"column":95},"end":{"line":61,"column":108}}],"line":61},"41":{"loc":{"start":{"line":61,"column":14},"end":{"line":61,"column":81}},"type":"cond-expr","locations":[{"start":{"line":61,"column":58},"end":{"line":61,"column":64}},{"start":{"line":61,"column":67},"end":{"line":61,"column":81}}],"line":61},"42":{"loc":{"start":{"line":61,"column":14},"end":{"line":61,"column":55}},"type":"binary-expr","locations":[{"start":{"line":61,"column":14},"end":{"line":61,"column":38}},{"start":{"line":61,"column":42},"end":{"line":61,"column":55}}],"line":61},"43":{"loc":{"start":{"line":61,"column":132},"end":{"line":61,"column":301}},"type":"binary-expr","locations":[{"start":{"line":61,"column":133},"end":{"line":61,"column":261}},{"start":{"line":61,"column":266},"end":{"line":61,"column":301}}],"line":61},"44":{"loc":{"start":{"line":61,"column":133},"end":{"line":61,"column":261}},"type":"cond-expr","locations":[{"start":{"line":61,"column":241},"end":{"line":61,"column":247}},{"start":{"line":61,"column":250},"end":{"line":61,"column":261}}],"line":61},"45":{"loc":{"start":{"line":61,"column":133},"end":{"line":61,"column":238}},"type":"binary-expr","locations":[{"start":{"line":61,"column":133},"end":{"line":61,"column":221}},{"start":{"line":61,"column":225},"end":{"line":61,"column":238}}],"line":61},"46":{"loc":{"start":{"line":61,"column":139},"end":{"line":61,"column":211}},"type":"cond-expr","locations":[{"start":{"line":61,"column":192},"end":{"line":61,"column":198}},{"start":{"line":61,"column":201},"end":{"line":61,"column":211}}],"line":61},"47":{"loc":{"start":{"line":61,"column":139},"end":{"line":61,"column":189}},"type":"binary-expr","locations":[{"start":{"line":61,"column":139},"end":{"line":61,"column":172}},{"start":{"line":61,"column":176},"end":{"line":61,"column":189}}],"line":61},"48":{"loc":{"start":{"line":86,"column":8},"end":{"line":91,"column":9}},"type":"if","locations":[{"start":{"line":86,"column":8},"end":{"line":91,"column":9}},{"start":{"line":86,"column":8},"end":{"line":91,"column":9}}],"line":86},"49":{"loc":{"start":{"line":88,"column":12},"end":{"line":88,"column":100}},"type":"cond-expr","locations":[{"start":{"line":88,"column":81},"end":{"line":88,"column":87}},{"start":{"line":88,"column":90},"end":{"line":88,"column":100}}],"line":88},"50":{"loc":{"start":{"line":88,"column":12},"end":{"line":88,"column":78}},"type":"binary-expr","locations":[{"start":{"line":88,"column":12},"end":{"line":88,"column":61}},{"start":{"line":88,"column":65},"end":{"line":88,"column":78}}],"line":88},"51":{"loc":{"start":{"line":92,"column":8},"end":{"line":96,"column":9}},"type":"if","locations":[{"start":{"line":92,"column":8},"end":{"line":96,"column":9}},{"start":{"line":92,"column":8},"end":{"line":96,"column":9}}],"line":92},"52":{"loc":{"start":{"line":94,"column":12},"end":{"line":94,"column":100}},"type":"cond-expr","locations":[{"start":{"line":94,"column":81},"end":{"line":94,"column":87}},{"start":{"line":94,"column":90},"end":{"line":94,"column":100}}],"line":94},"53":{"loc":{"start":{"line":94,"column":12},"end":{"line":94,"column":78}},"type":"binary-expr","locations":[{"start":{"line":94,"column":12},"end":{"line":94,"column":61}},{"start":{"line":94,"column":65},"end":{"line":94,"column":78}}],"line":94}},"s":{"0":1,"1":267,"2":267,"3":267,"4":267,"5":267,"6":1608,"7":267,"8":0,"9":0,"10":0,"11":1,"12":1,"13":0,"14":1,"15":1,"16":0,"17":1,"18":1,"19":1,"20":267,"21":267,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":44,"37":1,"38":1,"39":23,"40":1,"41":1,"42":24,"43":1,"44":1,"45":103,"46":1,"47":102,"48":102,"49":102,"50":102,"51":102,"52":102,"53":102,"54":102,"55":1377,"56":1275,"57":1275,"58":102,"59":102,"60":102,"61":102,"62":102,"63":102,"64":102,"65":102,"66":102,"67":21,"68":21,"69":1,"70":1,"71":1,"72":1,"73":20,"74":18,"75":18,"76":18,"77":20,"78":2,"79":2,"80":2,"81":4,"82":4,"83":1,"84":1,"85":1,"86":1,"87":53,"88":53,"89":6,"90":3,"91":2,"92":1,"93":1},"f":{"0":267,"1":1608,"2":0,"3":1,"4":0,"5":1,"6":44,"7":23,"8":24,"9":103,"10":102,"11":1377,"12":1275,"13":102,"14":21,"15":2,"16":2,"17":4,"18":4,"19":1,"20":1,"21":1,"22":53,"23":6,"24":3,"25":2,"26":1},"b":{"0":[1,1,1],"1":[1,0],"2":[267,0],"3":[267,0],"4":[267,267],"5":[0,267],"6":[267,0],"7":[0,0],"8":[1,1,1],"9":[1,0],"10":[1,1,1],"11":[0,1],"12":[1,1],"13":[1,0],"14":[267,0],"15":[267,267],"16":[43,1],"17":[0,43],"18":[43,43],"19":[23,21],"20":[24,22],"21":[2,22],"22":[24,24],"23":[0,103],"24":[103,103],"25":[0,103],"26":[103,103],"27":[0,103],"28":[103,103],"29":[0,103],"30":[103,103],"31":[0,103],"32":[103,103],"33":[0,103],"34":[103,103],"35":[0,103],"36":[103,103],"37":[0,103],"38":[103,103],"39":[0,102],"40":[102,102],"41":[0,102],"42":[102,102],"43":[102,102],"44":[96,6],"45":[102,102],"46":[0,102],"47":[102,102],"48":[1,20],"49":[0,1],"50":[1,1],"51":[18,2],"52":[1,17],"53":[18,18]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/GatewayClientCore.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/GatewayClientCore.ts"],"names":[],"mappings":"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","sourcesContent":["import { v4 as uuid } from 'uuid';\nimport { ClientCoreInput } from './types/clientCore';\nimport { prefixLogger } from './logger';\nimport { Orchestrator } from './orchestrate';\nimport { createGatewayCoreStore, Store } from './state/state';\nimport { ClientCoreOutput, GatewayClientCoreInterface, GatewayInput } from './types/gatewayCore';\nimport { getPayer } from './utils/inputs';\nimport { UserInteractionStatus } from './types/userInteraction';\nimport { DynamicGatewayClientParameters, GatewayClientParameters } from './types/parameters';\nimport { DEFAULT_LOG_LEVEL, LoggingInterface } from './logger/provider.logger';\nimport { ChainDetails } from './types/chain';\nimport { UIManager } from './ui';\nimport { UIInput } from './types/ui';\nimport * as R from 'ramda';\nimport { GknData } from './gatekeeperNetworkService';\n\nexport const getInstanceInputObject = (input: ClientCoreInput | undefined): InstanceInputObject =>\n  input\n    ? {\n        ...input.parameters,\n        ...input.chainImplementation?.chainDetails,\n      }\n    : ({} as InstanceInputObject);\n\nexport const shouldUpdateInstance = (inputs: ClientCoreInput, instance: GatewayClientCore | undefined): boolean =>\n  !instance || !R.equals(getInstanceInputObject(instance.inputs), getInstanceInputObject(inputs));\n\nexport const hasRequiredInputs = (inputs: ClientCoreInput): boolean =>\n  !!(inputs.parameters.wallet?.address && inputs.chainImplementation);\n\nexport const getInstanceName = (inputs: ClientCoreInput, instanceId: string) =>\n  `gcc_${inputs.parameters.wallet?.address?.substring(0, 4)}_${inputs.parameters?.gatekeeperNetwork?.substring(0, 4)}_${\n    inputs.chainImplementation?.chainDetails?.chainType\n  }_${inputs.chainImplementation?.chainDetails?.chainNetwork}_${instanceId.substring(0, 4)}`;\n\nexport type InstanceInputObject = GatewayClientParameters & ChainDetails;\n\nexport class GatewayClientCore implements GatewayClientCoreInterface {\n  private orchestratorInst: Orchestrator;\n\n  private uiInst: UIManager;\n\n  static currentInstance: GatewayClientCore | undefined;\n\n  private gatewayCoreStore: Store;\n\n  public instanceId: string;\n\n  private log: LoggingInterface;\n\n  constructor(readonly inputs: ClientCoreInput) {\n    this.instanceId = uuid();\n    this.log = prefixLogger(`Core instance: ${this.instanceId}`);\n    this.log?.setLogLevel?.(inputs.parameters?.options?.logLevel || DEFAULT_LOG_LEVEL);\n    this.log.info('GatewayClientCore created', { inputs });\n    this.gatewayCoreStore = createGatewayCoreStore({\n      name: getInstanceName(inputs, this.instanceId),\n      store: 'gateway-client-core',\n    });\n    this.log.info('GatewayClientCore gatewayCoreStore created', this.gatewayCoreStore);\n\n    this.gatewayCoreStore.subscribe(\n      (state) => state.output,\n      (output) => {\n        this.log.debug('GatewayClientCore output changed', output);\n        inputs.onOutputChange(R.clone(output) as ClientCoreOutput);\n      }\n    );\n\n    this.orchestratorInst = new Orchestrator(\n      this.gatewayCoreStore,\n      inputs.messageEventInterface,\n      this.instanceId,\n      inputs.parameters,\n      inputs.fetchConfig,\n      inputs.postMessageTargetCallback,\n      inputs.chainImplementation\n    );\n\n    // ensure that the inputs get cloned and not mutated\n    this.gatewayCoreStore.setState((state) => {\n      state.inputs.parameters = R.clone({ ...inputs.parameters, payer: getPayer(inputs.parameters) });\n      state.internal.chainDetails = R.clone(inputs.chainImplementation.chainDetails);\n      state.inputs.dynamicParameters = R.clone(inputs.dynamicParameters);\n      state.internal.instanceId = this.instanceId;\n    });\n\n    this.orchestratorInst.orchestrate();\n    this.orchestratorInst.initialise();\n\n    this.uiInst = new UIManager(this.gatewayCoreStore);\n  }\n\n  public static getSingleInstance(inputs: ClientCoreInput): GatewayClientCore | undefined {\n    const logger = prefixLogger('GatewayClientCore.getSingleInstance');\n    if (!hasRequiredInputs(inputs)) {\n      logger.debug(\n        'Missing wallet address or chain implementation, aborting previous and setting to undefined',\n        inputs\n      );\n      GatewayClientCore.currentInstance?.abort();\n      GatewayClientCore.currentInstance = undefined;\n      return undefined;\n    }\n\n    if (shouldUpdateInstance(inputs, GatewayClientCore.currentInstance)) {\n      logger.debug('Inputs have changed, aborting previous and creating a new instance', inputs);\n      GatewayClientCore.currentInstance?.abort();\n      GatewayClientCore.currentInstance = new GatewayClientCore(inputs);\n    }\n    return GatewayClientCore.currentInstance;\n  }\n\n  updateDynamicParameters(dynamicParameters: DynamicGatewayClientParameters) {\n    this.gatewayCoreStore.setState((state) => {\n      state.internal.userInteraction.status = null;\n      state.inputs.dynamicParameters = R.clone(dynamicParameters);\n    });\n  }\n\n  updateGatekeeperNetworkServiceData(gknData: GatewayInput<GknData>) {\n    this.gatewayCoreStore.setState((state) => {\n      state.inputs.gatekeeperNetworkData = R.clone(gknData);\n    });\n  }\n\n  startOrResumeFlow() {\n    this.gatewayCoreStore.setState((state) => {\n      state.internal.userInteraction.status = UserInteractionStatus.STARTED;\n    });\n  }\n\n  reset() {\n    this.log.info(`GatewayClientCore reset`);\n    this.orchestratorInst.reset();\n  }\n\n  abort() {\n    this.log.info(`GatewayClientCore aborting`);\n    this.orchestratorInst.abort();\n  }\n\n  get ui(): UIInput {\n    return {\n      onShow: () => this.uiInst.onShow(),\n      onHide: () => this.uiInst.onHide(),\n      onLoad: () => this.uiInst.onLoad(),\n    };\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"30e3c2a7cb6838f3a8cf090732314dd788d49a75"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/orchestrate.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/orchestrate.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":30}},"2":{"start":{"line":4,"column":20},"end":{"line":4,"column":42}},"3":{"start":{"line":5,"column":17},"end":{"line":5,"column":36}},"4":{"start":{"line":6,"column":16},"end":{"line":6,"column":40}},"5":{"start":{"line":7,"column":27},"end":{"line":7,"column":56}},"6":{"start":{"line":8,"column":18},"end":{"line":8,"column":44}},"7":{"start":{"line":9,"column":17},"end":{"line":9,"column":42}},"8":{"start":{"line":10,"column":21},"end":{"line":10,"column":44}},"9":{"start":{"line":11,"column":19},"end":{"line":11,"column":40}},"10":{"start":{"line":12,"column":18},"end":{"line":12,"column":38}},"11":{"start":{"line":13,"column":26},"end":{"line":13,"column":60}},"12":{"start":{"line":14,"column":24},"end":{"line":14,"column":50}},"13":{"start":{"line":15,"column":17},"end":{"line":15,"column":42}},"14":{"start":{"line":16,"column":17},"end":{"line":16,"column":42}},"15":{"start":{"line":17,"column":35},"end":{"line":17,"column":72}},"16":{"start":{"line":21,"column":8},"end":{"line":21,"column":49}},"17":{"start":{"line":22,"column":8},"end":{"line":22,"column":59}},"18":{"start":{"line":23,"column":8},"end":{"line":23,"column":37}},"19":{"start":{"line":24,"column":8},"end":{"line":24,"column":29}},"20":{"start":{"line":25,"column":8},"end":{"line":25,"column":67}},"21":{"start":{"line":26,"column":8},"end":{"line":26,"column":55}},"22":{"start":{"line":27,"column":8},"end":{"line":27,"column":53}},"23":{"start":{"line":28,"column":8},"end":{"line":30,"column":9}},"24":{"start":{"line":29,"column":12},"end":{"line":29,"column":81}},"25":{"start":{"line":31,"column":8},"end":{"line":31,"column":36}},"26":{"start":{"line":32,"column":8},"end":{"line":32,"column":52}},"27":{"start":{"line":33,"column":8},"end":{"line":33,"column":82}},"28":{"start":{"line":34,"column":8},"end":{"line":34,"column":134}},"29":{"start":{"line":35,"column":29},"end":{"line":35,"column":173}},"30":{"start":{"line":36,"column":8},"end":{"line":51,"column":11}},"31":{"start":{"line":52,"column":8},"end":{"line":52,"column":47}},"32":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"33":{"start":{"line":56,"column":12},"end":{"line":56,"column":186}},"34":{"start":{"line":58,"column":8},"end":{"line":58,"column":30}},"35":{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},"36":{"start":{"line":62,"column":12},"end":{"line":62,"column":183}},"37":{"start":{"line":64,"column":8},"end":{"line":64,"column":29}},"38":{"start":{"line":67,"column":8},"end":{"line":69,"column":9}},"39":{"start":{"line":68,"column":12},"end":{"line":68,"column":182}},"40":{"start":{"line":70,"column":8},"end":{"line":70,"column":35}},"41":{"start":{"line":73,"column":8},"end":{"line":75,"column":9}},"42":{"start":{"line":74,"column":12},"end":{"line":74,"column":182}},"43":{"start":{"line":76,"column":8},"end":{"line":76,"column":39}},"44":{"start":{"line":79,"column":21},"end":{"line":79,"column":63}},"45":{"start":{"line":80,"column":8},"end":{"line":82,"column":11}},"46":{"start":{"line":81,"column":12},"end":{"line":81,"column":44}},"47":{"start":{"line":85,"column":8},"end":{"line":87,"column":11}},"48":{"start":{"line":86,"column":12},"end":{"line":86,"column":88}},"49":{"start":{"line":88,"column":8},"end":{"line":106,"column":11}},"50":{"start":{"line":90,"column":12},"end":{"line":90,"column":65}},"51":{"start":{"line":91,"column":12},"end":{"line":92,"column":23}},"52":{"start":{"line":92,"column":16},"end":{"line":92,"column":23}},"53":{"start":{"line":93,"column":12},"end":{"line":96,"column":15}},"54":{"start":{"line":94,"column":16},"end":{"line":94,"column":89}},"55":{"start":{"line":95,"column":16},"end":{"line":95,"column":71}},"56":{"start":{"line":99,"column":12},"end":{"line":99,"column":78}},"57":{"start":{"line":100,"column":12},"end":{"line":101,"column":23}},"58":{"start":{"line":101,"column":16},"end":{"line":101,"column":23}},"59":{"start":{"line":102,"column":12},"end":{"line":105,"column":15}},"60":{"start":{"line":103,"column":16},"end":{"line":103,"column":86}},"61":{"start":{"line":104,"column":16},"end":{"line":104,"column":65}},"62":{"start":{"line":109,"column":33},"end":{"line":133,"column":9}},"63":{"start":{"line":110,"column":12},"end":{"line":112,"column":15}},"64":{"start":{"line":111,"column":16},"end":{"line":111,"column":87}},"65":{"start":{"line":113,"column":12},"end":{"line":132,"column":15}},"66":{"start":{"line":116,"column":16},"end":{"line":116,"column":82}},"67":{"start":{"line":117,"column":16},"end":{"line":118,"column":27}},"68":{"start":{"line":118,"column":20},"end":{"line":118,"column":27}},"69":{"start":{"line":119,"column":16},"end":{"line":122,"column":19}},"70":{"start":{"line":120,"column":20},"end":{"line":120,"column":88}},"71":{"start":{"line":121,"column":20},"end":{"line":121,"column":70}},"72":{"start":{"line":125,"column":16},"end":{"line":125,"column":76}},"73":{"start":{"line":126,"column":16},"end":{"line":127,"column":27}},"74":{"start":{"line":127,"column":20},"end":{"line":127,"column":27}},"75":{"start":{"line":128,"column":16},"end":{"line":131,"column":19}},"76":{"start":{"line":129,"column":20},"end":{"line":129,"column":85}},"77":{"start":{"line":130,"column":20},"end":{"line":130,"column":64}},"78":{"start":{"line":134,"column":37},"end":{"line":159,"column":9}},"79":{"start":{"line":135,"column":12},"end":{"line":137,"column":15}},"80":{"start":{"line":136,"column":16},"end":{"line":136,"column":83}},"81":{"start":{"line":138,"column":12},"end":{"line":158,"column":15}},"82":{"start":{"line":141,"column":16},"end":{"line":142,"column":27}},"83":{"start":{"line":142,"column":20},"end":{"line":142,"column":27}},"84":{"start":{"line":143,"column":16},"end":{"line":148,"column":19}},"85":{"start":{"line":144,"column":20},"end":{"line":144,"column":84}},"86":{"start":{"line":145,"column":20},"end":{"line":147,"column":21}},"87":{"start":{"line":146,"column":24},"end":{"line":146,"column":70}},"88":{"start":{"line":151,"column":16},"end":{"line":152,"column":27}},"89":{"start":{"line":152,"column":20},"end":{"line":152,"column":27}},"90":{"start":{"line":153,"column":16},"end":{"line":153,"column":72}},"91":{"start":{"line":154,"column":16},"end":{"line":157,"column":19}},"92":{"start":{"line":155,"column":20},"end":{"line":155,"column":81}},"93":{"start":{"line":156,"column":20},"end":{"line":156,"column":60}},"94":{"start":{"line":160,"column":32},"end":{"line":160,"column":56}},"95":{"start":{"line":161,"column":8},"end":{"line":163,"column":9}},"96":{"start":{"line":162,"column":12},"end":{"line":162,"column":53}},"97":{"start":{"line":164,"column":8},"end":{"line":164,"column":50}},"98":{"start":{"line":167,"column":8},"end":{"line":167,"column":52}},"99":{"start":{"line":168,"column":8},"end":{"line":168,"column":53}},"100":{"start":{"line":169,"column":8},"end":{"line":169,"column":44}},"101":{"start":{"line":170,"column":8},"end":{"line":170,"column":59}},"102":{"start":{"line":171,"column":8},"end":{"line":175,"column":11}},"103":{"start":{"line":178,"column":8},"end":{"line":178,"column":49}},"104":{"start":{"line":179,"column":8},"end":{"line":179,"column":26}},"105":{"start":{"line":183,"column":8},"end":{"line":194,"column":9}},"106":{"start":{"line":184,"column":30},"end":{"line":184,"column":62}},"107":{"start":{"line":185,"column":12},"end":{"line":192,"column":13}},"108":{"start":{"line":186,"column":16},"end":{"line":191,"column":19}},"109":{"start":{"line":187,"column":20},"end":{"line":189,"column":21}},"110":{"start":{"line":188,"column":24},"end":{"line":188,"column":51}},"111":{"start":{"line":190,"column":20},"end":{"line":190,"column":179}},"112":{"start":{"line":193,"column":12},"end":{"line":193,"column":19}},"113":{"start":{"line":195,"column":8},"end":{"line":203,"column":9}},"114":{"start":{"line":196,"column":12},"end":{"line":201,"column":13}},"115":{"start":{"line":197,"column":16},"end":{"line":197,"column":98}},"116":{"start":{"line":198,"column":16},"end":{"line":200,"column":17}},"117":{"start":{"line":199,"column":20},"end":{"line":199,"column":103}},"118":{"start":{"line":202,"column":12},"end":{"line":202,"column":19}},"119":{"start":{"line":204,"column":8},"end":{"line":206,"column":9}},"120":{"start":{"line":205,"column":12},"end":{"line":205,"column":57}},"121":{"start":{"line":207,"column":8},"end":{"line":209,"column":9}},"122":{"start":{"line":208,"column":12},"end":{"line":208,"column":78}},"123":{"start":{"line":210,"column":8},"end":{"line":215,"column":9}},"124":{"start":{"line":214,"column":12},"end":{"line":214,"column":111}},"125":{"start":{"line":216,"column":8},"end":{"line":221,"column":9}},"126":{"start":{"line":220,"column":12},"end":{"line":220,"column":51}},"127":{"start":{"line":222,"column":8},"end":{"line":224,"column":9}},"128":{"start":{"line":223,"column":12},"end":{"line":223,"column":54}},"129":{"start":{"line":225,"column":8},"end":{"line":227,"column":9}},"130":{"start":{"line":226,"column":12},"end":{"line":226,"column":77}},"131":{"start":{"line":228,"column":8},"end":{"line":233,"column":9}},"132":{"start":{"line":232,"column":12},"end":{"line":232,"column":110}},"133":{"start":{"line":234,"column":8},"end":{"line":236,"column":9}},"134":{"start":{"line":235,"column":12},"end":{"line":235,"column":50}},"135":{"start":{"line":237,"column":8},"end":{"line":239,"column":9}},"136":{"start":{"line":238,"column":12},"end":{"line":238,"column":53}},"137":{"start":{"line":240,"column":8},"end":{"line":242,"column":9}},"138":{"start":{"line":241,"column":12},"end":{"line":241,"column":62}},"139":{"start":{"line":243,"column":8},"end":{"line":245,"column":9}},"140":{"start":{"line":244,"column":12},"end":{"line":244,"column":32}},"141":{"start":{"line":248,"column":8},"end":{"line":248,"column":48}},"142":{"start":{"line":249,"column":8},"end":{"line":249,"column":155}},"143":{"start":{"line":249,"column":51},"end":{"line":249,"column":72}},"144":{"start":{"line":249,"column":102},"end":{"line":249,"column":153}},"145":{"start":{"line":250,"column":8},"end":{"line":259,"column":11}},"146":{"start":{"line":250,"column":61},"end":{"line":250,"column":161}},"147":{"start":{"line":251,"column":12},"end":{"line":258,"column":13}},"148":{"start":{"line":252,"column":16},"end":{"line":257,"column":19}},"149":{"start":{"line":254,"column":20},"end":{"line":256,"column":21}},"150":{"start":{"line":255,"column":24},"end":{"line":255,"column":83}},"151":{"start":{"line":260,"column":8},"end":{"line":265,"column":11}},"152":{"start":{"line":260,"column":51},"end":{"line":260,"column":82}},"153":{"start":{"line":261,"column":12},"end":{"line":264,"column":15}},"154":{"start":{"line":262,"column":45},"end":{"line":262,"column":181}},"155":{"start":{"line":263,"column":16},"end":{"line":263,"column":77}},"156":{"start":{"line":266,"column":8},"end":{"line":271,"column":11}},"157":{"start":{"line":267,"column":12},"end":{"line":270,"column":15}},"158":{"start":{"line":268,"column":16},"end":{"line":268,"column":77}},"159":{"start":{"line":269,"column":16},"end":{"line":269,"column":59}},"160":{"start":{"line":272,"column":8},"end":{"line":303,"column":11}},"161":{"start":{"line":273,"column":12},"end":{"line":276,"column":15}},"162":{"start":{"line":274,"column":16},"end":{"line":274,"column":77}},"163":{"start":{"line":275,"column":16},"end":{"line":275,"column":59}},"164":{"start":{"line":277,"column":30},"end":{"line":277,"column":81}},"165":{"start":{"line":278,"column":12},"end":{"line":302,"column":15}},"166":{"start":{"line":284,"column":16},"end":{"line":286,"column":17}},"167":{"start":{"line":285,"column":20},"end":{"line":285,"column":70}},"168":{"start":{"line":287,"column":16},"end":{"line":292,"column":19}},"169":{"start":{"line":288,"column":20},"end":{"line":288,"column":59}},"170":{"start":{"line":289,"column":20},"end":{"line":289,"column":57}},"171":{"start":{"line":290,"column":20},"end":{"line":290,"column":56}},"172":{"start":{"line":291,"column":20},"end":{"line":291,"column":82}},"173":{"start":{"line":295,"column":16},"end":{"line":301,"column":19}},"174":{"start":{"line":296,"column":37},"end":{"line":298,"column":112}},"175":{"start":{"line":299,"column":20},"end":{"line":299,"column":60}},"176":{"start":{"line":300,"column":20},"end":{"line":300,"column":78}},"177":{"start":{"line":304,"column":8},"end":{"line":308,"column":11}},"178":{"start":{"line":305,"column":12},"end":{"line":307,"column":15}},"179":{"start":{"line":306,"column":16},"end":{"line":306,"column":66}},"180":{"start":{"line":312,"column":8},"end":{"line":312,"column":48}},"181":{"start":{"line":313,"column":8},"end":{"line":313,"column":45}},"182":{"start":{"line":314,"column":8},"end":{"line":314,"column":78}},"183":{"start":{"line":315,"column":8},"end":{"line":315,"column":77}},"184":{"start":{"line":316,"column":8},"end":{"line":316,"column":83}},"185":{"start":{"line":317,"column":8},"end":{"line":317,"column":37}},"186":{"start":{"line":318,"column":8},"end":{"line":318,"column":38}},"187":{"start":{"line":319,"column":8},"end":{"line":319,"column":54}},"188":{"start":{"line":322,"column":0},"end":{"line":322,"column":36}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":138},"end":{"line":53,"column":5}},"line":19},"1":{"name":"(anonymous_1)","decl":{"start":{"line":54,"column":4},"end":{"line":54,"column":5}},"loc":{"start":{"line":54,"column":19},"end":{"line":59,"column":5}},"line":54},"2":{"name":"(anonymous_2)","decl":{"start":{"line":60,"column":4},"end":{"line":60,"column":5}},"loc":{"start":{"line":60,"column":18},"end":{"line":65,"column":5}},"line":60},"3":{"name":"(anonymous_3)","decl":{"start":{"line":66,"column":4},"end":{"line":66,"column":5}},"loc":{"start":{"line":66,"column":24},"end":{"line":71,"column":5}},"line":66},"4":{"name":"(anonymous_4)","decl":{"start":{"line":72,"column":4},"end":{"line":72,"column":5}},"loc":{"start":{"line":72,"column":28},"end":{"line":77,"column":5}},"line":72},"5":{"name":"(anonymous_5)","decl":{"start":{"line":78,"column":4},"end":{"line":78,"column":5}},"loc":{"start":{"line":78,"column":25},"end":{"line":83,"column":5}},"line":78},"6":{"name":"(anonymous_6)","decl":{"start":{"line":80,"column":39},"end":{"line":80,"column":40}},"loc":{"start":{"line":80,"column":50},"end":{"line":82,"column":9}},"line":80},"7":{"name":"(anonymous_7)","decl":{"start":{"line":84,"column":4},"end":{"line":84,"column":5}},"loc":{"start":{"line":84,"column":39},"end":{"line":107,"column":5}},"line":84},"8":{"name":"(anonymous_8)","decl":{"start":{"line":85,"column":39},"end":{"line":85,"column":40}},"loc":{"start":{"line":85,"column":50},"end":{"line":87,"column":9}},"line":85},"9":{"name":"(anonymous_9)","decl":{"start":{"line":89,"column":18},"end":{"line":89,"column":19}},"loc":{"start":{"line":89,"column":32},"end":{"line":97,"column":9}},"line":89},"10":{"name":"(anonymous_10)","decl":{"start":{"line":93,"column":43},"end":{"line":93,"column":44}},"loc":{"start":{"line":93,"column":54},"end":{"line":96,"column":13}},"line":93},"11":{"name":"(anonymous_11)","decl":{"start":{"line":98,"column":19},"end":{"line":98,"column":20}},"loc":{"start":{"line":98,"column":30},"end":{"line":106,"column":9}},"line":98},"12":{"name":"(anonymous_12)","decl":{"start":{"line":102,"column":43},"end":{"line":102,"column":44}},"loc":{"start":{"line":102,"column":54},"end":{"line":105,"column":13}},"line":102},"13":{"name":"(anonymous_13)","decl":{"start":{"line":108,"column":4},"end":{"line":108,"column":5}},"loc":{"start":{"line":108,"column":29},"end":{"line":165,"column":5}},"line":108},"14":{"name":"(anonymous_14)","decl":{"start":{"line":109,"column":33},"end":{"line":109,"column":34}},"loc":{"start":{"line":109,"column":45},"end":{"line":133,"column":9}},"line":109},"15":{"name":"(anonymous_15)","decl":{"start":{"line":110,"column":43},"end":{"line":110,"column":44}},"loc":{"start":{"line":110,"column":54},"end":{"line":112,"column":13}},"line":110},"16":{"name":"(anonymous_16)","decl":{"start":{"line":115,"column":22},"end":{"line":115,"column":23}},"loc":{"start":{"line":115,"column":36},"end":{"line":123,"column":13}},"line":115},"17":{"name":"(anonymous_17)","decl":{"start":{"line":119,"column":47},"end":{"line":119,"column":48}},"loc":{"start":{"line":119,"column":58},"end":{"line":122,"column":17}},"line":119},"18":{"name":"(anonymous_18)","decl":{"start":{"line":124,"column":23},"end":{"line":124,"column":24}},"loc":{"start":{"line":124,"column":34},"end":{"line":132,"column":13}},"line":124},"19":{"name":"(anonymous_19)","decl":{"start":{"line":128,"column":47},"end":{"line":128,"column":48}},"loc":{"start":{"line":128,"column":58},"end":{"line":131,"column":17}},"line":128},"20":{"name":"(anonymous_20)","decl":{"start":{"line":134,"column":37},"end":{"line":134,"column":38}},"loc":{"start":{"line":134,"column":49},"end":{"line":159,"column":9}},"line":134},"21":{"name":"(anonymous_21)","decl":{"start":{"line":135,"column":43},"end":{"line":135,"column":44}},"loc":{"start":{"line":135,"column":54},"end":{"line":137,"column":13}},"line":135},"22":{"name":"(anonymous_22)","decl":{"start":{"line":140,"column":22},"end":{"line":140,"column":23}},"loc":{"start":{"line":140,"column":36},"end":{"line":149,"column":13}},"line":140},"23":{"name":"(anonymous_23)","decl":{"start":{"line":143,"column":47},"end":{"line":143,"column":48}},"loc":{"start":{"line":143,"column":58},"end":{"line":148,"column":17}},"line":143},"24":{"name":"(anonymous_24)","decl":{"start":{"line":150,"column":23},"end":{"line":150,"column":24}},"loc":{"start":{"line":150,"column":34},"end":{"line":158,"column":13}},"line":150},"25":{"name":"(anonymous_25)","decl":{"start":{"line":154,"column":47},"end":{"line":154,"column":48}},"loc":{"start":{"line":154,"column":58},"end":{"line":157,"column":17}},"line":154},"26":{"name":"(anonymous_26)","decl":{"start":{"line":166,"column":4},"end":{"line":166,"column":5}},"loc":{"start":{"line":166,"column":23},"end":{"line":176,"column":5}},"line":166},"27":{"name":"(anonymous_27)","decl":{"start":{"line":177,"column":4},"end":{"line":177,"column":5}},"loc":{"start":{"line":177,"column":12},"end":{"line":180,"column":5}},"line":177},"28":{"name":"(anonymous_28)","decl":{"start":{"line":181,"column":4},"end":{"line":181,"column":5}},"loc":{"start":{"line":181,"column":51},"end":{"line":246,"column":5}},"line":181},"29":{"name":"(anonymous_29)","decl":{"start":{"line":186,"column":47},"end":{"line":186,"column":48}},"loc":{"start":{"line":186,"column":58},"end":{"line":191,"column":17}},"line":186},"30":{"name":"(anonymous_30)","decl":{"start":{"line":247,"column":4},"end":{"line":247,"column":5}},"loc":{"start":{"line":247,"column":18},"end":{"line":309,"column":5}},"line":247},"31":{"name":"(anonymous_31)","decl":{"start":{"line":249,"column":40},"end":{"line":249,"column":41}},"loc":{"start":{"line":249,"column":51},"end":{"line":249,"column":72}},"line":249},"32":{"name":"(anonymous_32)","decl":{"start":{"line":249,"column":74},"end":{"line":249,"column":75}},"loc":{"start":{"line":249,"column":102},"end":{"line":249,"column":153}},"line":249},"33":{"name":"(anonymous_33)","decl":{"start":{"line":250,"column":40},"end":{"line":250,"column":41}},"loc":{"start":{"line":250,"column":51},"end":{"line":250,"column":163}},"line":250},"34":{"name":"(anonymous_34)","decl":{"start":{"line":250,"column":165},"end":{"line":250,"column":166}},"loc":{"start":{"line":250,"column":201},"end":{"line":259,"column":9}},"line":250},"35":{"name":"(anonymous_35)","decl":{"start":{"line":252,"column":47},"end":{"line":252,"column":48}},"loc":{"start":{"line":252,"column":58},"end":{"line":257,"column":17}},"line":252},"36":{"name":"(anonymous_36)","decl":{"start":{"line":260,"column":40},"end":{"line":260,"column":41}},"loc":{"start":{"line":260,"column":51},"end":{"line":260,"column":82}},"line":260},"37":{"name":"(anonymous_37)","decl":{"start":{"line":260,"column":84},"end":{"line":260,"column":85}},"loc":{"start":{"line":260,"column":99},"end":{"line":265,"column":9}},"line":260},"38":{"name":"(anonymous_38)","decl":{"start":{"line":261,"column":50},"end":{"line":261,"column":51}},"loc":{"start":{"line":261,"column":61},"end":{"line":264,"column":13}},"line":261},"39":{"name":"(anonymous_39)","decl":{"start":{"line":266,"column":55},"end":{"line":266,"column":56}},"loc":{"start":{"line":266,"column":69},"end":{"line":271,"column":9}},"line":266},"40":{"name":"(anonymous_40)","decl":{"start":{"line":267,"column":43},"end":{"line":267,"column":44}},"loc":{"start":{"line":267,"column":54},"end":{"line":270,"column":13}},"line":267},"41":{"name":"(anonymous_41)","decl":{"start":{"line":272,"column":55},"end":{"line":272,"column":56}},"loc":{"start":{"line":272,"column":69},"end":{"line":303,"column":9}},"line":272},"42":{"name":"(anonymous_42)","decl":{"start":{"line":273,"column":43},"end":{"line":273,"column":44}},"loc":{"start":{"line":273,"column":54},"end":{"line":276,"column":13}},"line":273},"43":{"name":"(anonymous_43)","decl":{"start":{"line":283,"column":22},"end":{"line":283,"column":23}},"loc":{"start":{"line":283,"column":34},"end":{"line":293,"column":13}},"line":283},"44":{"name":"(anonymous_44)","decl":{"start":{"line":287,"column":47},"end":{"line":287,"column":48}},"loc":{"start":{"line":287,"column":58},"end":{"line":292,"column":17}},"line":287},"45":{"name":"(anonymous_45)","decl":{"start":{"line":294,"column":23},"end":{"line":294,"column":24}},"loc":{"start":{"line":294,"column":34},"end":{"line":302,"column":13}},"line":294},"46":{"name":"(anonymous_46)","decl":{"start":{"line":295,"column":47},"end":{"line":295,"column":48}},"loc":{"start":{"line":295,"column":58},"end":{"line":301,"column":17}},"line":295},"47":{"name":"(anonymous_47)","decl":{"start":{"line":304,"column":54},"end":{"line":304,"column":55}},"loc":{"start":{"line":304,"column":72},"end":{"line":308,"column":9}},"line":304},"48":{"name":"(anonymous_48)","decl":{"start":{"line":305,"column":43},"end":{"line":305,"column":44}},"loc":{"start":{"line":305,"column":54},"end":{"line":307,"column":13}},"line":305},"49":{"name":"(anonymous_49)","decl":{"start":{"line":310,"column":4},"end":{"line":310,"column":5}},"loc":{"start":{"line":310,"column":12},"end":{"line":320,"column":5}},"line":310}},"branchMap":{"0":{"loc":{"start":{"line":28,"column":8},"end":{"line":30,"column":9}},"type":"if","locations":[{"start":{"line":28,"column":8},"end":{"line":30,"column":9}},{"start":{"line":28,"column":8},"end":{"line":30,"column":9}}],"line":28},"1":{"loc":{"start":{"line":28,"column":12},"end":{"line":28,"column":129}},"type":"binary-expr","locations":[{"start":{"line":28,"column":12},"end":{"line":28,"column":37}},{"start":{"line":28,"column":41},"end":{"line":28,"column":112}},{"start":{"line":28,"column":116},"end":{"line":28,"column":129}}],"line":28},"2":{"loc":{"start":{"line":28,"column":43},"end":{"line":28,"column":111}},"type":"cond-expr","locations":[{"start":{"line":28,"column":92},"end":{"line":28,"column":98}},{"start":{"line":28,"column":101},"end":{"line":28,"column":111}}],"line":28},"3":{"loc":{"start":{"line":28,"column":43},"end":{"line":28,"column":89}},"type":"binary-expr","locations":[{"start":{"line":28,"column":43},"end":{"line":28,"column":72}},{"start":{"line":28,"column":76},"end":{"line":28,"column":89}}],"line":28},"4":{"loc":{"start":{"line":35,"column":29},"end":{"line":35,"column":173}},"type":"cond-expr","locations":[{"start":{"line":35,"column":149},"end":{"line":35,"column":155}},{"start":{"line":35,"column":158},"end":{"line":35,"column":173}}],"line":35},"5":{"loc":{"start":{"line":35,"column":29},"end":{"line":35,"column":146}},"type":"binary-expr","locations":[{"start":{"line":35,"column":29},"end":{"line":35,"column":129}},{"start":{"line":35,"column":133},"end":{"line":35,"column":146}}],"line":35},"6":{"loc":{"start":{"line":35,"column":35},"end":{"line":35,"column":119}},"type":"cond-expr","locations":[{"start":{"line":35,"column":95},"end":{"line":35,"column":101}},{"start":{"line":35,"column":104},"end":{"line":35,"column":119}}],"line":35},"7":{"loc":{"start":{"line":35,"column":35},"end":{"line":35,"column":92}},"type":"binary-expr","locations":[{"start":{"line":35,"column":35},"end":{"line":35,"column":75}},{"start":{"line":35,"column":79},"end":{"line":35,"column":92}}],"line":35},"8":{"loc":{"start":{"line":38,"column":21},"end":{"line":38,"column":99}},"type":"cond-expr","locations":[{"start":{"line":38,"column":80},"end":{"line":38,"column":86}},{"start":{"line":38,"column":89},"end":{"line":38,"column":99}}],"line":38},"9":{"loc":{"start":{"line":38,"column":21},"end":{"line":38,"column":77}},"type":"binary-expr","locations":[{"start":{"line":38,"column":21},"end":{"line":38,"column":60}},{"start":{"line":38,"column":64},"end":{"line":38,"column":77}}],"line":38},"10":{"loc":{"start":{"line":39,"column":25},"end":{"line":41,"column":27}},"type":"cond-expr","locations":[{"start":{"line":40,"column":18},"end":{"line":40,"column":95}},{"start":{"line":41,"column":18},"end":{"line":41,"column":27}}],"line":39},"11":{"loc":{"start":{"line":43,"column":20},"end":{"line":43,"column":106}},"type":"binary-expr","locations":[{"start":{"line":43,"column":21},"end":{"line":43,"column":99}},{"start":{"line":43,"column":104},"end":{"line":43,"column":106}}],"line":43},"12":{"loc":{"start":{"line":43,"column":21},"end":{"line":43,"column":99}},"type":"cond-expr","locations":[{"start":{"line":43,"column":80},"end":{"line":43,"column":86}},{"start":{"line":43,"column":89},"end":{"line":43,"column":99}}],"line":43},"13":{"loc":{"start":{"line":43,"column":21},"end":{"line":43,"column":77}},"type":"binary-expr","locations":[{"start":{"line":43,"column":21},"end":{"line":43,"column":60}},{"start":{"line":43,"column":64},"end":{"line":43,"column":77}}],"line":43},"14":{"loc":{"start":{"line":44,"column":20},"end":{"line":44,"column":100}},"type":"cond-expr","locations":[{"start":{"line":44,"column":48},"end":{"line":44,"column":95}},{"start":{"line":44,"column":98},"end":{"line":44,"column":100}}],"line":44},"15":{"loc":{"start":{"line":49,"column":27},"end":{"line":49,"column":95}},"type":"cond-expr","locations":[{"start":{"line":49,"column":76},"end":{"line":49,"column":82}},{"start":{"line":49,"column":85},"end":{"line":49,"column":95}}],"line":49},"16":{"loc":{"start":{"line":49,"column":27},"end":{"line":49,"column":73}},"type":"binary-expr","locations":[{"start":{"line":49,"column":27},"end":{"line":49,"column":56}},{"start":{"line":49,"column":60},"end":{"line":49,"column":73}}],"line":49},"17":{"loc":{"start":{"line":50,"column":23},"end":{"line":50,"column":164}},"type":"cond-expr","locations":[{"start":{"line":50,"column":143},"end":{"line":50,"column":149}},{"start":{"line":50,"column":152},"end":{"line":50,"column":164}}],"line":50},"18":{"loc":{"start":{"line":50,"column":23},"end":{"line":50,"column":140}},"type":"binary-expr","locations":[{"start":{"line":50,"column":23},"end":{"line":50,"column":123}},{"start":{"line":50,"column":127},"end":{"line":50,"column":140}}],"line":50},"19":{"loc":{"start":{"line":50,"column":29},"end":{"line":50,"column":113}},"type":"cond-expr","locations":[{"start":{"line":50,"column":89},"end":{"line":50,"column":95}},{"start":{"line":50,"column":98},"end":{"line":50,"column":113}}],"line":50},"20":{"loc":{"start":{"line":50,"column":29},"end":{"line":50,"column":86}},"type":"binary-expr","locations":[{"start":{"line":50,"column":29},"end":{"line":50,"column":69}},{"start":{"line":50,"column":73},"end":{"line":50,"column":86}}],"line":50},"21":{"loc":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"type":"if","locations":[{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},{"start":{"line":55,"column":8},"end":{"line":57,"column":9}}],"line":55},"22":{"loc":{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},"type":"if","locations":[{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},{"start":{"line":61,"column":8},"end":{"line":63,"column":9}}],"line":61},"23":{"loc":{"start":{"line":67,"column":8},"end":{"line":69,"column":9}},"type":"if","locations":[{"start":{"line":67,"column":8},"end":{"line":69,"column":9}},{"start":{"line":67,"column":8},"end":{"line":69,"column":9}}],"line":67},"24":{"loc":{"start":{"line":73,"column":8},"end":{"line":75,"column":9}},"type":"if","locations":[{"start":{"line":73,"column":8},"end":{"line":75,"column":9}},{"start":{"line":73,"column":8},"end":{"line":75,"column":9}}],"line":73},"25":{"loc":{"start":{"line":88,"column":72},"end":{"line":88,"column":99}},"type":"binary-expr","locations":[{"start":{"line":88,"column":72},"end":{"line":88,"column":89}},{"start":{"line":88,"column":93},"end":{"line":88,"column":99}}],"line":88},"26":{"loc":{"start":{"line":88,"column":101},"end":{"line":88,"column":136}},"type":"binary-expr","locations":[{"start":{"line":88,"column":101},"end":{"line":88,"column":130}},{"start":{"line":88,"column":134},"end":{"line":88,"column":136}}],"line":88},"27":{"loc":{"start":{"line":91,"column":12},"end":{"line":92,"column":23}},"type":"if","locations":[{"start":{"line":91,"column":12},"end":{"line":92,"column":23}},{"start":{"line":91,"column":12},"end":{"line":92,"column":23}}],"line":91},"28":{"loc":{"start":{"line":100,"column":12},"end":{"line":101,"column":23}},"type":"if","locations":[{"start":{"line":100,"column":12},"end":{"line":101,"column":23}},{"start":{"line":100,"column":12},"end":{"line":101,"column":23}}],"line":100},"29":{"loc":{"start":{"line":117,"column":16},"end":{"line":118,"column":27}},"type":"if","locations":[{"start":{"line":117,"column":16},"end":{"line":118,"column":27}},{"start":{"line":117,"column":16},"end":{"line":118,"column":27}}],"line":117},"30":{"loc":{"start":{"line":126,"column":16},"end":{"line":127,"column":27}},"type":"if","locations":[{"start":{"line":126,"column":16},"end":{"line":127,"column":27}},{"start":{"line":126,"column":16},"end":{"line":127,"column":27}}],"line":126},"31":{"loc":{"start":{"line":141,"column":16},"end":{"line":142,"column":27}},"type":"if","locations":[{"start":{"line":141,"column":16},"end":{"line":142,"column":27}},{"start":{"line":141,"column":16},"end":{"line":142,"column":27}}],"line":141},"32":{"loc":{"start":{"line":145,"column":20},"end":{"line":147,"column":21}},"type":"if","locations":[{"start":{"line":145,"column":20},"end":{"line":147,"column":21}},{"start":{"line":145,"column":20},"end":{"line":147,"column":21}}],"line":145},"33":{"loc":{"start":{"line":151,"column":16},"end":{"line":152,"column":27}},"type":"if","locations":[{"start":{"line":151,"column":16},"end":{"line":152,"column":27}},{"start":{"line":151,"column":16},"end":{"line":152,"column":27}}],"line":151},"34":{"loc":{"start":{"line":161,"column":8},"end":{"line":163,"column":9}},"type":"if","locations":[{"start":{"line":161,"column":8},"end":{"line":163,"column":9}},{"start":{"line":161,"column":8},"end":{"line":163,"column":9}}],"line":161},"35":{"loc":{"start":{"line":183,"column":8},"end":{"line":194,"column":9}},"type":"if","locations":[{"start":{"line":183,"column":8},"end":{"line":194,"column":9}},{"start":{"line":183,"column":8},"end":{"line":194,"column":9}}],"line":183},"36":{"loc":{"start":{"line":185,"column":12},"end":{"line":192,"column":13}},"type":"if","locations":[{"start":{"line":185,"column":12},"end":{"line":192,"column":13}},{"start":{"line":185,"column":12},"end":{"line":192,"column":13}}],"line":185},"37":{"loc":{"start":{"line":187,"column":20},"end":{"line":189,"column":21}},"type":"if","locations":[{"start":{"line":187,"column":20},"end":{"line":189,"column":21}},{"start":{"line":187,"column":20},"end":{"line":189,"column":21}}],"line":187},"38":{"loc":{"start":{"line":195,"column":8},"end":{"line":203,"column":9}},"type":"if","locations":[{"start":{"line":195,"column":8},"end":{"line":203,"column":9}},{"start":{"line":195,"column":8},"end":{"line":203,"column":9}}],"line":195},"39":{"loc":{"start":{"line":196,"column":12},"end":{"line":201,"column":13}},"type":"if","locations":[{"start":{"line":196,"column":12},"end":{"line":201,"column":13}},{"start":{"line":196,"column":12},"end":{"line":201,"column":13}}],"line":196},"40":{"loc":{"start":{"line":197,"column":16},"end":{"line":197,"column":97}},"type":"cond-expr","locations":[{"start":{"line":197,"column":65},"end":{"line":197,"column":71}},{"start":{"line":197,"column":74},"end":{"line":197,"column":97}}],"line":197},"41":{"loc":{"start":{"line":197,"column":16},"end":{"line":197,"column":62}},"type":"binary-expr","locations":[{"start":{"line":197,"column":16},"end":{"line":197,"column":45}},{"start":{"line":197,"column":49},"end":{"line":197,"column":62}}],"line":197},"42":{"loc":{"start":{"line":198,"column":16},"end":{"line":200,"column":17}},"type":"if","locations":[{"start":{"line":198,"column":16},"end":{"line":200,"column":17}},{"start":{"line":198,"column":16},"end":{"line":200,"column":17}}],"line":198},"43":{"loc":{"start":{"line":199,"column":20},"end":{"line":199,"column":102}},"type":"cond-expr","locations":[{"start":{"line":199,"column":70},"end":{"line":199,"column":76}},{"start":{"line":199,"column":79},"end":{"line":199,"column":102}}],"line":199},"44":{"loc":{"start":{"line":199,"column":20},"end":{"line":199,"column":67}},"type":"binary-expr","locations":[{"start":{"line":199,"column":20},"end":{"line":199,"column":50}},{"start":{"line":199,"column":54},"end":{"line":199,"column":67}}],"line":199},"45":{"loc":{"start":{"line":204,"column":8},"end":{"line":206,"column":9}},"type":"if","locations":[{"start":{"line":204,"column":8},"end":{"line":206,"column":9}},{"start":{"line":204,"column":8},"end":{"line":206,"column":9}}],"line":204},"46":{"loc":{"start":{"line":207,"column":8},"end":{"line":209,"column":9}},"type":"if","locations":[{"start":{"line":207,"column":8},"end":{"line":209,"column":9}},{"start":{"line":207,"column":8},"end":{"line":209,"column":9}}],"line":207},"47":{"loc":{"start":{"line":210,"column":8},"end":{"line":215,"column":9}},"type":"if","locations":[{"start":{"line":210,"column":8},"end":{"line":215,"column":9}},{"start":{"line":210,"column":8},"end":{"line":215,"column":9}}],"line":210},"48":{"loc":{"start":{"line":216,"column":8},"end":{"line":221,"column":9}},"type":"if","locations":[{"start":{"line":216,"column":8},"end":{"line":221,"column":9}},{"start":{"line":216,"column":8},"end":{"line":221,"column":9}}],"line":216},"49":{"loc":{"start":{"line":222,"column":8},"end":{"line":224,"column":9}},"type":"if","locations":[{"start":{"line":222,"column":8},"end":{"line":224,"column":9}},{"start":{"line":222,"column":8},"end":{"line":224,"column":9}}],"line":222},"50":{"loc":{"start":{"line":225,"column":8},"end":{"line":227,"column":9}},"type":"if","locations":[{"start":{"line":225,"column":8},"end":{"line":227,"column":9}},{"start":{"line":225,"column":8},"end":{"line":227,"column":9}}],"line":225},"51":{"loc":{"start":{"line":228,"column":8},"end":{"line":233,"column":9}},"type":"if","locations":[{"start":{"line":228,"column":8},"end":{"line":233,"column":9}},{"start":{"line":228,"column":8},"end":{"line":233,"column":9}}],"line":228},"52":{"loc":{"start":{"line":234,"column":8},"end":{"line":236,"column":9}},"type":"if","locations":[{"start":{"line":234,"column":8},"end":{"line":236,"column":9}},{"start":{"line":234,"column":8},"end":{"line":236,"column":9}}],"line":234},"53":{"loc":{"start":{"line":237,"column":8},"end":{"line":239,"column":9}},"type":"if","locations":[{"start":{"line":237,"column":8},"end":{"line":239,"column":9}},{"start":{"line":237,"column":8},"end":{"line":239,"column":9}}],"line":237},"54":{"loc":{"start":{"line":240,"column":8},"end":{"line":242,"column":9}},"type":"if","locations":[{"start":{"line":240,"column":8},"end":{"line":242,"column":9}},{"start":{"line":240,"column":8},"end":{"line":242,"column":9}}],"line":240},"55":{"loc":{"start":{"line":243,"column":8},"end":{"line":245,"column":9}},"type":"if","locations":[{"start":{"line":243,"column":8},"end":{"line":245,"column":9}},{"start":{"line":243,"column":8},"end":{"line":245,"column":9}}],"line":243},"56":{"loc":{"start":{"line":250,"column":68},"end":{"line":250,"column":160}},"type":"cond-expr","locations":[{"start":{"line":250,"column":138},"end":{"line":250,"column":144}},{"start":{"line":250,"column":147},"end":{"line":250,"column":160}}],"line":250},"57":{"loc":{"start":{"line":250,"column":68},"end":{"line":250,"column":135}},"type":"binary-expr","locations":[{"start":{"line":250,"column":68},"end":{"line":250,"column":118}},{"start":{"line":250,"column":122},"end":{"line":250,"column":135}}],"line":250},"58":{"loc":{"start":{"line":251,"column":12},"end":{"line":258,"column":13}},"type":"if","locations":[{"start":{"line":251,"column":12},"end":{"line":258,"column":13}},{"start":{"line":251,"column":12},"end":{"line":258,"column":13}}],"line":251},"59":{"loc":{"start":{"line":251,"column":16},"end":{"line":251,"column":83}},"type":"binary-expr","locations":[{"start":{"line":251,"column":16},"end":{"line":251,"column":26}},{"start":{"line":251,"column":30},"end":{"line":251,"column":48}},{"start":{"line":251,"column":52},"end":{"line":251,"column":83}}],"line":251},"60":{"loc":{"start":{"line":254,"column":20},"end":{"line":256,"column":21}},"type":"if","locations":[{"start":{"line":254,"column":20},"end":{"line":256,"column":21}},{"start":{"line":254,"column":20},"end":{"line":256,"column":21}}],"line":254},"61":{"loc":{"start":{"line":254,"column":25},"end":{"line":254,"column":122}},"type":"cond-expr","locations":[{"start":{"line":254,"column":91},"end":{"line":254,"column":97}},{"start":{"line":254,"column":100},"end":{"line":254,"column":122}}],"line":254},"62":{"loc":{"start":{"line":254,"column":25},"end":{"line":254,"column":88}},"type":"binary-expr","locations":[{"start":{"line":254,"column":25},"end":{"line":254,"column":71}},{"start":{"line":254,"column":75},"end":{"line":254,"column":88}}],"line":254},"63":{"loc":{"start":{"line":262,"column":110},"end":{"line":262,"column":180}},"type":"cond-expr","locations":[{"start":{"line":262,"column":155},"end":{"line":262,"column":161}},{"start":{"line":262,"column":164},"end":{"line":262,"column":180}}],"line":262},"64":{"loc":{"start":{"line":262,"column":110},"end":{"line":262,"column":152}},"type":"binary-expr","locations":[{"start":{"line":262,"column":110},"end":{"line":262,"column":128}},{"start":{"line":262,"column":132},"end":{"line":262,"column":152}}],"line":262},"65":{"loc":{"start":{"line":284,"column":16},"end":{"line":286,"column":17}},"type":"if","locations":[{"start":{"line":284,"column":16},"end":{"line":286,"column":17}},{"start":{"line":284,"column":16},"end":{"line":286,"column":17}}],"line":284},"66":{"loc":{"start":{"line":296,"column":37},"end":{"line":298,"column":112}},"type":"cond-expr","locations":[{"start":{"line":297,"column":26},"end":{"line":297,"column":31}},{"start":{"line":298,"column":26},"end":{"line":298,"column":112}}],"line":296},"67":{"loc":{"start":{"line":314,"column":8},"end":{"line":314,"column":77}},"type":"cond-expr","locations":[{"start":{"line":314,"column":58},"end":{"line":314,"column":64}},{"start":{"line":314,"column":67},"end":{"line":314,"column":77}}],"line":314},"68":{"loc":{"start":{"line":314,"column":8},"end":{"line":314,"column":55}},"type":"binary-expr","locations":[{"start":{"line":314,"column":8},"end":{"line":314,"column":38}},{"start":{"line":314,"column":42},"end":{"line":314,"column":55}}],"line":314},"69":{"loc":{"start":{"line":315,"column":8},"end":{"line":315,"column":76}},"type":"cond-expr","locations":[{"start":{"line":315,"column":57},"end":{"line":315,"column":63}},{"start":{"line":315,"column":66},"end":{"line":315,"column":76}}],"line":315},"70":{"loc":{"start":{"line":315,"column":8},"end":{"line":315,"column":54}},"type":"binary-expr","locations":[{"start":{"line":315,"column":8},"end":{"line":315,"column":37}},{"start":{"line":315,"column":41},"end":{"line":315,"column":54}}],"line":315},"71":{"loc":{"start":{"line":316,"column":8},"end":{"line":316,"column":82}},"type":"cond-expr","locations":[{"start":{"line":316,"column":63},"end":{"line":316,"column":69}},{"start":{"line":316,"column":72},"end":{"line":316,"column":82}}],"line":316},"72":{"loc":{"start":{"line":316,"column":8},"end":{"line":316,"column":60}},"type":"binary-expr","locations":[{"start":{"line":316,"column":8},"end":{"line":316,"column":43}},{"start":{"line":316,"column":47},"end":{"line":316,"column":60}}],"line":316}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":115,"17":115,"18":115,"19":115,"20":115,"21":115,"22":115,"23":115,"24":3,"25":112,"26":112,"27":112,"28":112,"29":112,"30":112,"31":112,"32":37,"33":18,"34":37,"35":30,"36":11,"37":30,"38":3,"39":3,"40":3,"41":31,"42":30,"43":31,"44":110,"45":105,"46":105,"47":112,"48":112,"49":112,"50":7,"51":7,"52":0,"53":7,"54":7,"55":7,"56":105,"57":105,"58":32,"59":73,"60":73,"61":73,"62":110,"63":107,"64":107,"65":107,"66":106,"67":106,"68":0,"69":106,"70":106,"71":106,"72":1,"73":1,"74":0,"75":1,"76":1,"77":1,"78":110,"79":110,"80":110,"81":110,"82":102,"83":0,"84":102,"85":102,"86":102,"87":11,"88":1,"89":0,"90":1,"91":1,"92":1,"93":1,"94":110,"95":110,"96":107,"97":110,"98":110,"99":110,"100":110,"101":110,"102":110,"103":8,"104":8,"105":365,"106":5,"107":5,"108":1,"109":1,"110":0,"111":1,"112":5,"113":360,"114":21,"115":21,"116":21,"117":12,"118":21,"119":339,"120":0,"121":339,"122":17,"123":322,"124":2,"125":320,"126":11,"127":309,"128":7,"129":302,"130":10,"131":292,"132":2,"133":290,"134":10,"135":280,"136":8,"137":272,"138":3,"139":269,"140":4,"141":103,"142":103,"143":1276,"144":364,"145":103,"146":1276,"147":32,"148":9,"149":9,"150":1,"151":103,"152":1276,"153":82,"154":82,"155":82,"156":103,"157":78,"158":78,"159":78,"160":103,"161":29,"162":29,"163":29,"164":29,"165":29,"166":29,"167":0,"168":29,"169":29,"170":29,"171":29,"172":29,"173":0,"174":0,"175":0,"176":0,"177":103,"178":21,"179":21,"180":52,"181":52,"182":52,"183":52,"184":52,"185":52,"186":52,"187":52,"188":1},"f":{"0":115,"1":37,"2":30,"3":3,"4":31,"5":110,"6":105,"7":112,"8":112,"9":7,"10":7,"11":105,"12":73,"13":110,"14":107,"15":107,"16":106,"17":106,"18":1,"19":1,"20":110,"21":110,"22":102,"23":102,"24":1,"25":1,"26":110,"27":8,"28":365,"29":1,"30":103,"31":1276,"32":364,"33":1276,"34":32,"35":9,"36":1276,"37":82,"38":82,"39":78,"40":78,"41":29,"42":29,"43":29,"44":29,"45":0,"46":0,"47":21,"48":21,"49":52},"b":{"0":[3,112],"1":[115,114,113],"2":[0,114],"3":[114,114],"4":[10,102],"5":[112,112],"6":[0,112],"7":[112,112],"8":[0,112],"9":[112,112],"10":[112,0],"11":[112,0],"12":[0,112],"13":[112,112],"14":[1,111],"15":[0,112],"16":[112,112],"17":[10,102],"18":[112,112],"19":[0,112],"20":[112,112],"21":[18,19],"22":[11,19],"23":[3,0],"24":[30,1],"25":[112,0],"26":[112,0],"27":[0,7],"28":[32,73],"29":[0,106],"30":[0,1],"31":[0,102],"32":[11,91],"33":[0,1],"34":[107,3],"35":[5,360],"36":[1,4],"37":[0,1],"38":[21,339],"39":[21,0],"40":[12,9],"41":[21,21],"42":[12,9],"43":[2,10],"44":[12,12],"45":[0,339],"46":[17,322],"47":[2,320],"48":[11,309],"49":[7,302],"50":[10,292],"51":[2,290],"52":[10,280],"53":[8,272],"54":[3,269],"55":[4,265],"56":[1080,196],"57":[1276,196],"58":[9,23],"59":[32,32,10],"60":[1,8],"61":[8,1],"62":[9,9],"63":[14,68],"64":[82,68],"65":[0,29],"66":[0,0],"67":[34,18],"68":[52,52],"69":[41,11],"70":[52,52],"71":[49,3],"72":[52,52]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/orchestrate.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/orchestrate.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * 1. register listeners:\n * onChain listener from chainImplementation\n * civicPass listener (postMessage)\n * (potentially handle separately) civicSign listener and responder (postMessage)\n * call gatekeeperClient.getRecord (if GKN requires it) to get gatekeeperRecord, then update gatekeeperRecord state\n *\n * 2. Respond to specific internal states for things that we need to take action on:\n *  - issuanceProofCollectionComplete: use gatekeeperClient to request a token using the proof from  civicPass, then update gatekeeperRecord state\n *  - refreshProofCollectionComplete: use gatekeeperClient to request a token refresh using the proof from civicPass, then update gatekeeperRecord state\n */\nimport { ListenerManager } from './listeners';\nimport { MessageEventInterface, PostMessageTargetCallback } from './types/eventInterface';\nimport { prefixLogger } from './logger';\nimport { FetchConfig, InputStatus } from './types/fetch';\nimport { GatekeeperClient } from './gatekeeperClient';\nimport { ChainClientInterface, DID, GatewayToken } from './types/chain';\nimport { WalletAdapter } from './types/parameters';\nimport { ExtendedGatewayStatus, GatewayStatus, InternalGatewayStatus } from './types/gateway';\nimport { getPayer } from './utils/inputs';\nimport { eventEmitter, handleRemoteSignEvent, RemoteSignWindowEventEmitter } from './remoteSign';\nimport { LoggingInterface } from './logger/provider.logger';\nimport { OrchestratorInputs } from './types/orchestrate';\nimport { Issuance } from './issuance';\nimport { CivicPassMessageAction } from './types/civicPass';\nimport { Store } from './state/state';\nimport { Refresh } from './refresh';\nimport { getUserInteractionStatusFromAction } from './utils/userInteraction';\nimport { PartnerReview } from './partnerReview';\nimport { tokenNoGatekeeperRecordError } from './state/common';\nimport { ChainError, ErrorCode } from './utils/errors';\nimport { getGatekeeperNetworkData } from './gatekeeperNetworkService';\n\nexport class Orchestrator {\n  readonly listenerManager: ListenerManager;\n\n  readonly gatekeeperClient: GatekeeperClient;\n\n  readonly payer: string | undefined;\n\n  readonly wallet: WalletAdapter;\n\n  remoteSignInstance: RemoteSignWindowEventEmitter | undefined;\n\n  private log: LoggingInterface;\n\n  private abortController: AbortController;\n\n  private _issuance: Issuance | undefined;\n\n  private _refresh: Refresh | undefined;\n\n  private _partnerReview: PartnerReview | undefined;\n\n  constructor(\n    readonly gatewayCoreStore: Store,\n    readonly messageEventInterface: MessageEventInterface,\n    readonly instanceId: string,\n    readonly inputs: OrchestratorInputs,\n    fetchConfig: FetchConfig,\n    readonly postMessageTargetCallback: PostMessageTargetCallback,\n    readonly chainImplementation: ChainClientInterface\n  ) {\n    this.abortController = new AbortController();\n    if (!this.chainImplementation || !inputs.wallet?.address || !inputs.stage) {\n      throw new Error('chainImplementation wallet and stage are required');\n    }\n    this.wallet = inputs.wallet;\n    this.payer = getPayer(inputs);\n    this.log = prefixLogger(`Orchestrator[${this.instanceId}]`);\n\n    this.listenerManager = new ListenerManager(this.messageEventInterface, this.chainImplementation, this.instanceId);\n    const chainNetwork = this.chainImplementation?.chainDetails?.chainNetwork;\n\n    this.gatekeeperClient = new GatekeeperClient({\n      abortController: this.abortController,\n      baseUrl: inputs.gatekeeperConfig?.baseUrl, // if not set, this will be derived from the stage in gatekeeperClient.ts\n      queryParams: inputs.gatekeeperNetwork\n        ? { network: chainNetwork, gatekeeperNetworkAddress: inputs.gatekeeperNetwork }\n        : undefined,\n      headers: {\n        ...(inputs.gatekeeperConfig?.headers || {}),\n        ...(inputs.xCivicClientHeader ? { 'x-civic-client': inputs.xCivicClientHeader } : {}),\n      },\n      stage: inputs.stage,\n      fetchImplementation: fetchConfig.fetchImplementation,\n      numRetries: fetchConfig.numRetries,\n      walletAddress: inputs.wallet?.address,\n      chainType: this.chainImplementation?.chainDetails?.chainType,\n    });\n\n    this.log.debug('Orchestrator created');\n  }\n\n  private get issuance() {\n    if (!this._issuance) {\n      this._issuance = new Issuance(\n        this.gatewayCoreStore,\n        this.chainImplementation,\n        this.gatekeeperClient,\n        this.abortController,\n        this.inputs.expectTokenTimeoutSeconds\n      );\n    }\n    return this._issuance;\n  }\n\n  private get refresh() {\n    if (!this._refresh) {\n      this._refresh = new Refresh(\n        this.gatewayCoreStore,\n        this.chainImplementation,\n        this.gatekeeperClient,\n        this.abortController,\n        this.inputs.expectTokenTimeoutSeconds\n      );\n    }\n    return this._refresh;\n  }\n\n  private get partnerReview() {\n    if (!this._partnerReview) {\n      this._partnerReview = new PartnerReview(\n        this.gatewayCoreStore,\n        this.gatekeeperClient,\n        this.abortController,\n        this.inputs.gatekeeperPollingIntervalSeconds\n      );\n    }\n    return this._partnerReview;\n  }\n\n  getRemoteSignInstance() {\n    if (!this.remoteSignInstance) {\n      this.remoteSignInstance = new RemoteSignWindowEventEmitter(\n        eventEmitter(this.postMessageTargetCallback(this.instanceId)),\n        this.instanceId\n      );\n    }\n    return this.remoteSignInstance;\n  }\n\n  async getOwnerDids() {\n    // The dids are exported as part of the computed flowParameters, but they are async on the chainImplementation,\n    // so we fetch them here and set them on state so zustand-compute can get them synchronously.\n    const dids = await this.chainImplementation.ownerDids();\n    this.gatewayCoreStore.setState((state) => {\n      state.internal.ownerDids = dids;\n    });\n  }\n\n  async fetchGatekeeperNetworkData() {\n    // We need the GKN data for control flow, so we fetch it here and set it on state so zustand-compute can get it synchronously.\n    this.gatewayCoreStore.setState((state) => {\n      state.inputs.gatekeeperNetworkData.status = InputStatus.IN_PROGRESS;\n    });\n    return getGatekeeperNetworkData(this.inputs.stage || 'prod', this.inputs.gatekeeperNetwork || '')\n      .then((response) => {\n        this.log.debug('getGatekeeperNetworkData', response);\n        if (this.abortController.signal.aborted) return;\n        this.gatewayCoreStore.setState((state) => {\n          state.inputs.gatekeeperNetworkData.status = InputStatus.COMPLETE;\n          state.inputs.gatekeeperNetworkData.received = response;\n        });\n      })\n      .catch((error) => {\n        this.log.error('Error retrieving gatekeeper network data', error);\n        if (this.abortController.signal.aborted) return;\n        this.gatewayCoreStore.setState((state) => {\n          state.inputs.gatekeeperNetworkData.status = InputStatus.ERROR;\n          state.inputs.gatekeeperNetworkData.error = error;\n        });\n      });\n  }\n\n  async lookupTokenState() {\n    const retrieveGKRecord = async () => {\n      // call gatekeeperClient.getRecord to get gatekeeperRecord (if GKN requires it)\n      // update gatekeeperRecord state before and after\n      this.gatewayCoreStore.setState((state) => {\n        state.inputs.gatekeeperRecord.status = InputStatus.IN_PROGRESS;\n      });\n      return this.gatekeeperClient\n        .getGatekeeperRecordWithPayload()\n        .then((response) => {\n          this.log.debug('getGatekeeperRecordWithPayload record', response);\n          if (this.abortController.signal.aborted) return;\n          this.gatewayCoreStore.setState((state) => {\n            state.inputs.gatekeeperRecord.status = InputStatus.COMPLETE;\n            state.inputs.gatekeeperRecord.received = response;\n          });\n        })\n        .catch((error) => {\n          this.log.error('Error retrieving gatekeeper record', error);\n          if (this.abortController.signal.aborted) return;\n          this.gatewayCoreStore.setState((state) => {\n            state.inputs.gatekeeperRecord.status = InputStatus.ERROR;\n            state.inputs.gatekeeperRecord.error = error;\n          });\n        });\n    };\n\n    const retrieveGatewayToken = async () => {\n      this.gatewayCoreStore.setState((state) => {\n        state.inputs.gatewayToken.status = InputStatus.IN_PROGRESS;\n      });\n      return this.chainImplementation\n        .findGatewayToken()\n        .then((response) => {\n          if (this.abortController.signal.aborted) return;\n          this.gatewayCoreStore.setState((state) => {\n            state.inputs.gatewayToken.status = InputStatus.COMPLETE;\n            if (response) {\n              state.inputs.gatewayToken.received = response;\n            }\n          });\n        })\n        .catch((error) => {\n          if (this.abortController.signal.aborted) return;\n          this.log.error('Error retrieving gateway token', error);\n          this.gatewayCoreStore.setState((state) => {\n            state.inputs.gatewayToken.status = InputStatus.ERROR;\n            state.inputs.gatewayToken.error = error;\n          });\n        });\n    };\n\n    // call the gatekeeper unless the initial call is disabled\n    const lookupFunctions = [retrieveGatewayToken()];\n    if (!this.inputs.disableInitialGatekeeperLookup) {\n      lookupFunctions.push(retrieveGKRecord());\n    }\n    // update on-chain state before and after\n    // TODO handle results and set error state if necessary\n    await Promise.allSettled(lookupFunctions);\n  }\n\n  async initialise() {\n    this.log.debug('Initialising orchestrator');\n    this.abortController = new AbortController();\n    this.remoteSignInstance = undefined;\n    this.gatewayCoreStore.getState().functions.reset();\n\n    await Promise.allSettled([\n      // The dids are exported as part of the computed flowParameters, but they are async on the chainImplementation,\n      // so we fetch them here and set them on state so zustand-compute can get them synchronously.\n      this.getOwnerDids(),\n      this.lookupTokenState(),\n      this.fetchGatekeeperNetworkData(),\n    ]);\n  }\n\n  reset() {\n    this.log.debug('resetting orchestrator');\n    this.initialise();\n  }\n\n  onInternalStatusChange(status: InternalGatewayStatus | null, previousStatus?: InternalGatewayStatus | null) {\n    if (status === GatewayStatus.ERROR) {\n      const fullState = this.gatewayCoreStore.getState();\n      if (tokenNoGatekeeperRecordError(fullState)) {\n        this.gatewayCoreStore.setState((state) => {\n          if (!state.internal.errors) {\n            state.internal.errors = {};\n          }\n          state.internal.errors.expectedTokenGatekeeperRecord = new ChainError(\n            'Token has no gatekeeper record',\n            ErrorCode.EXPECTED_GATEKEEPER_RECORD\n          );\n        });\n      }\n      return;\n    }\n    if (status === GatewayStatus.ACTIVE) {\n      // if the token has just turned active, finish the appropriate flow\n      if (previousStatus !== GatewayStatus.ACTIVE) {\n        this._refresh?.onActiveTokenFound();\n        if (!this._refresh) {\n          this._issuance?.onActiveTokenFound();\n        }\n      }\n      return;\n    }\n    if (status === ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION) {\n      return this.issuance.restartDataCollection();\n    }\n    if (status === GatewayStatus.USER_INFORMATION_VALIDATED) {\n      return this.issuance.makeGatekeeperRequest({ payer: this.payer });\n    }\n    if (\n      [\n        ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX,\n        ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n      ].includes(status as ExtendedGatewayStatus)\n    ) {\n      return this.issuance.makeGatekeeperRequest({ payer: this.payer, isFreshTransactionRequest: true });\n    }\n    if (\n      [\n        ExtendedGatewayStatus.ISSUANCE_AWAITING_TRANSACTION_SEND,\n        ExtendedGatewayStatus.ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND,\n      ].includes(status as ExtendedGatewayStatus)\n    ) {\n      return this.issuance.sendTransaction();\n    }\n    if (status === ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN) {\n      return this.issuance.expectOnChainToken();\n    }\n    if (status === ExtendedGatewayStatus.REFRESH_USER_INFORMATION_VALIDATED) {\n      return this.refresh.makeGatekeeperRequest({ payer: this.payer });\n    }\n    if (\n      [\n        ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX,\n        ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n      ].includes(status as ExtendedGatewayStatus)\n    ) {\n      return this.refresh.makeGatekeeperRequest({ payer: this.payer, isFreshTransactionRequest: true });\n    }\n    if (status === ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND) {\n      return this.refresh.sendTransaction();\n    }\n    if (status === ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN) {\n      return this.refresh.expectOnChainToken();\n    }\n\n    if (status === ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW) {\n      return this.partnerReview.pollForReviewFinished();\n    }\n    if (\n      [ExtendedGatewayStatus.RESTART, ExtendedGatewayStatus.RESTART_REFRESH].includes(status as ExtendedGatewayStatus)\n    ) {\n      // Check if this does a record lookup. If it does a record lookupp,\n      // The record lookup should update to the correct GT status\n      return this.reset();\n    }\n  }\n\n  orchestrate() {\n    this.log.debug('running orchestrate()');\n    this.gatewayCoreStore.subscribe(\n      (state) => state.internal.status,\n      (status, previousStatus) => this.onInternalStatusChange(status, previousStatus)\n    );\n\n    // handle the expiry changing on the gateway token: if it's increased, reset the force refresh flag\n    this.gatewayCoreStore.subscribe(\n      (state) => state.inputs.gatewayToken.received?.expiryTime,\n      (expiryTime, previousExpiryTime) => {\n        if (expiryTime && previousExpiryTime && expiryTime > previousExpiryTime) {\n          this.gatewayCoreStore.setState((state) => {\n            if (state.inputs.dynamicParameters?.forceRequireRefresh !== undefined) {\n              state.inputs.dynamicParameters.forceRequireRefresh = false;\n            }\n          });\n        }\n      }\n    );\n    // handle specific user interactions from civicPass, like user finishing flows\n    this.gatewayCoreStore.subscribe(\n      (state) => state.inputs.civicPass.received,\n      (civicPass) => {\n        return this.gatewayCoreStore.setState((state) => {\n          const userIteractionStatus = getUserInteractionStatusFromAction(\n            state,\n            civicPass?.action as CivicPassMessageAction\n          );\n          state.internal.userInteraction.status = userIteractionStatus;\n        });\n      }\n    );\n\n    this.listenerManager.registerCivicPassListener((response) => {\n      this.gatewayCoreStore.setState((state) => {\n        state.inputs.civicPass.status = InputStatus.COMPLETE;\n        state.inputs.civicPass.received = response;\n      });\n    });\n\n    this.listenerManager.registerCivicSignListener((response) => {\n      this.gatewayCoreStore.setState((state) => {\n        state.inputs.civicSign.status = InputStatus.RECEIVED;\n        state.inputs.civicSign.received = response;\n      });\n      const ownerDids = this.gatewayCoreStore.getState().internal.ownerDids;\n      handleRemoteSignEvent(response, this.getRemoteSignInstance(), {\n        chainImplementation: this.chainImplementation,\n        wallet: this.wallet,\n        ownerDids: ownerDids as DID[],\n      })\n        .then((result) => {\n          if (!result) {\n            this.log.warn('No result from remote sign event');\n          }\n          this.gatewayCoreStore.setState((draft) => {\n            draft.inputs.civicSign.received = null;\n            draft.inputs.civicSign.sent = result;\n            draft.inputs.civicSign.error = null;\n            draft.inputs.civicSign.status = InputStatus.RESPONDED;\n          });\n        })\n        .catch((error) => {\n          // If the error does not have an errorCode default to POWO_ERROR,\n          this.gatewayCoreStore.setState((draft) => {\n            const useError = !!error.errorCode\n              ? error\n              : new ChainError('handleRemoteSignEvent failed', ErrorCode.POWO_ERROR);\n            draft.inputs.civicSign.error = useError;\n            draft.inputs.civicSign.status = InputStatus.ERROR;\n          });\n        });\n    });\n\n    this.listenerManager.registerOnChainListeners((gatewayToken: GatewayToken): void => {\n      this.gatewayCoreStore.setState((state) => {\n        state.inputs.gatewayToken.received = gatewayToken;\n      });\n    });\n  }\n\n  abort() {\n    this.log.info('Aborting orchestration');\n    this.chainImplementation.onDestroy();\n    this._issuance?.abort();\n    this._refresh?.abort();\n    this._partnerReview?.abort();\n    this.abortController.abort();\n    this.gatekeeperClient.abort();\n    this.listenerManager.unregisterAllListeners();\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7b7b2ccc3e92353a2ea7d19ce1ac33303286ceb9"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/listeners.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/listeners.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":36}},"3":{"start":{"line":5,"column":20},"end":{"line":5,"column":48}},"4":{"start":{"line":6,"column":20},"end":{"line":6,"column":48}},"5":{"start":{"line":9,"column":8},"end":{"line":9,"column":59}},"6":{"start":{"line":10,"column":8},"end":{"line":10,"column":55}},"7":{"start":{"line":11,"column":8},"end":{"line":11,"column":37}},"8":{"start":{"line":12,"column":8},"end":{"line":12,"column":23}},"9":{"start":{"line":13,"column":8},"end":{"line":13,"column":35}},"10":{"start":{"line":16,"column":24},"end":{"line":33,"column":9}},"11":{"start":{"line":18,"column":12},"end":{"line":21,"column":13}},"12":{"start":{"line":19,"column":16},"end":{"line":19,"column":54}},"13":{"start":{"line":20,"column":16},"end":{"line":20,"column":23}},"14":{"start":{"line":22,"column":12},"end":{"line":27,"column":13}},"15":{"start":{"line":23,"column":16},"end":{"line":25,"column":17}},"16":{"start":{"line":24,"column":20},"end":{"line":24,"column":127}},"17":{"start":{"line":26,"column":16},"end":{"line":26,"column":23}},"18":{"start":{"line":28,"column":12},"end":{"line":30,"column":13}},"19":{"start":{"line":29,"column":16},"end":{"line":29,"column":23}},"20":{"start":{"line":31,"column":12},"end":{"line":31,"column":84}},"21":{"start":{"line":32,"column":12},"end":{"line":32,"column":37}},"22":{"start":{"line":34,"column":8},"end":{"line":34,"column":70}},"23":{"start":{"line":35,"column":8},"end":{"line":35,"column":68}},"24":{"start":{"line":36,"column":8},"end":{"line":36,"column":50}},"25":{"start":{"line":39,"column":24},"end":{"line":56,"column":9}},"26":{"start":{"line":41,"column":12},"end":{"line":44,"column":13}},"27":{"start":{"line":42,"column":16},"end":{"line":42,"column":54}},"28":{"start":{"line":43,"column":16},"end":{"line":43,"column":23}},"29":{"start":{"line":45,"column":12},"end":{"line":50,"column":13}},"30":{"start":{"line":46,"column":16},"end":{"line":48,"column":17}},"31":{"start":{"line":47,"column":20},"end":{"line":47,"column":127}},"32":{"start":{"line":49,"column":16},"end":{"line":49,"column":23}},"33":{"start":{"line":51,"column":12},"end":{"line":53,"column":13}},"34":{"start":{"line":52,"column":16},"end":{"line":52,"column":23}},"35":{"start":{"line":54,"column":12},"end":{"line":54,"column":84}},"36":{"start":{"line":55,"column":12},"end":{"line":55,"column":37}},"37":{"start":{"line":57,"column":8},"end":{"line":57,"column":70}},"38":{"start":{"line":58,"column":8},"end":{"line":58,"column":68}},"39":{"start":{"line":59,"column":8},"end":{"line":59,"column":50}},"40":{"start":{"line":62,"column":8},"end":{"line":62,"column":68}},"41":{"start":{"line":63,"column":8},"end":{"line":63,"column":68}},"42":{"start":{"line":66,"column":8},"end":{"line":70,"column":11}},"43":{"start":{"line":67,"column":12},"end":{"line":67,"column":67}},"44":{"start":{"line":68,"column":12},"end":{"line":68,"column":75}},"45":{"start":{"line":69,"column":12},"end":{"line":69,"column":46}},"46":{"start":{"line":73,"column":0},"end":{"line":73,"column":42}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":8,"column":4},"end":{"line":8,"column":5}},"loc":{"start":{"line":8,"column":125},"end":{"line":14,"column":5}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":41},"end":{"line":37,"column":5}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":24},"end":{"line":16,"column":25}},"loc":{"start":{"line":16,"column":38},"end":{"line":33,"column":9}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":38,"column":4},"end":{"line":38,"column":5}},"loc":{"start":{"line":38,"column":41},"end":{"line":60,"column":5}},"line":38},"4":{"name":"(anonymous_4)","decl":{"start":{"line":39,"column":24},"end":{"line":39,"column":25}},"loc":{"start":{"line":39,"column":38},"end":{"line":56,"column":9}},"line":39},"5":{"name":"(anonymous_5)","decl":{"start":{"line":61,"column":4},"end":{"line":61,"column":5}},"loc":{"start":{"line":61,"column":44},"end":{"line":64,"column":5}},"line":61},"6":{"name":"(anonymous_6)","decl":{"start":{"line":65,"column":4},"end":{"line":65,"column":5}},"loc":{"start":{"line":65,"column":29},"end":{"line":71,"column":5}},"line":65},"7":{"name":"(anonymous_7)","decl":{"start":{"line":66,"column":54},"end":{"line":66,"column":55}},"loc":{"start":{"line":66,"column":74},"end":{"line":70,"column":9}},"line":66}},"branchMap":{"0":{"loc":{"start":{"line":8,"column":72},"end":{"line":8,"column":123}},"type":"default-arg","locations":[{"start":{"line":8,"column":78},"end":{"line":8,"column":123}}],"line":8},"1":{"loc":{"start":{"line":18,"column":12},"end":{"line":21,"column":13}},"type":"if","locations":[{"start":{"line":18,"column":12},"end":{"line":21,"column":13}},{"start":{"line":18,"column":12},"end":{"line":21,"column":13}}],"line":18},"2":{"loc":{"start":{"line":22,"column":12},"end":{"line":27,"column":13}},"type":"if","locations":[{"start":{"line":22,"column":12},"end":{"line":27,"column":13}},{"start":{"line":22,"column":12},"end":{"line":27,"column":13}}],"line":22},"3":{"loc":{"start":{"line":22,"column":17},"end":{"line":22,"column":88}},"type":"cond-expr","locations":[{"start":{"line":22,"column":66},"end":{"line":22,"column":72}},{"start":{"line":22,"column":75},"end":{"line":22,"column":88}}],"line":22},"4":{"loc":{"start":{"line":22,"column":17},"end":{"line":22,"column":63}},"type":"binary-expr","locations":[{"start":{"line":22,"column":17},"end":{"line":22,"column":46}},{"start":{"line":22,"column":50},"end":{"line":22,"column":63}}],"line":22},"5":{"loc":{"start":{"line":23,"column":16},"end":{"line":25,"column":17}},"type":"if","locations":[{"start":{"line":23,"column":16},"end":{"line":25,"column":17}},{"start":{"line":23,"column":16},"end":{"line":25,"column":17}}],"line":23},"6":{"loc":{"start":{"line":23,"column":20},"end":{"line":23,"column":138}},"type":"binary-expr","locations":[{"start":{"line":23,"column":21},"end":{"line":23,"column":92}},{"start":{"line":23,"column":97},"end":{"line":23,"column":138}}],"line":23},"7":{"loc":{"start":{"line":23,"column":21},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":76}},{"start":{"line":23,"column":79},"end":{"line":23,"column":92}}],"line":23},"8":{"loc":{"start":{"line":23,"column":21},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":21},"end":{"line":23,"column":50}},{"start":{"line":23,"column":54},"end":{"line":23,"column":67}}],"line":23},"9":{"loc":{"start":{"line":28,"column":12},"end":{"line":30,"column":13}},"type":"if","locations":[{"start":{"line":28,"column":12},"end":{"line":30,"column":13}},{"start":{"line":28,"column":12},"end":{"line":30,"column":13}}],"line":28},"10":{"loc":{"start":{"line":41,"column":12},"end":{"line":44,"column":13}},"type":"if","locations":[{"start":{"line":41,"column":12},"end":{"line":44,"column":13}},{"start":{"line":41,"column":12},"end":{"line":44,"column":13}}],"line":41},"11":{"loc":{"start":{"line":45,"column":12},"end":{"line":50,"column":13}},"type":"if","locations":[{"start":{"line":45,"column":12},"end":{"line":50,"column":13}},{"start":{"line":45,"column":12},"end":{"line":50,"column":13}}],"line":45},"12":{"loc":{"start":{"line":45,"column":17},"end":{"line":45,"column":88}},"type":"cond-expr","locations":[{"start":{"line":45,"column":66},"end":{"line":45,"column":72}},{"start":{"line":45,"column":75},"end":{"line":45,"column":88}}],"line":45},"13":{"loc":{"start":{"line":45,"column":17},"end":{"line":45,"column":63}},"type":"binary-expr","locations":[{"start":{"line":45,"column":17},"end":{"line":45,"column":46}},{"start":{"line":45,"column":50},"end":{"line":45,"column":63}}],"line":45},"14":{"loc":{"start":{"line":46,"column":16},"end":{"line":48,"column":17}},"type":"if","locations":[{"start":{"line":46,"column":16},"end":{"line":48,"column":17}},{"start":{"line":46,"column":16},"end":{"line":48,"column":17}}],"line":46},"15":{"loc":{"start":{"line":46,"column":20},"end":{"line":46,"column":138}},"type":"binary-expr","locations":[{"start":{"line":46,"column":21},"end":{"line":46,"column":92}},{"start":{"line":46,"column":97},"end":{"line":46,"column":138}}],"line":46},"16":{"loc":{"start":{"line":46,"column":21},"end":{"line":46,"column":92}},"type":"cond-expr","locations":[{"start":{"line":46,"column":70},"end":{"line":46,"column":76}},{"start":{"line":46,"column":79},"end":{"line":46,"column":92}}],"line":46},"17":{"loc":{"start":{"line":46,"column":21},"end":{"line":46,"column":67}},"type":"binary-expr","locations":[{"start":{"line":46,"column":21},"end":{"line":46,"column":50}},{"start":{"line":46,"column":54},"end":{"line":46,"column":67}}],"line":46},"18":{"loc":{"start":{"line":51,"column":12},"end":{"line":53,"column":13}},"type":"if","locations":[{"start":{"line":51,"column":12},"end":{"line":53,"column":13}},{"start":{"line":51,"column":12},"end":{"line":53,"column":13}}],"line":51}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":120,"6":120,"7":120,"8":120,"9":120,"10":110,"11":112,"12":1,"13":1,"14":111,"15":2,"16":2,"17":2,"18":109,"19":30,"20":79,"21":79,"22":110,"23":110,"24":110,"25":103,"26":108,"27":0,"28":0,"29":108,"30":1,"31":1,"32":1,"33":107,"34":78,"35":29,"36":29,"37":103,"38":103,"39":103,"40":103,"41":103,"42":54,"43":106,"44":106,"45":106,"46":1},"f":{"0":120,"1":110,"2":112,"3":103,"4":108,"5":103,"6":54,"7":106},"b":{"0":[112],"1":[1,111],"2":[2,109],"3":[0,111],"4":[111,111],"5":[2,0],"6":[2,2],"7":[0,2],"8":[2,2],"9":[30,79],"10":[0,108],"11":[1,107],"12":[0,108],"13":[108,108],"14":[1,0],"15":[1,1],"16":[0,1],"17":[1,1],"18":[78,29]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/listeners.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/listeners.ts"],"names":[],"mappings":"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","sourcesContent":["// A Class to register the different listeners we need to orchestrate the different parts of the gateway\n// when a listener is registered, we set it up to update the appropriate part of the state\n// which will then trigger state updates and orchestration, if required\nimport { prefixLogger } from './logger';\nimport { MessageEventInterface } from './types/eventInterface';\nimport { CivicPassMessageAction, CivicPassMessageEventResponse, CivicPassMessageResponse } from './types/civicPass';\nimport { LoggingInterface } from './logger/provider.logger';\nimport { CivicSignEventTypeRequest, CivicSignEventTypeRequestMessage } from './types/civicSign';\nimport { ChainClientInterface, GatewayToken } from './types/chain';\n\ntype ListenerHandler = (arg: unknown) => void;\nexport class ListenerManager {\n  readonly messageListeners: Record<string, ListenerHandler> = {};\n\n  constructor(\n    readonly messageEventInterface: MessageEventInterface,\n    readonly chainImplementation: ChainClientInterface,\n    readonly instanceId: string,\n    readonly log: LoggingInterface = prefixLogger('ListenerManager')\n  ) {}\n\n  registerCivicPassListener(onMessage: (data: CivicPassMessageResponse) => void) {\n    const handler = (response: CivicPassMessageEventResponse) => {\n      if (!response.data) {\n        this.log.error('No data in response');\n        return; // Exit if there is no data in the response\n      }\n\n      // Checking instanceId matching\n      if (response.data?.instanceId !== this.instanceId) {\n        if (response.data?.instanceId && response.data.source !== '@devtools-page') {\n          this.log.debug('instanceId for different instance', { event: response.data, instanceId: this.instanceId });\n        }\n        return;\n      }\n      // ensure we only process civic-pass events\n      if (!Object.values(CivicPassMessageAction).includes(response.data.action)) {\n        return;\n      }\n      this.log.debug('received CivicPassListener postMessage', response.data);\n      onMessage(response.data);\n    };\n\n    this.log.debug('Adding event listener for civic-pass events');\n    this.messageEventInterface.addMessageEventListener(handler);\n    this.messageListeners.civicPass = handler;\n  }\n\n  registerCivicSignListener(onMessage: (data: CivicSignEventTypeRequestMessage) => void) {\n    const handler = (response: MessageEvent<CivicSignEventTypeRequestMessage>) => {\n      if (!response.data) {\n        this.log.error('No data in response');\n        return; // Exit if there is no data in the response\n      }\n\n      // Checking instanceId matching\n      if (response.data?.instanceId !== this.instanceId) {\n        if (response.data?.instanceId && response.data.source !== '@devtools-page') {\n          this.log.debug('instanceId for different instance', { event: response.data, instanceId: this.instanceId });\n        }\n        return;\n      }\n      // ensure we only process civic-sign events\n      if (!Object.values(CivicSignEventTypeRequest).includes(response.data.request)) {\n        return;\n      }\n\n      this.log.debug('received CivicSignListener postMessage', response.data);\n      onMessage(response.data);\n    };\n\n    this.log.debug('Adding event listener for civic-sign events');\n    this.messageEventInterface.addMessageEventListener(handler);\n    this.messageListeners.civicSign = handler;\n  }\n\n  registerOnChainListeners(onTokenChange: (gatewayToken: GatewayToken) => void) {\n    this.chainImplementation.on('TOKEN_CREATED', onTokenChange);\n    this.chainImplementation.on('TOKEN_CHANGED', onTokenChange);\n  }\n\n  unregisterAllListeners() {\n    Object.entries(this.messageListeners).forEach(([key, handler]) => {\n      this.log.debug('Removing message event listener', key);\n      this.messageEventInterface.removeMessageEventListener(handler);\n      delete this.messageListeners[key];\n    });\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"112cf8582a18c249e6476de2637b816d5aac8f4a"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/civicPass.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/civicPass.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":105}},"2":{"start":{"line":5,"column":0},"end":{"line":11,"column":108}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":55}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":55}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":59}},"6":{"start":{"line":9,"column":4},"end":{"line":9,"column":62}},"7":{"start":{"line":10,"column":4},"end":{"line":10,"column":51}},"8":{"start":{"line":13,"column":0},"end":{"line":33,"column":93}},"9":{"start":{"line":14,"column":4},"end":{"line":14,"column":52}},"10":{"start":{"line":15,"column":4},"end":{"line":15,"column":73}},"11":{"start":{"line":16,"column":4},"end":{"line":16,"column":59}},"12":{"start":{"line":17,"column":4},"end":{"line":17,"column":59}},"13":{"start":{"line":18,"column":4},"end":{"line":18,"column":61}},"14":{"start":{"line":19,"column":4},"end":{"line":19,"column":63}},"15":{"start":{"line":20,"column":4},"end":{"line":20,"column":64}},"16":{"start":{"line":21,"column":4},"end":{"line":21,"column":79}},"17":{"start":{"line":22,"column":4},"end":{"line":22,"column":79}},"18":{"start":{"line":23,"column":4},"end":{"line":23,"column":64}},"19":{"start":{"line":24,"column":4},"end":{"line":24,"column":66}},"20":{"start":{"line":25,"column":4},"end":{"line":25,"column":50}},"21":{"start":{"line":26,"column":4},"end":{"line":26,"column":48}},"22":{"start":{"line":27,"column":4},"end":{"line":27,"column":46}},"23":{"start":{"line":28,"column":4},"end":{"line":28,"column":57}},"24":{"start":{"line":29,"column":4},"end":{"line":29,"column":71}},"25":{"start":{"line":30,"column":4},"end":{"line":30,"column":67}},"26":{"start":{"line":31,"column":4},"end":{"line":31,"column":100}},"27":{"start":{"line":32,"column":4},"end":{"line":32,"column":93}},"28":{"start":{"line":35,"column":0},"end":{"line":42,"column":75}},"29":{"start":{"line":36,"column":4},"end":{"line":36,"column":50}},"30":{"start":{"line":37,"column":4},"end":{"line":37,"column":50}},"31":{"start":{"line":38,"column":4},"end":{"line":38,"column":48}},"32":{"start":{"line":39,"column":4},"end":{"line":39,"column":48}},"33":{"start":{"line":40,"column":4},"end":{"line":40,"column":42}},"34":{"start":{"line":41,"column":4},"end":{"line":41,"column":48}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":40},"end":{"line":11,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":1},"end":{"line":13,"column":2}},"loc":{"start":{"line":13,"column":35},"end":{"line":33,"column":1}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":35,"column":1},"end":{"line":35,"column":2}},"loc":{"start":{"line":35,"column":29},"end":{"line":42,"column":1}},"line":35}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":3},"end":{"line":11,"column":106}},"type":"binary-expr","locations":[{"start":{"line":11,"column":3},"end":{"line":11,"column":30}},{"start":{"line":11,"column":35},"end":{"line":11,"column":105}}],"line":11},"1":{"loc":{"start":{"line":33,"column":3},"end":{"line":33,"column":91}},"type":"binary-expr","locations":[{"start":{"line":33,"column":3},"end":{"line":33,"column":25}},{"start":{"line":33,"column":30},"end":{"line":33,"column":90}}],"line":33},"2":{"loc":{"start":{"line":42,"column":3},"end":{"line":42,"column":73}},"type":"binary-expr","locations":[{"start":{"line":42,"column":3},"end":{"line":42,"column":19}},{"start":{"line":42,"column":24},"end":{"line":42,"column":72}}],"line":42}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1},"f":{"0":1,"1":1,"2":1},"b":{"0":[1,1],"1":[1,1],"2":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/civicPass.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/civicPass.ts"],"names":[],"mappings":";;;AAAA,IAAY,2BAMX;AAND,WAAY,2BAA2B;IACrC,kDAAmB,CAAA;IACnB,kDAAmB,CAAA;IACnB,sDAAuB,CAAA;IACvB,yDAA0B,CAAA;IAC1B,8CAAe,CAAA;AACjB,CAAC,EANW,2BAA2B,2CAA3B,2BAA2B,QAMtC;AAED,IAAY,sBAoBX;AApBD,WAAY,sBAAsB;IAChC,+CAAqB,CAAA;IACrB,oEAA0C,CAAA;IAC1C,sDAA4B,CAAA;IAC5B,sDAA4B,CAAA;IAC5B,wDAA8B,CAAA;IAC9B,0DAAgC,CAAA;IAChC,2DAAiC,CAAA;IACjC,0EAAgD,CAAA;IAChD,0EAAgD,CAAA;IAChD,2DAAiC,CAAA;IACjC,6DAAmC,CAAA;IACnC,6CAAmB,CAAA;IACnB,2CAAiB,CAAA;IACjB,yCAAe,CAAA;IACf,oDAA0B,CAAA;IAC1B,kEAAwC,CAAA;IACxC,8DAAoC,CAAA;IACpC,+FAAqE,CAAA;IACrE,wFAA8D,CAAA;AAChE,CAAC,EApBW,sBAAsB,sCAAtB,sBAAsB,QAoBjC;AAED,IAAY,gBAOX;AAPD,WAAY,gBAAgB;IAC1B,6CAAyB,CAAA;IACzB,6CAAyB,CAAA;IACzB,2CAAuB,CAAA;IACvB,2CAAuB,CAAA;IACvB,qCAAiB,CAAA;IACjB,2CAAuB,CAAA;AACzB,CAAC,EAPW,gBAAgB,gCAAhB,gBAAgB,QAO3B","sourcesContent":["export enum CivicPassMessageEventResult {\n  SUCCESS = 'success',\n  FAILURE = 'failure',\n  CANCELLED = 'cancelled',\n  IN_PROGRESS = 'inProgress',\n  ERROR = 'error',\n}\n\nexport enum CivicPassMessageAction {\n  ISSUANCE = 'issuance',\n  CONFIRM_TRANSACTION = 'confirmTransaction',\n  TOKEN_FROZEN = 'tokenFrozen',\n  TOKEN_ACTIVE = 'tokenActive',\n  TOKEN_REVOKED = 'tokenRevoked',\n  TOKEN_REJECTED = 'tokenRejected',\n  TOKEN_IN_REVIEW = 'tokenInReview',\n  TOKEN_REFRESH_IN_REVIEW = 'tokenRefreshInReview',\n  TOKEN_IN_PARTNER_REVIEW = 'tokenInPartnerReview',\n  FAILED_IP_CHECK = 'failedIpCheck',\n  FAILED_VPN_CHECK = 'failedVpnCheck',\n  REFRESH = 'refresh',\n  STATUS = 'status',\n  ERROR = 'error',\n  CHAIN_ERROR = 'chainError',\n  CREDENTIAL_EXPIRED = 'credentialExpired',\n  SIGN_TRANSACTION = 'signTransaction',\n  AWAITING_TRANSACTION_CONFIRMATION = 'awaitingTransactionConfirmation',\n  START_PRE_APPROVED_TRANSACTION = 'startPreApprovedTransaction',\n}\n\nexport enum ValidationStatus {\n  COLLECTING = 'COLLECTING',\n  PROCESSING = 'PROCESSING',\n  IN_REVIEW = 'IN_REVIEW',\n  COMPLETED = 'COMPLETED',\n  FAILED = 'FAILED',\n  NOT_FOUND = 'NOT_FOUND',\n}\n\nexport type CivicPassMessagePayload = Record<string, unknown> & {\n  status: ValidationStatus;\n};\n\nexport interface CivicPassMessageRequest {\n  action: CivicPassMessageAction;\n  networkAddress: string;\n  payload?: string;\n}\n\nexport interface CivicPassMessageEventResponse extends MessageEvent {\n  data: CivicPassMessageResponse;\n}\n\nexport interface CivicPassMessageBase {\n  instanceId?: string;\n  source?: string;\n}\n\nexport interface CivicPassMessageResponse extends CivicPassMessageBase {\n  event: CivicPassMessageEventResult;\n  action: CivicPassMessageAction;\n  payload?: CivicPassMessagePayload;\n}\n\nexport interface CivicPassMessageEventResponse extends MessageEvent {\n  data: CivicPassMessageResponse;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"cdffccf627eb32da43c09a2045e170a17cdfc655"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/civicSign.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/civicSign.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":80}},"2":{"start":{"line":5,"column":0},"end":{"line":11,"column":105}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":78}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":64}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":82}},"6":{"start":{"line":9,"column":4},"end":{"line":9,"column":86}},"7":{"start":{"line":10,"column":4},"end":{"line":10,"column":68}},"8":{"start":{"line":13,"column":0},"end":{"line":18,"column":102}},"9":{"start":{"line":14,"column":4},"end":{"line":14,"column":75}},"10":{"start":{"line":15,"column":4},"end":{"line":15,"column":61}},"11":{"start":{"line":16,"column":4},"end":{"line":16,"column":79}},"12":{"start":{"line":17,"column":4},"end":{"line":17,"column":83}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":39},"end":{"line":11,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":1},"end":{"line":13,"column":2}},"loc":{"start":{"line":13,"column":38},"end":{"line":18,"column":1}},"line":13}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":3},"end":{"line":11,"column":103}},"type":"binary-expr","locations":[{"start":{"line":11,"column":3},"end":{"line":11,"column":29}},{"start":{"line":11,"column":34},"end":{"line":11,"column":102}}],"line":11},"1":{"loc":{"start":{"line":18,"column":3},"end":{"line":18,"column":100}},"type":"binary-expr","locations":[{"start":{"line":18,"column":3},"end":{"line":18,"column":28}},{"start":{"line":18,"column":33},"end":{"line":18,"column":99}}],"line":18}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1},"f":{"0":1,"1":1},"b":{"0":[1,1],"1":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/civicSign.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/civicSign.ts"],"names":[],"mappings":";;;AAOA,IAAY,0BAMX;AAND,WAAY,0BAA0B;IACpC,yEAA2C,CAAA;IAC3C,2DAA6B,CAAA;IAC7B,6EAA+C,CAAA;IAC/C,iFAAmD,CAAA;IACnD,+DAAiC,CAAA;AACnC,CAAC,EANW,0BAA0B,0CAA1B,0BAA0B,QAMrC;AAED,IAAY,yBAKX;AALD,WAAY,yBAAyB;IACnC,sEAAyC,CAAA;IACzC,wDAA2B,CAAA;IAC3B,0EAA6C,CAAA;IAC7C,8EAAiD,CAAA;AACnD,CAAC,EALW,yBAAyB,yCAAzB,yBAAyB,QAKpC","sourcesContent":["// TODO: Duplicate types in CivicSign\n\nimport { ChainError } from '../utils/errors';\nimport { SignatureMethod } from './chain';\nimport { CivicPassMessageBase } from './civicPass';\n\n// Move to a central repo or use TS paths\nexport enum CivicSignEventTypeResponse {\n  RESPONSE_PUBLIC_KEY = 'RESPONSE_PUBLIC_KEY',\n  RESPONSE_DID = 'RESPONSE_DID',\n  RESPONSE_SIGNED_PROOF = 'RESPONSE_SIGNED_PROOF',\n  RESPONSE_SIGNED_MESSAGE = 'RESPONSE_SIGNED_MESSAGE',\n  RESPONSE_ERROR = 'RESPONSE_ERROR',\n}\n\nexport enum CivicSignEventTypeRequest {\n  REQUEST_PUBLIC_KEY = 'REQUEST_PUBLIC_KEY',\n  REQUEST_DID = 'REQUEST_DID',\n  REQUEST_SIGNED_PROOF = 'REQUEST_SIGNED_PROOF',\n  REQUEST_SIGNED_MESSAGE = 'REQUEST_SIGNED_MESSAGE',\n}\n\nexport interface CivicSignEventTypeRequestMessage extends CivicPassMessageBase {\n  request: CivicSignEventTypeRequest;\n  payload?: Uint8Array | string;\n  requestId: string;\n}\n\nexport interface RemoteSign {\n  sendPublicKey: (requestId: string, publicKey: string) => void;\n  sendDid: (requestId: string, did: string) => void;\n  sendSignedProof: (requestId: string, proof: string, signatureMethod: SignatureMethod) => void;\n  sendSignedMessage: (requestId: string, message: Uint8Array) => void;\n  sendError: (requestId: string, request: CivicSignEventTypeRequest, error: Error | ChainError) => void;\n}\n\nexport type CivicSignResponseEvent = {\n  event: CivicSignEventTypeResponse;\n  data: string;\n  instanceId: string;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2d7798dbf6ce57ef3992679d12994ec04e13a3b8"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/fetch.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/fetch.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":5,"column":0},"end":{"line":11,"column":60}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":47}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":41}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":35}},"6":{"start":{"line":9,"column":4},"end":{"line":9,"column":41}},"7":{"start":{"line":10,"column":4},"end":{"line":10,"column":43}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":24},"end":{"line":11,"column":1}},"line":5}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":3},"end":{"line":11,"column":58}},"type":"binary-expr","locations":[{"start":{"line":11,"column":3},"end":{"line":11,"column":14}},{"start":{"line":11,"column":19},"end":{"line":11,"column":57}}],"line":11}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"f":{"0":1},"b":{"0":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/fetch.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/fetch.ts"],"names":[],"mappings":";;;AAAA,IAAY,WAMX;AAND,WAAY,WAAW;IACrB,0CAA2B,CAAA;IAC3B,oCAAqB,CAAA;IACrB,8BAAe,CAAA;IACf,oCAAqB,CAAA;IACrB,sCAAuB,CAAA;AACzB,CAAC,EANW,WAAW,2BAAX,WAAW,QAMtB","sourcesContent":["export enum InputStatus {\n  IN_PROGRESS = 'IN_PROGRESS',\n  COMPLETE = 'COMPLETE',\n  ERROR = 'ERROR',\n  RECEIVED = 'RECEIVED',\n  RESPONDED = 'RESPONDED',\n}\n\nexport type FetchConfig = {\n  fetchImplementation: typeof fetch;\n  numRetries: number;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4ef5afa01e87682a4d681427aa9cd82290ce370c"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/gateway.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/gateway.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":63}},"2":{"start":{"line":5,"column":0},"end":{"line":22,"column":66}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":41}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":43}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":53}},"6":{"start":{"line":9,"column":4},"end":{"line":9,"column":81}},"7":{"start":{"line":10,"column":4},"end":{"line":10,"column":45}},"8":{"start":{"line":11,"column":4},"end":{"line":11,"column":43}},"9":{"start":{"line":12,"column":4},"end":{"line":12,"column":41}},"10":{"start":{"line":13,"column":4},"end":{"line":13,"column":39}},"11":{"start":{"line":14,"column":4},"end":{"line":14,"column":39}},"12":{"start":{"line":15,"column":4},"end":{"line":15,"column":37}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":71}},"14":{"start":{"line":17,"column":4},"end":{"line":17,"column":61}},"15":{"start":{"line":18,"column":4},"end":{"line":18,"column":71}},"16":{"start":{"line":19,"column":4},"end":{"line":19,"column":81}},"17":{"start":{"line":20,"column":4},"end":{"line":20,"column":79}},"18":{"start":{"line":21,"column":4},"end":{"line":21,"column":77}},"19":{"start":{"line":24,"column":0},"end":{"line":54,"column":90}},"20":{"start":{"line":25,"column":4},"end":{"line":25,"column":87}},"21":{"start":{"line":26,"column":4},"end":{"line":26,"column":73}},"22":{"start":{"line":27,"column":4},"end":{"line":27,"column":85}},"23":{"start":{"line":28,"column":4},"end":{"line":28,"column":81}},"24":{"start":{"line":29,"column":4},"end":{"line":29,"column":81}},"25":{"start":{"line":30,"column":4},"end":{"line":30,"column":81}},"26":{"start":{"line":31,"column":4},"end":{"line":31,"column":79}},"27":{"start":{"line":32,"column":4},"end":{"line":32,"column":49}},"28":{"start":{"line":33,"column":4},"end":{"line":33,"column":83}},"29":{"start":{"line":34,"column":4},"end":{"line":34,"column":97}},"30":{"start":{"line":35,"column":4},"end":{"line":35,"column":103}},"31":{"start":{"line":36,"column":4},"end":{"line":36,"column":127}},"32":{"start":{"line":37,"column":4},"end":{"line":37,"column":99}},"33":{"start":{"line":38,"column":4},"end":{"line":38,"column":99}},"34":{"start":{"line":39,"column":4},"end":{"line":39,"column":107}},"35":{"start":{"line":40,"column":4},"end":{"line":40,"column":131}},"36":{"start":{"line":41,"column":4},"end":{"line":41,"column":103}},"37":{"start":{"line":42,"column":4},"end":{"line":42,"column":103}},"38":{"start":{"line":43,"column":4},"end":{"line":43,"column":95}},"39":{"start":{"line":44,"column":4},"end":{"line":44,"column":69}},"40":{"start":{"line":45,"column":4},"end":{"line":45,"column":101}},"41":{"start":{"line":46,"column":4},"end":{"line":46,"column":125}},"42":{"start":{"line":47,"column":4},"end":{"line":47,"column":97}},"43":{"start":{"line":48,"column":4},"end":{"line":48,"column":87}},"44":{"start":{"line":49,"column":4},"end":{"line":49,"column":99}},"45":{"start":{"line":50,"column":4},"end":{"line":50,"column":65}},"46":{"start":{"line":51,"column":4},"end":{"line":51,"column":105}},"47":{"start":{"line":52,"column":4},"end":{"line":52,"column":129}},"48":{"start":{"line":53,"column":4},"end":{"line":53,"column":101}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":26},"end":{"line":22,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":24,"column":1},"end":{"line":24,"column":2}},"loc":{"start":{"line":24,"column":34},"end":{"line":54,"column":1}},"line":24}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":3},"end":{"line":22,"column":64}},"type":"binary-expr","locations":[{"start":{"line":22,"column":3},"end":{"line":22,"column":16}},{"start":{"line":22,"column":21},"end":{"line":22,"column":63}}],"line":22},"1":{"loc":{"start":{"line":54,"column":3},"end":{"line":54,"column":88}},"type":"binary-expr","locations":[{"start":{"line":54,"column":3},"end":{"line":54,"column":24}},{"start":{"line":54,"column":29},"end":{"line":54,"column":87}}],"line":54}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1},"f":{"0":1,"1":1},"b":{"0":[1,1],"1":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/gateway.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/gateway.ts"],"names":[],"mappings":";;;AAAA,IAAY,aAiBX;AAjBD,WAAY,aAAa;IACvB,oCAAmB,CAAA;IACnB,sCAAqB,CAAA;IACrB,gDAA+B,CAAA;IAC/B,4EAA2D,CAAA;IAC3D,wCAAuB,CAAA;IACvB,sCAAqB,CAAA;IACrB,oCAAmB,CAAA;IACnB,kCAAiB,CAAA;IACjB,kCAAiB,CAAA;IACjB,gCAAe,CAAA;IACf,kEAAiD,CAAA;IACjD,wDAAuC,CAAA;IACvC,kEAAiD,CAAA;IACjD,4EAA2D,CAAA;IAC3D,0EAAyD,CAAA;IACzD,wEAAuD,CAAA;AACzD,CAAC,EAjBW,aAAa,6BAAb,aAAa,QAiBxB;AAGD,IAAY,qBAgCX;AAhCD,WAAY,qBAAqB;IAC/B,kFAAyD,CAAA;IACzD,oEAA2C,CAAA;IAC3C,gFAAuD,CAAA;IACvD,4EAAmD,CAAA;IACnD,4EAAmD,CAAA;IACnD,4EAAmD,CAAA;IACnD,0EAAiD,CAAA;IAEjD,4CAAmB,CAAA;IACnB,8EAAqD,CAAA;IACrD,4FAAmE,CAAA;IACnE,kGAAyE,CAAA;IACzE,0HAAiG,CAAA;IACjG,8FAAqE,CAAA;IACrE,8FAAqE,CAAA;IACrE,sGAA6E,CAAA;IAC7E,8HAAqG,CAAA;IACrG,kGAAyE,CAAA;IAEzE,kGAAyE,CAAA;IACzE,0FAAiE,CAAA;IACjE,gEAAuC,CAAA;IACvC,gGAAuE,CAAA;IACvE,wHAA+F,CAAA;IAC/F,4FAAmE,CAAA;IACnE,kFAAyD,CAAA;IACzD,8FAAqE,CAAA;IACrE,4DAAmC,CAAA;IACnC,oGAA2E,CAAA;IAC3E,4HAAmG,CAAA;IACnG,gGAAuE,CAAA;AACzE,CAAC,EAhCW,qBAAqB,qCAArB,qBAAqB,QAgChC","sourcesContent":["export enum GatewayStatus {\n  UNKNOWN = 'UNKNOWN', // the wallet or gatekeeper network is not set\n  CHECKING = 'CHECKING', // the blockchain is being queried to find an existing gateway token\n  NOT_REQUESTED = 'NOT_REQUESTED', // then token has not been requested\n  COLLECTING_USER_INFORMATION = 'COLLECTING_USER_INFORMATION', // the wallet owner is undergoing KYC\n  IN_REVIEW = 'IN_REVIEW', // the token has been requested and civic gatekeeper is reviewing the request\n  REJECTED = 'REJECTED', // the token issuance request was rejected\n  REVOKED = 'REVOKED', // the token has been revoked\n  FROZEN = 'FROZEN', // the token has been frozen\n  ACTIVE = 'ACTIVE', // the token has been issued successfully and is in an active state\n  ERROR = 'ERROR', // something went wrong\n  LOCATION_NOT_SUPPORTED = 'LOCATION_NOT_SUPPORTED', // location is not currently supported\n  VPN_NOT_SUPPORTED = 'VPN_NOT_SUPPORTED', // vpn usage is not currently supported\n  REFRESH_TOKEN_REQUIRED = 'REFRESH_TOKEN_REQUIRED', // waiting for the user to complete the civic pass refresh flow\n  VALIDATING_USER_INFORMATION = 'VALIDATING_USER_INFORMATION', // validation process is currently being reviewed\n  USER_INFORMATION_VALIDATED = 'USER_INFORMATION_VALIDATED', // validation process has finished processing\n  USER_INFORMATION_REJECTED = 'USER_INFORMATION_REJECTED', // validation process failed and needs to be restarted\n}\n\n// An extended status that provides more context on a gateway status, used to determine internal UI transitions, Not exposed in the public API\nexport enum ExtendedGatewayStatus {\n  AWAITING_OWNER_TRANSACTION = 'AWAITING_OWNER_TRANSACTION', // waiting for the owner submitted transaction to be confirmed on the chain\n  CHAIN_TIMEOUT_ERROR = 'CHAIN_TIMEOUT_ERROR', // we timed out waiting for the user submitted tx to confirm\n  CONFIRM_OWNER_TRANSACTION = 'CONFIRM_OWNER_TRANSACTION', // prompt the user to confirm the owner transaction\n  CHAIN_TRANSACTION_ERROR = 'CHAIN_TRANSACTION_ERROR', // during client-sends the userSendsTransaction call threw an error\n  TOKEN_IN_PARTNER_REVIEW = 'TOKEN_IN_PARTNER_REVIEW', // during pii-sharing flow\n  TOKEN_REFRESH_IN_REVIEW = 'TOKEN_REFRESH_IN_REVIEW', // during pii-sharing flow\n  USER_VALIDATION_FAILED = 'USER_VALIDATION_FAILED', // during the user validation flow\n\n  RESTART = 'RESTART', // the user needs to restart the flow\n  CHAIN_SIGN_MESSAGE_ERROR = 'CHAIN_SIGN_MESSAGE_ERROR', // during civic-sign sign message request\n  ISSUANCE_CLIENT_PAYER_REQUESTED = 'ISSUANCE_CLIENT_PAYER_REQUESTED', // set when the gatekeeper call is in progress\n  ISSUANCE_AWAITING_TRANSACTION_SEND = 'ISSUANCE_AWAITING_TRANSACTION_SEND', // during issuance flow\n  ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND = 'ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND', // during issuance flow\n  ISSUANCE_AWAITING_ON_CHAIN_TOKEN = 'ISSUANCE_AWAITING_ON_CHAIN_TOKEN', // during issuance flow\n  ISSUANCE_RESTART_DATA_COLLECTION = 'ISSUANCE_RESTART_DATA_COLLECTION', // the user already requested a token but it didn't complete successfully\n  ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX = 'ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX',\n  ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX = 'ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX', // triggers a request to the gatekeeper for a new transaction\n  ISSUANCE_CLIENT_SENDS_START_NEW_TX = 'ISSUANCE_CLIENT_SENDS_START_NEW_TX', // We need to ask the user to request a new transaction\n\n  REFRESH_USER_INFORMATION_VALIDATED = 'REFRESH_USER_INFORMATION_VALIDATED',\n  REFRESH_CLIENT_PAYER_REQUESTED = 'REFRESH_CLIENT_PAYER_REQUESTED',\n  REFRESH_IN_REVIEW = 'REFRESH_IN_REVIEW',\n  REFRESH_AWAITING_TRANSACTION_SEND = 'REFRESH_AWAITING_TRANSACTION_SEND',\n  REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND = 'REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND',\n  REFRESH_AWAITING_ON_CHAIN_TOKEN = 'REFRESH_AWAITING_ON_CHAIN_TOKEN',\n  REFRESH_CREDENTIAL_EXPIRED = 'REFRESH_CREDENTIAL_EXPIRED', // refreshing the token will require a new document scan because the previous one is expired\n  REFRESH_CREDENTIAL_EXPIRED_START = 'REFRESH_CREDENTIAL_EXPIRED_START', // refreshing the token will require a new document scan because the previous one is expired\n  RESTART_REFRESH = 'RESTART_REFRESH', // the user needs to restart the flow\n  REFRESH_CLIENT_SENDS_REQUEST_NEW_TX = 'REFRESH_CLIENT_SENDS_REQUEST_NEW_TX', // triggers a request to the gatekeeper for a new transaction\n  REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX = 'REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX', // triggers a request to the gatekeeper for a new transaction\n  REFRESH_CLIENT_SENDS_START_NEW_TX = 'REFRESH_CLIENT_SENDS_START_NEW_TX', // We need to ask the user to request a new transaction\n}\n\n// A type that represents all GatewayStatuses, including the private statuses that are not exposed\nexport type InternalGatewayStatus = GatewayStatus | ExtendedGatewayStatus;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f241b30a9de96d42911b53ff447e42c75ddac268"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/inputs.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/inputs.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":26}},"2":{"start":{"line":4,"column":17},"end":{"line":8,"column":1}},"3":{"start":{"line":5,"column":4},"end":{"line":6,"column":25}},"4":{"start":{"line":6,"column":8},"end":{"line":6,"column":25}},"5":{"start":{"line":7,"column":4},"end":{"line":7,"column":85}},"6":{"start":{"line":9,"column":0},"end":{"line":9,"column":28}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":17},"end":{"line":4,"column":18}},"loc":{"start":{"line":4,"column":68},"end":{"line":8,"column":1}},"line":4}},"branchMap":{"0":{"loc":{"start":{"line":5,"column":4},"end":{"line":6,"column":25}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":6,"column":25}},{"start":{"line":5,"column":4},"end":{"line":6,"column":25}}],"line":5},"1":{"loc":{"start":{"line":7,"column":11},"end":{"line":7,"column":84}},"type":"binary-expr","locations":[{"start":{"line":7,"column":11},"end":{"line":7,"column":16}},{"start":{"line":7,"column":21},"end":{"line":7,"column":83}}],"line":7},"2":{"loc":{"start":{"line":7,"column":21},"end":{"line":7,"column":83}},"type":"cond-expr","locations":[{"start":{"line":7,"column":60},"end":{"line":7,"column":66}},{"start":{"line":7,"column":69},"end":{"line":7,"column":83}}],"line":7},"3":{"loc":{"start":{"line":7,"column":21},"end":{"line":7,"column":57}},"type":"binary-expr","locations":[{"start":{"line":7,"column":21},"end":{"line":7,"column":36}},{"start":{"line":7,"column":40},"end":{"line":7,"column":57}}],"line":7}},"s":{"0":1,"1":1,"2":1,"3":218,"4":129,"5":89,"6":1},"f":{"0":218},"b":{"0":[129,89],"1":[89,4],"2":[1,3],"3":[4,4]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/inputs.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/inputs.ts"],"names":[],"mappings":";;;AASO,MAAM,QAAQ,GAAG,CAAC,EAAE,0BAA0B,EAAE,KAAK,EAAE,MAAM,EAAe,EAAsB,EAAE;IACzG,IAAI,0BAA0B;QAAE,OAAO,SAAS,CAAC;IAGjD,OAAO,KAAK,KAAI,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,OAAO,CAAA,CAAC;AAClC,CAAC,CAAC;AALW,QAAA,QAAQ,YAKnB","sourcesContent":["import { GatewayClientParameters } from '../types/parameters';\n\nexport type PayerInputs = Pick<GatewayClientParameters, 'wallet' | 'gatekeeperSendsTransaction' | 'payer'>;\n/**\n * Return the payer based on the gatekeeperSendsTransaction flag and any specified payer.\n * If gatekeeperSendsTransaction is defined, then ownerSings is the inverse of its value\n * If gatekeeperSendsTransaction is not defined, then ownerSings is the inverse of broadcastTransaction\n * If neither are defined, ownerSigns is enabled\n */\nexport const getPayer = ({ gatekeeperSendsTransaction, payer, wallet }: PayerInputs): string | undefined => {\n  if (gatekeeperSendsTransaction) return undefined; // Gatekeeper is the sender, no payer is passed from the client\n  // Payer is passed from the client or payer and gatekeeperSendsTransaction are both unspecified\n  // If payer is not passed, use the wallet address if gatekeeperSendsTransaction is not set or false\n  return payer || wallet?.address;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"fd618448b09c72fd4e3ecf87d8ff03d41e58a867"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/remoteSign.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/remoteSign.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":101}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":36}},"3":{"start":{"line":5,"column":20},"end":{"line":5,"column":48}},"4":{"start":{"line":6,"column":17},"end":{"line":6,"column":42}},"5":{"start":{"line":7,"column":17},"end":{"line":7,"column":63}},"6":{"start":{"line":8,"column":17},"end":{"line":8,"column":63}},"7":{"start":{"line":9,"column":21},"end":{"line":15,"column":1}},"8":{"start":{"line":10,"column":4},"end":{"line":14,"column":6}},"9":{"start":{"line":12,"column":12},"end":{"line":12,"column":65}},"10":{"start":{"line":16,"column":0},"end":{"line":16,"column":36}},"11":{"start":{"line":19,"column":8},"end":{"line":19,"column":37}},"12":{"start":{"line":20,"column":8},"end":{"line":20,"column":51}},"13":{"start":{"line":23,"column":8},"end":{"line":27,"column":11}},"14":{"start":{"line":30,"column":8},"end":{"line":34,"column":11}},"15":{"start":{"line":37,"column":8},"end":{"line":41,"column":11}},"16":{"start":{"line":44,"column":8},"end":{"line":48,"column":11}},"17":{"start":{"line":51,"column":8},"end":{"line":61,"column":11}},"18":{"start":{"line":64,"column":8},"end":{"line":64,"column":91}},"19":{"start":{"line":67,"column":0},"end":{"line":67,"column":68}},"20":{"start":{"line":68,"column":30},"end":{"line":116,"column":1}},"21":{"start":{"line":70,"column":44},"end":{"line":70,"column":50}},"22":{"start":{"line":71,"column":4},"end":{"line":115,"column":5}},"23":{"start":{"line":72,"column":26},"end":{"line":72,"column":85}},"24":{"start":{"line":73,"column":8},"end":{"line":77,"column":11}},"25":{"start":{"line":78,"column":8},"end":{"line":81,"column":9}},"26":{"start":{"line":79,"column":12},"end":{"line":79,"column":57}},"27":{"start":{"line":80,"column":12},"end":{"line":80,"column":19}},"28":{"start":{"line":82,"column":8},"end":{"line":85,"column":9}},"29":{"start":{"line":83,"column":12},"end":{"line":83,"column":146}},"30":{"start":{"line":84,"column":12},"end":{"line":84,"column":34}},"31":{"start":{"line":86,"column":8},"end":{"line":89,"column":9}},"32":{"start":{"line":87,"column":12},"end":{"line":87,"column":192}},"33":{"start":{"line":88,"column":12},"end":{"line":88,"column":86}},"34":{"start":{"line":90,"column":8},"end":{"line":94,"column":9}},"35":{"start":{"line":91,"column":33},"end":{"line":91,"column":96}},"36":{"start":{"line":92,"column":12},"end":{"line":92,"column":182}},"37":{"start":{"line":93,"column":12},"end":{"line":93,"column":96}},"38":{"start":{"line":95,"column":8},"end":{"line":104,"column":9}},"39":{"start":{"line":96,"column":12},"end":{"line":103,"column":13}},"40":{"start":{"line":97,"column":16},"end":{"line":99,"column":17}},"41":{"start":{"line":98,"column":20},"end":{"line":98,"column":89}},"42":{"start":{"line":100,"column":44},"end":{"line":100,"column":186}},"43":{"start":{"line":101,"column":16},"end":{"line":101,"column":159}},"44":{"start":{"line":102,"column":16},"end":{"line":102,"column":43}},"45":{"start":{"line":107,"column":21},"end":{"line":107,"column":83}},"46":{"start":{"line":108,"column":25},"end":{"line":108,"column":74}},"47":{"start":{"line":109,"column":8},"end":{"line":109,"column":113}},"48":{"start":{"line":110,"column":8},"end":{"line":110,"column":149}},"49":{"start":{"line":111,"column":8},"end":{"line":114,"column":10}},"50":{"start":{"line":117,"column":0},"end":{"line":117,"column":54}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":21},"end":{"line":9,"column":22}},"loc":{"start":{"line":9,"column":44},"end":{"line":15,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":21},"end":{"line":11,"column":22}},"loc":{"start":{"line":11,"column":48},"end":{"line":13,"column":9}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":18,"column":4},"end":{"line":18,"column":5}},"loc":{"start":{"line":18,"column":47},"end":{"line":21,"column":5}},"line":18},"3":{"name":"(anonymous_3)","decl":{"start":{"line":22,"column":4},"end":{"line":22,"column":5}},"loc":{"start":{"line":22,"column":40},"end":{"line":28,"column":5}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":28},"end":{"line":35,"column":5}},"line":29},"5":{"name":"(anonymous_5)","decl":{"start":{"line":36,"column":4},"end":{"line":36,"column":5}},"loc":{"start":{"line":36,"column":55},"end":{"line":42,"column":5}},"line":36},"6":{"name":"(anonymous_6)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":42},"end":{"line":49,"column":5}},"line":43},"7":{"name":"(anonymous_7)","decl":{"start":{"line":50,"column":4},"end":{"line":50,"column":5}},"loc":{"start":{"line":50,"column":41},"end":{"line":62,"column":5}},"line":50},"8":{"name":"(anonymous_8)","decl":{"start":{"line":63,"column":4},"end":{"line":63,"column":5}},"loc":{"start":{"line":63,"column":16},"end":{"line":65,"column":5}},"line":63},"9":{"name":"(anonymous_9)","decl":{"start":{"line":68,"column":30},"end":{"line":68,"column":31}},"loc":{"start":{"line":68,"column":75},"end":{"line":116,"column":1}},"line":68}},"branchMap":{"0":{"loc":{"start":{"line":58,"column":26},"end":{"line":58,"column":87}},"type":"cond-expr","locations":[{"start":{"line":58,"column":63},"end":{"line":58,"column":69}},{"start":{"line":58,"column":72},"end":{"line":58,"column":87}}],"line":58},"1":{"loc":{"start":{"line":58,"column":26},"end":{"line":58,"column":60}},"type":"binary-expr","locations":[{"start":{"line":58,"column":26},"end":{"line":58,"column":40}},{"start":{"line":58,"column":44},"end":{"line":58,"column":60}}],"line":58},"2":{"loc":{"start":{"line":72,"column":26},"end":{"line":72,"column":85}},"type":"binary-expr","locations":[{"start":{"line":72,"column":26},"end":{"line":72,"column":42}},{"start":{"line":72,"column":47},"end":{"line":72,"column":84}}],"line":72},"3":{"loc":{"start":{"line":78,"column":8},"end":{"line":81,"column":9}},"type":"if","locations":[{"start":{"line":78,"column":8},"end":{"line":81,"column":9}},{"start":{"line":78,"column":8},"end":{"line":81,"column":9}}],"line":78},"4":{"loc":{"start":{"line":82,"column":8},"end":{"line":85,"column":9}},"type":"if","locations":[{"start":{"line":82,"column":8},"end":{"line":85,"column":9}},{"start":{"line":82,"column":8},"end":{"line":85,"column":9}}],"line":82},"5":{"loc":{"start":{"line":83,"column":12},"end":{"line":83,"column":145}},"type":"cond-expr","locations":[{"start":{"line":83,"column":71},"end":{"line":83,"column":77}},{"start":{"line":83,"column":80},"end":{"line":83,"column":145}}],"line":83},"6":{"loc":{"start":{"line":83,"column":12},"end":{"line":83,"column":68}},"type":"binary-expr","locations":[{"start":{"line":83,"column":12},"end":{"line":83,"column":37}},{"start":{"line":83,"column":41},"end":{"line":83,"column":68}}],"line":83},"7":{"loc":{"start":{"line":86,"column":8},"end":{"line":89,"column":9}},"type":"if","locations":[{"start":{"line":86,"column":8},"end":{"line":89,"column":9}},{"start":{"line":86,"column":8},"end":{"line":89,"column":9}}],"line":86},"8":{"loc":{"start":{"line":87,"column":12},"end":{"line":87,"column":191}},"type":"cond-expr","locations":[{"start":{"line":87,"column":71},"end":{"line":87,"column":77}},{"start":{"line":87,"column":80},"end":{"line":87,"column":191}}],"line":87},"9":{"loc":{"start":{"line":87,"column":12},"end":{"line":87,"column":68}},"type":"binary-expr","locations":[{"start":{"line":87,"column":12},"end":{"line":87,"column":37}},{"start":{"line":87,"column":41},"end":{"line":87,"column":68}}],"line":87},"10":{"loc":{"start":{"line":87,"column":124},"end":{"line":87,"column":190}},"type":"cond-expr","locations":[{"start":{"line":87,"column":169},"end":{"line":87,"column":175}},{"start":{"line":87,"column":178},"end":{"line":87,"column":190}}],"line":87},"11":{"loc":{"start":{"line":87,"column":124},"end":{"line":87,"column":166}},"type":"binary-expr","locations":[{"start":{"line":87,"column":124},"end":{"line":87,"column":142}},{"start":{"line":87,"column":146},"end":{"line":87,"column":166}}],"line":87},"12":{"loc":{"start":{"line":88,"column":19},"end":{"line":88,"column":85}},"type":"cond-expr","locations":[{"start":{"line":88,"column":64},"end":{"line":88,"column":70}},{"start":{"line":88,"column":73},"end":{"line":88,"column":85}}],"line":88},"13":{"loc":{"start":{"line":88,"column":19},"end":{"line":88,"column":61}},"type":"binary-expr","locations":[{"start":{"line":88,"column":19},"end":{"line":88,"column":37}},{"start":{"line":88,"column":41},"end":{"line":88,"column":61}}],"line":88},"14":{"loc":{"start":{"line":90,"column":8},"end":{"line":94,"column":9}},"type":"if","locations":[{"start":{"line":90,"column":8},"end":{"line":94,"column":9}},{"start":{"line":90,"column":8},"end":{"line":94,"column":9}}],"line":90},"15":{"loc":{"start":{"line":92,"column":12},"end":{"line":92,"column":181}},"type":"cond-expr","locations":[{"start":{"line":92,"column":71},"end":{"line":92,"column":77}},{"start":{"line":92,"column":80},"end":{"line":92,"column":181}}],"line":92},"16":{"loc":{"start":{"line":92,"column":12},"end":{"line":92,"column":68}},"type":"binary-expr","locations":[{"start":{"line":92,"column":12},"end":{"line":92,"column":37}},{"start":{"line":92,"column":41},"end":{"line":92,"column":68}}],"line":92},"17":{"loc":{"start":{"line":95,"column":8},"end":{"line":104,"column":9}},"type":"if","locations":[{"start":{"line":95,"column":8},"end":{"line":104,"column":9}},{"start":{"line":95,"column":8},"end":{"line":104,"column":9}}],"line":95},"18":{"loc":{"start":{"line":96,"column":12},"end":{"line":103,"column":13}},"type":"if","locations":[{"start":{"line":96,"column":12},"end":{"line":103,"column":13}},{"start":{"line":96,"column":12},"end":{"line":103,"column":13}}],"line":96},"19":{"loc":{"start":{"line":97,"column":16},"end":{"line":99,"column":17}},"type":"if","locations":[{"start":{"line":97,"column":16},"end":{"line":99,"column":17}},{"start":{"line":97,"column":16},"end":{"line":99,"column":17}}],"line":97},"20":{"loc":{"start":{"line":100,"column":51},"end":{"line":100,"column":185}},"type":"cond-expr","locations":[{"start":{"line":100,"column":118},"end":{"line":100,"column":124}},{"start":{"line":100,"column":127},"end":{"line":100,"column":185}}],"line":100},"21":{"loc":{"start":{"line":100,"column":51},"end":{"line":100,"column":115}},"type":"binary-expr","locations":[{"start":{"line":100,"column":51},"end":{"line":100,"column":98}},{"start":{"line":100,"column":102},"end":{"line":100,"column":115}}],"line":100},"22":{"loc":{"start":{"line":101,"column":16},"end":{"line":101,"column":158}},"type":"cond-expr","locations":[{"start":{"line":101,"column":75},"end":{"line":101,"column":81}},{"start":{"line":101,"column":84},"end":{"line":101,"column":158}}],"line":101},"23":{"loc":{"start":{"line":101,"column":16},"end":{"line":101,"column":72}},"type":"binary-expr","locations":[{"start":{"line":101,"column":16},"end":{"line":101,"column":41}},{"start":{"line":101,"column":45},"end":{"line":101,"column":72}}],"line":101},"24":{"loc":{"start":{"line":107,"column":21},"end":{"line":107,"column":83}},"type":"binary-expr","locations":[{"start":{"line":107,"column":21},"end":{"line":107,"column":36}},{"start":{"line":107,"column":40},"end":{"line":107,"column":50}},{"start":{"line":107,"column":54},"end":{"line":107,"column":83}}],"line":107},"25":{"loc":{"start":{"line":110,"column":8},"end":{"line":110,"column":148}},"type":"cond-expr","locations":[{"start":{"line":110,"column":67},"end":{"line":110,"column":73}},{"start":{"line":110,"column":76},"end":{"line":110,"column":148}}],"line":110},"26":{"loc":{"start":{"line":110,"column":8},"end":{"line":110,"column":64}},"type":"binary-expr","locations":[{"start":{"line":110,"column":8},"end":{"line":110,"column":33}},{"start":{"line":110,"column":37},"end":{"line":110,"column":64}}],"line":110}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":30,"9":29,"10":1,"11":35,"12":35,"13":1,"14":30,"15":1,"16":1,"17":1,"18":34,"19":1,"20":1,"21":44,"22":44,"23":44,"24":44,"25":44,"26":1,"27":1,"28":43,"29":2,"30":2,"31":41,"32":31,"33":31,"34":10,"35":4,"36":2,"37":2,"38":6,"39":6,"40":6,"41":1,"42":5,"43":3,"44":3,"45":5,"46":5,"47":5,"48":5,"49":5,"50":1},"f":{"0":30,"1":29,"2":35,"3":1,"4":30,"5":1,"6":1,"7":1,"8":34,"9":44},"b":{"0":[0,1],"1":[1,1],"2":[44,15],"3":[1,43],"4":[2,41],"5":[0,2],"6":[2,2],"7":[31,10],"8":[0,31],"9":[31,31],"10":[0,31],"11":[31,31],"12":[0,31],"13":[31,31],"14":[4,6],"15":[0,2],"16":[2,2],"17":[6,0],"18":[6,0],"19":[1,5],"20":[0,5],"21":[5,5],"22":[0,3],"23":[3,3],"24":[5,5,5],"25":[0,5],"26":[5,5]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/remoteSign.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/remoteSign.ts"],"names":[],"mappings":"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","sourcesContent":["import { prefixLogger } from './logger';\nimport { ChainClientInterface, DID, ProveWalletOwnershipResponse, SignatureMethod } from './types/chain';\nimport {\n  CivicSignEventTypeRequest,\n  CivicSignEventTypeRequestMessage,\n  CivicSignEventTypeResponse,\n  RemoteSign,\n} from './types/civicSign';\nimport { ErrorWithCode } from './types/errors';\nimport { PostMessageInterface } from './types/eventInterface';\nimport { WalletAdapter } from './types/parameters';\nimport { ChainError, ErrorCode } from './utils/errors';\n\nconst logDebug = prefixLogger('remoteSign').debug;\nconst logError = prefixLogger('remoteSign').error;\n/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\nexport interface EventEmitter {\n  postMessage: (message: unknown, targetOrigin: string) => void;\n}\n\nexport const eventEmitter = (postMessageTarget: PostMessageInterface): EventEmitter => {\n  return {\n    postMessage: (message: unknown, targetOrigin: string) => {\n      postMessageTarget.postMessage(message, targetOrigin);\n    },\n  };\n};\n\nexport type RemoteError = {\n  request: CivicSignEventTypeRequest;\n  error: ErrorWithCode;\n};\nexport class RemoteSignWindowEventEmitter implements RemoteSign {\n  private postMessageTarget: EventEmitter;\n\n  constructor(postMessageTarget: EventEmitter, readonly instanceId: string) {\n    this.postMessageTarget = postMessageTarget;\n  }\n\n  public sendPublicKey(requestId: string, publicKey: string) {\n    this.emit({\n      event: CivicSignEventTypeResponse.RESPONSE_PUBLIC_KEY,\n      data: publicKey,\n      requestId,\n    });\n  }\n\n  public sendDid(requestId: string, did: string) {\n    this.emit({\n      event: CivicSignEventTypeResponse.RESPONSE_DID,\n      data: did,\n      requestId,\n    });\n  }\n\n  public sendSignedProof(requestId: string, proof: string, signatureMethod: SignatureMethod) {\n    this.emit({\n      event: CivicSignEventTypeResponse.RESPONSE_SIGNED_PROOF,\n      data: { proof, signatureMethod },\n      requestId,\n    });\n  }\n\n  public sendSignedMessage(requestId: string, message: Uint8Array) {\n    this.emit({\n      event: CivicSignEventTypeResponse.RESPONSE_SIGNED_MESSAGE,\n      data: message,\n      requestId,\n    });\n  }\n\n  public sendError(requestId: string, request: CivicSignEventTypeRequest, error: Error | ChainError) {\n    this.emit({\n      event: CivicSignEventTypeResponse.RESPONSE_ERROR,\n      requestId,\n      data: {\n        request,\n        error: {\n          message: error.message,\n          code: (error as ChainError)?.errorCode,\n        },\n      },\n    });\n  }\n\n  private emit(event: any) {\n    this.postMessageTarget.postMessage({ ...event, instanceId: this.instanceId }, '*');\n  }\n}\n\nexport const handleRemoteSignEvent = async (\n  message: CivicSignEventTypeRequestMessage,\n  remoteSignerInst: RemoteSignWindowEventEmitter,\n  inputs: { wallet: WalletAdapter; chainImplementation: ChainClientInterface; ownerDids?: DID[] }\n): Promise<string | ProveWalletOwnershipResponse | Uint8Array | undefined | RemoteError> => {\n  const { wallet, chainImplementation } = inputs;\n\n  try {\n    const ownerDids = inputs.ownerDids || (await chainImplementation.ownerDids());\n    logDebug(`handleRemoteSignEvent ${message.request}`, {\n      remoteSignerInst,\n      wallet,\n      chainImplDids: ownerDids,\n    });\n    if (!Object.values(CivicSignEventTypeRequest).includes(message.request)) {\n      logError('No result from remote sign event');\n      return;\n    }\n    if (message.request === CivicSignEventTypeRequest.REQUEST_PUBLIC_KEY) {\n      remoteSignerInst?.sendPublicKey(message.requestId, wallet.address);\n      return wallet.address;\n    }\n    if (message.request === CivicSignEventTypeRequest.REQUEST_DID) {\n      remoteSignerInst?.sendDid(message.requestId, ownerDids?.[0]);\n      return ownerDids?.[0];\n    }\n    if (message.request === CivicSignEventTypeRequest.REQUEST_SIGNED_PROOF) {\n      const powoResponse = await chainImplementation.proveWalletOwnership(message.payload as string);\n      remoteSignerInst?.sendSignedProof(message.requestId, powoResponse.proof, powoResponse.signatureMethod);\n      return { proof: powoResponse.proof, signatureMethod: powoResponse.signatureMethod };\n    }\n    if (message.request === CivicSignEventTypeRequest.REQUEST_SIGNED_MESSAGE) {\n      if (message.payload) {\n        if (!chainImplementation.signMessage) {\n          throw new Error('Chain implementation does not support signMessage');\n        }\n        const signMessageResponse = await chainImplementation.signMessage?.(Buffer.from(message.payload));\n        remoteSignerInst?.sendSignedMessage(message.requestId, signMessageResponse);\n        return signMessageResponse;\n      }\n    }\n  } catch (error) {\n    const code = (error as ChainError).errorCode || (error as ErrorWithCode).code || ErrorCode.POWO_ERROR;\n    const useError = new ChainError(error.message, `${code}`);\n    logError(`Error handling remote sign event, sending back an error response with code ${code}`, useError);\n    remoteSignerInst?.sendError(message.requestId, message.request, useError);\n    return {\n      request: message.request,\n      error: useError,\n    };\n  }\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7ad5c38130b9237e42dcac9aeaf7f61c6f72993b"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/errors.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/errors.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":83}},"4":{"start":{"line":7,"column":17},"end":{"line":7,"column":54}},"5":{"start":{"line":8,"column":0},"end":{"line":22,"column":2}},"6":{"start":{"line":25,"column":8},"end":{"line":25,"column":23}},"7":{"start":{"line":26,"column":8},"end":{"line":26,"column":35}},"8":{"start":{"line":27,"column":8},"end":{"line":27,"column":131}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":58}},"10":{"start":{"line":31,"column":0},"end":{"line":31,"column":32}},"11":{"start":{"line":34,"column":8},"end":{"line":34,"column":23}},"12":{"start":{"line":35,"column":8},"end":{"line":35,"column":35}},"13":{"start":{"line":36,"column":8},"end":{"line":36,"column":98}},"14":{"start":{"line":37,"column":8},"end":{"line":37,"column":72}},"15":{"start":{"line":40,"column":0},"end":{"line":40,"column":60}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":24,"column":4},"end":{"line":24,"column":5}},"loc":{"start":{"line":24,"column":66},"end":{"line":29,"column":5}},"line":24},"2":{"name":"(anonymous_2)","decl":{"start":{"line":33,"column":4},"end":{"line":33,"column":5}},"loc":{"start":{"line":33,"column":89},"end":{"line":38,"column":5}},"line":33}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":24,"column":36},"end":{"line":24,"column":64}},"type":"default-arg","locations":[{"start":{"line":24,"column":48},"end":{"line":24,"column":64}}],"line":24},"4":{"loc":{"start":{"line":27,"column":8},"end":{"line":27,"column":130}},"type":"cond-expr","locations":[{"start":{"line":27,"column":53},"end":{"line":27,"column":59}},{"start":{"line":27,"column":62},"end":{"line":27,"column":130}}],"line":27},"5":{"loc":{"start":{"line":27,"column":8},"end":{"line":27,"column":50}},"type":"binary-expr","locations":[{"start":{"line":27,"column":8},"end":{"line":27,"column":26}},{"start":{"line":27,"column":30},"end":{"line":27,"column":50}}],"line":27},"6":{"loc":{"start":{"line":33,"column":25},"end":{"line":33,"column":87}},"type":"default-arg","locations":[{"start":{"line":33,"column":37},"end":{"line":33,"column":87}}],"line":33}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":10,"7":10,"8":10,"9":10,"10":1,"11":2,"12":2,"13":2,"14":2,"15":1},"f":{"0":1,"1":10,"2":2},"b":{"0":[1,1,1],"1":[1,0],"2":[1,1],"3":[10],"4":[0,10],"5":[10,10],"6":[2]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/errors.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/errors.ts"],"names":[],"mappings":";;;;;;AAAA,uDAA+B;AAGlB,QAAA,SAAS,GAAG;IACvB,kBAAkB,EAAE,KAAK;IACzB,sBAAsB,EAAE,KAAK;IAC7B,oCAAoC,EAAE,MAAM;IAC5C,8BAA8B,EAAE,MAAM;IACtC,sBAAsB,EAAE,KAAK;IAC7B,+BAA+B,EAAE,KAAK;IACtC,UAAU,EAAE,KAAK;IACjB,gCAAgC,EAAE,KAAK;IACvC,iCAAiC,EAAE,MAAM;IACzC,yBAAyB,EAAE,MAAM;IACjC,sCAAsC,EAAE,MAAM;IAC9C,wCAAwC,EAAE,MAAM;IAChD,0BAA0B,EAAE,KAAK;CAClC,CAAC;AAEF,MAAa,UAAW,SAAQ,KAAK;IACnC,YAAY,OAAe,EAAW,SAAkB,EAAE,YAA8B,gBAAM;QAC5F,KAAK,CAAC,OAAO,CAAC,CAAC;QADqB,cAAS,GAAT,SAAS,CAAS;QAEtD,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,KAAK,CAAC,eAAe,OAAO,kBAAkB,SAAS,EAAE,CAAC,CAAC;QACtE,MAAM,CAAC,cAAc,CAAC,IAAI,EAAE,UAAU,CAAC,SAAS,CAAC,CAAC;IACpD,CAAC;CACF;AAND,gCAMC;AAED,MAAa,wBAAyB,SAAQ,KAAK;IACjD,YAAY,OAAe,EAAW,YAAY,iBAAS,CAAC,gCAAgC;QAC1F,KAAK,CAAC,OAAO,CAAC,CAAC;QADqB,cAAS,GAAT,SAAS,CAA6C;QAE1F,gBAAM,CAAC,KAAK,CAAC,6BAA6B,OAAO,kBAAkB,SAAS,EAAE,CAAC,CAAC;QAChF,MAAM,CAAC,cAAc,CAAC,IAAI,EAAE,wBAAwB,CAAC,SAAS,CAAC,CAAC;IAClE,CAAC;CACF;AAND,4DAMC","sourcesContent":["import logger from '../logger';\nimport { LoggingInterface } from '../logger/provider.logger';\n\nexport const ErrorCode = {\n  INSUFFICIENT_FUNDS: '0x1',\n  SIGN_TRANSACTION_ERROR: '0x2',\n  SIGN_TRANSACTION_USER_REJECTED_ERROR: '0x21',\n  SIGN_TRANSACTION_UNKNOWN_ERROR: '0x22',\n  SEND_TRANSACTION_ERROR: '0x3',\n  CUSTOM_HANDLE_TRANSACTION_ERROR: '0x4',\n  POWO_ERROR: '0x5',\n  CHAIN_CONFIRMATION_TIMEOUT_ERROR: '0x6', // the tx has been sent but hasn't confirmed on-chain within a timeout\n  TRANSACTION_FAILED_ON_CHAIN_ERROR: '0x61', // The tx receipt indicates the transaction failed / had an error.\n  TRANSACTION_DROPPED_ERROR: '0x62', // Transaction not found on-chain after sending it. For Solana, when confirmTransaction times out.\n  TRANSACTION_CONFIRMATION_UNKNOWN_ERROR: '0x63', // For e.g. Solana confirmTransaction threw some error instead of just timing out.\n  BROWSER_CLOSED_WHILE_TRANSACTION_PENDING: '0x64', // We use the Beacon API (in no-cors mode) to emit this if the user closes the browser tab while a tx is still in flight\n  EXPECTED_GATEKEEPER_RECORD: '0x7', // we have a token on chain but no correspondoing record in the gatekeeper\n};\n\nexport class ChainError extends Error {\n  constructor(message: string, readonly errorCode?: string, useLogger: LoggingInterface = logger) {\n    super(message);\n    useLogger?.error(`ChainError: ${message} throwing code ${errorCode}`);\n    Object.setPrototypeOf(this, ChainError.prototype); // required for instance checking\n  }\n}\n\nexport class ChainConfirmationTimeout extends Error {\n  constructor(message: string, readonly errorCode = ErrorCode.CHAIN_CONFIRMATION_TIMEOUT_ERROR) {\n    super(message);\n    logger.error(`ChainConfirmationTimeout: ${message} throwing code ${errorCode}`);\n    Object.setPrototypeOf(this, ChainConfirmationTimeout.prototype); // required for instance checking\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5357c3ea1bce14e18fbd2c1982ec43861dfcbf7a"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/issuance.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/issuance.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":26}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":36}},"3":{"start":{"line":5,"column":27},"end":{"line":5,"column":56}},"4":{"start":{"line":6,"column":16},"end":{"line":6,"column":40}},"5":{"start":{"line":7,"column":19},"end":{"line":7,"column":46}},"6":{"start":{"line":8,"column":17},"end":{"line":8,"column":42}},"7":{"start":{"line":9,"column":17},"end":{"line":9,"column":42}},"8":{"start":{"line":12,"column":8},"end":{"line":12,"column":67}},"9":{"start":{"line":13,"column":8},"end":{"line":13,"column":49}},"10":{"start":{"line":14,"column":8},"end":{"line":14,"column":55}},"11":{"start":{"line":15,"column":8},"end":{"line":15,"column":49}},"12":{"start":{"line":16,"column":8},"end":{"line":16,"column":47}},"13":{"start":{"line":17,"column":8},"end":{"line":17,"column":67}},"14":{"start":{"line":18,"column":8},"end":{"line":18,"column":25}},"15":{"start":{"line":19,"column":8},"end":{"line":19,"column":127}},"16":{"start":{"line":23,"column":26},"end":{"line":23,"column":58}},"17":{"start":{"line":24,"column":8},"end":{"line":27,"column":9}},"18":{"start":{"line":25,"column":12},"end":{"line":25,"column":63}},"19":{"start":{"line":26,"column":12},"end":{"line":26,"column":64}},"20":{"start":{"line":28,"column":8},"end":{"line":42,"column":11}},"21":{"start":{"line":29,"column":12},"end":{"line":33,"column":13}},"22":{"start":{"line":30,"column":16},"end":{"line":32,"column":18}},"23":{"start":{"line":34,"column":12},"end":{"line":36,"column":13}},"24":{"start":{"line":35,"column":16},"end":{"line":35,"column":62}},"25":{"start":{"line":37,"column":12},"end":{"line":37,"column":65}},"26":{"start":{"line":38,"column":12},"end":{"line":38,"column":62}},"27":{"start":{"line":39,"column":12},"end":{"line":39,"column":76}},"28":{"start":{"line":40,"column":12},"end":{"line":40,"column":62}},"29":{"start":{"line":41,"column":12},"end":{"line":41,"column":51}},"30":{"start":{"line":43,"column":8},"end":{"line":43,"column":39}},"31":{"start":{"line":44,"column":8},"end":{"line":47,"column":9}},"32":{"start":{"line":45,"column":12},"end":{"line":45,"column":83}},"33":{"start":{"line":46,"column":12},"end":{"line":46,"column":83}},"34":{"start":{"line":48,"column":26},"end":{"line":48,"column":114}},"35":{"start":{"line":49,"column":46},"end":{"line":51,"column":23}},"36":{"start":{"line":52,"column":8},"end":{"line":72,"column":11}},"37":{"start":{"line":55,"column":12},"end":{"line":56,"column":23}},"38":{"start":{"line":56,"column":16},"end":{"line":56,"column":23}},"39":{"start":{"line":57,"column":12},"end":{"line":63,"column":15}},"40":{"start":{"line":58,"column":16},"end":{"line":60,"column":17}},"41":{"start":{"line":59,"column":20},"end":{"line":59,"column":57}},"42":{"start":{"line":61,"column":16},"end":{"line":61,"column":68}},"43":{"start":{"line":62,"column":16},"end":{"line":62,"column":64}},"44":{"start":{"line":66,"column":12},"end":{"line":71,"column":15}},"45":{"start":{"line":67,"column":16},"end":{"line":69,"column":17}},"46":{"start":{"line":68,"column":20},"end":{"line":68,"column":57}},"47":{"start":{"line":70,"column":16},"end":{"line":70,"column":62}},"48":{"start":{"line":76,"column":8},"end":{"line":79,"column":9}},"49":{"start":{"line":77,"column":12},"end":{"line":77,"column":67}},"50":{"start":{"line":78,"column":12},"end":{"line":78,"column":57}},"51":{"start":{"line":80,"column":8},"end":{"line":80,"column":121}},"52":{"start":{"line":81,"column":8},"end":{"line":84,"column":11}},"53":{"start":{"line":87,"column":8},"end":{"line":89,"column":11}},"54":{"start":{"line":92,"column":8},"end":{"line":100,"column":11}},"55":{"start":{"line":93,"column":12},"end":{"line":93,"column":62}},"56":{"start":{"line":94,"column":12},"end":{"line":94,"column":76}},"57":{"start":{"line":95,"column":12},"end":{"line":95,"column":58}},"58":{"start":{"line":96,"column":12},"end":{"line":96,"column":83}},"59":{"start":{"line":97,"column":12},"end":{"line":99,"column":13}},"60":{"start":{"line":98,"column":16},"end":{"line":98,"column":60}},"61":{"start":{"line":103,"column":26},"end":{"line":103,"column":58}},"62":{"start":{"line":104,"column":8},"end":{"line":104,"column":41}},"63":{"start":{"line":105,"column":8},"end":{"line":105,"column":59}},"64":{"start":{"line":106,"column":8},"end":{"line":106,"column":39}},"65":{"start":{"line":107,"column":8},"end":{"line":107,"column":74}},"66":{"start":{"line":108,"column":31},"end":{"line":110,"column":54}},"67":{"start":{"line":111,"column":8},"end":{"line":125,"column":11}},"68":{"start":{"line":113,"column":12},"end":{"line":114,"column":23}},"69":{"start":{"line":114,"column":16},"end":{"line":114,"column":23}},"70":{"start":{"line":115,"column":12},"end":{"line":118,"column":15}},"71":{"start":{"line":116,"column":16},"end":{"line":116,"column":84}},"72":{"start":{"line":117,"column":16},"end":{"line":117,"column":66}},"73":{"start":{"line":121,"column":12},"end":{"line":124,"column":15}},"74":{"start":{"line":122,"column":16},"end":{"line":122,"column":81}},"75":{"start":{"line":123,"column":16},"end":{"line":123,"column":60}},"76":{"start":{"line":129,"column":26},"end":{"line":129,"column":58}},"77":{"start":{"line":130,"column":8},"end":{"line":133,"column":9}},"78":{"start":{"line":131,"column":12},"end":{"line":131,"column":67}},"79":{"start":{"line":132,"column":12},"end":{"line":132,"column":57}},"80":{"start":{"line":134,"column":8},"end":{"line":134,"column":41}},"81":{"start":{"line":135,"column":8},"end":{"line":135,"column":62}},"82":{"start":{"line":136,"column":8},"end":{"line":136,"column":39}},"83":{"start":{"line":137,"column":8},"end":{"line":137,"column":49}},"84":{"start":{"line":138,"column":8},"end":{"line":152,"column":11}},"85":{"start":{"line":140,"column":12},"end":{"line":141,"column":23}},"86":{"start":{"line":141,"column":16},"end":{"line":141,"column":23}},"87":{"start":{"line":142,"column":12},"end":{"line":145,"column":15}},"88":{"start":{"line":143,"column":16},"end":{"line":143,"column":84}},"89":{"start":{"line":144,"column":16},"end":{"line":144,"column":66}},"90":{"start":{"line":148,"column":12},"end":{"line":151,"column":15}},"91":{"start":{"line":149,"column":16},"end":{"line":149,"column":81}},"92":{"start":{"line":150,"column":16},"end":{"line":150,"column":60}},"93":{"start":{"line":155,"column":29},"end":{"line":155,"column":61}},"94":{"start":{"line":156,"column":8},"end":{"line":156,"column":59}},"95":{"start":{"line":159,"column":26},"end":{"line":159,"column":58}},"96":{"start":{"line":160,"column":8},"end":{"line":162,"column":9}},"97":{"start":{"line":161,"column":12},"end":{"line":161,"column":19}},"98":{"start":{"line":163,"column":8},"end":{"line":169,"column":50}},"99":{"start":{"line":164,"column":12},"end":{"line":168,"column":15}},"100":{"start":{"line":165,"column":16},"end":{"line":167,"column":17}},"101":{"start":{"line":166,"column":20},"end":{"line":166,"column":146}},"102":{"start":{"line":170,"column":8},"end":{"line":170,"column":87}},"103":{"start":{"line":173,"column":8},"end":{"line":173,"column":39}},"104":{"start":{"line":174,"column":8},"end":{"line":174,"column":42}},"105":{"start":{"line":177,"column":8},"end":{"line":180,"column":9}},"106":{"start":{"line":178,"column":12},"end":{"line":178,"column":92}},"107":{"start":{"line":179,"column":12},"end":{"line":179,"column":57}},"108":{"start":{"line":183,"column":8},"end":{"line":183,"column":39}},"109":{"start":{"line":184,"column":8},"end":{"line":190,"column":11}},"110":{"start":{"line":186,"column":12},"end":{"line":189,"column":13}},"111":{"start":{"line":187,"column":16},"end":{"line":187,"column":60}},"112":{"start":{"line":188,"column":16},"end":{"line":188,"column":75}},"113":{"start":{"line":191,"column":8},"end":{"line":191,"column":42}},"114":{"start":{"line":194,"column":26},"end":{"line":194,"column":58}},"115":{"start":{"line":195,"column":29},"end":{"line":195,"column":67}},"116":{"start":{"line":196,"column":8},"end":{"line":198,"column":9}},"117":{"start":{"line":197,"column":12},"end":{"line":197,"column":19}},"118":{"start":{"line":199,"column":8},"end":{"line":199,"column":42}},"119":{"start":{"line":200,"column":40},"end":{"line":200,"column":117}},"120":{"start":{"line":201,"column":8},"end":{"line":203,"column":36}},"121":{"start":{"line":202,"column":12},"end":{"line":202,"column":46}},"122":{"start":{"line":204,"column":8},"end":{"line":207,"column":11}},"123":{"start":{"line":210,"column":8},"end":{"line":212,"column":11}},"124":{"start":{"line":213,"column":8},"end":{"line":216,"column":9}},"125":{"start":{"line":214,"column":12},"end":{"line":214,"column":60}},"126":{"start":{"line":215,"column":12},"end":{"line":215,"column":58}},"127":{"start":{"line":219,"column":8},"end":{"line":221,"column":11}},"128":{"start":{"line":220,"column":12},"end":{"line":220,"column":51}},"129":{"start":{"line":224,"column":0},"end":{"line":224,"column":28}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":11,"column":4},"end":{"line":11,"column":5}},"loc":{"start":{"line":11,"column":167},"end":{"line":20,"column":5}},"line":11},"1":{"name":"(anonymous_1)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":28},"end":{"line":73,"column":5}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":39},"end":{"line":28,"column":40}},"loc":{"start":{"line":28,"column":50},"end":{"line":42,"column":9}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":54,"column":18},"end":{"line":54,"column":19}},"loc":{"start":{"line":54,"column":28},"end":{"line":64,"column":9}},"line":54},"4":{"name":"(anonymous_4)","decl":{"start":{"line":57,"column":43},"end":{"line":57,"column":44}},"loc":{"start":{"line":57,"column":54},"end":{"line":63,"column":13}},"line":57},"5":{"name":"(anonymous_5)","decl":{"start":{"line":65,"column":19},"end":{"line":65,"column":20}},"loc":{"start":{"line":65,"column":30},"end":{"line":72,"column":9}},"line":65},"6":{"name":"(anonymous_6)","decl":{"start":{"line":66,"column":43},"end":{"line":66,"column":44}},"loc":{"start":{"line":66,"column":54},"end":{"line":71,"column":13}},"line":66},"7":{"name":"(anonymous_7)","decl":{"start":{"line":74,"column":4},"end":{"line":74,"column":5}},"loc":{"start":{"line":74,"column":46},"end":{"line":85,"column":5}},"line":74},"8":{"name":"(anonymous_8)","decl":{"start":{"line":86,"column":4},"end":{"line":86,"column":5}},"loc":{"start":{"line":86,"column":51},"end":{"line":90,"column":5}},"line":86},"9":{"name":"(anonymous_9)","decl":{"start":{"line":91,"column":4},"end":{"line":91,"column":5}},"loc":{"start":{"line":91,"column":73},"end":{"line":101,"column":5}},"line":91},"10":{"name":"(anonymous_10)","decl":{"start":{"line":92,"column":39},"end":{"line":92,"column":40}},"loc":{"start":{"line":92,"column":50},"end":{"line":100,"column":9}},"line":92},"11":{"name":"(anonymous_11)","decl":{"start":{"line":102,"column":4},"end":{"line":102,"column":5}},"loc":{"start":{"line":102,"column":71},"end":{"line":126,"column":5}},"line":102},"12":{"name":"(anonymous_12)","decl":{"start":{"line":112,"column":18},"end":{"line":112,"column":19}},"loc":{"start":{"line":112,"column":32},"end":{"line":119,"column":9}},"line":112},"13":{"name":"(anonymous_13)","decl":{"start":{"line":115,"column":43},"end":{"line":115,"column":44}},"loc":{"start":{"line":115,"column":54},"end":{"line":118,"column":13}},"line":115},"14":{"name":"(anonymous_14)","decl":{"start":{"line":120,"column":19},"end":{"line":120,"column":20}},"loc":{"start":{"line":120,"column":30},"end":{"line":125,"column":9}},"line":120},"15":{"name":"(anonymous_15)","decl":{"start":{"line":121,"column":43},"end":{"line":121,"column":44}},"loc":{"start":{"line":121,"column":54},"end":{"line":124,"column":13}},"line":121},"16":{"name":"(anonymous_16)","decl":{"start":{"line":127,"column":4},"end":{"line":127,"column":5}},"loc":{"start":{"line":127,"column":42},"end":{"line":153,"column":5}},"line":127},"17":{"name":"(anonymous_17)","decl":{"start":{"line":139,"column":18},"end":{"line":139,"column":19}},"loc":{"start":{"line":139,"column":32},"end":{"line":146,"column":9}},"line":139},"18":{"name":"(anonymous_18)","decl":{"start":{"line":142,"column":43},"end":{"line":142,"column":44}},"loc":{"start":{"line":142,"column":54},"end":{"line":145,"column":13}},"line":142},"19":{"name":"(anonymous_19)","decl":{"start":{"line":147,"column":19},"end":{"line":147,"column":20}},"loc":{"start":{"line":147,"column":30},"end":{"line":152,"column":9}},"line":147},"20":{"name":"(anonymous_20)","decl":{"start":{"line":148,"column":43},"end":{"line":148,"column":44}},"loc":{"start":{"line":148,"column":54},"end":{"line":151,"column":13}},"line":148},"21":{"name":"(anonymous_21)","decl":{"start":{"line":154,"column":4},"end":{"line":154,"column":5}},"loc":{"start":{"line":154,"column":26},"end":{"line":157,"column":5}},"line":154},"22":{"name":"(anonymous_22)","decl":{"start":{"line":158,"column":4},"end":{"line":158,"column":5}},"loc":{"start":{"line":158,"column":25},"end":{"line":171,"column":5}},"line":158},"23":{"name":"(anonymous_23)","decl":{"start":{"line":163,"column":52},"end":{"line":163,"column":53}},"loc":{"start":{"line":163,"column":58},"end":{"line":169,"column":9}},"line":163},"24":{"name":"(anonymous_24)","decl":{"start":{"line":164,"column":43},"end":{"line":164,"column":44}},"loc":{"start":{"line":164,"column":54},"end":{"line":168,"column":13}},"line":164},"25":{"name":"(anonymous_25)","decl":{"start":{"line":172,"column":4},"end":{"line":172,"column":5}},"loc":{"start":{"line":172,"column":12},"end":{"line":175,"column":5}},"line":172},"26":{"name":"(anonymous_26)","decl":{"start":{"line":176,"column":4},"end":{"line":176,"column":5}},"loc":{"start":{"line":176,"column":30},"end":{"line":181,"column":5}},"line":176},"27":{"name":"(anonymous_27)","decl":{"start":{"line":182,"column":4},"end":{"line":182,"column":5}},"loc":{"start":{"line":182,"column":25},"end":{"line":192,"column":5}},"line":182},"28":{"name":"(anonymous_28)","decl":{"start":{"line":184,"column":39},"end":{"line":184,"column":40}},"loc":{"start":{"line":184,"column":50},"end":{"line":190,"column":9}},"line":184},"29":{"name":"(anonymous_29)","decl":{"start":{"line":193,"column":4},"end":{"line":193,"column":5}},"loc":{"start":{"line":193,"column":33},"end":{"line":208,"column":5}},"line":193},"30":{"name":"(anonymous_30)","decl":{"start":{"line":201,"column":55},"end":{"line":201,"column":56}},"loc":{"start":{"line":201,"column":61},"end":{"line":203,"column":9}},"line":201},"31":{"name":"(anonymous_31)","decl":{"start":{"line":209,"column":4},"end":{"line":209,"column":5}},"loc":{"start":{"line":209,"column":33},"end":{"line":217,"column":5}},"line":209},"32":{"name":"(anonymous_32)","decl":{"start":{"line":218,"column":4},"end":{"line":218,"column":5}},"loc":{"start":{"line":218,"column":28},"end":{"line":222,"column":5}},"line":218},"33":{"name":"(anonymous_33)","decl":{"start":{"line":219,"column":39},"end":{"line":219,"column":40}},"loc":{"start":{"line":219,"column":50},"end":{"line":221,"column":9}},"line":219}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":90},"end":{"line":11,"column":165}},"type":"default-arg","locations":[{"start":{"line":11,"column":118},"end":{"line":11,"column":165}}],"line":11},"1":{"loc":{"start":{"line":24,"column":8},"end":{"line":27,"column":9}},"type":"if","locations":[{"start":{"line":24,"column":8},"end":{"line":27,"column":9}},{"start":{"line":24,"column":8},"end":{"line":27,"column":9}}],"line":24},"2":{"loc":{"start":{"line":24,"column":14},"end":{"line":24,"column":115}},"type":"cond-expr","locations":[{"start":{"line":24,"column":92},"end":{"line":24,"column":98}},{"start":{"line":24,"column":101},"end":{"line":24,"column":115}}],"line":24},"3":{"loc":{"start":{"line":24,"column":14},"end":{"line":24,"column":89}},"type":"binary-expr","locations":[{"start":{"line":24,"column":14},"end":{"line":24,"column":72}},{"start":{"line":24,"column":76},"end":{"line":24,"column":89}}],"line":24},"4":{"loc":{"start":{"line":29,"column":12},"end":{"line":33,"column":13}},"type":"if","locations":[{"start":{"line":29,"column":12},"end":{"line":33,"column":13}},{"start":{"line":29,"column":12},"end":{"line":33,"column":13}}],"line":29},"5":{"loc":{"start":{"line":34,"column":12},"end":{"line":36,"column":13}},"type":"if","locations":[{"start":{"line":34,"column":12},"end":{"line":36,"column":13}},{"start":{"line":34,"column":12},"end":{"line":36,"column":13}}],"line":34},"6":{"loc":{"start":{"line":44,"column":8},"end":{"line":47,"column":9}},"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":47,"column":9}},{"start":{"line":44,"column":8},"end":{"line":47,"column":9}}],"line":44},"7":{"loc":{"start":{"line":48,"column":26},"end":{"line":48,"column":114}},"type":"cond-expr","locations":[{"start":{"line":48,"column":93},"end":{"line":48,"column":99}},{"start":{"line":48,"column":102},"end":{"line":48,"column":114}}],"line":48},"8":{"loc":{"start":{"line":48,"column":26},"end":{"line":48,"column":90}},"type":"binary-expr","locations":[{"start":{"line":48,"column":26},"end":{"line":48,"column":73}},{"start":{"line":48,"column":77},"end":{"line":48,"column":90}}],"line":48},"9":{"loc":{"start":{"line":49,"column":46},"end":{"line":51,"column":23}},"type":"cond-expr","locations":[{"start":{"line":50,"column":14},"end":{"line":50,"column":203}},{"start":{"line":51,"column":14},"end":{"line":51,"column":23}}],"line":49},"10":{"loc":{"start":{"line":50,"column":14},"end":{"line":50,"column":203}},"type":"cond-expr","locations":[{"start":{"line":50,"column":162},"end":{"line":50,"column":168}},{"start":{"line":50,"column":171},"end":{"line":50,"column":203}}],"line":50},"11":{"loc":{"start":{"line":50,"column":14},"end":{"line":50,"column":159}},"type":"binary-expr","locations":[{"start":{"line":50,"column":14},"end":{"line":50,"column":142}},{"start":{"line":50,"column":146},"end":{"line":50,"column":159}}],"line":50},"12":{"loc":{"start":{"line":50,"column":20},"end":{"line":50,"column":132}},"type":"cond-expr","locations":[{"start":{"line":50,"column":103},"end":{"line":50,"column":109}},{"start":{"line":50,"column":112},"end":{"line":50,"column":132}}],"line":50},"13":{"loc":{"start":{"line":50,"column":20},"end":{"line":50,"column":100}},"type":"binary-expr","locations":[{"start":{"line":50,"column":20},"end":{"line":50,"column":83}},{"start":{"line":50,"column":87},"end":{"line":50,"column":100}}],"line":50},"14":{"loc":{"start":{"line":55,"column":12},"end":{"line":56,"column":23}},"type":"if","locations":[{"start":{"line":55,"column":12},"end":{"line":56,"column":23}},{"start":{"line":55,"column":12},"end":{"line":56,"column":23}}],"line":55},"15":{"loc":{"start":{"line":58,"column":16},"end":{"line":60,"column":17}},"type":"if","locations":[{"start":{"line":58,"column":16},"end":{"line":60,"column":17}},{"start":{"line":58,"column":16},"end":{"line":60,"column":17}}],"line":58},"16":{"loc":{"start":{"line":67,"column":16},"end":{"line":69,"column":17}},"type":"if","locations":[{"start":{"line":67,"column":16},"end":{"line":69,"column":17}},{"start":{"line":67,"column":16},"end":{"line":69,"column":17}}],"line":67},"17":{"loc":{"start":{"line":76,"column":8},"end":{"line":79,"column":9}},"type":"if","locations":[{"start":{"line":76,"column":8},"end":{"line":79,"column":9}},{"start":{"line":76,"column":8},"end":{"line":79,"column":9}}],"line":76},"18":{"loc":{"start":{"line":76,"column":14},"end":{"line":76,"column":104}},"type":"cond-expr","locations":[{"start":{"line":76,"column":85},"end":{"line":76,"column":91}},{"start":{"line":76,"column":94},"end":{"line":76,"column":104}}],"line":76},"19":{"loc":{"start":{"line":76,"column":14},"end":{"line":76,"column":82}},"type":"binary-expr","locations":[{"start":{"line":76,"column":14},"end":{"line":76,"column":65}},{"start":{"line":76,"column":69},"end":{"line":76,"column":82}}],"line":76},"20":{"loc":{"start":{"line":80,"column":30},"end":{"line":80,"column":120}},"type":"cond-expr","locations":[{"start":{"line":80,"column":101},"end":{"line":80,"column":107}},{"start":{"line":80,"column":110},"end":{"line":80,"column":120}}],"line":80},"21":{"loc":{"start":{"line":80,"column":30},"end":{"line":80,"column":98}},"type":"binary-expr","locations":[{"start":{"line":80,"column":30},"end":{"line":80,"column":81}},{"start":{"line":80,"column":85},"end":{"line":80,"column":98}}],"line":80},"22":{"loc":{"start":{"line":82,"column":21},"end":{"line":82,"column":111}},"type":"cond-expr","locations":[{"start":{"line":82,"column":92},"end":{"line":82,"column":98}},{"start":{"line":82,"column":101},"end":{"line":82,"column":111}}],"line":82},"23":{"loc":{"start":{"line":82,"column":21},"end":{"line":82,"column":89}},"type":"binary-expr","locations":[{"start":{"line":82,"column":21},"end":{"line":82,"column":72}},{"start":{"line":82,"column":76},"end":{"line":82,"column":89}}],"line":82},"24":{"loc":{"start":{"line":91,"column":38},"end":{"line":91,"column":71}},"type":"default-arg","locations":[{"start":{"line":91,"column":66},"end":{"line":91,"column":71}}],"line":91},"25":{"loc":{"start":{"line":97,"column":12},"end":{"line":99,"column":13}},"type":"if","locations":[{"start":{"line":97,"column":12},"end":{"line":99,"column":13}},{"start":{"line":97,"column":12},"end":{"line":99,"column":13}}],"line":97},"26":{"loc":{"start":{"line":108,"column":31},"end":{"line":110,"column":54}},"type":"cond-expr","locations":[{"start":{"line":109,"column":14},"end":{"line":109,"column":59}},{"start":{"line":110,"column":14},"end":{"line":110,"column":54}}],"line":108},"27":{"loc":{"start":{"line":113,"column":12},"end":{"line":114,"column":23}},"type":"if","locations":[{"start":{"line":113,"column":12},"end":{"line":114,"column":23}},{"start":{"line":113,"column":12},"end":{"line":114,"column":23}}],"line":113},"28":{"loc":{"start":{"line":130,"column":8},"end":{"line":133,"column":9}},"type":"if","locations":[{"start":{"line":130,"column":8},"end":{"line":133,"column":9}},{"start":{"line":130,"column":8},"end":{"line":133,"column":9}}],"line":130},"29":{"loc":{"start":{"line":130,"column":14},"end":{"line":130,"column":104}},"type":"cond-expr","locations":[{"start":{"line":130,"column":85},"end":{"line":130,"column":91}},{"start":{"line":130,"column":94},"end":{"line":130,"column":104}}],"line":130},"30":{"loc":{"start":{"line":130,"column":14},"end":{"line":130,"column":82}},"type":"binary-expr","locations":[{"start":{"line":130,"column":14},"end":{"line":130,"column":65}},{"start":{"line":130,"column":69},"end":{"line":130,"column":82}}],"line":130},"31":{"loc":{"start":{"line":140,"column":12},"end":{"line":141,"column":23}},"type":"if","locations":[{"start":{"line":140,"column":12},"end":{"line":141,"column":23}},{"start":{"line":140,"column":12},"end":{"line":141,"column":23}}],"line":140},"32":{"loc":{"start":{"line":160,"column":8},"end":{"line":162,"column":9}},"type":"if","locations":[{"start":{"line":160,"column":8},"end":{"line":162,"column":9}},{"start":{"line":160,"column":8},"end":{"line":162,"column":9}}],"line":160},"33":{"loc":{"start":{"line":160,"column":12},"end":{"line":160,"column":84}},"type":"binary-expr","locations":[{"start":{"line":160,"column":12},"end":{"line":160,"column":50}},{"start":{"line":160,"column":54},"end":{"line":160,"column":84}}],"line":160},"34":{"loc":{"start":{"line":165,"column":16},"end":{"line":167,"column":17}},"type":"if","locations":[{"start":{"line":165,"column":16},"end":{"line":167,"column":17}},{"start":{"line":165,"column":16},"end":{"line":167,"column":17}}],"line":165},"35":{"loc":{"start":{"line":177,"column":8},"end":{"line":180,"column":9}},"type":"if","locations":[{"start":{"line":177,"column":8},"end":{"line":180,"column":9}},{"start":{"line":177,"column":8},"end":{"line":180,"column":9}}],"line":177},"36":{"loc":{"start":{"line":186,"column":12},"end":{"line":189,"column":13}},"type":"if","locations":[{"start":{"line":186,"column":12},"end":{"line":189,"column":13}},{"start":{"line":186,"column":12},"end":{"line":189,"column":13}}],"line":186},"37":{"loc":{"start":{"line":186,"column":17},"end":{"line":186,"column":114}},"type":"cond-expr","locations":[{"start":{"line":186,"column":83},"end":{"line":186,"column":89}},{"start":{"line":186,"column":92},"end":{"line":186,"column":114}}],"line":186},"38":{"loc":{"start":{"line":186,"column":17},"end":{"line":186,"column":80}},"type":"binary-expr","locations":[{"start":{"line":186,"column":17},"end":{"line":186,"column":63}},{"start":{"line":186,"column":67},"end":{"line":186,"column":80}}],"line":186},"39":{"loc":{"start":{"line":196,"column":8},"end":{"line":198,"column":9}},"type":"if","locations":[{"start":{"line":196,"column":8},"end":{"line":198,"column":9}},{"start":{"line":196,"column":8},"end":{"line":198,"column":9}}],"line":196},"40":{"loc":{"start":{"line":196,"column":14},"end":{"line":196,"column":97}},"type":"cond-expr","locations":[{"start":{"line":196,"column":65},"end":{"line":196,"column":71}},{"start":{"line":196,"column":74},"end":{"line":196,"column":97}}],"line":196},"41":{"loc":{"start":{"line":196,"column":14},"end":{"line":196,"column":62}},"type":"binary-expr","locations":[{"start":{"line":196,"column":14},"end":{"line":196,"column":35}},{"start":{"line":196,"column":39},"end":{"line":196,"column":62}}],"line":196},"42":{"loc":{"start":{"line":213,"column":8},"end":{"line":216,"column":9}},"type":"if","locations":[{"start":{"line":213,"column":8},"end":{"line":216,"column":9}},{"start":{"line":213,"column":8},"end":{"line":216,"column":9}}],"line":213}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":57,"9":57,"10":57,"11":57,"12":57,"13":57,"14":57,"15":57,"16":28,"17":28,"18":1,"19":1,"20":27,"21":25,"22":17,"23":25,"24":25,"25":25,"26":25,"27":25,"28":25,"29":25,"30":27,"31":27,"32":1,"33":1,"34":26,"35":26,"36":26,"37":15,"38":0,"39":15,"40":14,"41":0,"42":14,"43":14,"44":11,"45":11,"46":0,"47":11,"48":21,"49":2,"50":2,"51":19,"52":19,"53":5,"54":24,"55":23,"56":23,"57":23,"58":23,"59":23,"60":2,"61":33,"62":33,"63":32,"64":32,"65":32,"66":32,"67":32,"68":32,"69":5,"70":27,"71":27,"72":27,"73":0,"74":0,"75":0,"76":4,"77":4,"78":1,"79":1,"80":3,"81":3,"82":3,"83":3,"84":3,"85":2,"86":0,"87":2,"88":2,"89":2,"90":1,"91":1,"92":1,"93":3,"94":3,"95":15,"96":15,"97":8,"98":7,"99":1,"100":1,"101":1,"102":7,"103":63,"104":63,"105":144,"106":13,"107":13,"108":19,"109":19,"110":19,"111":1,"112":1,"113":19,"114":19,"115":19,"116":19,"117":0,"118":19,"119":19,"120":19,"121":0,"122":19,"123":82,"124":82,"125":19,"126":19,"127":1,"128":1,"129":1},"f":{"0":57,"1":28,"2":25,"3":15,"4":14,"5":11,"6":11,"7":21,"8":5,"9":24,"10":23,"11":33,"12":32,"13":27,"14":0,"15":0,"16":4,"17":2,"18":2,"19":1,"20":1,"21":3,"22":15,"23":1,"24":1,"25":63,"26":144,"27":19,"28":19,"29":19,"30":0,"31":82,"32":1,"33":1},"b":{"0":[37],"1":[1,27],"2":[0,28],"3":[28,28],"4":[17,8],"5":[25,0],"6":[1,26],"7":[4,22],"8":[26,26],"9":[22,4],"10":[21,1],"11":[22,22],"12":[20,2],"13":[22,2],"14":[0,15],"15":[0,14],"16":[0,11],"17":[2,19],"18":[1,20],"19":[21,21],"20":[0,19],"21":[19,19],"22":[0,19],"23":[19,19],"24":[22],"25":[2,21],"26":[4,28],"27":[5,27],"28":[1,3],"29":[1,3],"30":[4,4],"31":[0,2],"32":[8,7],"33":[15,7],"34":[1,0],"35":[13,131],"36":[1,18],"37":[18,1],"38":[19,19],"39":[0,19],"40":[0,19],"41":[19,19],"42":[19,63]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/issuance.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/issuance.ts"],"names":[],"mappings":"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","sourcesContent":["import { GatekeeperClient } from './gatekeeperClient';\nimport { prefixLogger } from './logger';\nimport { LoggingInterface } from './logger/provider.logger';\nimport { OrchestratorFlow } from './orchestratorFlow';\nimport { Store } from './state/state';\nimport { ChainClientInterface } from './types/chain';\nimport { CivicPassMessagePayload } from './types/civicPass';\nimport { InputStatus } from './types/fetch';\nimport { TokenRequest } from './types/gatekeeperApi';\nimport { GatewayCoreState } from './types/gatewayCore';\nimport { DEFAULT_EXPECT_TOKEN_TIMEOUT_SECONDS } from './utils/defaults';\nimport { ChainConfirmationTimeout } from './utils/errors';\nimport { getTokenRefreshIntervalMilliseconds } from './utils/expiry';\n\nexport class Issuance extends OrchestratorFlow {\n  protected log: LoggingInterface;\n\n  private timers: Partial<Record<'expectOnChainToken' | 'refreshCountdownTimer', any>> = {};\n\n  currentPayload: CivicPassMessagePayload;\n\n  constructor(\n    readonly gatewayCoreStore: Store,\n    readonly chainImplementation: ChainClientInterface,\n    readonly gatekeeperClient: GatekeeperClient,\n    readonly abortController: AbortController,\n    readonly expectTokenTimeoutSeconds: number = DEFAULT_EXPECT_TOKEN_TIMEOUT_SECONDS\n  ) {\n    super(gatewayCoreStore, gatekeeperClient, abortController);\n    this.log = prefixLogger(`Issuance instance with expectTokenTimeoutSeconds ${expectTokenTimeoutSeconds}`);\n  }\n\n  /**\n   * gatewayStatus flow:\n   * CHECKING\n   * NOT_REQUESTED\n   *\n   * @param chainImplementation\n   * @param this.abortController\n   */\n  async sendTransaction() {\n    const fullState = this.gatewayCoreStore.getState();\n    if (!fullState.inputs.gatekeeperRecord.received?.transaction) {\n      this.log.error('Missing gatekeeperRecord payload');\n      throw new Error('Missing gatekeeperRecord payload');\n    }\n\n    //clear any previous sending errors\n    this.gatewayCoreStore.setState((draft) => {\n      if (!draft.internal.chainTransaction) {\n        draft.internal.chainTransaction = {\n          attempts: 0,\n        };\n      }\n      if (draft.internal.chainTransaction.attempts !== undefined) {\n        draft.internal.chainTransaction.attempts += 1;\n      }\n      draft.internal.chainTransaction.sentTxId = undefined;\n      draft.internal.errors.expectedOnChainToken = null;\n      draft.inputs.gatewayToken.status = InputStatus.COMPLETE;\n      draft.internal.chainTransaction.error = undefined;\n      draft.inputs.civicPass.received = null;\n    });\n    // clear any previous errors\n    this.abortExpectedTokenTimer();\n    // client sends case\n    if (!this.chainImplementation.handleTransaction) {\n      this.log.error('No handleTransaction defined on chainImplementation.');\n      throw new Error('No handleTransaction defined on chainImplementation');\n    }\n\n    const chainType = fullState.internal.chainDetails?.chainType;\n    const frontendPollingTimeoutSeconds = chainType\n      ? fullState.inputs.gatekeeperNetworkData.received?.chains[chainType]?.frontendPollingTimeoutSeconds\n      : undefined;\n\n    this.chainImplementation\n      .handleTransaction(fullState.inputs.gatekeeperRecord.received.transaction, frontendPollingTimeoutSeconds)\n      .then((txId) => {\n        if (this.abortController.signal.aborted) return;\n        this.gatewayCoreStore.setState((state) => {\n          if (!state.internal.chainTransaction) {\n            state.internal.chainTransaction = {};\n          }\n\n          // Fire and forget the request to set the TXId on the gatekeeper\n          this.gatekeeperClient.updateTransactionStatus(txId);\n\n          state.internal.chainTransaction.sentTxId = txId;\n        });\n      })\n      .catch((error) => {\n        this.gatewayCoreStore.setState((draft) => {\n          if (!draft.internal.chainTransaction) {\n            draft.internal.chainTransaction = {};\n          }\n          draft.internal.chainTransaction.error = error;\n        });\n      });\n  }\n\n  async gatekeeperRequest(payer: string | undefined, fullState: GatewayCoreState) {\n    if (!fullState.inputs.civicPass.received?.payload) {\n      this.log.error('Missing civicPass payload', fullState);\n      throw new Error('Missing civicPass payload');\n    }\n    this.currentPayload = fullState.inputs.civicPass.received?.payload;\n    return this.gatekeeperClient.requestGatewayTokenFromGatekeeper({\n      payload: fullState.inputs.civicPass.received?.payload,\n      payer,\n    } as TokenRequest);\n  }\n\n  async freshTransactionGatekeeperRequest(payer: string | undefined) {\n    return this.gatekeeperClient.fetchFreshTransaction({\n      payer,\n    } as TokenRequest);\n  }\n\n  clearStateBeforeGatekeeperRequest(isFreshTransactionRequest = false) {\n    this.gatewayCoreStore.setState((state) => {\n      state.internal.errors.expectedOnChainToken = null;\n      state.inputs.gatewayToken.status = InputStatus.COMPLETE;\n      state.inputs.gatekeeperRecord.received = null;\n      state.inputs.gatekeeperRecord.status = InputStatus.IN_PROGRESS;\n      if (isFreshTransactionRequest) {\n        state.internal.chainTransaction = undefined;\n      }\n    });\n  }\n\n  async makeGatekeeperRequest({\n    payer,\n    isFreshTransactionRequest,\n  }: {\n    payer: string | undefined;\n    isFreshTransactionRequest?: boolean;\n  }) {\n    const fullState = this.gatewayCoreStore.getState();\n    this.setGatekeeperClientFlowId();\n    this.log.debug('makeGatekeeperRequest', fullState);\n    // clear any previous errors\n    this.abortExpectedTokenTimer();\n    this.clearStateBeforeGatekeeperRequest(isFreshTransactionRequest);\n    const requestPromise = isFreshTransactionRequest\n      ? this.freshTransactionGatekeeperRequest(payer)\n      : this.gatekeeperRequest(payer, fullState);\n\n    requestPromise\n      .then((response) => {\n        if (this.abortController.signal.aborted) return;\n        this.gatewayCoreStore.setState((state) => {\n          state.inputs.gatekeeperRecord.status = InputStatus.COMPLETE;\n          state.inputs.gatekeeperRecord.received = response;\n        });\n      })\n      .catch((error) => {\n        this.gatewayCoreStore.setState((state) => {\n          state.inputs.gatekeeperRecord.status = InputStatus.ERROR;\n          state.inputs.gatekeeperRecord.error = error;\n        });\n      });\n  }\n\n  async retrieveFreshTransaction(payer: string | undefined) {\n    const fullState = this.gatewayCoreStore.getState();\n    if (!fullState.inputs.civicPass.received?.payload) {\n      this.log.error('Missing civicPass payload', fullState);\n      throw new Error('Missing civicPass payload');\n    }\n    this.setGatekeeperClientFlowId();\n    this.log.debug('retrieveFreshTransaction', fullState);\n    // clear any previous errors\n    this.abortExpectedTokenTimer();\n    this.clearStateBeforeGatekeeperRequest();\n    this.gatekeeperRequest(payer, fullState)\n      .then((response) => {\n        if (this.abortController.signal.aborted) return;\n        this.gatewayCoreStore.setState((state) => {\n          state.inputs.gatekeeperRecord.status = InputStatus.COMPLETE;\n          state.inputs.gatekeeperRecord.received = response;\n        });\n      })\n      .catch((error) => {\n        this.gatewayCoreStore.setState((state) => {\n          state.inputs.gatekeeperRecord.status = InputStatus.ERROR;\n          state.inputs.gatekeeperRecord.error = error;\n        });\n      });\n  }\n\n  statusHasValidToken(): boolean {\n    const updatedState = this.gatewayCoreStore.getState();\n    return !!updatedState.inputs.gatewayToken.received;\n  }\n\n  /**\n   * expect a token to exist in state before a timeout occurs\n   */\n  expectOnChainToken() {\n    const fullState = this.gatewayCoreStore.getState();\n    if (fullState.inputs.gatewayToken.received || this.timers.expectOnChainToken) {\n      return;\n    }\n\n    this.timers.expectOnChainToken = setTimeout(() => {\n      this.gatewayCoreStore.setState((state) => {\n        if (!this.statusHasValidToken()) {\n          state.internal.errors.expectedOnChainToken = new ChainConfirmationTimeout(\n            'No on-chain token found within interval'\n          );\n        }\n      });\n    }, this.expectTokenTimeoutSeconds * 1000);\n    this.log.debug('Started expected token timer', this.timers.expectOnChainToken);\n  }\n\n  abort() {\n    this.abortExpectedTokenTimer();\n    this.abortRefreshCountdownTimer();\n  }\n\n  /**\n   * Clear the timer that expects an on-chain token\n   */\n  abortExpectedTokenTimer() {\n    if (this.timers.expectOnChainToken) {\n      this.log.debug('Aborting expected token timer', this.timers.expectOnChainToken);\n      clearTimeout(this.timers.expectOnChainToken);\n    }\n  }\n\n  /**\n   * Clear the timer that expects an on-chain token\n   */\n  onActiveTokenFound() {\n    this.abortExpectedTokenTimer();\n    // clear the force require refresh flag to stop the flow restarting\n    this.gatewayCoreStore.setState((state) => {\n      if (state.inputs.dynamicParameters?.forceRequireRefresh !== undefined) {\n        state.internal.chainTransaction = undefined;\n        state.inputs.dynamicParameters.forceRequireRefresh = false;\n      }\n    });\n    this.startRefreshCountdownTimer();\n  }\n\n  /**\n   * start a countdown towards when the token will expire\n   * so that we can update the state and prompt the user to refresh\n   */\n  startRefreshCountdownTimer() {\n    const fullState = this.gatewayCoreStore.getState();\n    const gatewayToken = fullState.inputs.gatewayToken.received;\n    if (!gatewayToken?.expiryTime) {\n      return;\n    }\n\n    this.abortRefreshCountdownTimer();\n    const refreshIntervalDuration = getTokenRefreshIntervalMilliseconds(gatewayToken.expiryTime, 0);\n    this.timers.refreshCountdownTimer = setTimeout(() => {\n      this.abortRefreshCountdownTimer();\n    }, refreshIntervalDuration);\n    this.log.debug('Started refresh countdown timer', {\n      gatewayToken,\n      refreshCountdownTimer: this.timers.refreshCountdownTimer,\n    });\n  }\n\n  abortRefreshCountdownTimer() {\n    this.log.debug('abortRefreshCountdownTimer', {\n      refreshCountdownTimer: this.timers.refreshCountdownTimer,\n    });\n    if (this.timers.refreshCountdownTimer) {\n      clearTimeout(this.timers.refreshCountdownTimer);\n      this.timers.refreshCountdownTimer = undefined;\n    }\n  }\n\n  // reset civic-pass data collection so thta the user can restart the flow\n  // and get a payload\n  restartDataCollection() {\n    this.gatewayCoreStore.setState((state) => {\n      state.inputs.civicPass.received = null;\n    });\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"147d2f6e3a8a613c952ce69ef5ffd5fc922a13cb"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/orchestratorFlow.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/orchestratorFlow.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":34}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":36}},"3":{"start":{"line":7,"column":8},"end":{"line":7,"column":49}},"4":{"start":{"line":8,"column":8},"end":{"line":8,"column":49}},"5":{"start":{"line":9,"column":8},"end":{"line":9,"column":47}},"6":{"start":{"line":10,"column":8},"end":{"line":10,"column":66}},"7":{"start":{"line":14,"column":26},"end":{"line":14,"column":58}},"8":{"start":{"line":15,"column":8},"end":{"line":18,"column":9}},"9":{"start":{"line":16,"column":12},"end":{"line":16,"column":56}},"10":{"start":{"line":17,"column":12},"end":{"line":17,"column":46}},"11":{"start":{"line":19,"column":8},"end":{"line":19,"column":174}},"12":{"start":{"line":22,"column":0},"end":{"line":22,"column":44}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":4},"end":{"line":6,"column":5}},"loc":{"start":{"line":6,"column":69},"end":{"line":11,"column":5}},"line":6},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":32},"end":{"line":20,"column":5}},"line":12}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":8},"end":{"line":18,"column":9}},"type":"if","locations":[{"start":{"line":15,"column":8},"end":{"line":18,"column":9}},{"start":{"line":15,"column":8},"end":{"line":18,"column":9}}],"line":15},"1":{"loc":{"start":{"line":15,"column":14},"end":{"line":15,"column":146}},"type":"cond-expr","locations":[{"start":{"line":15,"column":128},"end":{"line":15,"column":134}},{"start":{"line":15,"column":137},"end":{"line":15,"column":146}}],"line":15},"2":{"loc":{"start":{"line":15,"column":14},"end":{"line":15,"column":125}},"type":"binary-expr","locations":[{"start":{"line":15,"column":14},"end":{"line":15,"column":108}},{"start":{"line":15,"column":112},"end":{"line":15,"column":125}}],"line":15},"3":{"loc":{"start":{"line":15,"column":20},"end":{"line":15,"column":98}},"type":"cond-expr","locations":[{"start":{"line":15,"column":72},"end":{"line":15,"column":78}},{"start":{"line":15,"column":81},"end":{"line":15,"column":98}}],"line":15},"4":{"loc":{"start":{"line":15,"column":20},"end":{"line":15,"column":69}},"type":"binary-expr","locations":[{"start":{"line":15,"column":20},"end":{"line":15,"column":52}},{"start":{"line":15,"column":56},"end":{"line":15,"column":69}}],"line":15},"5":{"loc":{"start":{"line":19,"column":40},"end":{"line":19,"column":172}},"type":"cond-expr","locations":[{"start":{"line":19,"column":154},"end":{"line":19,"column":160}},{"start":{"line":19,"column":163},"end":{"line":19,"column":172}}],"line":19},"6":{"loc":{"start":{"line":19,"column":40},"end":{"line":19,"column":151}},"type":"binary-expr","locations":[{"start":{"line":19,"column":40},"end":{"line":19,"column":134}},{"start":{"line":19,"column":138},"end":{"line":19,"column":151}}],"line":19},"7":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":124}},"type":"cond-expr","locations":[{"start":{"line":19,"column":98},"end":{"line":19,"column":104}},{"start":{"line":19,"column":107},"end":{"line":19,"column":124}}],"line":19},"8":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":95}},"type":"binary-expr","locations":[{"start":{"line":19,"column":46},"end":{"line":19,"column":78}},{"start":{"line":19,"column":82},"end":{"line":19,"column":95}}],"line":19}},"s":{"0":1,"1":1,"2":1,"3":140,"4":140,"5":140,"6":140,"7":119,"8":119,"9":2,"10":2,"11":117,"12":1},"f":{"0":140,"1":119},"b":{"0":[2,117],"1":[2,117],"2":[119,119],"3":[1,118],"4":[119,119],"5":[0,117],"6":[117,117],"7":[0,117],"8":[117,117]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/orchestratorFlow.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/orchestratorFlow.ts"],"names":[],"mappings":";;;AACA,qCAAwC;AAIxC,MAAa,gBAAgB;IAG3B,YACW,gBAAuB,EACvB,gBAAkC,EAClC,eAAgC;QAFhC,qBAAgB,GAAhB,gBAAgB,CAAO;QACvB,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,oBAAe,GAAf,eAAe,CAAiB;QAEzC,IAAI,CAAC,GAAG,GAAG,IAAA,qBAAY,EAAC,kBAAkB,CAAC,CAAC;IAC9C,CAAC;IAED,yBAAyB;;QACvB,MAAM,SAAS,GAAG,IAAI,CAAC,gBAAgB,CAAC,QAAQ,EAAE,CAAC;QACnD,IAAI,CAAC,CAAA,MAAA,MAAA,SAAS,CAAC,MAAM,0CAAE,cAAc,0CAAE,MAAM,CAAA,EAAE,CAAC;YAC9C,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,gBAAgB,EAAE,SAAS,CAAC,CAAC;YAC5C,MAAM,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC;QACpC,CAAC;QACD,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,MAAA,MAAA,SAAS,CAAC,MAAM,0CAAE,cAAc,0CAAE,MAAM,CAAC,CAAC;IAC5E,CAAC;CACF;AAnBD,4CAmBC","sourcesContent":["import { GatekeeperClient } from './gatekeeperClient';\nimport { prefixLogger } from './logger';\nimport { LoggingInterface } from './logger/provider.logger';\nimport { Store } from './state/state';\n\nexport class OrchestratorFlow {\n  protected log: LoggingInterface;\n\n  constructor(\n    readonly gatewayCoreStore: Store,\n    readonly gatekeeperClient: GatekeeperClient,\n    readonly abortController: AbortController\n  ) {\n    this.log = prefixLogger('OrchestratorFlow');\n  }\n\n  setGatekeeperClientFlowId() {\n    const fullState = this.gatewayCoreStore.getState();\n    if (!fullState.output?.flowParameters?.flowId) {\n      this.log.error('Missing flowId', fullState);\n      throw new Error('Missing flowId');\n    }\n    this.gatekeeperClient.setFlowId(fullState.output?.flowParameters?.flowId);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a332e363840fb4a6def90dd2ca43146934f89055"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/defaults.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/defaults.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":97}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":51}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":45}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1},"f":{},"b":{},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/defaults.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/defaults.ts"],"names":[],"mappings":";;;AAAa,QAAA,oCAAoC,GAAG,GAAG,CAAC;AAE3C,QAAA,gCAAgC,GAAG,CAAC,CAAC","sourcesContent":["export const DEFAULT_EXPECT_TOKEN_TIMEOUT_SECONDS = 120; // 2 minutes\n\nexport const DEFAULT_MAX_CLIENT_SENDS_RETRIES = 3;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8270b48dc24bf92f77c6af016241155f144cb700"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/expiry.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/expiry.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":158}},"2":{"start":{"line":4,"column":16},"end":{"line":4,"column":41}},"3":{"start":{"line":5,"column":28},"end":{"line":8,"column":1}},"4":{"start":{"line":6,"column":16},"end":{"line":6,"column":45}},"5":{"start":{"line":7,"column":4},"end":{"line":7,"column":63}},"6":{"start":{"line":9,"column":19},"end":{"line":14,"column":1}},"7":{"start":{"line":10,"column":4},"end":{"line":11,"column":21}},"8":{"start":{"line":11,"column":8},"end":{"line":11,"column":21}},"9":{"start":{"line":12,"column":16},"end":{"line":12,"column":45}},"10":{"start":{"line":13,"column":4},"end":{"line":13,"column":29}},"11":{"start":{"line":15,"column":0},"end":{"line":15,"column":32}},"12":{"start":{"line":16,"column":31},"end":{"line":22,"column":1}},"13":{"start":{"line":17,"column":34},"end":{"line":17,"column":52}},"14":{"start":{"line":18,"column":21},"end":{"line":18,"column":51}},"15":{"start":{"line":19,"column":4},"end":{"line":20,"column":21}},"16":{"start":{"line":20,"column":8},"end":{"line":20,"column":21}},"17":{"start":{"line":21,"column":4},"end":{"line":21,"column":139}},"18":{"start":{"line":23,"column":0},"end":{"line":23,"column":56}},"19":{"start":{"line":24,"column":0},"end":{"line":24,"column":41}},"20":{"start":{"line":25,"column":19},"end":{"line":25,"column":54}},"21":{"start":{"line":25,"column":25},"end":{"line":25,"column":54}},"22":{"start":{"line":26,"column":0},"end":{"line":26,"column":32}},"23":{"start":{"line":27,"column":44},"end":{"line":31,"column":1}},"24":{"start":{"line":28,"column":21},"end":{"line":28,"column":97}},"25":{"start":{"line":29,"column":19},"end":{"line":29,"column":53}},"26":{"start":{"line":30,"column":4},"end":{"line":30,"column":92}},"27":{"start":{"line":32,"column":0},"end":{"line":32,"column":82}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":28},"end":{"line":5,"column":29}},"loc":{"start":{"line":5,"column":77},"end":{"line":8,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":9,"column":19},"end":{"line":9,"column":20}},"loc":{"start":{"line":9,"column":35},"end":{"line":14,"column":1}},"line":9},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":31},"end":{"line":16,"column":32}},"loc":{"start":{"line":16,"column":105},"end":{"line":22,"column":1}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":25,"column":19},"end":{"line":25,"column":20}},"loc":{"start":{"line":25,"column":25},"end":{"line":25,"column":54}},"line":25},"4":{"name":"(anonymous_4)","decl":{"start":{"line":27,"column":44},"end":{"line":27,"column":45}},"loc":{"start":{"line":27,"column":97},"end":{"line":31,"column":1}},"line":27}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":4},"end":{"line":11,"column":21}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":11,"column":21}},{"start":{"line":10,"column":4},"end":{"line":11,"column":21}}],"line":10},"1":{"loc":{"start":{"line":17,"column":34},"end":{"line":17,"column":52}},"type":"binary-expr","locations":[{"start":{"line":17,"column":34},"end":{"line":17,"column":46}},{"start":{"line":17,"column":50},"end":{"line":17,"column":52}}],"line":17},"2":{"loc":{"start":{"line":19,"column":4},"end":{"line":20,"column":21}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":20,"column":21}},{"start":{"line":19,"column":4},"end":{"line":20,"column":21}}],"line":19},"3":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":32}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":19}},{"start":{"line":19,"column":23},"end":{"line":19,"column":32}}],"line":19},"4":{"loc":{"start":{"line":21,"column":12},"end":{"line":21,"column":137}},"type":"binary-expr","locations":[{"start":{"line":21,"column":12},"end":{"line":21,"column":33}},{"start":{"line":21,"column":37},"end":{"line":21,"column":72}},{"start":{"line":21,"column":76},"end":{"line":21,"column":137}}],"line":21},"5":{"loc":{"start":{"line":29,"column":19},"end":{"line":29,"column":53}},"type":"cond-expr","locations":[{"start":{"line":29,"column":34},"end":{"line":29,"column":49}},{"start":{"line":29,"column":52},"end":{"line":29,"column":53}}],"line":29},"6":{"loc":{"start":{"line":30,"column":11},"end":{"line":30,"column":91}},"type":"cond-expr","locations":[{"start":{"line":30,"column":51},"end":{"line":30,"column":82}},{"start":{"line":30,"column":85},"end":{"line":30,"column":91}}],"line":30}},"s":{"0":1,"1":1,"2":1,"3":1,"4":183,"5":183,"6":1,"7":536,"8":1,"9":535,"10":535,"11":1,"12":1,"13":569,"14":569,"15":569,"16":13,"17":556,"18":1,"19":1,"20":1,"21":210,"22":1,"23":1,"24":22,"25":22,"26":22,"27":1},"f":{"0":183,"1":536,"2":569,"3":210,"4":22},"b":{"0":[1,535],"1":[569,1],"2":[13,556],"3":[569,556],"4":[556,533,183],"5":[21,1],"6":[1,21]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/expiry.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/expiry.ts"],"names":[],"mappings":";;;AAAA,0CAAqD;AAErD,MAAM,mBAAmB,GAAG,CAAC,aAAqB,EAAE,4BAAoC,EAAW,EAAE;IACnG,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;IAC1C,OAAO,aAAa,GAAG,GAAG,IAAI,4BAA4B,CAAC;AAC7D,CAAC,CAAC;AAEK,MAAM,UAAU,GAAG,CAAC,UAAkB,EAAW,EAAE;IACxD,IAAI,CAAC,UAAU;QAAE,OAAO,KAAK,CAAC;IAC9B,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;IAC1C,OAAO,GAAG,IAAI,UAAU,CAAC;AAC3B,CAAC,CAAC;AAJW,QAAA,UAAU,cAIrB;AAEK,MAAM,sBAAsB,GAAG,CAAC,EACrC,YAAY,EACZ,4BAA4B,EAC5B,mBAAmB,GAKpB,EAAW,EAAE;IACZ,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,GAAG,YAAY,IAAI,EAAE,CAAC;IACjD,MAAM,QAAQ,GAAG,KAAK,KAAK,aAAK,CAAC,MAAM,CAAC;IACxC,IAAI,CAAC,UAAU,IAAI,CAAC,QAAQ;QAAE,OAAO,KAAK,CAAC;IAE3C,OAAO,CACL,CAAC,CAAC,mBAAmB,IAAI,IAAA,kBAAU,EAAC,UAAU,CAAC,IAAI,mBAAmB,CAAC,UAAU,EAAE,4BAA4B,CAAC,CACjH,CAAC;AACJ,CAAC,CAAC;AAhBW,QAAA,sBAAsB,0BAgBjC;AAGW,QAAA,mBAAmB,GAAG,UAAU,CAAC;AAEvC,MAAM,UAAU,GAAG,GAAW,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;AAAzD,QAAA,UAAU,cAA+C;AAU/D,MAAM,mCAAmC,GAAG,CACjD,iBAAyB,EACzB,4BAAoC,EAC5B,EAAE;IACV,MAAM,QAAQ,GAAG,iBAAiB,GAAG,IAAA,kBAAU,GAAE,GAAG,4BAA4B,CAAC;IACjF,MAAM,MAAM,GAAG,QAAQ,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;IAClD,OAAO,MAAM,IAAI,2BAAmB,CAAC,CAAC,CAAC,2BAAmB,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;AAC1E,CAAC,CAAC;AAPW,QAAA,mCAAmC,uCAO9C","sourcesContent":["import { GatewayToken, State } from '../types/chain';\n\nconst isApproachingExpiry = (currentExpiry: number, tokenExpirationMarginSeconds: number): boolean => {\n  const now = Math.floor(Date.now() / 1000);\n  return currentExpiry - now <= tokenExpirationMarginSeconds;\n};\n\nexport const hasExpired = (expiryTime: number): boolean => {\n  if (!expiryTime) return false;\n  const now = Math.floor(Date.now() / 1000);\n  return now >= expiryTime;\n};\n\nexport const isTokenRefreshRequired = ({\n  gatewayToken,\n  tokenExpirationMarginSeconds,\n  forceRequireRefresh,\n}: {\n  gatewayToken?: GatewayToken;\n  tokenExpirationMarginSeconds: number;\n  forceRequireRefresh?: boolean;\n}): boolean => {\n  const { expiryTime, state } = gatewayToken || {};\n  const isActive = state === State.ACTIVE;\n  if (!expiryTime || !isActive) return false;\n\n  return (\n    !!forceRequireRefresh || hasExpired(expiryTime) || isApproachingExpiry(expiryTime, tokenExpirationMarginSeconds)\n  );\n};\n\n// Maximum allowed timeout for setInterval and setTimeout is 2147483647 (https://nodejs.org/api/timers.html)\nexport const MAX_ALLOWED_TIMEOUT = 2147483647;\n\nexport const nowSeconds = (): number => Math.floor(Date.now() / 1000);\n\n/**\n * return the expiry time in milliseconds from the current time until the gateway token expires\n * taking into account a margin (if provided). If the interval is too large for a javascript timer\n * then return the maximum allowed timeout\n * @param {number} expiryTimeSeconds\n * @param {number} tokenExpirationMarginSeconds\n * @returns {number}\n */\nexport const getTokenRefreshIntervalMilliseconds = (\n  expiryTimeSeconds: number,\n  tokenExpirationMarginSeconds: number\n): number => {\n  const interval = expiryTimeSeconds - nowSeconds() - tokenExpirationMarginSeconds;\n  const retVal = interval > 0 ? interval * 1000 : 0;\n  return retVal >= MAX_ALLOWED_TIMEOUT ? MAX_ALLOWED_TIMEOUT - 1 : retVal;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"feaee6f973c2809b51e9296a1f9fc7d95adc3eb4"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/refresh.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/refresh.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":19},"end":{"line":4,"column":40}},"3":{"start":{"line":5,"column":16},"end":{"line":5,"column":40}},"4":{"start":{"line":6,"column":19},"end":{"line":6,"column":46}},"5":{"start":{"line":7,"column":17},"end":{"line":7,"column":42}},"6":{"start":{"line":10,"column":8},"end":{"line":10,"column":115}},"7":{"start":{"line":11,"column":8},"end":{"line":11,"column":49}},"8":{"start":{"line":12,"column":8},"end":{"line":12,"column":55}},"9":{"start":{"line":13,"column":8},"end":{"line":13,"column":49}},"10":{"start":{"line":14,"column":8},"end":{"line":14,"column":47}},"11":{"start":{"line":15,"column":8},"end":{"line":15,"column":67}},"12":{"start":{"line":18,"column":8},"end":{"line":22,"column":11}},"13":{"start":{"line":19,"column":12},"end":{"line":19,"column":58}},"14":{"start":{"line":20,"column":12},"end":{"line":20,"column":56}},"15":{"start":{"line":21,"column":12},"end":{"line":21,"column":83}},"16":{"start":{"line":26,"column":8},"end":{"line":29,"column":9}},"17":{"start":{"line":27,"column":12},"end":{"line":27,"column":67}},"18":{"start":{"line":28,"column":12},"end":{"line":28,"column":57}},"19":{"start":{"line":30,"column":8},"end":{"line":30,"column":121}},"20":{"start":{"line":31,"column":8},"end":{"line":34,"column":11}},"21":{"start":{"line":37,"column":29},"end":{"line":37,"column":61}},"22":{"start":{"line":38,"column":29},"end":{"line":38,"column":70}},"23":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"24":{"start":{"line":40,"column":12},"end":{"line":40,"column":25}},"25":{"start":{"line":42,"column":8},"end":{"line":46,"column":16}},"26":{"start":{"line":49,"column":0},"end":{"line":49,"column":26}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":4},"end":{"line":9,"column":5}},"loc":{"start":{"line":9,"column":167},"end":{"line":16,"column":5}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":17,"column":4},"end":{"line":17,"column":5}},"loc":{"start":{"line":17,"column":40},"end":{"line":23,"column":5}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":18,"column":39},"end":{"line":18,"column":40}},"loc":{"start":{"line":18,"column":50},"end":{"line":22,"column":9}},"line":18},"3":{"name":"(anonymous_3)","decl":{"start":{"line":24,"column":4},"end":{"line":24,"column":5}},"loc":{"start":{"line":24,"column":46},"end":{"line":35,"column":5}},"line":24},"4":{"name":"(anonymous_4)","decl":{"start":{"line":36,"column":4},"end":{"line":36,"column":5}},"loc":{"start":{"line":36,"column":26},"end":{"line":47,"column":5}},"line":36}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":90},"end":{"line":9,"column":165}},"type":"default-arg","locations":[{"start":{"line":9,"column":118},"end":{"line":9,"column":165}}],"line":9},"1":{"loc":{"start":{"line":26,"column":8},"end":{"line":29,"column":9}},"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":29,"column":9}},{"start":{"line":26,"column":8},"end":{"line":29,"column":9}}],"line":26},"2":{"loc":{"start":{"line":26,"column":14},"end":{"line":26,"column":104}},"type":"cond-expr","locations":[{"start":{"line":26,"column":85},"end":{"line":26,"column":91}},{"start":{"line":26,"column":94},"end":{"line":26,"column":104}}],"line":26},"3":{"loc":{"start":{"line":26,"column":14},"end":{"line":26,"column":82}},"type":"binary-expr","locations":[{"start":{"line":26,"column":14},"end":{"line":26,"column":65}},{"start":{"line":26,"column":69},"end":{"line":26,"column":82}}],"line":26},"4":{"loc":{"start":{"line":30,"column":30},"end":{"line":30,"column":120}},"type":"cond-expr","locations":[{"start":{"line":30,"column":101},"end":{"line":30,"column":107}},{"start":{"line":30,"column":110},"end":{"line":30,"column":120}}],"line":30},"5":{"loc":{"start":{"line":30,"column":30},"end":{"line":30,"column":98}},"type":"binary-expr","locations":[{"start":{"line":30,"column":30},"end":{"line":30,"column":81}},{"start":{"line":30,"column":85},"end":{"line":30,"column":98}}],"line":30},"6":{"loc":{"start":{"line":32,"column":21},"end":{"line":32,"column":111}},"type":"cond-expr","locations":[{"start":{"line":32,"column":92},"end":{"line":32,"column":98}},{"start":{"line":32,"column":101},"end":{"line":32,"column":111}}],"line":32},"7":{"loc":{"start":{"line":32,"column":21},"end":{"line":32,"column":89}},"type":"binary-expr","locations":[{"start":{"line":32,"column":21},"end":{"line":32,"column":72}},{"start":{"line":32,"column":76},"end":{"line":32,"column":89}}],"line":32},"8":{"loc":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"type":"if","locations":[{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},{"start":{"line":39,"column":8},"end":{"line":41,"column":9}}],"line":39},"9":{"loc":{"start":{"line":39,"column":14},"end":{"line":39,"column":97}},"type":"cond-expr","locations":[{"start":{"line":39,"column":65},"end":{"line":39,"column":71}},{"start":{"line":39,"column":74},"end":{"line":39,"column":97}}],"line":39},"10":{"loc":{"start":{"line":39,"column":14},"end":{"line":39,"column":62}},"type":"binary-expr","locations":[{"start":{"line":39,"column":14},"end":{"line":39,"column":35}},{"start":{"line":39,"column":39},"end":{"line":39,"column":62}}],"line":39},"11":{"loc":{"start":{"line":42,"column":18},"end":{"line":46,"column":14}},"type":"binary-expr","locations":[{"start":{"line":42,"column":18},"end":{"line":42,"column":30}},{"start":{"line":43,"column":12},"end":{"line":46,"column":14}}],"line":42}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":19,"7":19,"8":19,"9":19,"10":19,"11":19,"12":13,"13":12,"14":12,"15":12,"16":13,"17":2,"18":2,"19":11,"20":11,"21":3,"22":3,"23":3,"24":1,"25":2,"26":1},"f":{"0":19,"1":13,"2":12,"3":13,"4":3},"b":{"0":[19],"1":[2,11],"2":[1,12],"3":[13,13],"4":[0,11],"5":[11,11],"6":[0,11],"7":[11,11],"8":[1,2],"9":[0,3],"10":[3,3],"11":[2,2]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/refresh.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/refresh.ts"],"names":[],"mappings":";;;AACA,yCAAsC;AAGtC,yCAA4C;AAG5C,+CAAwE;AACxE,2CAAwD;AAExD,MAAa,OAAQ,SAAQ,mBAAQ;IACnC,YACW,gBAAuB,EACvB,mBAAyC,EACzC,gBAAkC,EAClC,eAAgC,EAChC,4BAAoC,+CAAoC;QAEjF,KAAK,CAAC,gBAAgB,EAAE,mBAAmB,EAAE,gBAAgB,EAAE,eAAe,EAAE,yBAAyB,CAAC,CAAC;QANlG,qBAAgB,GAAhB,gBAAgB,CAAO;QACvB,wBAAmB,GAAnB,mBAAmB,CAAsB;QACzC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,oBAAe,GAAf,eAAe,CAAiB;QAChC,8BAAyB,GAAzB,yBAAyB,CAA+C;IAGnF,CAAC;IAED,iCAAiC;QAC/B,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,EAAE;YACvC,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC,QAAQ,GAAG,IAAI,CAAC;YAC9C,KAAK,CAAC,QAAQ,CAAC,gBAAgB,GAAG,SAAS,CAAC;YAC5C,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,GAAG,mBAAW,CAAC,WAAW,CAAC;QACjE,CAAC,CAAC,CAAC;IACL,CAAC;IAED,KAAK,CAAC,iBAAiB,CAAC,KAAyB,EAAE,SAA2B;;QAC5E,IAAI,CAAC,CAAA,MAAA,SAAS,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,0CAAE,OAAO,CAAA,EAAE,CAAC;YAClD,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,2BAA2B,EAAE,SAAS,CAAC,CAAC;YACvD,MAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC;QAC/C,CAAC;QACD,IAAI,CAAC,cAAc,GAAG,MAAA,SAAS,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,0CAAE,OAAO,CAAC;QACnE,OAAO,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC;YACxC,OAAO,EAAE,MAAA,SAAS,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,0CAAE,OAAO;YACrD,KAAK;SACU,CAAC,CAAC;IACrB,CAAC;IAED,mBAAmB;QACjB,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,QAAQ,EAAE,CAAC;QACtD,MAAM,YAAY,GAAG,YAAY,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC;QAC/D,IAAI,CAAC,CAAA,YAAY,aAAZ,YAAY,uBAAZ,YAAY,CAAE,UAAU,CAAA,EAAE,CAAC;YAC9B,OAAO,KAAK,CAAC;QACf,CAAC;QACD,OAAO,CAAC,CAAC,CACP,YAAY;YACZ,CAAC,IAAA,+BAAsB,EAAC;gBACtB,YAAY;gBACZ,4BAA4B,EAAE,CAAC;aAChC,CAAC,CACH,CAAC;IACJ,CAAC;CACF;AA7CD,0BA6CC","sourcesContent":["import { GatekeeperClient } from './gatekeeperClient';\nimport { Issuance } from './issuance';\nimport { Store } from './state/state';\nimport { ChainClientInterface } from './types/chain';\nimport { InputStatus } from './types/fetch';\nimport { TokenRequest } from './types/gatekeeperApi';\nimport { GatewayCoreState } from './types/gatewayCore';\nimport { DEFAULT_EXPECT_TOKEN_TIMEOUT_SECONDS } from './utils/defaults';\nimport { isTokenRefreshRequired } from './utils/expiry';\n\nexport class Refresh extends Issuance {\n  constructor(\n    readonly gatewayCoreStore: Store,\n    readonly chainImplementation: ChainClientInterface,\n    readonly gatekeeperClient: GatekeeperClient,\n    readonly abortController: AbortController,\n    readonly expectTokenTimeoutSeconds: number = DEFAULT_EXPECT_TOKEN_TIMEOUT_SECONDS\n  ) {\n    super(gatewayCoreStore, chainImplementation, gatekeeperClient, abortController, expectTokenTimeoutSeconds);\n  }\n\n  clearStateBeforeGatekeeperRequest() {\n    this.gatewayCoreStore.setState((state) => {\n      state.inputs.gatekeeperRecord.received = null;\n      state.internal.chainTransaction = undefined;\n      state.inputs.gatekeeperRecord.status = InputStatus.IN_PROGRESS;\n    });\n  }\n\n  async gatekeeperRequest(payer: string | undefined, fullState: GatewayCoreState) {\n    if (!fullState.inputs.civicPass.received?.payload) {\n      this.log.error('Missing civicPass payload', fullState);\n      throw new Error('Missing civicPass payload');\n    }\n    this.currentPayload = fullState.inputs.civicPass.received?.payload;\n    return this.gatekeeperClient.refreshToken({\n      payload: fullState.inputs.civicPass.received?.payload,\n      payer,\n    } as TokenRequest);\n  }\n\n  statusHasValidToken(): boolean {\n    const updatedState = this.gatewayCoreStore.getState();\n    const gatewayToken = updatedState.inputs.gatewayToken.received;\n    if (!gatewayToken?.expiryTime) {\n      return false;\n    }\n    return !!(\n      gatewayToken &&\n      !isTokenRefreshRequired({\n        gatewayToken,\n        tokenExpirationMarginSeconds: 0,\n      })\n    );\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b2c1086e5ec5fd483b88dbaa4961b3fc8e8cc477"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/userInteraction.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/userInteraction.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":52}},"2":{"start":{"line":4,"column":26},"end":{"line":4,"column":61}},"3":{"start":{"line":5,"column":20},"end":{"line":5,"column":49}},"4":{"start":{"line":6,"column":43},"end":{"line":20,"column":1}},"5":{"start":{"line":8,"column":4},"end":{"line":18,"column":5}},"6":{"start":{"line":17,"column":8},"end":{"line":17,"column":64}},"7":{"start":{"line":19,"column":4},"end":{"line":19,"column":143}},"8":{"start":{"line":21,"column":0},"end":{"line":21,"column":80}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":43},"end":{"line":6,"column":44}},"loc":{"start":{"line":6,"column":62},"end":{"line":20,"column":1}},"line":6}},"branchMap":{"0":{"loc":{"start":{"line":8,"column":4},"end":{"line":18,"column":5}},"type":"if","locations":[{"start":{"line":8,"column":4},"end":{"line":18,"column":5}},{"start":{"line":8,"column":4},"end":{"line":18,"column":5}}],"line":8},"1":{"loc":{"start":{"line":19,"column":11},"end":{"line":19,"column":142}},"type":"cond-expr","locations":[{"start":{"line":19,"column":124},"end":{"line":19,"column":130}},{"start":{"line":19,"column":133},"end":{"line":19,"column":142}}],"line":19},"2":{"loc":{"start":{"line":19,"column":11},"end":{"line":19,"column":121}},"type":"binary-expr","locations":[{"start":{"line":19,"column":11},"end":{"line":19,"column":104}},{"start":{"line":19,"column":108},"end":{"line":19,"column":121}}],"line":19},"3":{"loc":{"start":{"line":19,"column":17},"end":{"line":19,"column":94}},"type":"cond-expr","locations":[{"start":{"line":19,"column":67},"end":{"line":19,"column":73}},{"start":{"line":19,"column":76},"end":{"line":19,"column":94}}],"line":19},"4":{"loc":{"start":{"line":19,"column":17},"end":{"line":19,"column":64}},"type":"binary-expr","locations":[{"start":{"line":19,"column":17},"end":{"line":19,"column":47}},{"start":{"line":19,"column":51},"end":{"line":19,"column":64}}],"line":19}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":82,"6":16,"7":66,"8":1},"f":{"0":82},"b":{"0":[16,66],"1":[0,66],"2":[66,66],"3":[0,66],"4":[66,66]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/userInteraction.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/userInteraction.ts"],"names":[],"mappings":";;;AAAA,8DAAiE;AACjE,kDAA4D;AAGrD,MAAM,kCAAkC,GAAG,CAChD,KAAuB,EACvB,MAA8B,EACA,EAAE;;IAChC,IAEE;QACE,kCAAsB,CAAC,YAAY;QACnC,kCAAsB,CAAC,aAAa;QACpC,kCAAsB,CAAC,YAAY;QACnC,kCAAsB,CAAC,cAAc;QACrC,kCAAsB,CAAC,eAAe;QACtC,kCAAsB,CAAC,gBAAgB;QACvC,kCAAsB,CAAC,KAAK;KAC7B,CAAC,QAAQ,CAAC,MAAM,CAAC,EAClB,CAAC;QACD,OAAO,uCAAqB,CAAC,QAAQ,CAAC;IACxC,CAAC;IACD,OAAO,MAAA,MAAA,KAAK,CAAC,QAAQ,0CAAE,eAAe,0CAAE,MAAM,CAAC;AACjD,CAAC,CAAC;AAnBW,QAAA,kCAAkC,sCAmB7C","sourcesContent":["import { UserInteractionStatus } from '../types/userInteraction';\nimport { CivicPassMessageAction } from '../types/civicPass';\nimport { GatewayCoreState } from '../types/gatewayCore';\n\nexport const getUserInteractionStatusFromAction = (\n  state: GatewayCoreState,\n  action: CivicPassMessageAction\n): UserInteractionStatus | null => {\n  if (\n    // these actions don't have any follow-on flow so they represent a finished flow\n    [\n      CivicPassMessageAction.TOKEN_ACTIVE,\n      CivicPassMessageAction.TOKEN_REVOKED,\n      CivicPassMessageAction.TOKEN_FROZEN,\n      CivicPassMessageAction.TOKEN_REJECTED,\n      CivicPassMessageAction.FAILED_IP_CHECK,\n      CivicPassMessageAction.FAILED_VPN_CHECK,\n      CivicPassMessageAction.ERROR,\n    ].includes(action)\n  ) {\n    return UserInteractionStatus.FINISHED;\n  }\n  return state.internal?.userInteraction?.status;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b14c4f6711f8fc4f6289b276154cbf86e71a3f7d"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/userInteraction.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/userInteraction.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":39}},"2":{"start":{"line":5,"column":0},"end":{"line":8,"column":90}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":49}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":51}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":34},"end":{"line":8,"column":1}},"line":5}},"branchMap":{"0":{"loc":{"start":{"line":8,"column":3},"end":{"line":8,"column":88}},"type":"binary-expr","locations":[{"start":{"line":8,"column":3},"end":{"line":8,"column":24}},{"start":{"line":8,"column":29},"end":{"line":8,"column":87}}],"line":8}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1},"f":{"0":1},"b":{"0":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/userInteraction.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/userInteraction.ts"],"names":[],"mappings":";;;AAAA,IAAY,qBAGX;AAHD,WAAY,qBAAqB;IAC/B,4CAAmB,CAAA;IACnB,8CAAqB,CAAA;AACvB,CAAC,EAHW,qBAAqB,qCAArB,qBAAqB,QAGhC","sourcesContent":["export enum UserInteractionStatus {\n  STARTED = 'started',\n  FINISHED = 'finished',\n}\nexport type UserInteraction = {\n  status: UserInteractionStatus | null;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8ec72450bca2accffb91c9a2653321af713fd00f"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/partnerReview.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/partnerReview.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":31}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":36}},"3":{"start":{"line":5,"column":27},"end":{"line":5,"column":56}},"4":{"start":{"line":6,"column":16},"end":{"line":6,"column":40}},"5":{"start":{"line":7,"column":24},"end":{"line":7,"column":56}},"6":{"start":{"line":10,"column":8},"end":{"line":10,"column":67}},"7":{"start":{"line":11,"column":8},"end":{"line":11,"column":49}},"8":{"start":{"line":12,"column":8},"end":{"line":12,"column":49}},"9":{"start":{"line":13,"column":8},"end":{"line":13,"column":47}},"10":{"start":{"line":14,"column":8},"end":{"line":14,"column":61}},"11":{"start":{"line":15,"column":8},"end":{"line":15,"column":25}},"12":{"start":{"line":16,"column":8},"end":{"line":16,"column":72}},"13":{"start":{"line":19,"column":8},"end":{"line":19,"column":41}},"14":{"start":{"line":20,"column":48},"end":{"line":41,"column":9}},"15":{"start":{"line":22,"column":12},"end":{"line":25,"column":13}},"16":{"start":{"line":23,"column":16},"end":{"line":23,"column":70}},"17":{"start":{"line":24,"column":16},"end":{"line":24,"column":23}},"18":{"start":{"line":26,"column":12},"end":{"line":40,"column":15}},"19":{"start":{"line":27,"column":16},"end":{"line":31,"column":17}},"20":{"start":{"line":28,"column":20},"end":{"line":28,"column":90}},"21":{"start":{"line":29,"column":20},"end":{"line":29,"column":74}},"22":{"start":{"line":30,"column":20},"end":{"line":30,"column":83}},"23":{"start":{"line":32,"column":16},"end":{"line":32,"column":83}},"24":{"start":{"line":33,"column":16},"end":{"line":39,"column":17}},"25":{"start":{"line":34,"column":20},"end":{"line":37,"column":23}},"26":{"start":{"line":35,"column":24},"end":{"line":35,"column":92}},"27":{"start":{"line":36,"column":24},"end":{"line":36,"column":72}},"28":{"start":{"line":38,"column":20},"end":{"line":38,"column":74}},"29":{"start":{"line":42,"column":8},"end":{"line":42,"column":42}},"30":{"start":{"line":43,"column":8},"end":{"line":43,"column":130}},"31":{"start":{"line":46,"column":8},"end":{"line":46,"column":62}},"32":{"start":{"line":49,"column":0},"end":{"line":49,"column":38}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":4},"end":{"line":9,"column":5}},"loc":{"start":{"line":9,"column":97},"end":{"line":17,"column":5}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":18,"column":4},"end":{"line":18,"column":5}},"loc":{"start":{"line":18,"column":34},"end":{"line":44,"column":5}},"line":18},"2":{"name":"(anonymous_2)","decl":{"start":{"line":20,"column":48},"end":{"line":20,"column":49}},"loc":{"start":{"line":20,"column":60},"end":{"line":41,"column":9}},"line":20},"3":{"name":"(anonymous_3)","decl":{"start":{"line":26,"column":72},"end":{"line":26,"column":73}},"loc":{"start":{"line":26,"column":84},"end":{"line":40,"column":13}},"line":26},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":51},"end":{"line":34,"column":52}},"loc":{"start":{"line":34,"column":62},"end":{"line":37,"column":21}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":45,"column":4},"end":{"line":45,"column":5}},"loc":{"start":{"line":45,"column":12},"end":{"line":47,"column":5}},"line":45}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":69},"end":{"line":9,"column":95}},"type":"default-arg","locations":[{"start":{"line":9,"column":94},"end":{"line":9,"column":95}}],"line":9},"1":{"loc":{"start":{"line":22,"column":12},"end":{"line":25,"column":13}},"type":"if","locations":[{"start":{"line":22,"column":12},"end":{"line":25,"column":13}},{"start":{"line":22,"column":12},"end":{"line":25,"column":13}}],"line":22},"2":{"loc":{"start":{"line":22,"column":16},"end":{"line":22,"column":98}},"type":"cond-expr","locations":[{"start":{"line":22,"column":72},"end":{"line":22,"column":78}},{"start":{"line":22,"column":81},"end":{"line":22,"column":98}}],"line":22},"3":{"loc":{"start":{"line":22,"column":16},"end":{"line":22,"column":69}},"type":"binary-expr","locations":[{"start":{"line":22,"column":16},"end":{"line":22,"column":52}},{"start":{"line":22,"column":56},"end":{"line":22,"column":69}}],"line":22},"4":{"loc":{"start":{"line":27,"column":16},"end":{"line":31,"column":17}},"type":"if","locations":[{"start":{"line":27,"column":16},"end":{"line":31,"column":17}},{"start":{"line":27,"column":16},"end":{"line":31,"column":17}}],"line":27},"5":{"loc":{"start":{"line":27,"column":20},"end":{"line":27,"column":228}},"type":"binary-expr","locations":[{"start":{"line":27,"column":20},"end":{"line":27,"column":27}},{"start":{"line":27,"column":31},"end":{"line":27,"column":107}},{"start":{"line":27,"column":111},"end":{"line":27,"column":228}}],"line":27},"6":{"loc":{"start":{"line":27,"column":32},"end":{"line":27,"column":92}},"type":"cond-expr","locations":[{"start":{"line":27,"column":71},"end":{"line":27,"column":77}},{"start":{"line":27,"column":80},"end":{"line":27,"column":92}}],"line":27},"7":{"loc":{"start":{"line":27,"column":32},"end":{"line":27,"column":68}},"type":"binary-expr","locations":[{"start":{"line":27,"column":32},"end":{"line":27,"column":47}},{"start":{"line":27,"column":51},"end":{"line":27,"column":68}}],"line":27},"8":{"loc":{"start":{"line":27,"column":112},"end":{"line":27,"column":172}},"type":"cond-expr","locations":[{"start":{"line":27,"column":151},"end":{"line":27,"column":157}},{"start":{"line":27,"column":160},"end":{"line":27,"column":172}}],"line":27},"9":{"loc":{"start":{"line":27,"column":112},"end":{"line":27,"column":148}},"type":"binary-expr","locations":[{"start":{"line":27,"column":112},"end":{"line":27,"column":127}},{"start":{"line":27,"column":131},"end":{"line":27,"column":148}}],"line":27},"10":{"loc":{"start":{"line":33,"column":16},"end":{"line":39,"column":17}},"type":"if","locations":[{"start":{"line":33,"column":16},"end":{"line":39,"column":17}},{"start":{"line":33,"column":16},"end":{"line":39,"column":17}}],"line":33}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":82,"7":82,"8":82,"9":82,"10":82,"11":82,"12":82,"13":82,"14":82,"15":115,"16":24,"17":24,"18":91,"19":66,"20":0,"21":0,"22":0,"23":66,"24":66,"25":52,"26":52,"27":52,"28":52,"29":82,"30":82,"31":83,"32":1},"f":{"0":82,"1":82,"2":115,"3":66,"4":52,"5":83},"b":{"0":[6],"1":[24,91],"2":[0,115],"3":[115,115],"4":[0,66],"5":[66,66,66],"6":[0,66],"7":[66,66],"8":[0,66],"9":[66,66],"10":[52,14]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/partnerReview.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/partnerReview.ts"],"names":[],"mappings":";;;AACA,qCAAwC;AAExC,yDAAsD;AAEtD,yCAA4C;AAC5C,yDAAsF;AAEtF,MAAa,aAAc,SAAQ,mCAAgB;IAKjD,YACW,gBAAuB,EACvB,gBAAkC,EAClC,eAAgC,EAChC,yBAAiC,CAAC;QAE3C,KAAK,CAAC,gBAAgB,EAAE,gBAAgB,EAAE,eAAe,CAAC,CAAC;QALlD,qBAAgB,GAAhB,gBAAgB,CAAO;QACvB,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,oBAAe,GAAf,eAAe,CAAiB;QAChC,2BAAsB,GAAtB,sBAAsB,CAAY;QANrC,WAAM,GAAuD,EAAE,CAAC;QAStE,IAAI,CAAC,GAAG,GAAG,IAAA,qBAAY,EAAC,wBAAwB,CAAC,CAAC;IACpD,CAAC;IAMD,KAAK,CAAC,qBAAqB;QACzB,IAAI,CAAC,yBAAyB,EAAE,CAAC;QACjC,MAAM,+BAA+B,GAAG,KAAK,IAAI,EAAE;;YACjD,IAAI,MAAA,IAAI,CAAC,eAAe,0CAAE,MAAM,CAAC,OAAO,EAAE,CAAC;gBACzC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,0BAA0B,CAAC,CAAC;gBACtD,OAAO;YACT,CAAC;YACD,IAAI,CAAC,gBAAgB,CAAC,8BAA8B,EAAE,CAAC,IAAI,CAAC,CAAC,MAAgC,EAAE,EAAE;gBAC/F,IAAI,CAAC,MAAM,IAAI,CAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,KAAK,MAAK,SAAS,IAAI,CAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,KAAK,MAAK,mCAAmB,CAAC,cAAc,EAAE,CAAC;oBACnG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,6CAA6C,EAAE,MAAM,CAAC,CAAC;oBACtE,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,0BAA0B,CAAC,CAAC;oBACtD,MAAM,IAAI,KAAK,CAAC,6CAA6C,CAAC,CAAC;gBACjE,CAAC;gBACD,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,oCAAoC,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC;gBACnE,IAAI,MAAM,CAAC,KAAK,KAAK,mCAAmB,CAAC,SAAS,EAAE,CAAC;oBACnD,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,EAAE;wBACvC,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,GAAG,mBAAW,CAAC,QAAQ,CAAC;wBAC5D,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC,QAAQ,GAAG,MAAM,CAAC;oBAClD,CAAC,CAAC,CAAC;oBACH,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,0BAA0B,CAAC,CAAC;gBACxD,CAAC;YACH,CAAC,CAAC,CAAC;QACL,CAAC,CAAC;QACF,+BAA+B,EAAE,CAAC;QAClC,IAAI,CAAC,MAAM,CAAC,0BAA0B,GAAG,WAAW,CAClD,+BAA+B,EAC/B,IAAI,CAAC,sBAAsB,GAAG,IAAI,CACnC,CAAC;IACJ,CAAC;IAED,KAAK;QACH,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,0BAA0B,CAAC,CAAC;IACxD,CAAC;CACF;AApDD,sCAoDC","sourcesContent":["import { GatekeeperClient } from './gatekeeperClient';\nimport { prefixLogger } from './logger';\nimport { LoggingInterface } from './logger/provider.logger';\nimport { OrchestratorFlow } from './orchestratorFlow';\nimport { Store } from './state/state';\nimport { InputStatus } from './types/fetch';\nimport { GatekeeperAPIStatus, GatekeeperRecordResponse } from './types/gatekeeperApi';\n\nexport class PartnerReview extends OrchestratorFlow {\n  protected log: LoggingInterface;\n\n  private timers: Partial<Record<'pollForReviewFinishedTimer', any>> = {};\n\n  constructor(\n    readonly gatewayCoreStore: Store,\n    readonly gatekeeperClient: GatekeeperClient,\n    readonly abortController: AbortController,\n    readonly pollingIntervalSeconds: number = 2\n  ) {\n    super(gatewayCoreStore, gatekeeperClient, abortController);\n    this.log = prefixLogger('PartnerReview instance');\n  }\n\n  /**\n   * Call the gatekeeper to get the latest record and check if it's changed from REQUESTED,\n   * once it changes, update the gatekeeerRecord state and let the orchestration logic finish\n   */\n  async pollForReviewFinished() {\n    this.setGatekeeperClientFlowId();\n    const callGatekeeperForReviewFinished = async () => {\n      if (this.abortController?.signal.aborted) {\n        clearInterval(this.timers.pollForReviewFinishedTimer);\n        return;\n      }\n      this.gatekeeperClient.getGatekeeperRecordWithPayload().then((record: GatekeeperRecordResponse) => {\n        if (!record || record?.state === undefined || record?.state === GatekeeperAPIStatus.SERVER_FAILURE) {\n          this.log.error('Error polling gatekeeper, no state returned', record);\n          clearInterval(this.timers.pollForReviewFinishedTimer);\n          throw new Error('Error polling gatekeeper, no state returned');\n        }\n        this.log.debug('pollUntilNotRequested record.state', record.state);\n        if (record.state !== GatekeeperAPIStatus.REQUESTED) {\n          this.gatewayCoreStore.setState((state) => {\n            state.inputs.gatekeeperRecord.status = InputStatus.COMPLETE;\n            state.inputs.gatekeeperRecord.received = record;\n          });\n          clearInterval(this.timers.pollForReviewFinishedTimer);\n        }\n      });\n    };\n    callGatekeeperForReviewFinished();\n    this.timers.pollForReviewFinishedTimer = setInterval(\n      callGatekeeperForReviewFinished,\n      this.pollingIntervalSeconds * 1000\n    );\n  }\n\n  abort() {\n    clearInterval(this.timers.pollForReviewFinishedTimer);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"50fae8684199966aacd57b57dae881f92ead19c4"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/common.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/common.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":243}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":43}},"3":{"start":{"line":5,"column":20},"end":{"line":5,"column":49}},"4":{"start":{"line":6,"column":18},"end":{"line":6,"column":45}},"5":{"start":{"line":7,"column":17},"end":{"line":7,"column":37}},"6":{"start":{"line":8,"column":24},"end":{"line":8,"column":57}},"7":{"start":{"line":9,"column":17},"end":{"line":9,"column":59}},"8":{"start":{"line":10,"column":0},"end":{"line":16,"column":2}},"9":{"start":{"line":17,"column":27},"end":{"line":17,"column":287}},"10":{"start":{"line":17,"column":56},"end":{"line":17,"column":285}},"11":{"start":{"line":18,"column":0},"end":{"line":18,"column":48}},"12":{"start":{"line":19,"column":37},"end":{"line":23,"column":1}},"13":{"start":{"line":21,"column":4},"end":{"line":22,"column":204}},"14":{"start":{"line":24,"column":0},"end":{"line":24,"column":68}},"15":{"start":{"line":25,"column":39},"end":{"line":50,"column":1}},"16":{"start":{"line":27,"column":25},"end":{"line":27,"column":106}},"17":{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},"18":{"start":{"line":29,"column":8},"end":{"line":29,"column":45}},"19":{"start":{"line":31,"column":4},"end":{"line":48,"column":5}},"20":{"start":{"line":32,"column":37},"end":{"line":36,"column":10}},"21":{"start":{"line":37,"column":8},"end":{"line":47,"column":9}},"22":{"start":{"line":39,"column":16},"end":{"line":39,"column":126}},"23":{"start":{"line":41,"column":16},"end":{"line":41,"column":54}},"24":{"start":{"line":43,"column":16},"end":{"line":43,"column":55}},"25":{"start":{"line":45,"column":16},"end":{"line":45,"column":74}},"26":{"start":{"line":46,"column":16},"end":{"line":46,"column":53}},"27":{"start":{"line":49,"column":4},"end":{"line":49,"column":21}},"28":{"start":{"line":51,"column":0},"end":{"line":51,"column":72}},"29":{"start":{"line":52,"column":39},"end":{"line":59,"column":1}},"30":{"start":{"line":53,"column":19},"end":{"line":53,"column":69}},"31":{"start":{"line":54,"column":4},"end":{"line":57,"column":5}},"32":{"start":{"line":55,"column":8},"end":{"line":55,"column":98}},"33":{"start":{"line":56,"column":8},"end":{"line":56,"column":45}},"34":{"start":{"line":58,"column":4},"end":{"line":58,"column":18}},"35":{"start":{"line":60,"column":0},"end":{"line":60,"column":72}},"36":{"start":{"line":61,"column":41},"end":{"line":82,"column":1}},"37":{"start":{"line":63,"column":29},"end":{"line":63,"column":58}},"38":{"start":{"line":64,"column":25},"end":{"line":64,"column":50}},"39":{"start":{"line":65,"column":24},"end":{"line":65,"column":170}},"40":{"start":{"line":66,"column":4},"end":{"line":81,"column":5}},"41":{"start":{"line":68,"column":12},"end":{"line":68,"column":147}},"42":{"start":{"line":70,"column":12},"end":{"line":70,"column":52}},"43":{"start":{"line":73,"column":12},"end":{"line":73,"column":66}},"44":{"start":{"line":76,"column":12},"end":{"line":76,"column":61}},"45":{"start":{"line":78,"column":12},"end":{"line":78,"column":49}},"46":{"start":{"line":80,"column":12},"end":{"line":80,"column":29}},"47":{"start":{"line":83,"column":0},"end":{"line":83,"column":76}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":17,"column":27},"end":{"line":17,"column":28}},"loc":{"start":{"line":17,"column":38},"end":{"line":17,"column":287}},"line":17},"1":{"name":"(anonymous_1)","decl":{"start":{"line":19,"column":37},"end":{"line":19,"column":38}},"loc":{"start":{"line":19,"column":48},"end":{"line":23,"column":1}},"line":19},"2":{"name":"(anonymous_2)","decl":{"start":{"line":25,"column":39},"end":{"line":25,"column":40}},"loc":{"start":{"line":25,"column":50},"end":{"line":50,"column":1}},"line":25},"3":{"name":"(anonymous_3)","decl":{"start":{"line":52,"column":39},"end":{"line":52,"column":40}},"loc":{"start":{"line":52,"column":50},"end":{"line":59,"column":1}},"line":52},"4":{"name":"(anonymous_4)","decl":{"start":{"line":61,"column":41},"end":{"line":61,"column":42}},"loc":{"start":{"line":61,"column":52},"end":{"line":82,"column":1}},"line":61}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":67},"end":{"line":17,"column":143}},"type":"cond-expr","locations":[{"start":{"line":17,"column":126},"end":{"line":17,"column":132}},{"start":{"line":17,"column":135},"end":{"line":17,"column":143}}],"line":17},"1":{"loc":{"start":{"line":17,"column":67},"end":{"line":17,"column":123}},"type":"binary-expr","locations":[{"start":{"line":17,"column":67},"end":{"line":17,"column":106}},{"start":{"line":17,"column":110},"end":{"line":17,"column":123}}],"line":17},"2":{"loc":{"start":{"line":17,"column":150},"end":{"line":17,"column":282}},"type":"cond-expr","locations":[{"start":{"line":17,"column":263},"end":{"line":17,"column":269}},{"start":{"line":17,"column":272},"end":{"line":17,"column":282}}],"line":17},"3":{"loc":{"start":{"line":17,"column":150},"end":{"line":17,"column":260}},"type":"binary-expr","locations":[{"start":{"line":17,"column":150},"end":{"line":17,"column":243}},{"start":{"line":17,"column":247},"end":{"line":17,"column":260}}],"line":17},"4":{"loc":{"start":{"line":17,"column":156},"end":{"line":17,"column":233}},"type":"cond-expr","locations":[{"start":{"line":17,"column":215},"end":{"line":17,"column":221}},{"start":{"line":17,"column":224},"end":{"line":17,"column":233}}],"line":17},"5":{"loc":{"start":{"line":17,"column":156},"end":{"line":17,"column":212}},"type":"binary-expr","locations":[{"start":{"line":17,"column":156},"end":{"line":17,"column":195}},{"start":{"line":17,"column":199},"end":{"line":17,"column":212}}],"line":17},"6":{"loc":{"start":{"line":21,"column":14},"end":{"line":22,"column":202}},"type":"binary-expr","locations":[{"start":{"line":21,"column":15},"end":{"line":21,"column":96}},{"start":{"line":22,"column":8},"end":{"line":22,"column":202}}],"line":21},"7":{"loc":{"start":{"line":21,"column":15},"end":{"line":21,"column":96}},"type":"cond-expr","locations":[{"start":{"line":21,"column":76},"end":{"line":21,"column":82}},{"start":{"line":21,"column":85},"end":{"line":21,"column":96}}],"line":21},"8":{"loc":{"start":{"line":21,"column":15},"end":{"line":21,"column":73}},"type":"binary-expr","locations":[{"start":{"line":21,"column":15},"end":{"line":21,"column":56}},{"start":{"line":21,"column":60},"end":{"line":21,"column":73}}],"line":21},"9":{"loc":{"start":{"line":22,"column":9},"end":{"line":22,"column":147}},"type":"cond-expr","locations":[{"start":{"line":22,"column":130},"end":{"line":22,"column":136}},{"start":{"line":22,"column":139},"end":{"line":22,"column":147}}],"line":22},"10":{"loc":{"start":{"line":22,"column":9},"end":{"line":22,"column":127}},"type":"binary-expr","locations":[{"start":{"line":22,"column":9},"end":{"line":22,"column":110}},{"start":{"line":22,"column":114},"end":{"line":22,"column":127}}],"line":22},"11":{"loc":{"start":{"line":22,"column":15},"end":{"line":22,"column":100}},"type":"cond-expr","locations":[{"start":{"line":22,"column":80},"end":{"line":22,"column":86}},{"start":{"line":22,"column":89},"end":{"line":22,"column":100}}],"line":22},"12":{"loc":{"start":{"line":22,"column":15},"end":{"line":22,"column":77}},"type":"binary-expr","locations":[{"start":{"line":22,"column":15},"end":{"line":22,"column":60}},{"start":{"line":22,"column":64},"end":{"line":22,"column":77}}],"line":22},"13":{"loc":{"start":{"line":27,"column":25},"end":{"line":27,"column":106}},"type":"cond-expr","locations":[{"start":{"line":27,"column":86},"end":{"line":27,"column":92}},{"start":{"line":27,"column":95},"end":{"line":27,"column":106}}],"line":27},"14":{"loc":{"start":{"line":27,"column":25},"end":{"line":27,"column":83}},"type":"binary-expr","locations":[{"start":{"line":27,"column":25},"end":{"line":27,"column":66}},{"start":{"line":27,"column":70},"end":{"line":27,"column":83}}],"line":27},"15":{"loc":{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},{"start":{"line":28,"column":4},"end":{"line":30,"column":5}}],"line":28},"16":{"loc":{"start":{"line":31,"column":4},"end":{"line":48,"column":5}},"type":"if","locations":[{"start":{"line":31,"column":4},"end":{"line":48,"column":5}},{"start":{"line":31,"column":4},"end":{"line":48,"column":5}}],"line":31},"17":{"loc":{"start":{"line":35,"column":33},"end":{"line":35,"column":130}},"type":"cond-expr","locations":[{"start":{"line":35,"column":99},"end":{"line":35,"column":105}},{"start":{"line":35,"column":108},"end":{"line":35,"column":130}}],"line":35},"18":{"loc":{"start":{"line":35,"column":33},"end":{"line":35,"column":96}},"type":"binary-expr","locations":[{"start":{"line":35,"column":33},"end":{"line":35,"column":79}},{"start":{"line":35,"column":83},"end":{"line":35,"column":96}}],"line":35},"19":{"loc":{"start":{"line":37,"column":8},"end":{"line":47,"column":9}},"type":"switch","locations":[{"start":{"line":38,"column":12},"end":{"line":39,"column":126}},{"start":{"line":40,"column":12},"end":{"line":41,"column":54}},{"start":{"line":42,"column":12},"end":{"line":43,"column":55}},{"start":{"line":44,"column":12},"end":{"line":46,"column":53}}],"line":37},"20":{"loc":{"start":{"line":39,"column":23},"end":{"line":39,"column":125}},"type":"cond-expr","locations":[{"start":{"line":39,"column":46},"end":{"line":39,"column":92}},{"start":{"line":39,"column":95},"end":{"line":39,"column":125}}],"line":39},"21":{"loc":{"start":{"line":54,"column":4},"end":{"line":57,"column":5}},"type":"if","locations":[{"start":{"line":54,"column":4},"end":{"line":57,"column":5}},{"start":{"line":54,"column":4},"end":{"line":57,"column":5}}],"line":54},"22":{"loc":{"start":{"line":65,"column":24},"end":{"line":65,"column":170}},"type":"cond-expr","locations":[{"start":{"line":65,"column":153},"end":{"line":65,"column":159}},{"start":{"line":65,"column":162},"end":{"line":65,"column":170}}],"line":65},"23":{"loc":{"start":{"line":65,"column":24},"end":{"line":65,"column":150}},"type":"binary-expr","locations":[{"start":{"line":65,"column":24},"end":{"line":65,"column":133}},{"start":{"line":65,"column":137},"end":{"line":65,"column":150}}],"line":65},"24":{"loc":{"start":{"line":65,"column":30},"end":{"line":65,"column":123}},"type":"cond-expr","locations":[{"start":{"line":65,"column":89},"end":{"line":65,"column":95}},{"start":{"line":65,"column":98},"end":{"line":65,"column":123}}],"line":65},"25":{"loc":{"start":{"line":65,"column":30},"end":{"line":65,"column":86}},"type":"binary-expr","locations":[{"start":{"line":65,"column":30},"end":{"line":65,"column":55}},{"start":{"line":65,"column":59},"end":{"line":65,"column":86}}],"line":65},"26":{"loc":{"start":{"line":66,"column":4},"end":{"line":81,"column":5}},"type":"switch","locations":[{"start":{"line":67,"column":8},"end":{"line":68,"column":147}},{"start":{"line":69,"column":8},"end":{"line":70,"column":52}},{"start":{"line":71,"column":8},"end":{"line":71,"column":79}},{"start":{"line":72,"column":8},"end":{"line":73,"column":66}},{"start":{"line":74,"column":8},"end":{"line":74,"column":74}},{"start":{"line":75,"column":8},"end":{"line":76,"column":61}},{"start":{"line":77,"column":8},"end":{"line":78,"column":49}},{"start":{"line":79,"column":8},"end":{"line":80,"column":29}}],"line":66},"27":{"loc":{"start":{"line":68,"column":19},"end":{"line":68,"column":146}},"type":"cond-expr","locations":[{"start":{"line":68,"column":105},"end":{"line":68,"column":114}},{"start":{"line":68,"column":117},"end":{"line":68,"column":146}}],"line":68},"28":{"loc":{"start":{"line":68,"column":20},"end":{"line":68,"column":101}},"type":"cond-expr","locations":[{"start":{"line":68,"column":71},"end":{"line":68,"column":77}},{"start":{"line":68,"column":80},"end":{"line":68,"column":101}}],"line":68},"29":{"loc":{"start":{"line":68,"column":20},"end":{"line":68,"column":68}},"type":"binary-expr","locations":[{"start":{"line":68,"column":20},"end":{"line":68,"column":41}},{"start":{"line":68,"column":45},"end":{"line":68,"column":68}}],"line":68}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":450,"11":1,"12":1,"13":1449,"14":1,"15":1,"16":1444,"17":1444,"18":1,"19":1443,"20":185,"21":185,"22":178,"23":2,"24":2,"25":3,"26":3,"27":1258,"28":1,"29":1,"30":43,"31":43,"32":1,"33":1,"34":42,"35":1,"36":1,"37":377,"38":377,"39":377,"40":377,"41":16,"42":10,"43":8,"44":8,"45":5,"46":330,"47":1},"f":{"0":450,"1":1449,"2":1444,"3":43,"4":377},"b":{"0":[9,441],"1":[450,446],"2":[18,432],"3":[450,450],"4":[9,441],"5":[450,446],"6":[1449,187],"7":[1,1448],"8":[1449,1449],"9":[52,135],"10":[187,147],"11":[12,175],"12":[187,187],"13":[1,1443],"14":[1444,1444],"15":[1,1443],"16":[185,1258],"17":[173,12],"18":[185,185],"19":[178,2,2,3],"20":[116,62],"21":[1,42],"22":[130,247],"23":[377,247],"24":[0,377],"25":[377,377],"26":[16,10,3,8,3,8,5,330],"27":[15,1],"28":[0,16],"29":[16,16]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/common.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/common.ts"],"names":[],"mappings":";;;AAAA,4CAAyD;AACzD,kDAAsD;AACtD,8CAAiD;AAEjD,sCAAyC;AACzC,0DAA6D;AAE7D,MAAM,QAAQ,GAAG,IAAA,qBAAY,EAAC,QAAQ,CAAC,CAAC,KAAK,CAAC;AAcjC,QAAA,gCAAgC,GAAmE;IAC9G,CAAC,4BAAgB,CAAC,UAAU,CAAC,EAAE,uBAAa,CAAC,2BAA2B;IACxE,CAAC,4BAAgB,CAAC,UAAU,CAAC,EAAE,uBAAa,CAAC,2BAA2B;IACxE,CAAC,4BAAgB,CAAC,SAAS,CAAC,EAAE,uBAAa,CAAC,2BAA2B;IACvE,CAAC,4BAAgB,CAAC,MAAM,CAAC,EAAE,uBAAa,CAAC,yBAAyB;IAClE,CAAC,4BAAgB,CAAC,SAAS,CAAC,EAAE,uBAAa,CAAC,0BAA0B;CACvE,CAAC;AAEK,MAAM,kBAAkB,GAAG,CAAC,KAAuB,EAAW,EAAE,mBACrE,OAAA,CAAC,CAAC,CAAC,CAAA,MAAA,KAAK,CAAC,MAAM,CAAC,UAAU,0CAAE,KAAK,OAAK,MAAA,MAAA,KAAK,CAAC,MAAM,CAAC,UAAU,0CAAE,MAAM,0CAAE,OAAO,CAAA,CAAC,CAAA,EAAA,CAAC;AADrE,QAAA,kBAAkB,sBACmD;AAE3E,MAAM,4BAA4B,GAAG,CAAC,KAAuB,EAAW,EAAE;;IAC/E,OAAA,CAAC,CAAC,CACA,CAAA,MAAA,KAAK,CAAC,MAAM,CAAC,YAAY,0CAAE,QAAQ;QACnC,CAAA,MAAA,MAAA,KAAK,CAAC,MAAM,CAAC,gBAAgB,0CAAE,QAAQ,0CAAE,KAAK,MAAK,mCAAmB,CAAC,aAAa,CACrF,CAAA;CAAA,CAAC;AAJS,QAAA,4BAA4B,gCAIrC;AAmBG,MAAM,8BAA8B,GAAG,CAAC,KAAuB,EAAqC,EAAE;;IAC3G,MAAM,YAAY,GAAG,MAAA,KAAK,CAAC,MAAM,CAAC,YAAY,0CAAE,QAAQ,CAAC;IACzD,IAAI,IAAA,oCAA4B,EAAC,KAAK,CAAC,EAAE,CAAC;QACxC,OAAO,uBAAa,CAAC,KAAK,CAAC;IAC7B,CAAC;IACD,IAAI,YAAY,EAAE,CAAC;QACjB,MAAM,oBAAoB,GAAG,IAAA,+BAAsB,EAAC;YAClD,YAAY;YACZ,4BAA4B,EAAE,CAAC;YAC/B,mBAAmB,EAAE,MAAA,KAAK,CAAC,MAAM,CAAC,iBAAiB,0CAAE,mBAAmB;SACzE,CAAC,CAAC;QAEH,QAAQ,YAAY,CAAC,KAAK,EAAE,CAAC;YAC3B,KAAK,QAAQ;gBACX,OAAO,oBAAoB,CAAC,CAAC,CAAC,uBAAa,CAAC,sBAAsB,CAAC,CAAC,CAAC,uBAAa,CAAC,MAAM,CAAC;YAC5F,KAAK,QAAQ;gBACX,OAAO,uBAAa,CAAC,MAAM,CAAC;YAC9B,KAAK,SAAS;gBACZ,OAAO,uBAAa,CAAC,OAAO,CAAC;YAC/B;gBAEE,QAAQ,CAAC,2BAA2B,YAAY,CAAC,KAAK,EAAE,CAAC,CAAC;gBAC1D,OAAO,uBAAa,CAAC,KAAK,CAAC;QAC/B,CAAC;IACH,CAAC;IACD,OAAO,SAAS,CAAC;AACnB,CAAC,CAAC;AA1BW,QAAA,8BAA8B,kCA0BzC;AAEK,MAAM,8BAA8B,GAAG,CAAC,KAAuB,EAAyB,EAAE;IAC/F,MAAM,MAAM,GAAG,IAAA,sCAA8B,EAAC,KAAK,CAAC,CAAC;IACrD,IAAI,CAAC,MAAM,EAAE,CAAC;QACZ,QAAQ,CAAC,+EAA+E,CAAC,CAAC;QAC1F,OAAO,uBAAa,CAAC,KAAK,CAAC;IAC7B,CAAC;IACD,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC;AAPW,QAAA,8BAA8B,kCAOzC;AAOK,MAAM,gCAAgC,GAAG,CAC9C,KAAuB,EAC2B,EAAE;;IACpD,MAAM,gBAAgB,GAAG,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC;IACvD,MAAM,YAAY,GAAG,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC;IAC/C,MAAM,WAAW,GAAG,MAAA,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAE,QAAQ,0CAAE,KAAK,CAAC;IACtD,QAAQ,WAAW,EAAE,CAAC;QACpB,KAAK,mCAAmB,CAAC,cAAc;YAGrC,OAAO,CAAA,YAAY,aAAZ,YAAY,uBAAZ,YAAY,CAAE,QAAQ,EAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,uBAAa,CAAC,KAAK,CAAC;QAClE,KAAK,mCAAmB,CAAC,QAAQ;YAC/B,OAAO,uBAAa,CAAC,QAAQ,CAAC;QAChC,KAAK,mCAAmB,CAAC,6BAA6B,CAAC;QACvD,KAAK,mCAAmB,CAAC,sBAAsB;YAC7C,OAAO,uBAAa,CAAC,sBAAsB,CAAC;QAC9C,KAAK,mCAAmB,CAAC,wBAAwB,CAAC;QAClD,KAAK,mCAAmB,CAAC,iBAAiB;YACxC,OAAO,uBAAa,CAAC,iBAAiB,CAAC;QACzC,KAAK,mCAAmB,CAAC,2BAA2B;YAClD,OAAO,uBAAa,CAAC,KAAK,CAAC;QAC7B;YACE,OAAO,SAAS,CAAC;IACrB,CAAC;AACH,CAAC,CAAC;AAxBW,QAAA,gCAAgC,oCAwB3C","sourcesContent":["import { isTokenRefreshRequired } from '../utils/expiry';\nimport { ValidationStatus } from '../types/civicPass';\nimport { GatewayStatus } from '../types/gateway';\nimport { GatewayCoreState } from '../types/gatewayCore';\nimport { prefixLogger } from '../logger';\nimport { GatekeeperAPIStatus } from '../types/gatekeeperApi';\n\nconst logError = prefixLogger('common').error;\nexport type ValidationGatewayStatusType =\n  | GatewayStatus.COLLECTING_USER_INFORMATION\n  | GatewayStatus.VALIDATING_USER_INFORMATION\n  | GatewayStatus.USER_INFORMATION_REJECTED\n  | GatewayStatus.NOT_REQUESTED\n  | GatewayStatus.USER_INFORMATION_VALIDATED;\n\nexport type CheckValidationStatusType =\n  | ValidationStatus.COLLECTING\n  | ValidationStatus.PROCESSING\n  | ValidationStatus.IN_REVIEW\n  | ValidationStatus.FAILED\n  | ValidationStatus.COMPLETED;\nexport const validationProcessToGatewayStatus: Record<CheckValidationStatusType, ValidationGatewayStatusType> = {\n  [ValidationStatus.COLLECTING]: GatewayStatus.COLLECTING_USER_INFORMATION,\n  [ValidationStatus.PROCESSING]: GatewayStatus.VALIDATING_USER_INFORMATION,\n  [ValidationStatus.IN_REVIEW]: GatewayStatus.VALIDATING_USER_INFORMATION,\n  [ValidationStatus.FAILED]: GatewayStatus.USER_INFORMATION_REJECTED,\n  [ValidationStatus.COMPLETED]: GatewayStatus.USER_INFORMATION_VALIDATED,\n};\n\nexport const payerIsWalletOwner = (state: GatewayCoreState): boolean =>\n  !!(state.inputs.parameters?.payer === state.inputs.parameters?.wallet?.address);\n\nexport const tokenNoGatekeeperRecordError = (state: GatewayCoreState): boolean =>\n  !!(\n    state.inputs.gatewayToken?.received &&\n    state.inputs.gatekeeperRecord?.received?.state === GatekeeperAPIStatus.NOT_REQUESTED\n  );\n\n/**\n * if a gateway token is present in state, then derive the status from the token fields:\n * - if the state is ACTIVE, check if a token refresh is required OR if the forceRequireRefresh input flag is set\n * in which case return REFRESH_TOKEN_REQUIRED, otherwise return ACTIVE\n * - if the state is FROZEN, return FROZEN\n * - if the state is REVOKED, return REVOKED\n * - if the state is not one of the above, then the gatewayToken is in an unsupported state, so log an error and return ERROR\n * @param state\n * @returns\n */\nexport type GatewayTokenCheckType =\n  | GatewayStatus.ERROR\n  | GatewayStatus.REFRESH_TOKEN_REQUIRED\n  | GatewayStatus.ACTIVE\n  | GatewayStatus.FROZEN\n  | GatewayStatus.REVOKED;\n\nexport const statusFromGatewayTokenIfExists = (state: GatewayCoreState): GatewayTokenCheckType | undefined => {\n  const gatewayToken = state.inputs.gatewayToken?.received;\n  if (tokenNoGatekeeperRecordError(state)) {\n    return GatewayStatus.ERROR;\n  }\n  if (gatewayToken) {\n    const tokenRefreshRequired = isTokenRefreshRequired({\n      gatewayToken,\n      tokenExpirationMarginSeconds: 0,\n      forceRequireRefresh: state.inputs.dynamicParameters?.forceRequireRefresh,\n    });\n\n    switch (gatewayToken.state) {\n      case 'ACTIVE':\n        return tokenRefreshRequired ? GatewayStatus.REFRESH_TOKEN_REQUIRED : GatewayStatus.ACTIVE;\n      case 'FROZEN':\n        return GatewayStatus.FROZEN;\n      case 'REVOKED':\n        return GatewayStatus.REVOKED;\n      default:\n        // Handle unexpected token states or add logging as necessary\n        logError(`Unexpected token state: ${gatewayToken.state}`);\n        return GatewayStatus.ERROR;\n    }\n  }\n  return undefined;\n};\n\nexport const handleGatewayTokenExistsStatus = (state: GatewayCoreState): GatewayTokenCheckType => {\n  const status = statusFromGatewayTokenIfExists(state);\n  if (!status) {\n    logError('The gateway status indicated an existing token but no status could be derived');\n    return GatewayStatus.ERROR;\n  }\n  return status;\n};\nexport type StatusIfGatekeeperRecordRejectedType =\n  | GatewayStatus.REJECTED\n  | GatewayStatus.LOCATION_NOT_SUPPORTED\n  | GatewayStatus.VPN_NOT_SUPPORTED\n  | GatewayStatus.REFRESH_TOKEN_REQUIRED\n  | GatewayStatus.ERROR;\nexport const statusIfGatekeeperRecordRejected = (\n  state: GatewayCoreState\n): StatusIfGatekeeperRecordRejectedType | undefined => {\n  const gatekeeperRecord = state.inputs.gatekeeperRecord;\n  const gatewayToken = state.inputs.gatewayToken;\n  const recordState = gatekeeperRecord?.received?.state;\n  switch (recordState) {\n    case GatekeeperAPIStatus.ISSUED_EXPIRED:\n      // we only want to handle the error case here\n      // the refresh case will be handled by statusFromGatewayTokenIfExists\n      return gatewayToken?.received ? undefined : GatewayStatus.ERROR;\n    case GatekeeperAPIStatus.REJECTED:\n      return GatewayStatus.REJECTED;\n    case GatekeeperAPIStatus.ISSUED_LOCATION_NOT_SUPPORTED:\n    case GatekeeperAPIStatus.LOCATION_NOT_SUPPORTED:\n      return GatewayStatus.LOCATION_NOT_SUPPORTED;\n    case GatekeeperAPIStatus.ISSUED_VPN_NOT_SUPPORTED:\n    case GatekeeperAPIStatus.VPN_NOT_SUPPORTED:\n      return GatewayStatus.VPN_NOT_SUPPORTED;\n    case GatekeeperAPIStatus.REQUESTED_RETRIES_EXHAUSTED:\n      return GatewayStatus.ERROR;\n    default:\n      return undefined;\n  }\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"105e7eeed57b4be0c3ecda47880a11a5e09a7dd0"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/state.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/state.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":97}},"2":{"start":{"line":4,"column":18},"end":{"line":4,"column":44}},"3":{"start":{"line":5,"column":16},"end":{"line":5,"column":51}},"4":{"start":{"line":6,"column":21},"end":{"line":6,"column":50}},"5":{"start":{"line":7,"column":21},"end":{"line":7,"column":50}},"6":{"start":{"line":8,"column":33},"end":{"line":8,"column":66}},"7":{"start":{"line":9,"column":18},"end":{"line":9,"column":45}},"8":{"start":{"line":10,"column":23},"end":{"line":10,"column":48}},"9":{"start":{"line":11,"column":15},"end":{"line":11,"column":39}},"10":{"start":{"line":12,"column":24},"end":{"line":12,"column":50}},"11":{"start":{"line":13,"column":25},"end":{"line":13,"column":52}},"12":{"start":{"line":14,"column":16},"end":{"line":14,"column":32}},"13":{"start":{"line":15,"column":24},"end":{"line":15,"column":57}},"14":{"start":{"line":16,"column":13},"end":{"line":16,"column":28}},"15":{"start":{"line":17,"column":15},"end":{"line":17,"column":39}},"16":{"start":{"line":18,"column":29},"end":{"line":26,"column":1}},"17":{"start":{"line":27,"column":0},"end":{"line":41,"column":2}},"18":{"start":{"line":42,"column":0},"end":{"line":50,"column":2}},"19":{"start":{"line":51,"column":21},"end":{"line":55,"column":1}},"20":{"start":{"line":56,"column":21},"end":{"line":96,"column":1}},"21":{"start":{"line":58,"column":35},"end":{"line":58,"column":84}},"22":{"start":{"line":59,"column":27},"end":{"line":59,"column":114}},"23":{"start":{"line":60,"column":23},"end":{"line":60,"column":85}},"24":{"start":{"line":61,"column":15},"end":{"line":64,"column":5}},"25":{"start":{"line":65,"column":42},"end":{"line":68,"column":47}},"26":{"start":{"line":69,"column":34},"end":{"line":69,"column":125}},"27":{"start":{"line":70,"column":4},"end":{"line":95,"column":6}},"28":{"start":{"line":97,"column":27},"end":{"line":97,"column":196}},"29":{"start":{"line":97,"column":40},"end":{"line":97,"column":196}},"30":{"start":{"line":97,"column":52},"end":{"line":97,"column":196}},"31":{"start":{"line":98,"column":31},"end":{"line":121,"column":4}},"32":{"start":{"line":98,"column":44},"end":{"line":121,"column":4}},"33":{"start":{"line":98,"column":114},"end":{"line":121,"column":1}},"34":{"start":{"line":101,"column":21},"end":{"line":118,"column":11}},"35":{"start":{"line":103,"column":12},"end":{"line":107,"column":14}},"36":{"start":{"line":108,"column":12},"end":{"line":116,"column":14}},"37":{"start":{"line":117,"column":12},"end":{"line":117,"column":129}},"38":{"start":{"line":122,"column":0},"end":{"line":122,"column":56}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":56,"column":21},"end":{"line":56,"column":22}},"loc":{"start":{"line":56,"column":32},"end":{"line":96,"column":1}},"line":56},"1":{"name":"(anonymous_1)","decl":{"start":{"line":97,"column":27},"end":{"line":97,"column":28}},"loc":{"start":{"line":97,"column":40},"end":{"line":97,"column":196}},"line":97},"2":{"name":"(anonymous_2)","decl":{"start":{"line":97,"column":40},"end":{"line":97,"column":41}},"loc":{"start":{"line":97,"column":52},"end":{"line":97,"column":196}},"line":97},"3":{"name":"(anonymous_3)","decl":{"start":{"line":98,"column":31},"end":{"line":98,"column":32}},"loc":{"start":{"line":98,"column":44},"end":{"line":121,"column":4}},"line":98},"4":{"name":"(anonymous_4)","decl":{"start":{"line":98,"column":99},"end":{"line":98,"column":100}},"loc":{"start":{"line":98,"column":114},"end":{"line":121,"column":1}},"line":98},"5":{"name":"(anonymous_5)","decl":{"start":{"line":101,"column":15},"end":{"line":101,"column":16}},"loc":{"start":{"line":101,"column":21},"end":{"line":118,"column":11}},"line":101},"6":{"name":"(anonymous_6)","decl":{"start":{"line":101,"column":46},"end":{"line":101,"column":47}},"loc":{"start":{"line":101,"column":57},"end":{"line":118,"column":9}},"line":101}},"branchMap":{"0":{"loc":{"start":{"line":59,"column":27},"end":{"line":59,"column":114}},"type":"binary-expr","locations":[{"start":{"line":59,"column":27},"end":{"line":59,"column":101}},{"start":{"line":59,"column":105},"end":{"line":59,"column":114}}],"line":59},"1":{"loc":{"start":{"line":62,"column":11},"end":{"line":62,"column":73}},"type":"cond-expr","locations":[{"start":{"line":62,"column":59},"end":{"line":62,"column":65}},{"start":{"line":62,"column":68},"end":{"line":62,"column":73}}],"line":62},"2":{"loc":{"start":{"line":62,"column":11},"end":{"line":62,"column":56}},"type":"binary-expr","locations":[{"start":{"line":62,"column":11},"end":{"line":62,"column":39}},{"start":{"line":62,"column":43},"end":{"line":62,"column":56}}],"line":62},"3":{"loc":{"start":{"line":65,"column":42},"end":{"line":68,"column":47}},"type":"cond-expr","locations":[{"start":{"line":67,"column":10},"end":{"line":67,"column":14}},{"start":{"line":68,"column":10},"end":{"line":68,"column":47}}],"line":65},"4":{"loc":{"start":{"line":65,"column":42},"end":{"line":66,"column":233}},"type":"binary-expr","locations":[{"start":{"line":65,"column":42},"end":{"line":65,"column":117}},{"start":{"line":66,"column":8},"end":{"line":66,"column":233}}],"line":65},"5":{"loc":{"start":{"line":66,"column":9},"end":{"line":66,"column":219}},"type":"cond-expr","locations":[{"start":{"line":66,"column":189},"end":{"line":66,"column":195}},{"start":{"line":66,"column":198},"end":{"line":66,"column":219}}],"line":66},"6":{"loc":{"start":{"line":66,"column":9},"end":{"line":66,"column":186}},"type":"binary-expr","locations":[{"start":{"line":66,"column":9},"end":{"line":66,"column":169}},{"start":{"line":66,"column":173},"end":{"line":66,"column":186}}],"line":66},"7":{"loc":{"start":{"line":66,"column":15},"end":{"line":66,"column":159}},"type":"cond-expr","locations":[{"start":{"line":66,"column":141},"end":{"line":66,"column":147}},{"start":{"line":66,"column":150},"end":{"line":66,"column":159}}],"line":66},"8":{"loc":{"start":{"line":66,"column":15},"end":{"line":66,"column":138}},"type":"binary-expr","locations":[{"start":{"line":66,"column":15},"end":{"line":66,"column":121}},{"start":{"line":66,"column":125},"end":{"line":66,"column":138}}],"line":66},"9":{"loc":{"start":{"line":66,"column":21},"end":{"line":66,"column":111}},"type":"cond-expr","locations":[{"start":{"line":66,"column":91},"end":{"line":66,"column":97}},{"start":{"line":66,"column":100},"end":{"line":66,"column":111}}],"line":66},"10":{"loc":{"start":{"line":66,"column":21},"end":{"line":66,"column":88}},"type":"binary-expr","locations":[{"start":{"line":66,"column":21},"end":{"line":66,"column":71}},{"start":{"line":66,"column":75},"end":{"line":66,"column":88}}],"line":66},"11":{"loc":{"start":{"line":91,"column":26},"end":{"line":91,"column":73}},"type":"binary-expr","locations":[{"start":{"line":91,"column":26},"end":{"line":91,"column":60}},{"start":{"line":91,"column":64},"end":{"line":91,"column":73}}],"line":91},"12":{"loc":{"start":{"line":92,"column":37},"end":{"line":92,"column":181}},"type":"cond-expr","locations":[{"start":{"line":92,"column":158},"end":{"line":92,"column":164}},{"start":{"line":92,"column":167},"end":{"line":92,"column":181}}],"line":92},"13":{"loc":{"start":{"line":92,"column":37},"end":{"line":92,"column":155}},"type":"binary-expr","locations":[{"start":{"line":92,"column":37},"end":{"line":92,"column":138}},{"start":{"line":92,"column":142},"end":{"line":92,"column":155}}],"line":92},"14":{"loc":{"start":{"line":92,"column":43},"end":{"line":92,"column":128}},"type":"cond-expr","locations":[{"start":{"line":92,"column":108},"end":{"line":92,"column":114}},{"start":{"line":92,"column":117},"end":{"line":92,"column":128}}],"line":92},"15":{"loc":{"start":{"line":92,"column":43},"end":{"line":92,"column":105}},"type":"binary-expr","locations":[{"start":{"line":92,"column":43},"end":{"line":92,"column":88}},{"start":{"line":92,"column":92},"end":{"line":92,"column":105}}],"line":92},"16":{"loc":{"start":{"line":93,"column":29},"end":{"line":93,"column":90}},"type":"cond-expr","locations":[{"start":{"line":93,"column":53},"end":{"line":93,"column":78}},{"start":{"line":93,"column":81},"end":{"line":93,"column":90}}],"line":93},"17":{"loc":{"start":{"line":117,"column":64},"end":{"line":117,"column":126}},"type":"cond-expr","locations":[{"start":{"line":117,"column":112},"end":{"line":117,"column":118}},{"start":{"line":117,"column":121},"end":{"line":117,"column":126}}],"line":117},"18":{"loc":{"start":{"line":117,"column":64},"end":{"line":117,"column":109}},"type":"binary-expr","locations":[{"start":{"line":117,"column":64},"end":{"line":117,"column":92}},{"start":{"line":117,"column":96},"end":{"line":117,"column":109}}],"line":117}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1746,"22":1746,"23":1746,"24":1746,"25":1746,"26":1746,"27":1746,"28":1,"29":251,"30":251,"31":1,"32":251,"33":251,"34":111,"35":111,"36":111,"37":111,"38":1},"f":{"0":1746,"1":251,"2":251,"3":251,"4":251,"5":111,"6":111},"b":{"0":[1746,1057],"1":[3,1743],"2":[1746,1746],"3":[2,1744],"4":[1746,213],"5":[211,2],"6":[213,213],"7":[184,29],"8":[213,29],"9":[0,213],"10":[213,213],"11":[1746,1550],"12":[1218,528],"13":[1746,528],"14":[0,1746],"15":[1746,1746],"16":[66,1680],"17":[0,111],"18":[111,111]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/state.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/state.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * the state manaer takes inputs from a variety of different sources and determines the current state of the application\n * based on those inputs. It then updates the gatewayStatus and flowParameters\n *\n * Inputs:\n *  UserFlowEvents: { start, abort }\n *  Config: { stage, walletAddress, gatekeeperNetwork, payer }\n *  CivicPass events (from iframe or potentially other sources in future): { fetchStatus: FetchStatus, event: CivicPassMessageResponse | null }\n *  GK-API Record events: { fetchStatus: FetchStatus, record: GatekeeperRecordResponse | null }\n *  On-Chain Token events: { fetchStatus: FetchStatus, token: GatewayToken | null }\n *\n * States:\n * initialisation: when data is being fetched from various sources: civicPass iframe, gk-api, on-chain\n *\n * -- Token does not exist states: nothing on-chain, nothing from gk-api, no validation in progress from civic-pass\n * tokenNotFound\n * issuanceValidationInProgress: the iframe indicates that the user has an existing flow they are completing\n * issuanceProofCollectionInProgress: user has initiated a proof collection flow: UserFlowEvents.start\n * issuanceProofCollectionComplete: the iframe has returned all the information needed for a gk-api request\n * issuanceProofCollectionError: an error occurred during the proof collection process\n *\n * -- Token exists states:\n * tokenActive\n * tokenExpired\n * tokenRevoked\n * refreshValidationInProgress: the iframe indicates that the user has an existing refresh flow they are completing\n * refreshProofCollectionInProgress: user has initiated a proof collection flow: UserFlowEvents.start\n * refreshProofCollectionComplete: the iframe has returned all the information needed for a gk-api request\n * refreshProofCollectionError: an error occurred during the proof collection process\n *\n * Outputs/Derived states:\n *  External gateway status\n *  Internal gateway status (more detailed subset of above)\n *  Flow parameters (params that can be passed to the iframe)\n */\nimport { createStore, Mutate, StateCreator, StoreApi } from 'zustand/vanilla';\nimport { immer } from 'zustand/middleware/immer';\nimport { DevtoolsOptions, subscribeWithSelector } from 'zustand/middleware';\nimport { devtools } from 'zustand/middleware';\nimport { computed, compute } from 'zustand-computed-state';\nimport { GatewayStatus } from '../types/gateway';\nimport { GatewayCoreState } from '../types/gatewayCore';\nimport { internalToOutputGatewayStatus } from './stateMapping';\nimport { flowStatusFromState } from '../utils/flow';\nimport { computeInternalStatus } from './gatewayStatus';\nimport { computeFlowParameters } from './flowParameters';\nimport { produce } from 'immer';\nimport { Draft } from 'immer';\nimport { getScopeRequestIdFromGatekeeperResponse } from '../utils/partnerReview';\nimport { computeUiState } from './ui';\nimport { UIOutput } from '../types/ui';\nimport { FlowStatus } from '../types/flow';\n\nexport type Store = Mutate<\n  StoreApi<GatewayCoreState>,\n  [['zustand/subscribeWithSelector', never], ['zustand/immer', never]]\n>;\n\nexport type WritableDraft<T> = {\n  -readonly [K in keyof T]: Draft<T[K]>;\n};\n\n// Define default states for internal and output states\nconst initialInternalState = {\n  status: GatewayStatus.UNKNOWN,\n  userInteraction: {\n    status: null,\n  },\n  errors: {},\n  ownerDids: [], // Dids will be queried using async chainImplementation.ownerDids() and updated here\n  chainDetails: undefined,\n};\n\nexport const initialOutputState = {\n  flowParameters: undefined,\n  flowState: {\n    status: undefined,\n    userInteraction: {\n      status: null,\n      count: 0,\n    },\n  },\n  gatewayStatus: GatewayStatus.UNKNOWN,\n  gatewayToken: undefined,\n  gatewayTokenTransaction: undefined,\n  pendingRequests: undefined,\n  ui: undefined,\n};\n\nexport const initialInputState = {\n  civicSign: { status: null, received: null },\n  civicPass: { status: null, received: null },\n  gatewayToken: { status: null, received: null },\n  gatekeeperRecord: { status: null, received: null },\n  parameters: null,\n  dynamicParameters: { forceRequireRefresh: false },\n  gatekeeperNetworkData: { status: null, received: null },\n};\n\nconst initialState = {\n  inputs: initialInputState,\n  internal: initialInternalState,\n  output: initialOutputState,\n};\n\n// the business logic of how all the different inputs create the gateway status and outputs can go here\nconst computeState = (state: GatewayCoreState): Partial<GatewayCoreState> => {\n  const computedInternalStatus = computeInternalStatus(state);\n  const flowParameters = computeFlowParameters(state, computedInternalStatus) || undefined;\n  const flowStatus = flowStatusFromState(state, computedInternalStatus);\n\n  const ui = {\n    ...state.output?.ui,\n    ...computeUiState(state, flowStatus, flowParameters),\n  };\n\n  // If the token active screen should not be shown we set the status to null so it can be detected when flow status is re-computed\n  // It will be reset when the user restarts a flow\n  const computedUserInteractionStatus =\n    [FlowStatus.RESULT, FlowStatus.FINISHED].includes(flowStatus as FlowStatus) &&\n    state.inputs.gatekeeperNetworkData?.received?.client?.tokenActiveDisplay === 'hidden'\n      ? null\n      : state.internal.userInteraction.status;\n\n  // Comes from either the 'pending' object on the gatekeeper response (partner-review case) or the top-level (accepted without partner-review)\n  const presentationRequestId = getScopeRequestIdFromGatekeeperResponse(state.inputs.gatekeeperRecord);\n  return {\n    internal: {\n      ...state.internal,\n      status: computedInternalStatus,\n      userInteraction: {\n        ...state.internal.userInteraction,\n        status: computedUserInteractionStatus,\n      },\n    },\n    output: {\n      ...state.output,\n      ui: ui as UIOutput,\n      flowParameters,\n      flowState: {\n        status: flowStatus,\n        userInteraction: {\n          ...state.internal.userInteraction,\n          status: computedUserInteractionStatus,\n        },\n      },\n      gatewayStatus: internalToOutputGatewayStatus(computedInternalStatus),\n      gatewayToken: state.inputs.gatewayToken.received || undefined,\n      gatewayTokenTransaction: state.inputs.gatekeeperRecord?.received?.transaction,\n      // Comes from either the 'pending' object on the gatekeeper response (partner-review case) or the top-level (accepted without partner-review)\n      pendingRequests: presentationRequestId ? { presentationRequestId } : undefined,\n    },\n  };\n};\n\n// Explicitly type the combined middleware\nconst combinedMiddleware = (options: DevtoolsOptions) => (config: StateCreator<GatewayCoreState>) =>\n  subscribeWithSelector(computed(immer(devtools(config, options)))) as StateCreator<\n    GatewayCoreState,\n    [['zustand/subscribeWithSelector', never], ['zustand/immer', never]],\n    [],\n    GatewayCoreState\n  >;\n// Define the store creator with a helper function to correctly chain the middlewares\nexport const createGatewayCoreStore = (options: DevtoolsOptions): WritableDraft<Store> =>\n  createStore<GatewayCoreState>(\n    combinedMiddleware(options)((set, get) => ({\n      ...initialState,\n      functions: {\n        reset: () =>\n          set(\n            produce((state) => {\n              // Don't clear input parameters across resets\n              state.inputs = {\n                ...initialInputState,\n                // don't override dynamic parameters\n                dynamicParameters: state.inputs.dynamicParameters,\n                parameters: state.inputs.parameters,\n              };\n              // Keep instanceId intact across resets as it's still the same store.\n              state.internal = {\n                ...initialInternalState,\n                userInteraction: {\n                  status: state.internal.userInteraction.status,\n                },\n                instanceId: state.internal.instanceId,\n                ownerDids: [], // Dids will be queried using async chainImplementation.ownerDids() and updated here\n                chainDetails: state.internal.chainDetails,\n              };\n              state.output = { ...initialOutputState, ui: state.output?.ui };\n            })\n          ),\n      },\n      ...compute(get, computeState),\n    }))\n  );\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c8c7fe592136dea1cb470a726c276eafc3896a9d"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/stateMapping.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/stateMapping.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":88}},"2":{"start":{"line":4,"column":20},"end":{"line":4,"column":49}},"3":{"start":{"line":5,"column":18},"end":{"line":5,"column":45}},"4":{"start":{"line":6,"column":0},"end":{"line":52,"column":2}},"5":{"start":{"line":53,"column":38},"end":{"line":116,"column":1}},"6":{"start":{"line":54,"column":4},"end":{"line":115,"column":5}},"7":{"start":{"line":56,"column":12},"end":{"line":56,"column":53}},"8":{"start":{"line":58,"column":12},"end":{"line":58,"column":53}},"9":{"start":{"line":60,"column":12},"end":{"line":60,"column":49}},"10":{"start":{"line":62,"column":12},"end":{"line":62,"column":49}},"11":{"start":{"line":64,"column":12},"end":{"line":64,"column":53}},"12":{"start":{"line":66,"column":12},"end":{"line":66,"column":53}},"13":{"start":{"line":68,"column":12},"end":{"line":68,"column":57}},"14":{"start":{"line":70,"column":12},"end":{"line":70,"column":66}},"15":{"start":{"line":72,"column":12},"end":{"line":72,"column":66}},"16":{"start":{"line":74,"column":12},"end":{"line":74,"column":66}},"17":{"start":{"line":76,"column":12},"end":{"line":76,"column":69}},"18":{"start":{"line":78,"column":12},"end":{"line":78,"column":49}},"19":{"start":{"line":80,"column":12},"end":{"line":80,"column":53}},"20":{"start":{"line":82,"column":12},"end":{"line":82,"column":53}},"21":{"start":{"line":84,"column":12},"end":{"line":84,"column":57}},"22":{"start":{"line":86,"column":12},"end":{"line":86,"column":53}},"23":{"start":{"line":88,"column":12},"end":{"line":88,"column":70}},"24":{"start":{"line":90,"column":12},"end":{"line":90,"column":53}},"25":{"start":{"line":92,"column":12},"end":{"line":92,"column":53}},"26":{"start":{"line":94,"column":12},"end":{"line":94,"column":53}},"27":{"start":{"line":96,"column":12},"end":{"line":96,"column":53}},"28":{"start":{"line":98,"column":12},"end":{"line":98,"column":53}},"29":{"start":{"line":100,"column":12},"end":{"line":100,"column":53}},"30":{"start":{"line":102,"column":12},"end":{"line":102,"column":70}},"31":{"start":{"line":104,"column":12},"end":{"line":104,"column":70}},"32":{"start":{"line":106,"column":12},"end":{"line":106,"column":53}},"33":{"start":{"line":108,"column":12},"end":{"line":108,"column":53}},"34":{"start":{"line":110,"column":12},"end":{"line":110,"column":53}},"35":{"start":{"line":112,"column":12},"end":{"line":112,"column":53}},"36":{"start":{"line":114,"column":12},"end":{"line":114,"column":34}},"37":{"start":{"line":117,"column":0},"end":{"line":117,"column":70}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":53,"column":38},"end":{"line":53,"column":39}},"loc":{"start":{"line":53,"column":58},"end":{"line":116,"column":1}},"line":53}},"branchMap":{"0":{"loc":{"start":{"line":54,"column":4},"end":{"line":115,"column":5}},"type":"switch","locations":[{"start":{"line":55,"column":8},"end":{"line":56,"column":53}},{"start":{"line":57,"column":8},"end":{"line":58,"column":53}},{"start":{"line":59,"column":8},"end":{"line":60,"column":49}},{"start":{"line":61,"column":8},"end":{"line":62,"column":49}},{"start":{"line":63,"column":8},"end":{"line":64,"column":53}},{"start":{"line":65,"column":8},"end":{"line":66,"column":53}},{"start":{"line":67,"column":8},"end":{"line":68,"column":57}},{"start":{"line":69,"column":8},"end":{"line":70,"column":66}},{"start":{"line":71,"column":8},"end":{"line":72,"column":66}},{"start":{"line":73,"column":8},"end":{"line":74,"column":66}},{"start":{"line":75,"column":8},"end":{"line":76,"column":69}},{"start":{"line":77,"column":8},"end":{"line":78,"column":49}},{"start":{"line":79,"column":8},"end":{"line":80,"column":53}},{"start":{"line":81,"column":8},"end":{"line":82,"column":53}},{"start":{"line":83,"column":8},"end":{"line":84,"column":57}},{"start":{"line":85,"column":8},"end":{"line":86,"column":53}},{"start":{"line":87,"column":8},"end":{"line":88,"column":70}},{"start":{"line":89,"column":8},"end":{"line":90,"column":53}},{"start":{"line":91,"column":8},"end":{"line":92,"column":53}},{"start":{"line":93,"column":8},"end":{"line":94,"column":53}},{"start":{"line":95,"column":8},"end":{"line":96,"column":53}},{"start":{"line":97,"column":8},"end":{"line":98,"column":53}},{"start":{"line":99,"column":8},"end":{"line":100,"column":53}},{"start":{"line":101,"column":8},"end":{"line":102,"column":70}},{"start":{"line":103,"column":8},"end":{"line":104,"column":70}},{"start":{"line":105,"column":8},"end":{"line":106,"column":53}},{"start":{"line":107,"column":8},"end":{"line":108,"column":53}},{"start":{"line":109,"column":8},"end":{"line":110,"column":53}},{"start":{"line":111,"column":8},"end":{"line":112,"column":53}},{"start":{"line":113,"column":8},"end":{"line":114,"column":34}}],"line":54}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1767,"7":1,"8":1,"9":2,"10":13,"11":6,"12":1,"13":4,"14":2,"15":8,"16":1,"17":3,"18":1,"19":30,"20":15,"21":1,"22":23,"23":11,"24":16,"25":4,"26":27,"27":11,"28":1,"29":1,"30":3,"31":3,"32":6,"33":0,"34":6,"35":0,"36":1566,"37":1},"f":{"0":1767},"b":{"0":[1,1,2,13,6,1,4,2,8,1,3,1,30,15,1,23,11,16,4,27,11,1,1,3,3,6,0,6,0,1566]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/stateMapping.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/stateMapping.ts"],"names":[],"mappings":";;;AAAA,kDAA4D;AAC5D,8CAA+F;AAElF,QAAA,8BAA8B,GAA0D;IACnG,CAAC,uBAAa,CAAC,SAAS,CAAC,EAAE,kCAAsB,CAAC,eAAe;IACjE,CAAC,uBAAa,CAAC,KAAK,CAAC,EAAE,kCAAsB,CAAC,KAAK;IACnD,CAAC,uBAAa,CAAC,MAAM,CAAC,EAAE,kCAAsB,CAAC,YAAY;IAC3D,CAAC,uBAAa,CAAC,OAAO,CAAC,EAAE,kCAAsB,CAAC,aAAa;IAC7D,CAAC,uBAAa,CAAC,MAAM,CAAC,EAAE,kCAAsB,CAAC,YAAY;IAC3D,CAAC,uBAAa,CAAC,QAAQ,CAAC,EAAE,kCAAsB,CAAC,cAAc;IAK/D,CAAC,uBAAa,CAAC,sBAAsB,CAAC,EAAE,kCAAsB,CAAC,cAAc;IAC7E,CAAC,uBAAa,CAAC,iBAAiB,CAAC,EAAE,kCAAsB,CAAC,cAAc;IACxE,CAAC,uBAAa,CAAC,sBAAsB,CAAC,EAAE,kCAAsB,CAAC,OAAO;IACtE,CAAC,uBAAa,CAAC,QAAQ,CAAC,EAAE,kCAAsB,CAAC,MAAM;IACvD,CAAC,uBAAa,CAAC,OAAO,CAAC,EAAE,kCAAsB,CAAC,QAAQ;IACxD,CAAC,uBAAa,CAAC,aAAa,CAAC,EAAE,kCAAsB,CAAC,QAAQ;IAC9D,CAAC,uBAAa,CAAC,2BAA2B,CAAC,EAAE,kCAAsB,CAAC,QAAQ;IAC5E,CAAC,uBAAa,CAAC,2BAA2B,CAAC,EAAE,kCAAsB,CAAC,QAAQ;IAC5E,CAAC,uBAAa,CAAC,0BAA0B,CAAC,EAAE,kCAAsB,CAAC,QAAQ;IAC3E,CAAC,uBAAa,CAAC,yBAAyB,CAAC,EAAE,kCAAsB,CAAC,QAAQ;IAC1E,CAAC,+BAAqB,CAAC,sBAAsB,CAAC,EAAE,kCAAsB,CAAC,QAAQ;IAC/E,CAAC,+BAAqB,CAAC,gCAAgC,CAAC,EAAE,kCAAsB,CAAC,QAAQ;IACzF,CAAC,+BAAqB,CAAC,kCAAkC,CAAC,EAAE,kCAAsB,CAAC,gBAAgB;IACnG,CAAC,+BAAqB,CAAC,8CAA8C,CAAC,EAAE,kCAAsB,CAAC,eAAe;IAC9G,CAAC,+BAAqB,CAAC,+BAA+B,CAAC,EAAE,kCAAsB,CAAC,gBAAgB;IAChG,CAAC,+BAAqB,CAAC,gCAAgC,CAAC,EAAE,kCAAsB,CAAC,iCAAiC;IAClH,CAAC,+BAAqB,CAAC,yBAAyB,CAAC,EAAE,kCAAsB,CAAC,gBAAgB;IAC1F,CAAC,+BAAqB,CAAC,0BAA0B,CAAC,EAAE,kCAAsB,CAAC,iCAAiC;IAC5G,CAAC,+BAAqB,CAAC,mBAAmB,CAAC,EAAE,kCAAsB,CAAC,WAAW;IAC/E,CAAC,+BAAqB,CAAC,uBAAuB,CAAC,EAAE,kCAAsB,CAAC,WAAW;IACnF,CAAC,+BAAqB,CAAC,wBAAwB,CAAC,EAAE,kCAAsB,CAAC,WAAW;IACpF,CAAC,+BAAqB,CAAC,uBAAuB,CAAC,EAAE,kCAAsB,CAAC,uBAAuB;IAC/F,CAAC,+BAAqB,CAAC,uBAAuB,CAAC,EAAE,kCAAsB,CAAC,uBAAuB;IAC/F,CAAC,+BAAqB,CAAC,iCAAiC,CAAC,EAAE,kCAAsB,CAAC,gBAAgB;IAClG,CAAC,+BAAqB,CAAC,8BAA8B,CAAC,EAAE,kCAAsB,CAAC,gBAAgB;IAC/F,CAAC,+BAAqB,CAAC,+BAA+B,CAAC,EAAE,kCAAsB,CAAC,iCAAiC;IACjH,CAAC,+BAAqB,CAAC,kCAAkC,CAAC,EAAE,kCAAsB,CAAC,OAAO;IAC1F,CAAC,+BAAqB,CAAC,OAAO,CAAC,EAAE,kCAAsB,CAAC,QAAQ;IAChE,CAAC,+BAAqB,CAAC,iBAAiB,CAAC,EAAE,kCAAsB,CAAC,OAAO;IACzE,CAAC,+BAAqB,CAAC,eAAe,CAAC,EAAE,kCAAsB,CAAC,OAAO;IACvE,CAAC,+BAAqB,CAAC,6CAA6C,CAAC,EAAE,kCAAsB,CAAC,uBAAuB;IACrH,CAAC,+BAAqB,CAAC,kCAAkC,CAAC,EAAE,kCAAsB,CAAC,8BAA8B;IACjH,CAAC,+BAAqB,CAAC,iCAAiC,CAAC,EAAE,kCAAsB,CAAC,8BAA8B;IAChH,CAAC,+BAAqB,CAAC,oCAAoC,CAAC,EAAE,kCAAsB,CAAC,gBAAgB;IACrG,CAAC,+BAAqB,CAAC,mCAAmC,CAAC,EAAE,kCAAsB,CAAC,gBAAgB;IACpG,CAAC,+BAAqB,CAAC,gDAAgD,CAAC,EAAE,kCAAsB,CAAC,eAAe;IAChH,CAAC,+BAAqB,CAAC,+CAA+C,CAAC,EACrE,kCAAsB,CAAC,uBAAuB;IAChD,CAAC,+BAAqB,CAAC,0BAA0B,CAAC,EAAE,kCAAsB,CAAC,kBAAkB;IAC7F,CAAC,+BAAqB,CAAC,gCAAgC,CAAC,EAAE,kCAAsB,CAAC,OAAO;CACzF,CAAC;AAGK,MAAM,6BAA6B,GAAG,CAAC,cAAqC,EAAiB,EAAE;IACpG,QAAQ,cAAc,EAAE,CAAC;QAEvB,KAAK,+BAAqB,CAAC,0BAA0B;YACnD,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,yBAAyB;YAClD,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,mBAAmB;YAC5C,OAAO,uBAAa,CAAC,KAAK,CAAC;QAC7B,KAAK,+BAAqB,CAAC,uBAAuB;YAChD,OAAO,uBAAa,CAAC,KAAK,CAAC;QAC7B,KAAK,+BAAqB,CAAC,uBAAuB;YAChD,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,uBAAuB;YAChD,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,OAAO;YAChC,OAAO,uBAAa,CAAC,aAAa,CAAC;QACrC,KAAK,+BAAqB,CAAC,0BAA0B;YACnD,OAAO,uBAAa,CAAC,sBAAsB,CAAC;QAC9C,KAAK,+BAAqB,CAAC,gCAAgC;YACzD,OAAO,uBAAa,CAAC,sBAAsB,CAAC;QAC9C,KAAK,+BAAqB,CAAC,eAAe;YACxC,OAAO,uBAAa,CAAC,sBAAsB,CAAC;QAC9C,KAAK,+BAAqB,CAAC,sBAAsB;YAC/C,OAAO,uBAAa,CAAC,yBAAyB,CAAC;QACjD,KAAK,+BAAqB,CAAC,wBAAwB;YACjD,OAAO,uBAAa,CAAC,KAAK,CAAC;QAC7B,KAAK,+BAAqB,CAAC,kCAAkC;YAC3D,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,gCAAgC;YACzD,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,gCAAgC;YACzD,OAAO,uBAAa,CAAC,aAAa,CAAC;QACrC,KAAK,+BAAqB,CAAC,+BAA+B;YACxD,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,kCAAkC;YAC3D,OAAO,uBAAa,CAAC,0BAA0B,CAAC;QAClD,KAAK,+BAAqB,CAAC,8BAA8B;YACvD,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,iBAAiB;YAC1C,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,iCAAiC;YAC1D,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,+BAA+B;YACxD,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,8CAA8C;YACvE,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,6CAA6C;YACtE,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,kCAAkC;YAC3D,OAAO,uBAAa,CAAC,0BAA0B,CAAC;QAClD,KAAK,+BAAqB,CAAC,iCAAiC;YAC1D,OAAO,uBAAa,CAAC,0BAA0B,CAAC;QAClD,KAAK,+BAAqB,CAAC,oCAAoC;YAC7D,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,gDAAgD;YACzE,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,mCAAmC;YAC5D,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC,KAAK,+BAAqB,CAAC,+CAA+C;YACxE,OAAO,uBAAa,CAAC,SAAS,CAAC;QACjC;YAEE,OAAO,cAAc,CAAC;IAC1B,CAAC;AACH,CAAC,CAAC;AAjEW,QAAA,6BAA6B,iCAiExC","sourcesContent":["import { CivicPassMessageAction } from '../types/civicPass';\nimport { ExtendedGatewayStatus, GatewayStatus, InternalGatewayStatus } from '../types/gateway';\n\nexport const gatewayStatusToCivicPassAction: Record<InternalGatewayStatus, CivicPassMessageAction> = {\n  [GatewayStatus.IN_REVIEW]: CivicPassMessageAction.TOKEN_IN_REVIEW,\n  [GatewayStatus.ERROR]: CivicPassMessageAction.ERROR,\n  [GatewayStatus.ACTIVE]: CivicPassMessageAction.TOKEN_ACTIVE,\n  [GatewayStatus.REVOKED]: CivicPassMessageAction.TOKEN_REVOKED,\n  [GatewayStatus.FROZEN]: CivicPassMessageAction.TOKEN_FROZEN,\n  [GatewayStatus.REJECTED]: CivicPassMessageAction.TOKEN_REJECTED,\n  // The Gatekeeper now returns errorCodes for all different kinds of IP errors,\n  // and the iframe's tokenRejected route has mappings for all of them.\n  // No need to use specific iframe routes for VPN Detected / Country Restricted anymore.\n  // However we still keep separate GatewayStatuses for them (HTTP status codes) to support legacy clients.\n  [GatewayStatus.LOCATION_NOT_SUPPORTED]: CivicPassMessageAction.TOKEN_REJECTED,\n  [GatewayStatus.VPN_NOT_SUPPORTED]: CivicPassMessageAction.TOKEN_REJECTED,\n  [GatewayStatus.REFRESH_TOKEN_REQUIRED]: CivicPassMessageAction.REFRESH,\n  [GatewayStatus.CHECKING]: CivicPassMessageAction.STATUS,\n  [GatewayStatus.UNKNOWN]: CivicPassMessageAction.ISSUANCE,\n  [GatewayStatus.NOT_REQUESTED]: CivicPassMessageAction.ISSUANCE,\n  [GatewayStatus.COLLECTING_USER_INFORMATION]: CivicPassMessageAction.ISSUANCE,\n  [GatewayStatus.VALIDATING_USER_INFORMATION]: CivicPassMessageAction.ISSUANCE,\n  [GatewayStatus.USER_INFORMATION_VALIDATED]: CivicPassMessageAction.ISSUANCE,\n  [GatewayStatus.USER_INFORMATION_REJECTED]: CivicPassMessageAction.ISSUANCE,\n  [ExtendedGatewayStatus.USER_VALIDATION_FAILED]: CivicPassMessageAction.ISSUANCE,\n  [ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION]: CivicPassMessageAction.ISSUANCE,\n  [ExtendedGatewayStatus.ISSUANCE_AWAITING_TRANSACTION_SEND]: CivicPassMessageAction.SIGN_TRANSACTION,\n  [ExtendedGatewayStatus.ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND]: CivicPassMessageAction.TOKEN_IN_REVIEW,\n  [ExtendedGatewayStatus.ISSUANCE_CLIENT_PAYER_REQUESTED]: CivicPassMessageAction.SIGN_TRANSACTION,\n  [ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN]: CivicPassMessageAction.AWAITING_TRANSACTION_CONFIRMATION,\n  [ExtendedGatewayStatus.CONFIRM_OWNER_TRANSACTION]: CivicPassMessageAction.SIGN_TRANSACTION,\n  [ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION]: CivicPassMessageAction.AWAITING_TRANSACTION_CONFIRMATION,\n  [ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR]: CivicPassMessageAction.CHAIN_ERROR,\n  [ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR]: CivicPassMessageAction.CHAIN_ERROR,\n  [ExtendedGatewayStatus.CHAIN_SIGN_MESSAGE_ERROR]: CivicPassMessageAction.CHAIN_ERROR,\n  [ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW]: CivicPassMessageAction.TOKEN_IN_PARTNER_REVIEW,\n  [ExtendedGatewayStatus.TOKEN_REFRESH_IN_REVIEW]: CivicPassMessageAction.TOKEN_REFRESH_IN_REVIEW,\n  [ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND]: CivicPassMessageAction.SIGN_TRANSACTION,\n  [ExtendedGatewayStatus.REFRESH_CLIENT_PAYER_REQUESTED]: CivicPassMessageAction.SIGN_TRANSACTION,\n  [ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN]: CivicPassMessageAction.AWAITING_TRANSACTION_CONFIRMATION,\n  [ExtendedGatewayStatus.REFRESH_USER_INFORMATION_VALIDATED]: CivicPassMessageAction.REFRESH,\n  [ExtendedGatewayStatus.RESTART]: CivicPassMessageAction.ISSUANCE,\n  [ExtendedGatewayStatus.REFRESH_IN_REVIEW]: CivicPassMessageAction.REFRESH,\n  [ExtendedGatewayStatus.RESTART_REFRESH]: CivicPassMessageAction.REFRESH,\n  [ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND]: CivicPassMessageAction.TOKEN_REFRESH_IN_REVIEW,\n  [ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_START_NEW_TX]: CivicPassMessageAction.START_PRE_APPROVED_TRANSACTION,\n  [ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_START_NEW_TX]: CivicPassMessageAction.START_PRE_APPROVED_TRANSACTION,\n  [ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX]: CivicPassMessageAction.SIGN_TRANSACTION,\n  [ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX]: CivicPassMessageAction.SIGN_TRANSACTION,\n  [ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX]: CivicPassMessageAction.TOKEN_IN_REVIEW,\n  [ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX]:\n    CivicPassMessageAction.TOKEN_REFRESH_IN_REVIEW,\n  [ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED]: CivicPassMessageAction.CREDENTIAL_EXPIRED,\n  [ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED_START]: CivicPassMessageAction.REFRESH,\n};\n\n/** Map InternalGatewayStatuses that also contain non public API ExtendedGatewayStatuses to GatewayStatuses */\nexport const internalToOutputGatewayStatus = (internalStatus: InternalGatewayStatus): GatewayStatus => {\n  switch (internalStatus) {\n    // Map extended statuses to GatewayStatus\n    case ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.CONFIRM_OWNER_TRANSACTION:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR:\n      return GatewayStatus.ERROR;\n    case ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR:\n      return GatewayStatus.ERROR;\n    case ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.TOKEN_REFRESH_IN_REVIEW:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.RESTART:\n      return GatewayStatus.NOT_REQUESTED;\n    case ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED:\n      return GatewayStatus.REFRESH_TOKEN_REQUIRED;\n    case ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED_START:\n      return GatewayStatus.REFRESH_TOKEN_REQUIRED;\n    case ExtendedGatewayStatus.RESTART_REFRESH:\n      return GatewayStatus.REFRESH_TOKEN_REQUIRED;\n    case ExtendedGatewayStatus.USER_VALIDATION_FAILED:\n      return GatewayStatus.USER_INFORMATION_REJECTED;\n    case ExtendedGatewayStatus.CHAIN_SIGN_MESSAGE_ERROR:\n      return GatewayStatus.ERROR;\n    case ExtendedGatewayStatus.ISSUANCE_AWAITING_TRANSACTION_SEND:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION:\n      return GatewayStatus.NOT_REQUESTED;\n    case ExtendedGatewayStatus.ISSUANCE_CLIENT_PAYER_REQUESTED:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.REFRESH_USER_INFORMATION_VALIDATED:\n      return GatewayStatus.USER_INFORMATION_VALIDATED;\n    case ExtendedGatewayStatus.REFRESH_CLIENT_PAYER_REQUESTED:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.REFRESH_IN_REVIEW:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_START_NEW_TX:\n      return GatewayStatus.USER_INFORMATION_VALIDATED;\n    case ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_START_NEW_TX:\n      return GatewayStatus.USER_INFORMATION_VALIDATED;\n    case ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX:\n      return GatewayStatus.IN_REVIEW;\n    case ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX:\n      return GatewayStatus.IN_REVIEW;\n    default:\n      // otherwise return GatewayStatus\n      return internalStatus;\n  }\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7d0e0982fdb401df754ea54885597e3616b012f5"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/flow.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/flow.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":184}},"2":{"start":{"line":4,"column":15},"end":{"line":4,"column":39}},"3":{"start":{"line":5,"column":15},"end":{"line":5,"column":30}},"4":{"start":{"line":6,"column":18},"end":{"line":6,"column":45}},"5":{"start":{"line":7,"column":26},"end":{"line":7,"column":61}},"6":{"start":{"line":8,"column":17},"end":{"line":8,"column":36}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":39}},"8":{"start":{"line":10,"column":26},"end":{"line":38,"column":1}},"9":{"start":{"line":12,"column":4},"end":{"line":33,"column":5}},"10":{"start":{"line":13,"column":37},"end":{"line":17,"column":10}},"11":{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},"12":{"start":{"line":19,"column":12},"end":{"line":19,"column":62}},"13":{"start":{"line":21,"column":8},"end":{"line":25,"column":9}},"14":{"start":{"line":24,"column":12},"end":{"line":24,"column":43}},"15":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"16":{"start":{"line":27,"column":12},"end":{"line":27,"column":43}},"17":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"18":{"start":{"line":30,"column":12},"end":{"line":30,"column":44}},"19":{"start":{"line":32,"column":8},"end":{"line":32,"column":38}},"20":{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},"21":{"start":{"line":35,"column":8},"end":{"line":35,"column":38}},"22":{"start":{"line":37,"column":4},"end":{"line":37,"column":36}},"23":{"start":{"line":39,"column":0},"end":{"line":39,"column":46}},"24":{"start":{"line":40,"column":18},"end":{"line":48,"column":1}},"25":{"start":{"line":42,"column":27},"end":{"line":42,"column":155}},"26":{"start":{"line":43,"column":21},"end":{"line":43,"column":82}},"27":{"start":{"line":44,"column":19},"end":{"line":44,"column":33}},"28":{"start":{"line":45,"column":4},"end":{"line":47,"column":25}},"29":{"start":{"line":49,"column":0},"end":{"line":49,"column":30}},"30":{"start":{"line":50,"column":0},"end":{"line":55,"column":2}},"31":{"start":{"line":56,"column":0},"end":{"line":62,"column":2}},"32":{"start":{"line":63,"column":28},"end":{"line":94,"column":1}},"33":{"start":{"line":65,"column":4},"end":{"line":67,"column":5}},"34":{"start":{"line":66,"column":8},"end":{"line":66,"column":25}},"35":{"start":{"line":68,"column":27},"end":{"line":68,"column":48}},"36":{"start":{"line":69,"column":4},"end":{"line":78,"column":5}},"37":{"start":{"line":74,"column":8},"end":{"line":76,"column":9}},"38":{"start":{"line":75,"column":12},"end":{"line":75,"column":46}},"39":{"start":{"line":77,"column":8},"end":{"line":77,"column":40}},"40":{"start":{"line":79,"column":4},"end":{"line":81,"column":5}},"41":{"start":{"line":80,"column":8},"end":{"line":80,"column":42}},"42":{"start":{"line":82,"column":4},"end":{"line":86,"column":5}},"43":{"start":{"line":85,"column":8},"end":{"line":85,"column":42}},"44":{"start":{"line":87,"column":4},"end":{"line":89,"column":5}},"45":{"start":{"line":88,"column":8},"end":{"line":88,"column":42}},"46":{"start":{"line":90,"column":4},"end":{"line":92,"column":5}},"47":{"start":{"line":91,"column":8},"end":{"line":91,"column":45}},"48":{"start":{"line":93,"column":4},"end":{"line":93,"column":135}},"49":{"start":{"line":95,"column":0},"end":{"line":95,"column":50}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":10,"column":26},"end":{"line":10,"column":27}},"loc":{"start":{"line":10,"column":61},"end":{"line":38,"column":1}},"line":10},"1":{"name":"(anonymous_1)","decl":{"start":{"line":40,"column":18},"end":{"line":40,"column":19}},"loc":{"start":{"line":40,"column":53},"end":{"line":48,"column":1}},"line":40},"2":{"name":"(anonymous_2)","decl":{"start":{"line":63,"column":28},"end":{"line":63,"column":29}},"loc":{"start":{"line":63,"column":63},"end":{"line":94,"column":1}},"line":63}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":4},"end":{"line":33,"column":5}},"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":33,"column":5}},{"start":{"line":12,"column":4},"end":{"line":33,"column":5}}],"line":12},"1":{"loc":{"start":{"line":12,"column":8},"end":{"line":12,"column":89}},"type":"cond-expr","locations":[{"start":{"line":12,"column":69},"end":{"line":12,"column":75}},{"start":{"line":12,"column":78},"end":{"line":12,"column":89}}],"line":12},"2":{"loc":{"start":{"line":12,"column":8},"end":{"line":12,"column":66}},"type":"binary-expr","locations":[{"start":{"line":12,"column":8},"end":{"line":12,"column":49}},{"start":{"line":12,"column":53},"end":{"line":12,"column":66}}],"line":12},"3":{"loc":{"start":{"line":14,"column":26},"end":{"line":14,"column":107}},"type":"cond-expr","locations":[{"start":{"line":14,"column":87},"end":{"line":14,"column":93}},{"start":{"line":14,"column":96},"end":{"line":14,"column":107}}],"line":14},"4":{"loc":{"start":{"line":14,"column":26},"end":{"line":14,"column":84}},"type":"binary-expr","locations":[{"start":{"line":14,"column":26},"end":{"line":14,"column":67}},{"start":{"line":14,"column":71},"end":{"line":14,"column":84}}],"line":14},"5":{"loc":{"start":{"line":16,"column":33},"end":{"line":16,"column":177}},"type":"cond-expr","locations":[{"start":{"line":16,"column":146},"end":{"line":16,"column":152}},{"start":{"line":16,"column":155},"end":{"line":16,"column":177}}],"line":16},"6":{"loc":{"start":{"line":16,"column":33},"end":{"line":16,"column":143}},"type":"binary-expr","locations":[{"start":{"line":16,"column":33},"end":{"line":16,"column":126}},{"start":{"line":16,"column":130},"end":{"line":16,"column":143}}],"line":16},"7":{"loc":{"start":{"line":16,"column":39},"end":{"line":16,"column":116}},"type":"cond-expr","locations":[{"start":{"line":16,"column":87},"end":{"line":16,"column":93}},{"start":{"line":16,"column":96},"end":{"line":16,"column":116}}],"line":16},"8":{"loc":{"start":{"line":16,"column":39},"end":{"line":16,"column":84}},"type":"binary-expr","locations":[{"start":{"line":16,"column":39},"end":{"line":16,"column":67}},{"start":{"line":16,"column":71},"end":{"line":16,"column":84}}],"line":16},"9":{"loc":{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},"type":"if","locations":[{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},{"start":{"line":18,"column":8},"end":{"line":20,"column":9}}],"line":18},"10":{"loc":{"start":{"line":18,"column":12},"end":{"line":18,"column":133}},"type":"binary-expr","locations":[{"start":{"line":18,"column":12},"end":{"line":18,"column":32}},{"start":{"line":18,"column":37},"end":{"line":18,"column":132}}],"line":18},"11":{"loc":{"start":{"line":18,"column":37},"end":{"line":18,"column":132}},"type":"cond-expr","locations":[{"start":{"line":18,"column":103},"end":{"line":18,"column":109}},{"start":{"line":18,"column":112},"end":{"line":18,"column":132}}],"line":18},"12":{"loc":{"start":{"line":18,"column":37},"end":{"line":18,"column":100}},"type":"binary-expr","locations":[{"start":{"line":18,"column":37},"end":{"line":18,"column":83}},{"start":{"line":18,"column":87},"end":{"line":18,"column":100}}],"line":18},"13":{"loc":{"start":{"line":21,"column":8},"end":{"line":25,"column":9}},"type":"if","locations":[{"start":{"line":21,"column":8},"end":{"line":25,"column":9}},{"start":{"line":21,"column":8},"end":{"line":25,"column":9}}],"line":21},"14":{"loc":{"start":{"line":21,"column":12},"end":{"line":23,"column":68}},"type":"binary-expr","locations":[{"start":{"line":21,"column":12},"end":{"line":21,"column":32}},{"start":{"line":22,"column":13},"end":{"line":22,"column":115}},{"start":{"line":23,"column":12},"end":{"line":23,"column":68}}],"line":21},"15":{"loc":{"start":{"line":22,"column":13},"end":{"line":22,"column":115}},"type":"cond-expr","locations":[{"start":{"line":22,"column":70},"end":{"line":22,"column":76}},{"start":{"line":22,"column":79},"end":{"line":22,"column":115}}],"line":22},"16":{"loc":{"start":{"line":22,"column":13},"end":{"line":22,"column":67}},"type":"binary-expr","locations":[{"start":{"line":22,"column":13},"end":{"line":22,"column":50}},{"start":{"line":22,"column":54},"end":{"line":22,"column":67}}],"line":22},"17":{"loc":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},{"start":{"line":26,"column":8},"end":{"line":28,"column":9}}],"line":26},"18":{"loc":{"start":{"line":26,"column":12},"end":{"line":26,"column":202}},"type":"cond-expr","locations":[{"start":{"line":26,"column":122},"end":{"line":26,"column":128}},{"start":{"line":26,"column":131},"end":{"line":26,"column":202}}],"line":26},"19":{"loc":{"start":{"line":26,"column":12},"end":{"line":26,"column":119}},"type":"binary-expr","locations":[{"start":{"line":26,"column":12},"end":{"line":26,"column":102}},{"start":{"line":26,"column":106},"end":{"line":26,"column":119}}],"line":26},"20":{"loc":{"start":{"line":26,"column":18},"end":{"line":26,"column":92}},"type":"cond-expr","locations":[{"start":{"line":26,"column":66},"end":{"line":26,"column":72}},{"start":{"line":26,"column":75},"end":{"line":26,"column":92}}],"line":26},"21":{"loc":{"start":{"line":26,"column":18},"end":{"line":26,"column":63}},"type":"binary-expr","locations":[{"start":{"line":26,"column":18},"end":{"line":26,"column":46}},{"start":{"line":26,"column":50},"end":{"line":26,"column":63}}],"line":26},"22":{"loc":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},{"start":{"line":29,"column":8},"end":{"line":31,"column":9}}],"line":29},"23":{"loc":{"start":{"line":29,"column":12},"end":{"line":29,"column":203}},"type":"cond-expr","locations":[{"start":{"line":29,"column":122},"end":{"line":29,"column":128}},{"start":{"line":29,"column":131},"end":{"line":29,"column":203}}],"line":29},"24":{"loc":{"start":{"line":29,"column":12},"end":{"line":29,"column":119}},"type":"binary-expr","locations":[{"start":{"line":29,"column":12},"end":{"line":29,"column":102}},{"start":{"line":29,"column":106},"end":{"line":29,"column":119}}],"line":29},"25":{"loc":{"start":{"line":29,"column":18},"end":{"line":29,"column":92}},"type":"cond-expr","locations":[{"start":{"line":29,"column":66},"end":{"line":29,"column":72}},{"start":{"line":29,"column":75},"end":{"line":29,"column":92}}],"line":29},"26":{"loc":{"start":{"line":29,"column":18},"end":{"line":29,"column":63}},"type":"binary-expr","locations":[{"start":{"line":29,"column":18},"end":{"line":29,"column":46}},{"start":{"line":29,"column":50},"end":{"line":29,"column":63}}],"line":29},"27":{"loc":{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},"type":"if","locations":[{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},{"start":{"line":34,"column":4},"end":{"line":36,"column":5}}],"line":34},"28":{"loc":{"start":{"line":42,"column":27},"end":{"line":42,"column":155}},"type":"cond-expr","locations":[{"start":{"line":42,"column":137},"end":{"line":42,"column":143}},{"start":{"line":42,"column":146},"end":{"line":42,"column":155}}],"line":42},"29":{"loc":{"start":{"line":42,"column":27},"end":{"line":42,"column":134}},"type":"binary-expr","locations":[{"start":{"line":42,"column":27},"end":{"line":42,"column":117}},{"start":{"line":42,"column":121},"end":{"line":42,"column":134}}],"line":42},"30":{"loc":{"start":{"line":42,"column":33},"end":{"line":42,"column":107}},"type":"cond-expr","locations":[{"start":{"line":42,"column":81},"end":{"line":42,"column":87}},{"start":{"line":42,"column":90},"end":{"line":42,"column":107}}],"line":42},"31":{"loc":{"start":{"line":42,"column":33},"end":{"line":42,"column":78}},"type":"binary-expr","locations":[{"start":{"line":42,"column":33},"end":{"line":42,"column":61}},{"start":{"line":42,"column":65},"end":{"line":42,"column":78}}],"line":42},"32":{"loc":{"start":{"line":45,"column":11},"end":{"line":47,"column":24}},"type":"cond-expr","locations":[{"start":{"line":46,"column":10},"end":{"line":46,"column":163}},{"start":{"line":47,"column":10},"end":{"line":47,"column":24}}],"line":45},"33":{"loc":{"start":{"line":45,"column":11},"end":{"line":45,"column":87}},"type":"binary-expr","locations":[{"start":{"line":45,"column":11},"end":{"line":45,"column":26}},{"start":{"line":45,"column":30},"end":{"line":45,"column":51}},{"start":{"line":45,"column":55},"end":{"line":45,"column":87}}],"line":45},"34":{"loc":{"start":{"line":46,"column":13},"end":{"line":46,"column":132}},"type":"binary-expr","locations":[{"start":{"line":46,"column":14},"end":{"line":46,"column":97}},{"start":{"line":46,"column":102},"end":{"line":46,"column":132}}],"line":46},"35":{"loc":{"start":{"line":46,"column":14},"end":{"line":46,"column":97}},"type":"cond-expr","locations":[{"start":{"line":46,"column":73},"end":{"line":46,"column":79}},{"start":{"line":46,"column":82},"end":{"line":46,"column":97}}],"line":46},"36":{"loc":{"start":{"line":46,"column":14},"end":{"line":46,"column":70}},"type":"binary-expr","locations":[{"start":{"line":46,"column":14},"end":{"line":46,"column":53}},{"start":{"line":46,"column":57},"end":{"line":46,"column":70}}],"line":46},"37":{"loc":{"start":{"line":65,"column":4},"end":{"line":67,"column":5}},"type":"if","locations":[{"start":{"line":65,"column":4},"end":{"line":67,"column":5}},{"start":{"line":65,"column":4},"end":{"line":67,"column":5}}],"line":65},"38":{"loc":{"start":{"line":65,"column":10},"end":{"line":65,"column":87}},"type":"cond-expr","locations":[{"start":{"line":65,"column":60},"end":{"line":65,"column":66}},{"start":{"line":65,"column":69},"end":{"line":65,"column":87}}],"line":65},"39":{"loc":{"start":{"line":65,"column":10},"end":{"line":65,"column":57}},"type":"binary-expr","locations":[{"start":{"line":65,"column":10},"end":{"line":65,"column":40}},{"start":{"line":65,"column":44},"end":{"line":65,"column":57}}],"line":65},"40":{"loc":{"start":{"line":69,"column":4},"end":{"line":78,"column":5}},"type":"if","locations":[{"start":{"line":69,"column":4},"end":{"line":78,"column":5}},{"start":{"line":69,"column":4},"end":{"line":78,"column":5}}],"line":69},"41":{"loc":{"start":{"line":69,"column":8},"end":{"line":73,"column":209}},"type":"binary-expr","locations":[{"start":{"line":69,"column":9},"end":{"line":69,"column":60}},{"start":{"line":69,"column":64},"end":{"line":69,"column":130}},{"start":{"line":70,"column":9},"end":{"line":70,"column":60}},{"start":{"line":71,"column":12},"end":{"line":71,"column":72}},{"start":{"line":72,"column":12},"end":{"line":72,"column":65}},{"start":{"line":73,"column":9},"end":{"line":73,"column":58}},{"start":{"line":73,"column":63},"end":{"line":73,"column":207}}],"line":69},"42":{"loc":{"start":{"line":73,"column":63},"end":{"line":73,"column":207}},"type":"cond-expr","locations":[{"start":{"line":73,"column":176},"end":{"line":73,"column":182}},{"start":{"line":73,"column":185},"end":{"line":73,"column":207}}],"line":73},"43":{"loc":{"start":{"line":73,"column":63},"end":{"line":73,"column":173}},"type":"binary-expr","locations":[{"start":{"line":73,"column":63},"end":{"line":73,"column":156}},{"start":{"line":73,"column":160},"end":{"line":73,"column":173}}],"line":73},"44":{"loc":{"start":{"line":73,"column":69},"end":{"line":73,"column":146}},"type":"cond-expr","locations":[{"start":{"line":73,"column":117},"end":{"line":73,"column":123}},{"start":{"line":73,"column":126},"end":{"line":73,"column":146}}],"line":73},"45":{"loc":{"start":{"line":73,"column":69},"end":{"line":73,"column":114}},"type":"binary-expr","locations":[{"start":{"line":73,"column":69},"end":{"line":73,"column":97}},{"start":{"line":73,"column":101},"end":{"line":73,"column":114}}],"line":73},"46":{"loc":{"start":{"line":74,"column":8},"end":{"line":76,"column":9}},"type":"if","locations":[{"start":{"line":74,"column":8},"end":{"line":76,"column":9}},{"start":{"line":74,"column":8},"end":{"line":76,"column":9}}],"line":74},"47":{"loc":{"start":{"line":74,"column":13},"end":{"line":74,"column":223}},"type":"cond-expr","locations":[{"start":{"line":74,"column":193},"end":{"line":74,"column":199}},{"start":{"line":74,"column":202},"end":{"line":74,"column":223}}],"line":74},"48":{"loc":{"start":{"line":74,"column":13},"end":{"line":74,"column":190}},"type":"binary-expr","locations":[{"start":{"line":74,"column":13},"end":{"line":74,"column":173}},{"start":{"line":74,"column":177},"end":{"line":74,"column":190}}],"line":74},"49":{"loc":{"start":{"line":74,"column":19},"end":{"line":74,"column":163}},"type":"cond-expr","locations":[{"start":{"line":74,"column":145},"end":{"line":74,"column":151}},{"start":{"line":74,"column":154},"end":{"line":74,"column":163}}],"line":74},"50":{"loc":{"start":{"line":74,"column":19},"end":{"line":74,"column":142}},"type":"binary-expr","locations":[{"start":{"line":74,"column":19},"end":{"line":74,"column":125}},{"start":{"line":74,"column":129},"end":{"line":74,"column":142}}],"line":74},"51":{"loc":{"start":{"line":74,"column":25},"end":{"line":74,"column":115}},"type":"cond-expr","locations":[{"start":{"line":74,"column":95},"end":{"line":74,"column":101}},{"start":{"line":74,"column":104},"end":{"line":74,"column":115}}],"line":74},"52":{"loc":{"start":{"line":74,"column":25},"end":{"line":74,"column":92}},"type":"binary-expr","locations":[{"start":{"line":74,"column":25},"end":{"line":74,"column":75}},{"start":{"line":74,"column":79},"end":{"line":74,"column":92}}],"line":74},"53":{"loc":{"start":{"line":79,"column":4},"end":{"line":81,"column":5}},"type":"if","locations":[{"start":{"line":79,"column":4},"end":{"line":81,"column":5}},{"start":{"line":79,"column":4},"end":{"line":81,"column":5}}],"line":79},"54":{"loc":{"start":{"line":79,"column":9},"end":{"line":79,"column":93}},"type":"cond-expr","locations":[{"start":{"line":79,"column":59},"end":{"line":79,"column":65}},{"start":{"line":79,"column":68},"end":{"line":79,"column":93}}],"line":79},"55":{"loc":{"start":{"line":79,"column":9},"end":{"line":79,"column":56}},"type":"binary-expr","locations":[{"start":{"line":79,"column":9},"end":{"line":79,"column":39}},{"start":{"line":79,"column":43},"end":{"line":79,"column":56}}],"line":79},"56":{"loc":{"start":{"line":82,"column":4},"end":{"line":86,"column":5}},"type":"if","locations":[{"start":{"line":82,"column":4},"end":{"line":86,"column":5}},{"start":{"line":82,"column":4},"end":{"line":86,"column":5}}],"line":82},"57":{"loc":{"start":{"line":82,"column":8},"end":{"line":84,"column":150}},"type":"binary-expr","locations":[{"start":{"line":82,"column":8},"end":{"line":82,"column":57}},{"start":{"line":83,"column":8},"end":{"line":83,"column":233}},{"start":{"line":84,"column":8},"end":{"line":84,"column":150}}],"line":82},"58":{"loc":{"start":{"line":83,"column":9},"end":{"line":83,"column":219}},"type":"cond-expr","locations":[{"start":{"line":83,"column":189},"end":{"line":83,"column":195}},{"start":{"line":83,"column":198},"end":{"line":83,"column":219}}],"line":83},"59":{"loc":{"start":{"line":83,"column":9},"end":{"line":83,"column":186}},"type":"binary-expr","locations":[{"start":{"line":83,"column":9},"end":{"line":83,"column":169}},{"start":{"line":83,"column":173},"end":{"line":83,"column":186}}],"line":83},"60":{"loc":{"start":{"line":83,"column":15},"end":{"line":83,"column":159}},"type":"cond-expr","locations":[{"start":{"line":83,"column":141},"end":{"line":83,"column":147}},{"start":{"line":83,"column":150},"end":{"line":83,"column":159}}],"line":83},"61":{"loc":{"start":{"line":83,"column":15},"end":{"line":83,"column":138}},"type":"binary-expr","locations":[{"start":{"line":83,"column":15},"end":{"line":83,"column":121}},{"start":{"line":83,"column":125},"end":{"line":83,"column":138}}],"line":83},"62":{"loc":{"start":{"line":83,"column":21},"end":{"line":83,"column":111}},"type":"cond-expr","locations":[{"start":{"line":83,"column":91},"end":{"line":83,"column":97}},{"start":{"line":83,"column":100},"end":{"line":83,"column":111}}],"line":83},"63":{"loc":{"start":{"line":83,"column":21},"end":{"line":83,"column":88}},"type":"binary-expr","locations":[{"start":{"line":83,"column":21},"end":{"line":83,"column":71}},{"start":{"line":83,"column":75},"end":{"line":83,"column":88}}],"line":83},"64":{"loc":{"start":{"line":84,"column":9},"end":{"line":84,"column":140}},"type":"cond-expr","locations":[{"start":{"line":84,"column":122},"end":{"line":84,"column":128}},{"start":{"line":84,"column":131},"end":{"line":84,"column":140}}],"line":84},"65":{"loc":{"start":{"line":84,"column":9},"end":{"line":84,"column":119}},"type":"binary-expr","locations":[{"start":{"line":84,"column":9},"end":{"line":84,"column":102}},{"start":{"line":84,"column":106},"end":{"line":84,"column":119}}],"line":84},"66":{"loc":{"start":{"line":84,"column":15},"end":{"line":84,"column":92}},"type":"cond-expr","locations":[{"start":{"line":84,"column":65},"end":{"line":84,"column":71}},{"start":{"line":84,"column":74},"end":{"line":84,"column":92}}],"line":84},"67":{"loc":{"start":{"line":84,"column":15},"end":{"line":84,"column":62}},"type":"binary-expr","locations":[{"start":{"line":84,"column":15},"end":{"line":84,"column":45}},{"start":{"line":84,"column":49},"end":{"line":84,"column":62}}],"line":84},"68":{"loc":{"start":{"line":87,"column":4},"end":{"line":89,"column":5}},"type":"if","locations":[{"start":{"line":87,"column":4},"end":{"line":89,"column":5}},{"start":{"line":87,"column":4},"end":{"line":89,"column":5}}],"line":87},"69":{"loc":{"start":{"line":90,"column":4},"end":{"line":92,"column":5}},"type":"if","locations":[{"start":{"line":90,"column":4},"end":{"line":92,"column":5}},{"start":{"line":90,"column":4},"end":{"line":92,"column":5}}],"line":90},"70":{"loc":{"start":{"line":90,"column":9},"end":{"line":90,"column":93}},"type":"cond-expr","locations":[{"start":{"line":90,"column":59},"end":{"line":90,"column":65}},{"start":{"line":90,"column":68},"end":{"line":90,"column":93}}],"line":90},"71":{"loc":{"start":{"line":90,"column":9},"end":{"line":90,"column":56}},"type":"binary-expr","locations":[{"start":{"line":90,"column":9},"end":{"line":90,"column":39}},{"start":{"line":90,"column":43},"end":{"line":90,"column":56}}],"line":90},"72":{"loc":{"start":{"line":93,"column":11},"end":{"line":93,"column":134}},"type":"cond-expr","locations":[{"start":{"line":93,"column":116},"end":{"line":93,"column":122}},{"start":{"line":93,"column":125},"end":{"line":93,"column":134}}],"line":93},"73":{"loc":{"start":{"line":93,"column":11},"end":{"line":93,"column":113}},"type":"binary-expr","locations":[{"start":{"line":93,"column":11},"end":{"line":93,"column":96}},{"start":{"line":93,"column":100},"end":{"line":93,"column":113}}],"line":93},"74":{"loc":{"start":{"line":93,"column":17},"end":{"line":93,"column":86}},"type":"cond-expr","locations":[{"start":{"line":93,"column":65},"end":{"line":93,"column":71}},{"start":{"line":93,"column":74},"end":{"line":93,"column":86}}],"line":93},"75":{"loc":{"start":{"line":93,"column":17},"end":{"line":93,"column":62}},"type":"binary-expr","locations":[{"start":{"line":93,"column":17},"end":{"line":93,"column":45}},{"start":{"line":93,"column":49},"end":{"line":93,"column":62}}],"line":93}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1411,"10":377,"11":377,"12":0,"13":377,"14":276,"15":101,"16":35,"17":66,"18":63,"19":3,"20":1034,"21":2,"22":1032,"23":1,"24":1,"25":702,"26":702,"27":702,"28":702,"29":1,"30":1,"31":1,"32":1,"33":1783,"34":1,"35":1782,"36":1782,"37":54,"38":6,"39":48,"40":1728,"41":26,"42":1702,"43":6,"44":1696,"45":3,"46":1693,"47":177,"48":1516,"49":1},"f":{"0":1411,"1":702,"2":1783},"b":{"0":[377,1034],"1":[26,1385],"2":[1411,1410],"3":[0,377],"4":[377,377],"5":[353,24],"6":[377,377],"7":[0,377],"8":[377,377],"9":[0,377],"10":[377,255],"11":[240,15],"12":[255,255],"13":[276,101],"14":[377,122,103],"15":[0,122],"16":[122,122],"17":[35,66],"18":[2,99],"19":[101,101],"20":[0,101],"21":[101,101],"22":[63,3],"23":[2,64],"24":[66,66],"25":[0,66],"26":[66,66],"27":[2,1032],"28":[198,504],"29":[702,702],"30":[11,691],"31":[702,702],"32":[201,501],"33":[702,504,504],"34":[201,11],"35":[1,200],"36":[201,201],"37":[1,1782],"38":[0,1783],"39":[1783,1783],"40":[54,1728],"41":[1782,648,1765,1134,111,1739,55],"42":[38,17],"43":[55,55],"44":[0,55],"45":[55,55],"46":[6,48],"47":[48,6],"48":[54,54],"49":[46,8],"50":[54,22],"51":[5,49],"52":[54,54],"53":[26,1702],"54":[0,1728],"55":[1728,1728],"56":[6,1696],"57":[1702,39,7],"58":[32,7],"59":[39,39],"60":[28,11],"61":[39,12],"62":[0,39],"63":[39,39],"64":[0,7],"65":[7,7],"66":[0,7],"67":[7,7],"68":[3,1693],"69":[177,1516],"70":[0,1693],"71":[1693,1693],"72":[3,1513],"73":[1516,1516],"74":[3,1513],"75":[1516,1516]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/flow.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/flow.ts"],"names":[],"mappings":"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","sourcesContent":["import { FlowStatus, FlowType } from '../types/flow';\nimport { v4 as uuid } from 'uuid';\nimport { ExtendedGatewayStatus, GatewayStatus, InternalGatewayStatus } from '../types/gateway';\nimport { GatewayCoreState } from '../types/gatewayCore';\nimport { UserInteractionStatus } from '../types/userInteraction';\nimport { isTokenRefreshRequired } from './expiry';\n\nexport const DEFAULT_FLOW_ID_PREFIX = 'GWC';\n/**\n * This derives the current flow type from the existing state and the next, computed state:\n * - if we have a gateway token, we check if a refresh is required and return REFRESH if so\n * - if we have a gateway token and the token is active but the previous flowId includes REFRESH, we return REFRESH\n * so that the 'active' event gets included as part of the flow\n * - if we have a gateway token and the token is active and the previous flowId includes ISSUANCE, we return ISSUANCE\n * so that the 'active' event gets included as part of the flow\n * - if we have a gateway token and the token is active but there was no previous issuance or refresh flow, we return STATUS\n * as the user has not started any flow yet\n * - in the case where no gateway token is present, we assume ISSUANCE, except for the initialisation state where the gatewayStatus\n * is UNKNOWN or CHECKING, in which case we return STATUS\n * @param {GatewayCoreState} state\n * @param {InternalGatewayStatus} computedInternalStatus\n * @returns {FlowType}\n */\nexport const flowTypeFromState = (state: GatewayCoreState, computedInternalStatus: InternalGatewayStatus): FlowType => {\n  if (state.inputs.gatewayToken?.received) {\n    const tokenRefreshRequired = isTokenRefreshRequired({\n      gatewayToken: state.inputs.gatewayToken?.received,\n      tokenExpirationMarginSeconds: 0,\n      forceRequireRefresh: state.inputs?.dynamicParameters?.forceRequireRefresh,\n    });\n\n    if (tokenRefreshRequired && state.inputs.dynamicParameters?.credentialExpired) {\n      return FlowType.REFRESH_EXPIRED_CREDENTIAL;\n    }\n\n    if (\n      tokenRefreshRequired ||\n      state.internal.status?.toLowerCase().includes('refresh') ||\n      computedInternalStatus.toLowerCase().includes('refresh')\n    ) {\n      return FlowType.REFRESH;\n    }\n\n    // handle the case where we find an ACTIVE token following the issuance flow\n    if (state.output?.flowParameters?.flowId.toLowerCase().includes(FlowType.REFRESH.toLowerCase())) {\n      return FlowType.REFRESH;\n    }\n\n    // handle the case where we find an ACTIVE token following the issuance flow\n    if (state.output?.flowParameters?.flowId.toLowerCase().includes(FlowType.ISSUANCE.toLowerCase())) {\n      return FlowType.ISSUANCE;\n    }\n    return FlowType.STATUS;\n  }\n\n  if ([GatewayStatus.CHECKING, GatewayStatus.UNKNOWN].includes(computedInternalStatus as GatewayStatus)) {\n    return FlowType.STATUS;\n  }\n  // issuance is the default flow type when we don't have a gateway token\n  return FlowType.ISSUANCE;\n};\n\n/**\n * Creates or returns a flowId based on the action and state: we only want to generate\n * a new flowId if we're changing flow types\n * @param action\n * @param state\n * @returns\n */\nexport const getFlowId = (state: GatewayCoreState, computedInternalStatus: InternalGatewayStatus): string => {\n  const existingFlowId = state.output?.flowParameters?.flowId;\n  const flowType = flowTypeFromState(state, computedInternalStatus);\n  // we only want to set a default flowId prefix if a flowId hasn't been set\n  const prefix = `${flowType}_`;\n  return !existingFlowId || existingFlowId === '' || !existingFlowId.includes(prefix)\n    ? `${state.inputs.parameters?.flowIdPrefix || DEFAULT_FLOW_ID_PREFIX}_${prefix}${uuid()}`\n    : existingFlowId;\n};\n\nexport const initialFlowResultStatuses: InternalGatewayStatus[] = [\n  GatewayStatus.REFRESH_TOKEN_REQUIRED,\n  GatewayStatus.FROZEN,\n  GatewayStatus.REVOKED,\n  GatewayStatus.ERROR,\n];\n\nexport const flowResultsStatuses: InternalGatewayStatus[] = [\n  GatewayStatus.ACTIVE,\n  GatewayStatus.REFRESH_TOKEN_REQUIRED,\n  GatewayStatus.FROZEN,\n  GatewayStatus.REVOKED,\n  GatewayStatus.ERROR,\n];\n\nexport const flowStatusFromState = (\n  state: GatewayCoreState,\n  computedInternalStatus: InternalGatewayStatus\n): FlowStatus | undefined => {\n  if (!state.internal?.userInteraction) {\n    return undefined;\n  }\n\n  // Change to a result status if:\n  // - the previous status was CHECKING (no flow has run yet) and the new status is one of the initialFlowResultStatuses\n  // - the previous status was not CHECKING (a flow has been run) and the new status is one of the flowResultsStatuses\n  // and the previous status was not one of the flowResultsStatuses\n  const previousStatus = state.internal.status as InternalGatewayStatus;\n  if (\n    (previousStatus === GatewayStatus.CHECKING && initialFlowResultStatuses.includes(computedInternalStatus)) ||\n    (previousStatus !== GatewayStatus.CHECKING &&\n      flowResultsStatuses.includes(computedInternalStatus) &&\n      !flowResultsStatuses.includes(previousStatus)) ||\n    (previousStatus === GatewayStatus.ACTIVE && state.inputs?.dynamicParameters?.forceRequireRefresh)\n  ) {\n    if (state.inputs.gatekeeperNetworkData?.received?.client?.tokenActiveDisplay === 'hidden') {\n      // If the network is configured to not show the token active screen, we skip the RESULT state and go directly to FINISHED.\n      // state.internal.userInteraction will then be updated to null so the below checks return FINISHED instead of IN-PROGRESS\n      return FlowStatus.FINISHED;\n    }\n    return FlowStatus.RESULT;\n  }\n\n  if (state.internal?.userInteraction.status === UserInteractionStatus.FINISHED) {\n    return FlowStatus.FINISHED;\n  }\n\n  if (\n    previousStatus === GatewayStatus.ACTIVE &&\n    state.inputs.gatekeeperNetworkData?.received?.client?.tokenActiveDisplay === 'hidden' &&\n    state.internal?.userInteraction?.status === null\n  ) {\n    // If the network is configured to not show the token active screen and the flow status was set to FINISHED above\n    // there are still subsequent calls to flowStatusFromState so we need to handle them and keep returning FINISHED\n    return FlowStatus.FINISHED;\n  }\n\n  // If the user validation failed, it should be handled as a finished flow and close the iframe\n  if (computedInternalStatus === ExtendedGatewayStatus.USER_VALIDATION_FAILED) {\n    return FlowStatus.FINISHED;\n  }\n\n  if (state.internal?.userInteraction.status === UserInteractionStatus.STARTED) {\n    return FlowStatus.IN_PROGRESS;\n  }\n\n  return state.output?.flowState?.status;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"cb4b7c8c52a2f304caeaa94b61675bc3bdfd80a2"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/flow.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/flow.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":47}},"2":{"start":{"line":5,"column":0},"end":{"line":12,"column":51}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":38}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":36}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":72}},"6":{"start":{"line":9,"column":4},"end":{"line":9,"column":34}},"7":{"start":{"line":10,"column":4},"end":{"line":10,"column":42}},"8":{"start":{"line":11,"column":4},"end":{"line":11,"column":38}},"9":{"start":{"line":14,"column":0},"end":{"line":18,"column":57}},"10":{"start":{"line":15,"column":4},"end":{"line":15,"column":46}},"11":{"start":{"line":16,"column":4},"end":{"line":16,"column":36}},"12":{"start":{"line":17,"column":4},"end":{"line":17,"column":40}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":21},"end":{"line":12,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":1},"end":{"line":14,"column":2}},"loc":{"start":{"line":14,"column":23},"end":{"line":18,"column":1}},"line":14}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":3},"end":{"line":12,"column":49}},"type":"binary-expr","locations":[{"start":{"line":12,"column":3},"end":{"line":12,"column":11}},{"start":{"line":12,"column":16},"end":{"line":12,"column":48}}],"line":12},"1":{"loc":{"start":{"line":18,"column":3},"end":{"line":18,"column":55}},"type":"binary-expr","locations":[{"start":{"line":18,"column":3},"end":{"line":18,"column":13}},{"start":{"line":18,"column":18},"end":{"line":18,"column":54}}],"line":18}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1},"f":{"0":1,"1":1},"b":{"0":[1,1],"1":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/flow.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/flow.ts"],"names":[],"mappings":";;;AAAA,IAAY,QAOX;AAPD,WAAY,QAAQ;IAClB,iCAAqB,CAAA;IACrB,+BAAmB,CAAA;IACnB,mEAAuD,CAAA;IACvD,6BAAiB,CAAA;IACjB,qCAAyB,CAAA;IACzB,iCAAqB,CAAA;AACvB,CAAC,EAPW,QAAQ,wBAAR,QAAQ,QAOnB;AACD,IAAY,UAIX;AAJD,WAAY,UAAU;IACpB,yCAA2B,CAAA;IAC3B,+BAAiB,CAAA;IACjB,mCAAqB,CAAA;AACvB,CAAC,EAJW,UAAU,0BAAV,UAAU,QAIrB","sourcesContent":["export enum FlowType {\n  ISSUANCE = 'issuance',\n  REFRESH = 'refresh',\n  REFRESH_EXPIRED_CREDENTIAL = 'refreshExpiredCredential',\n  STATUS = 'status',\n  REVOCATION = 'revocation',\n  UNFREEZE = 'unfreeze',\n}\nexport enum FlowStatus {\n  IN_PROGRESS = 'in-progress', // when the user has initiated a flow that is ongoing\n  RESULT = 'result', // when the user has completed a flow and the result is available for display\n  FINISHED = 'finished', // when the user has completed a flow and has closed the display\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3a2a9a9903e982932fbd14964fe3ddf2b38b4062"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/gatewayStatus.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/gatewayStatus.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":61}},"2":{"start":{"line":4,"column":17},"end":{"line":4,"column":37}},"3":{"start":{"line":5,"column":18},"end":{"line":5,"column":45}},"4":{"start":{"line":6,"column":17},"end":{"line":6,"column":36}},"5":{"start":{"line":7,"column":16},"end":{"line":7,"column":34}},"6":{"start":{"line":8,"column":25},"end":{"line":8,"column":52}},"7":{"start":{"line":9,"column":19},"end":{"line":9,"column":40}},"8":{"start":{"line":10,"column":18},"end":{"line":10,"column":38}},"9":{"start":{"line":11,"column":17},"end":{"line":11,"column":66}},"10":{"start":{"line":12,"column":17},"end":{"line":12,"column":66}},"11":{"start":{"line":13,"column":29},"end":{"line":18,"column":1}},"12":{"start":{"line":19,"column":34},"end":{"line":24,"column":1}},"13":{"start":{"line":25,"column":22},"end":{"line":30,"column":1}},"14":{"start":{"line":32,"column":4},"end":{"line":32,"column":34}},"15":{"start":{"line":34,"column":0},"end":{"line":262,"column":2}},"16":{"start":{"line":85,"column":67},"end":{"line":85,"column":99}},"17":{"start":{"line":110,"column":81},"end":{"line":110,"column":127}},"18":{"start":{"line":111,"column":76},"end":{"line":111,"column":117}},"19":{"start":{"line":182,"column":113},"end":{"line":182,"column":152}},"20":{"start":{"line":183,"column":129},"end":{"line":183,"column":176}},"21":{"start":{"line":210,"column":93},"end":{"line":210,"column":151}},"22":{"start":{"line":211,"column":92},"end":{"line":211,"column":149}},"23":{"start":{"line":263,"column":26},"end":{"line":266,"column":1}},"24":{"start":{"line":265,"column":4},"end":{"line":265,"column":112}},"25":{"start":{"line":267,"column":26},"end":{"line":284,"column":1}},"26":{"start":{"line":269,"column":26},"end":{"line":269,"column":94}},"27":{"start":{"line":270,"column":22},"end":{"line":270,"column":111}},"28":{"start":{"line":271,"column":4},"end":{"line":273,"column":5}},"29":{"start":{"line":272,"column":8},"end":{"line":272,"column":86}},"30":{"start":{"line":274,"column":27},"end":{"line":274,"column":43}},"31":{"start":{"line":275,"column":4},"end":{"line":277,"column":5}},"32":{"start":{"line":276,"column":8},"end":{"line":276,"column":29}},"33":{"start":{"line":278,"column":4},"end":{"line":281,"column":5}},"34":{"start":{"line":279,"column":8},"end":{"line":279,"column":96}},"35":{"start":{"line":280,"column":8},"end":{"line":280,"column":137}},"36":{"start":{"line":282,"column":4},"end":{"line":282,"column":79}},"37":{"start":{"line":283,"column":4},"end":{"line":283,"column":26}},"38":{"start":{"line":285,"column":30},"end":{"line":287,"column":1}},"39":{"start":{"line":286,"column":4},"end":{"line":286,"column":36}},"40":{"start":{"line":288,"column":0},"end":{"line":288,"column":54}}},"fnMap":{"0":{"name":"createTransition","decl":{"start":{"line":31,"column":9},"end":{"line":31,"column":25}},"loc":{"start":{"line":31,"column":46},"end":{"line":33,"column":1}},"line":31},"1":{"name":"(anonymous_1)","decl":{"start":{"line":85,"column":61},"end":{"line":85,"column":62}},"loc":{"start":{"line":85,"column":67},"end":{"line":85,"column":99}},"line":85},"2":{"name":"(anonymous_2)","decl":{"start":{"line":110,"column":75},"end":{"line":110,"column":76}},"loc":{"start":{"line":110,"column":81},"end":{"line":110,"column":127}},"line":110},"3":{"name":"(anonymous_3)","decl":{"start":{"line":111,"column":70},"end":{"line":111,"column":71}},"loc":{"start":{"line":111,"column":76},"end":{"line":111,"column":117}},"line":111},"4":{"name":"(anonymous_4)","decl":{"start":{"line":182,"column":107},"end":{"line":182,"column":108}},"loc":{"start":{"line":182,"column":113},"end":{"line":182,"column":152}},"line":182},"5":{"name":"(anonymous_5)","decl":{"start":{"line":183,"column":123},"end":{"line":183,"column":124}},"loc":{"start":{"line":183,"column":129},"end":{"line":183,"column":176}},"line":183},"6":{"name":"(anonymous_6)","decl":{"start":{"line":210,"column":87},"end":{"line":210,"column":88}},"loc":{"start":{"line":210,"column":93},"end":{"line":210,"column":151}},"line":210},"7":{"name":"(anonymous_7)","decl":{"start":{"line":211,"column":86},"end":{"line":211,"column":87}},"loc":{"start":{"line":211,"column":92},"end":{"line":211,"column":149}},"line":211},"8":{"name":"(anonymous_8)","decl":{"start":{"line":263,"column":26},"end":{"line":263,"column":27}},"loc":{"start":{"line":263,"column":45},"end":{"line":266,"column":1}},"line":263},"9":{"name":"(anonymous_9)","decl":{"start":{"line":267,"column":26},"end":{"line":267,"column":27}},"loc":{"start":{"line":267,"column":37},"end":{"line":284,"column":1}},"line":267},"10":{"name":"(anonymous_10)","decl":{"start":{"line":285,"column":30},"end":{"line":285,"column":31}},"loc":{"start":{"line":285,"column":41},"end":{"line":287,"column":1}},"line":285}},"branchMap":{"0":{"loc":{"start":{"line":265,"column":11},"end":{"line":265,"column":111}},"type":"cond-expr","locations":[{"start":{"line":265,"column":75},"end":{"line":265,"column":81}},{"start":{"line":265,"column":84},"end":{"line":265,"column":111}}],"line":265},"1":{"loc":{"start":{"line":265,"column":11},"end":{"line":265,"column":72}},"type":"binary-expr","locations":[{"start":{"line":265,"column":11},"end":{"line":265,"column":55}},{"start":{"line":265,"column":59},"end":{"line":265,"column":72}}],"line":265},"2":{"loc":{"start":{"line":269,"column":26},"end":{"line":269,"column":94}},"type":"cond-expr","locations":[{"start":{"line":269,"column":76},"end":{"line":269,"column":82}},{"start":{"line":269,"column":85},"end":{"line":269,"column":94}}],"line":269},"3":{"loc":{"start":{"line":269,"column":26},"end":{"line":269,"column":73}},"type":"binary-expr","locations":[{"start":{"line":269,"column":26},"end":{"line":269,"column":56}},{"start":{"line":269,"column":60},"end":{"line":269,"column":73}}],"line":269},"4":{"loc":{"start":{"line":270,"column":22},"end":{"line":270,"column":111}},"type":"cond-expr","locations":[{"start":{"line":270,"column":92},"end":{"line":270,"column":98}},{"start":{"line":270,"column":101},"end":{"line":270,"column":111}}],"line":270},"5":{"loc":{"start":{"line":270,"column":22},"end":{"line":270,"column":89}},"type":"binary-expr","locations":[{"start":{"line":270,"column":22},"end":{"line":270,"column":72}},{"start":{"line":270,"column":76},"end":{"line":270,"column":89}}],"line":270},"6":{"loc":{"start":{"line":271,"column":4},"end":{"line":273,"column":5}},"type":"if","locations":[{"start":{"line":271,"column":4},"end":{"line":273,"column":5}},{"start":{"line":271,"column":4},"end":{"line":273,"column":5}}],"line":271},"7":{"loc":{"start":{"line":275,"column":4},"end":{"line":277,"column":5}},"type":"if","locations":[{"start":{"line":275,"column":4},"end":{"line":277,"column":5}},{"start":{"line":275,"column":4},"end":{"line":277,"column":5}}],"line":275},"8":{"loc":{"start":{"line":278,"column":4},"end":{"line":281,"column":5}},"type":"if","locations":[{"start":{"line":278,"column":4},"end":{"line":281,"column":5}},{"start":{"line":278,"column":4},"end":{"line":281,"column":5}}],"line":278}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":45,"15":1,"16":17,"17":7,"18":5,"19":1,"20":1,"21":3,"22":1,"23":1,"24":490,"25":1,"26":1782,"27":1782,"28":1782,"29":2,"30":1780,"31":1780,"32":1290,"33":490,"34":1,"35":1,"36":489,"37":489,"38":1,"39":1782,"40":1},"f":{"0":45,"1":17,"2":7,"3":5,"4":1,"5":1,"6":3,"7":1,"8":490,"9":1782,"10":1782},"b":{"0":[0,490],"1":[490,490],"2":[0,1782],"3":[1782,1782],"4":[2,1780],"5":[1782,1782],"6":[2,1780],"7":[1290,490],"8":[1,489]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/gatewayStatus.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/gatewayStatus.ts"],"names":[],"mappings":"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","sourcesContent":["import { prefixLogger } from '../logger';\nimport { ExtendedGatewayStatus, GatewayStatus, InternalGatewayStatus } from '../types/gateway';\nimport { GatewayCoreState, Transition } from '../types/gatewayCore';\nimport { GatewayTokenCheckType, handleGatewayTokenExistsStatus, ValidationGatewayStatusType } from './common';\nimport { handleChainError, handleGatekeeperError, handleUserValidationFailed } from './error';\nimport { checkForInProgress, computeInitialState } from './initialisation';\nimport {\n  computeIssuanceAwaitingOnChainToken,\n  computeIssuanceDataCollectionRestart,\n  computeIssuanceInReview,\n  computeIssuanceRequested,\n  computeIssuanceStartPreApprovedTransaction,\n  computeIssuanceStatus,\n} from './issuance';\nimport {\n  computeRefreshAwaitingOnChainToken,\n  computeRefreshCredentialExpiredStatus,\n  computeRefreshInReview,\n  computeRefreshRequested,\n  computeRefreshStartPreApprovedTransaction,\n  computeRefreshStatus,\n} from './refresh';\n\nconst logDebug = prefixLogger('gatewayStatus').debug;\nconst logError = prefixLogger('gatewayStatus').error;\n\nconst gatewayTokenStatuses = [\n  GatewayStatus.ACTIVE,\n  GatewayStatus.FROZEN,\n  GatewayStatus.REVOKED,\n  GatewayStatus.REFRESH_TOKEN_REQUIRED,\n] as GatewayTokenCheckType[];\n\nconst validationProcessStatuses = [\n  GatewayStatus.COLLECTING_USER_INFORMATION,\n  GatewayStatus.VALIDATING_USER_INFORMATION,\n  GatewayStatus.USER_INFORMATION_REJECTED,\n  GatewayStatus.USER_INFORMATION_VALIDATED,\n] as ValidationGatewayStatusType[];\n\ntype ErrorStatusType = GatewayStatus.ERROR | GatewayStatus.LOCATION_NOT_SUPPORTED | GatewayStatus.VPN_NOT_SUPPORTED;\n\nconst errorStatuses = [\n  GatewayStatus.REJECTED,\n  GatewayStatus.ERROR,\n  GatewayStatus.LOCATION_NOT_SUPPORTED,\n  GatewayStatus.VPN_NOT_SUPPORTED,\n] as ErrorStatusType[];\n\nfunction createTransition<T extends R[], R>(nextState: T, compute: (state: GatewayCoreState) => R): Transition<T, R> {\n  return { nextState, compute };\n}\n\nexport const transitions: Record<Partial<InternalGatewayStatus>, Transition<any, any>> = {\n  [GatewayStatus.UNKNOWN]: createTransition([...gatewayTokenStatuses, GatewayStatus.CHECKING], checkForInProgress),\n  [GatewayStatus.CHECKING]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...errorStatuses,\n      ...validationProcessStatuses,\n      GatewayStatus.NOT_REQUESTED,\n      ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION,\n      ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW,\n      ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_START_NEW_TX,\n      ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_START_NEW_TX,\n      ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n      // ExtendedGatewayStatus.TOKEN_REFRESH_IN_REVIEW, // we don't support this flow yet\n    ],\n    computeInitialState\n  ),\n  [GatewayStatus.NOT_REQUESTED]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...validationProcessStatuses,\n      ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN,\n      GatewayStatus.NOT_REQUESTED,\n      ExtendedGatewayStatus.RESTART,\n      ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION,\n    ],\n    computeIssuanceStatus\n  ),\n  [GatewayStatus.COLLECTING_USER_INFORMATION]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...validationProcessStatuses,\n      ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN,\n      GatewayStatus.NOT_REQUESTED,\n      ExtendedGatewayStatus.RESTART,\n      ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION,\n      ExtendedGatewayStatus.USER_VALIDATION_FAILED,\n    ],\n    computeIssuanceStatus\n  ),\n  [GatewayStatus.USER_INFORMATION_VALIDATED]: createTransition(\n    [...gatewayTokenStatuses, ExtendedGatewayStatus.ISSUANCE_CLIENT_PAYER_REQUESTED, GatewayStatus.IN_REVIEW],\n    computeIssuanceRequested\n  ),\n  [ExtendedGatewayStatus.ISSUANCE_CLIENT_PAYER_REQUESTED]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...errorStatuses,\n      ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_TRANSACTION_SEND,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN, // civic-sends case\n      ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW,\n    ],\n    computeIssuanceInReview\n  ),\n  [GatewayStatus.IN_REVIEW]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...errorStatuses,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_TRANSACTION_SEND,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN, // civic-sends case\n      ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW,\n    ],\n    computeIssuanceInReview\n  ),\n  [GatewayStatus.REJECTED]: createTransition([], () => GatewayStatus.REJECTED), // final state\n  [ExtendedGatewayStatus.ISSUANCE_AWAITING_TRANSACTION_SEND]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN,\n      ExtendedGatewayStatus.CONFIRM_OWNER_TRANSACTION,\n      ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR,\n    ],\n    computeIssuanceInReview\n  ),\n  [ExtendedGatewayStatus.ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN,\n      ExtendedGatewayStatus.CONFIRM_OWNER_TRANSACTION,\n      ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR,\n    ],\n    computeIssuanceInReview\n  ),\n  [ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN]: createTransition(\n    [...gatewayTokenStatuses, ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR],\n    computeIssuanceAwaitingOnChainToken\n  ),\n  [ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...validationProcessStatuses,\n      GatewayStatus.USER_INFORMATION_VALIDATED,\n      ExtendedGatewayStatus.ISSUANCE_CLIENT_PAYER_REQUESTED,\n      GatewayStatus.NOT_REQUESTED,\n    ],\n    computeIssuanceDataCollectionRestart\n  ),\n  [GatewayStatus.REVOKED]: createTransition([], handleGatewayTokenExistsStatus),\n  [GatewayStatus.FROZEN]: createTransition([...gatewayTokenStatuses], handleGatewayTokenExistsStatus),\n  [GatewayStatus.ACTIVE]: createTransition([...gatewayTokenStatuses], handleGatewayTokenExistsStatus),\n  [GatewayStatus.ERROR]: createTransition(\n    [...gatewayTokenStatuses, ExtendedGatewayStatus.RESTART, ExtendedGatewayStatus.RESTART_REFRESH],\n    handleGatekeeperError\n  ), // final state\n  [GatewayStatus.LOCATION_NOT_SUPPORTED]: createTransition([], () => GatewayStatus.LOCATION_NOT_SUPPORTED), // final state\n  [GatewayStatus.VPN_NOT_SUPPORTED]: createTransition([], () => GatewayStatus.VPN_NOT_SUPPORTED), // final state\n  [ExtendedGatewayStatus.USER_VALIDATION_FAILED]: createTransition(\n    [ExtendedGatewayStatus.USER_VALIDATION_FAILED, ExtendedGatewayStatus.RESTART],\n    handleUserValidationFailed\n  ),\n  [GatewayStatus.REFRESH_TOKEN_REQUIRED]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ExtendedGatewayStatus.REFRESH_USER_INFORMATION_VALIDATED,\n      ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_START_NEW_TX,\n      ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED,\n    ],\n    computeRefreshStatus\n  ),\n  [ExtendedGatewayStatus.REFRESH_USER_INFORMATION_VALIDATED]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ExtendedGatewayStatus.REFRESH_CLIENT_PAYER_REQUESTED,\n      ExtendedGatewayStatus.REFRESH_IN_REVIEW,\n    ],\n    computeRefreshRequested\n  ),\n  [ExtendedGatewayStatus.REFRESH_IN_REVIEW]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...errorStatuses,\n      ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND,\n      ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND,\n      ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN, // civic-sends case\n    ],\n    computeRefreshInReview\n  ),\n  [ExtendedGatewayStatus.TOKEN_REFRESH_IN_REVIEW]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...errorStatuses,\n      ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND,\n      ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND,\n      ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN, // civic-sends case\n    ],\n    computeRefreshInReview\n  ),\n  [ExtendedGatewayStatus.REFRESH_CLIENT_PAYER_REQUESTED]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...errorStatuses,\n      ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND,\n      ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND,\n      ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN,\n    ],\n    computeRefreshInReview\n  ),\n  [ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN,\n      ExtendedGatewayStatus.CONFIRM_OWNER_TRANSACTION,\n      ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR,\n    ],\n    computeRefreshInReview\n  ),\n  [ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN,\n      ExtendedGatewayStatus.CONFIRM_OWNER_TRANSACTION,\n      ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR,\n    ],\n    computeRefreshInReview\n  ),\n  [ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN]: createTransition(\n    [...gatewayTokenStatuses, ...errorStatuses, ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR],\n    computeRefreshAwaitingOnChainToken\n  ),\n  [ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      GatewayStatus.USER_INFORMATION_VALIDATED,\n      ExtendedGatewayStatus.RESTART,\n      ExtendedGatewayStatus.RESTART_REFRESH,\n      ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n    ],\n    handleChainError\n  ),\n  [ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ExtendedGatewayStatus.RESTART,\n      ExtendedGatewayStatus.RESTART_REFRESH,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_TRANSACTION_SEND,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND,\n      ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN,\n      ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND,\n    ],\n    handleChainError\n  ),\n  [ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW]: createTransition(\n    [...gatewayTokenStatuses, ...errorStatuses, ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN],\n    computeIssuanceInReview\n  ),\n  [ExtendedGatewayStatus.RESTART]: createTransition(\n    [ExtendedGatewayStatus.RESTART],\n    () => ExtendedGatewayStatus.RESTART\n  ),\n  [ExtendedGatewayStatus.RESTART_REFRESH]: createTransition(\n    [ExtendedGatewayStatus.RESTART_REFRESH],\n    () => ExtendedGatewayStatus.RESTART_REFRESH\n  ),\n  [ExtendedGatewayStatus.CHAIN_SIGN_MESSAGE_ERROR]: createTransition(\n    [\n      ExtendedGatewayStatus.RESTART,\n      ExtendedGatewayStatus.RESTART_REFRESH,\n      ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n    ],\n    handleChainError\n  ),\n  // the states below are not currently being used by the events emitter\n  // but they are included here in case they are needed in the future\n  [GatewayStatus.VALIDATING_USER_INFORMATION]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...validationProcessStatuses,\n      ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW,\n      ExtendedGatewayStatus.RESTART,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN,\n      ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION,\n      GatewayStatus.NOT_REQUESTED,\n    ],\n    computeIssuanceStatus\n  ),\n  [GatewayStatus.USER_INFORMATION_REJECTED]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...validationProcessStatuses,\n      ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW,\n      ExtendedGatewayStatus.RESTART,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN,\n      ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION,\n      GatewayStatus.NOT_REQUESTED,\n    ],\n    computeIssuanceStatus\n  ),\n  [ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION]: createTransition(\n    [],\n    () => ExtendedGatewayStatus.AWAITING_OWNER_TRANSACTION\n  ),\n  [ExtendedGatewayStatus.CONFIRM_OWNER_TRANSACTION]: createTransition(\n    [],\n    () => ExtendedGatewayStatus.CONFIRM_OWNER_TRANSACTION\n  ),\n  [ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_START_NEW_TX]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n    ],\n    computeIssuanceStartPreApprovedTransaction\n  ),\n  [ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...errorStatuses,\n      ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_TRANSACTION_SEND,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN, // civic-sends case\n      ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW,\n      ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR,\n    ],\n    computeIssuanceInReview\n  ),\n  [ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...errorStatuses,\n      ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_TRANSACTION_SEND,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND,\n      ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN, // civic-sends case\n      ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW,\n      ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR,\n    ],\n    computeIssuanceInReview\n  ),\n  [ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_START_NEW_TX]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX,\n      ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX,\n    ],\n    computeRefreshStartPreApprovedTransaction\n  ),\n  [ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...errorStatuses,\n      ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND,\n      ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND,\n      ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN,\n    ],\n    computeRefreshInReview\n  ),\n  [ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ...errorStatuses,\n      ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND,\n      ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND,\n      ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN,\n    ],\n    computeRefreshInReview\n  ),\n  [ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED]: createTransition(\n    [...gatewayTokenStatuses, ...errorStatuses, ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED_START],\n    computeRefreshCredentialExpiredStatus\n  ),\n  [ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED_START]: createTransition(\n    [\n      ...gatewayTokenStatuses,\n      ExtendedGatewayStatus.REFRESH_USER_INFORMATION_VALIDATED,\n      ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_START_NEW_TX,\n    ],\n    computeRefreshStatus\n  ),\n};\n\nconst isValidTransition = (current: InternalGatewayStatus, next: InternalGatewayStatus): boolean => {\n  return transitions[current]?.nextState.includes(next);\n};\n\nconst performTransition = (state: GatewayCoreState) => {\n  const currentStatus = state.internal?.status as GatewayStatus;\n  const computeFn = transitions[currentStatus]?.compute;\n  if (!computeFn) {\n    throw new Error(`No transition function defined for ${currentStatus} status`);\n  }\n  const computedStatus = computeFn(state);\n  if (computedStatus === currentStatus) {\n    return currentStatus;\n  }\n  if (!isValidTransition(currentStatus, computedStatus)) {\n    logError('Invalid transition, throwing an error...', { currentStatus, computedStatus });\n    throw new Error(\n      `Invalid transition, returning currentStatus currentStatus: ${currentStatus} computedStatus: ${computedStatus}`\n    );\n  }\n  logDebug('Transitioning to new status', { currentStatus, computedStatus });\n  return computedStatus;\n};\n\nexport const computeInternalStatus = (state: GatewayCoreState): InternalGatewayStatus => {\n  return performTransition(state);\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6d559a0c00e6e9547e3d8afe20950356673cde66"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/error.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/error.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":103}},"2":{"start":{"line":4,"column":19},"end":{"line":4,"column":47}},"3":{"start":{"line":5,"column":20},"end":{"line":5,"column":49}},"4":{"start":{"line":6,"column":18},"end":{"line":6,"column":45}},"5":{"start":{"line":7,"column":17},"end":{"line":7,"column":36}},"6":{"start":{"line":8,"column":25},"end":{"line":35,"column":1}},"7":{"start":{"line":10,"column":4},"end":{"line":33,"column":5}},"8":{"start":{"line":12,"column":30},"end":{"line":12,"column":115}},"9":{"start":{"line":13,"column":8},"end":{"line":24,"column":9}},"10":{"start":{"line":16,"column":12},"end":{"line":20,"column":13}},"11":{"start":{"line":17,"column":16},"end":{"line":19,"column":100}},"12":{"start":{"line":21,"column":12},"end":{"line":23,"column":97}},"13":{"start":{"line":25,"column":8},"end":{"line":29,"column":9}},"14":{"start":{"line":26,"column":12},"end":{"line":28,"column":98}},"15":{"start":{"line":30,"column":8},"end":{"line":32,"column":95}},"16":{"start":{"line":34,"column":4},"end":{"line":34,"column":80}},"17":{"start":{"line":36,"column":0},"end":{"line":36,"column":44}},"18":{"start":{"line":37,"column":30},"end":{"line":45,"column":1}},"19":{"start":{"line":39,"column":26},"end":{"line":39,"column":62}},"20":{"start":{"line":40,"column":4},"end":{"line":43,"column":5}},"21":{"start":{"line":42,"column":8},"end":{"line":42,"column":121}},"22":{"start":{"line":44,"column":4},"end":{"line":44,"column":80}},"23":{"start":{"line":46,"column":0},"end":{"line":46,"column":54}},"24":{"start":{"line":47,"column":35},"end":{"line":52,"column":1}},"25":{"start":{"line":49,"column":4},"end":{"line":51,"column":50}},"26":{"start":{"line":53,"column":0},"end":{"line":53,"column":64}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":8,"column":25},"end":{"line":8,"column":26}},"loc":{"start":{"line":8,"column":36},"end":{"line":35,"column":1}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":37,"column":30},"end":{"line":37,"column":31}},"loc":{"start":{"line":37,"column":41},"end":{"line":45,"column":1}},"line":37},"2":{"name":"(anonymous_2)","decl":{"start":{"line":47,"column":35},"end":{"line":47,"column":36}},"loc":{"start":{"line":47,"column":46},"end":{"line":52,"column":1}},"line":47}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":4},"end":{"line":33,"column":5}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":33,"column":5}},{"start":{"line":10,"column":4},"end":{"line":33,"column":5}}],"line":10},"1":{"loc":{"start":{"line":10,"column":8},"end":{"line":11,"column":146}},"type":"binary-expr","locations":[{"start":{"line":10,"column":8},"end":{"line":10,"column":146}},{"start":{"line":11,"column":8},"end":{"line":11,"column":146}}],"line":10},"2":{"loc":{"start":{"line":10,"column":9},"end":{"line":10,"column":93}},"type":"cond-expr","locations":[{"start":{"line":10,"column":76},"end":{"line":10,"column":82}},{"start":{"line":10,"column":85},"end":{"line":10,"column":93}}],"line":10},"3":{"loc":{"start":{"line":10,"column":9},"end":{"line":10,"column":73}},"type":"binary-expr","locations":[{"start":{"line":10,"column":9},"end":{"line":10,"column":56}},{"start":{"line":10,"column":60},"end":{"line":10,"column":73}}],"line":10},"4":{"loc":{"start":{"line":11,"column":9},"end":{"line":11,"column":94}},"type":"cond-expr","locations":[{"start":{"line":11,"column":76},"end":{"line":11,"column":82}},{"start":{"line":11,"column":85},"end":{"line":11,"column":94}}],"line":11},"5":{"loc":{"start":{"line":11,"column":9},"end":{"line":11,"column":73}},"type":"binary-expr","locations":[{"start":{"line":11,"column":9},"end":{"line":11,"column":56}},{"start":{"line":11,"column":60},"end":{"line":11,"column":73}}],"line":11},"6":{"loc":{"start":{"line":12,"column":33},"end":{"line":12,"column":114}},"type":"cond-expr","locations":[{"start":{"line":12,"column":94},"end":{"line":12,"column":100}},{"start":{"line":12,"column":103},"end":{"line":12,"column":114}}],"line":12},"7":{"loc":{"start":{"line":12,"column":33},"end":{"line":12,"column":91}},"type":"binary-expr","locations":[{"start":{"line":12,"column":33},"end":{"line":12,"column":74}},{"start":{"line":12,"column":78},"end":{"line":12,"column":91}}],"line":12},"8":{"loc":{"start":{"line":13,"column":8},"end":{"line":24,"column":9}},"type":"if","locations":[{"start":{"line":13,"column":8},"end":{"line":24,"column":9}},{"start":{"line":13,"column":8},"end":{"line":24,"column":9}}],"line":13},"9":{"loc":{"start":{"line":13,"column":12},"end":{"line":15,"column":214}},"type":"binary-expr","locations":[{"start":{"line":13,"column":13},"end":{"line":13,"column":97}},{"start":{"line":14,"column":12},"end":{"line":15,"column":214}}],"line":13},"10":{"loc":{"start":{"line":13,"column":13},"end":{"line":13,"column":97}},"type":"cond-expr","locations":[{"start":{"line":13,"column":80},"end":{"line":13,"column":86}},{"start":{"line":13,"column":89},"end":{"line":13,"column":97}}],"line":13},"11":{"loc":{"start":{"line":13,"column":13},"end":{"line":13,"column":77}},"type":"binary-expr","locations":[{"start":{"line":13,"column":13},"end":{"line":13,"column":60}},{"start":{"line":13,"column":64},"end":{"line":13,"column":77}}],"line":13},"12":{"loc":{"start":{"line":14,"column":13},"end":{"line":14,"column":58}},"type":"binary-expr","locations":[{"start":{"line":14,"column":13},"end":{"line":14,"column":53}},{"start":{"line":14,"column":57},"end":{"line":14,"column":58}}],"line":14},"13":{"loc":{"start":{"line":15,"column":17},"end":{"line":15,"column":213}},"type":"binary-expr","locations":[{"start":{"line":15,"column":18},"end":{"line":15,"column":165}},{"start":{"line":15,"column":170},"end":{"line":15,"column":213}}],"line":15},"14":{"loc":{"start":{"line":15,"column":18},"end":{"line":15,"column":165}},"type":"cond-expr","locations":[{"start":{"line":15,"column":132},"end":{"line":15,"column":138}},{"start":{"line":15,"column":141},"end":{"line":15,"column":165}}],"line":15},"15":{"loc":{"start":{"line":15,"column":18},"end":{"line":15,"column":129}},"type":"binary-expr","locations":[{"start":{"line":15,"column":18},"end":{"line":15,"column":112}},{"start":{"line":15,"column":116},"end":{"line":15,"column":129}}],"line":15},"16":{"loc":{"start":{"line":15,"column":24},"end":{"line":15,"column":102}},"type":"cond-expr","locations":[{"start":{"line":15,"column":83},"end":{"line":15,"column":89}},{"start":{"line":15,"column":92},"end":{"line":15,"column":102}}],"line":15},"17":{"loc":{"start":{"line":15,"column":24},"end":{"line":15,"column":80}},"type":"binary-expr","locations":[{"start":{"line":15,"column":24},"end":{"line":15,"column":63}},{"start":{"line":15,"column":67},"end":{"line":15,"column":80}}],"line":15},"18":{"loc":{"start":{"line":16,"column":12},"end":{"line":20,"column":13}},"type":"if","locations":[{"start":{"line":16,"column":12},"end":{"line":20,"column":13}},{"start":{"line":16,"column":12},"end":{"line":20,"column":13}}],"line":16},"19":{"loc":{"start":{"line":17,"column":23},"end":{"line":19,"column":99}},"type":"cond-expr","locations":[{"start":{"line":18,"column":22},"end":{"line":18,"column":87}},{"start":{"line":19,"column":22},"end":{"line":19,"column":99}}],"line":17},"20":{"loc":{"start":{"line":21,"column":19},"end":{"line":23,"column":96}},"type":"cond-expr","locations":[{"start":{"line":22,"column":18},"end":{"line":22,"column":84}},{"start":{"line":23,"column":18},"end":{"line":23,"column":96}}],"line":21},"21":{"loc":{"start":{"line":25,"column":8},"end":{"line":29,"column":9}},"type":"if","locations":[{"start":{"line":25,"column":8},"end":{"line":29,"column":9}},{"start":{"line":25,"column":8},"end":{"line":29,"column":9}}],"line":25},"22":{"loc":{"start":{"line":26,"column":19},"end":{"line":28,"column":97}},"type":"cond-expr","locations":[{"start":{"line":27,"column":18},"end":{"line":27,"column":85}},{"start":{"line":28,"column":18},"end":{"line":28,"column":97}}],"line":26},"23":{"loc":{"start":{"line":30,"column":15},"end":{"line":32,"column":94}},"type":"cond-expr","locations":[{"start":{"line":31,"column":14},"end":{"line":31,"column":82}},{"start":{"line":32,"column":14},"end":{"line":32,"column":94}}],"line":30},"24":{"loc":{"start":{"line":34,"column":11},"end":{"line":34,"column":79}},"type":"cond-expr","locations":[{"start":{"line":34,"column":61},"end":{"line":34,"column":67}},{"start":{"line":34,"column":70},"end":{"line":34,"column":79}}],"line":34},"25":{"loc":{"start":{"line":34,"column":11},"end":{"line":34,"column":58}},"type":"binary-expr","locations":[{"start":{"line":34,"column":11},"end":{"line":34,"column":41}},{"start":{"line":34,"column":45},"end":{"line":34,"column":58}}],"line":34},"26":{"loc":{"start":{"line":40,"column":4},"end":{"line":43,"column":5}},"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":43,"column":5}},{"start":{"line":40,"column":4},"end":{"line":43,"column":5}}],"line":40},"27":{"loc":{"start":{"line":40,"column":8},"end":{"line":41,"column":140}},"type":"binary-expr","locations":[{"start":{"line":40,"column":8},"end":{"line":40,"column":146}},{"start":{"line":41,"column":8},"end":{"line":41,"column":140}}],"line":40},"28":{"loc":{"start":{"line":40,"column":9},"end":{"line":40,"column":93}},"type":"cond-expr","locations":[{"start":{"line":40,"column":76},"end":{"line":40,"column":82}},{"start":{"line":40,"column":85},"end":{"line":40,"column":93}}],"line":40},"29":{"loc":{"start":{"line":40,"column":9},"end":{"line":40,"column":73}},"type":"binary-expr","locations":[{"start":{"line":40,"column":9},"end":{"line":40,"column":56}},{"start":{"line":40,"column":60},"end":{"line":40,"column":73}}],"line":40},"30":{"loc":{"start":{"line":41,"column":9},"end":{"line":41,"column":94}},"type":"cond-expr","locations":[{"start":{"line":41,"column":76},"end":{"line":41,"column":82}},{"start":{"line":41,"column":85},"end":{"line":41,"column":94}}],"line":41},"31":{"loc":{"start":{"line":41,"column":9},"end":{"line":41,"column":73}},"type":"binary-expr","locations":[{"start":{"line":41,"column":9},"end":{"line":41,"column":56}},{"start":{"line":41,"column":60},"end":{"line":41,"column":73}}],"line":41},"32":{"loc":{"start":{"line":42,"column":15},"end":{"line":42,"column":120}},"type":"cond-expr","locations":[{"start":{"line":42,"column":31},"end":{"line":42,"column":78}},{"start":{"line":42,"column":81},"end":{"line":42,"column":120}}],"line":42},"33":{"loc":{"start":{"line":44,"column":11},"end":{"line":44,"column":79}},"type":"cond-expr","locations":[{"start":{"line":44,"column":61},"end":{"line":44,"column":67}},{"start":{"line":44,"column":70},"end":{"line":44,"column":79}}],"line":44},"34":{"loc":{"start":{"line":44,"column":11},"end":{"line":44,"column":58}},"type":"binary-expr","locations":[{"start":{"line":44,"column":11},"end":{"line":44,"column":41}},{"start":{"line":44,"column":45},"end":{"line":44,"column":58}}],"line":44},"35":{"loc":{"start":{"line":49,"column":11},"end":{"line":51,"column":49}},"type":"cond-expr","locations":[{"start":{"line":50,"column":10},"end":{"line":50,"column":64}},{"start":{"line":51,"column":10},"end":{"line":51,"column":49}}],"line":49},"36":{"loc":{"start":{"line":49,"column":12},"end":{"line":49,"column":175}},"type":"cond-expr","locations":[{"start":{"line":49,"column":126},"end":{"line":49,"column":132}},{"start":{"line":49,"column":135},"end":{"line":49,"column":175}}],"line":49},"37":{"loc":{"start":{"line":49,"column":12},"end":{"line":49,"column":123}},"type":"binary-expr","locations":[{"start":{"line":49,"column":12},"end":{"line":49,"column":106}},{"start":{"line":49,"column":110},"end":{"line":49,"column":123}}],"line":49},"38":{"loc":{"start":{"line":49,"column":18},"end":{"line":49,"column":96}},"type":"cond-expr","locations":[{"start":{"line":49,"column":77},"end":{"line":49,"column":83}},{"start":{"line":49,"column":86},"end":{"line":49,"column":96}}],"line":49},"39":{"loc":{"start":{"line":49,"column":18},"end":{"line":49,"column":74}},"type":"binary-expr","locations":[{"start":{"line":49,"column":18},"end":{"line":49,"column":57}},{"start":{"line":49,"column":61},"end":{"line":49,"column":74}}],"line":49}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":26,"8":23,"9":23,"10":11,"11":5,"12":6,"13":12,"14":5,"15":7,"16":3,"17":1,"18":1,"19":16,"20":16,"21":6,"22":10,"23":1,"24":1,"25":7,"26":1},"f":{"0":26,"1":16,"2":7},"b":{"0":[23,3],"1":[26,24],"2":[2,24],"3":[26,24],"4":[0,24],"5":[24,24],"6":[0,23],"7":[23,23],"8":[11,12],"9":[23,19],"10":[4,19],"11":[23,23],"12":[19,0],"13":[19,9],"14":[9,10],"15":[19,19],"16":[6,13],"17":[19,17],"18":[5,6],"19":[5,0],"20":[6,0],"21":[5,7],"22":[3,2],"23":[4,3],"24":[0,3],"25":[3,3],"26":[6,10],"27":[16,7],"28":[4,12],"29":[16,12],"30":[0,7],"31":[7,7],"32":[2,4],"33":[0,10],"34":[10,10],"35":[3,4],"36":[3,4],"37":[7,7],"38":[0,7],"39":[7,7]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/error.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/error.ts"],"names":[],"mappings":";;;AAAA,gDAAqE;AACrE,kDAAyF;AACzF,8CAAgF;AAEhF,qCAA8C;AAEvC,MAAM,gBAAgB,GAAG,CAAC,KAAuB,EAAyB,EAAE;;IACjF,IACE,CAAA,MAAA,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,0CAAE,KAAK,MAAK,uCAA2B,CAAC,OAAO;QAC9E,CAAA,MAAA,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,0CAAE,MAAM,MAAK,kCAAsB,CAAC,WAAW,EAC9E,CAAC;QACD,MAAM,aAAa,GAAG,CAAC,CAAC,CAAA,MAAA,KAAK,CAAC,MAAM,CAAC,YAAY,0CAAE,QAAQ,CAAA,CAAC;QAK5D,IACE,CAAA,MAAA,KAAK,CAAC,QAAQ,CAAC,gBAAgB,0CAAE,KAAK;YACtC,CAAC,KAAK,CAAC,QAAQ,CAAC,gBAAgB,CAAC,QAAQ,IAAI,CAAC,CAAC;gBAC7C,CAAC,CAAA,MAAA,MAAA,KAAK,CAAC,MAAM,CAAC,UAAU,0CAAE,OAAO,0CAAE,qBAAqB,KAAI,2CAAgC,CAAC,EAC/F,CAAC;YACD,IAAI,aAAa,EAAE,CAAC;gBAClB,OAAO,IAAA,2BAAkB,EAAC,KAAK,CAAC;oBAC9B,CAAC,CAAC,+BAAqB,CAAC,iCAAiC;oBACzD,CAAC,CAAC,+BAAqB,CAAC,6CAA6C,CAAC;YAC1E,CAAC;YAED,OAAO,IAAA,2BAAkB,EAAC,KAAK,CAAC;gBAC9B,CAAC,CAAC,+BAAqB,CAAC,kCAAkC;gBAC1D,CAAC,CAAC,+BAAqB,CAAC,8CAA8C,CAAC;QAC3E,CAAC;QAKD,IAAI,aAAa,EAAE,CAAC;YAClB,OAAO,IAAA,2BAAkB,EAAC,KAAK,CAAC;gBAC9B,CAAC,CAAC,+BAAqB,CAAC,mCAAmC;gBAC3D,CAAC,CAAC,+BAAqB,CAAC,+CAA+C,CAAC;QAC5E,CAAC;QAED,OAAO,IAAA,2BAAkB,EAAC,KAAK,CAAC;YAC9B,CAAC,CAAC,+BAAqB,CAAC,oCAAoC;YAC5D,CAAC,CAAC,+BAAqB,CAAC,gDAAgD,CAAC;IAC7E,CAAC;IACD,OAAO,MAAA,KAAK,CAAC,QAAQ,0CAAE,MAA+B,CAAC;AACzD,CAAC,CAAC;AAxCW,QAAA,gBAAgB,oBAwC3B;AAEK,MAAM,qBAAqB,GAAG,CAAC,KAAuB,EAAyB,EAAE;;IACtF,MAAM,aAAa,GAAG,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC;IAC3D,IACE,CAAA,MAAA,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,0CAAE,KAAK,MAAK,uCAA2B,CAAC,OAAO;QAC9E,CAAA,MAAA,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,0CAAE,MAAM,MAAK,kCAAsB,CAAC,KAAK,EACxE,CAAC;QACD,OAAO,aAAa,CAAC,CAAC,CAAC,+BAAqB,CAAC,eAAe,CAAC,CAAC,CAAC,+BAAqB,CAAC,OAAO,CAAC;IAC/F,CAAC;IACD,OAAO,MAAA,KAAK,CAAC,QAAQ,0CAAE,MAA+B,CAAC;AACzD,CAAC,CAAC;AATW,QAAA,qBAAqB,yBAShC;AAEK,MAAM,0BAA0B,GAAG,CAAC,KAAuB,EAAyB,EAAE;;IAC3F,OAAA,CAAA,MAAA,MAAA,KAAK,CAAC,MAAM,CAAC,UAAU,0CAAE,OAAO,0CAAE,qCAAqC;QACrE,CAAC,CAAC,+BAAqB,CAAC,sBAAsB;QAC9C,CAAC,CAAC,+BAAqB,CAAC,OAAO,CAAA;CAAA,CAAC;AAHvB,QAAA,0BAA0B,8BAGH","sourcesContent":["import { DEFAULT_MAX_CLIENT_SENDS_RETRIES } from '../utils/defaults';\nimport { CivicPassMessageAction, CivicPassMessageEventResult } from '../types/civicPass';\nimport { ExtendedGatewayStatus, InternalGatewayStatus } from '../types/gateway';\nimport { GatewayCoreState } from '../types/gatewayCore';\nimport { payerIsWalletOwner } from './common';\n\nexport const handleChainError = (state: GatewayCoreState): InternalGatewayStatus => {\n  if (\n    state.inputs.civicPass.received?.event === CivicPassMessageEventResult.FAILURE &&\n    state.inputs.civicPass.received?.action === CivicPassMessageAction.CHAIN_ERROR\n  ) {\n    const isRefreshFlow = !!state.inputs.gatewayToken?.received;\n\n    // handle the case where the user didn't send the client-sends transaction\n    // TODO use a different civicPass action to differentiate between failed send transactions and failed signMessages\n    // TODO make the number of attempts configurable\n    if (\n      state.internal.chainTransaction?.error &&\n      (state.internal.chainTransaction.attempts || 0) <=\n        (state.inputs.parameters?.options?.clientSendsMaxRetries || DEFAULT_MAX_CLIENT_SENDS_RETRIES)\n    ) {\n      if (isRefreshFlow) {\n        return payerIsWalletOwner(state)\n          ? ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND\n          : ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND;\n      }\n\n      return payerIsWalletOwner(state)\n        ? ExtendedGatewayStatus.ISSUANCE_AWAITING_TRANSACTION_SEND\n        : ExtendedGatewayStatus.ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND;\n    }\n\n    // The user tried to send the transaction, but it failed too many times\n    // No need to restart the flow, instead we will request a new transaction\n\n    if (isRefreshFlow) {\n      return payerIsWalletOwner(state)\n        ? ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX\n        : ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX;\n    }\n\n    return payerIsWalletOwner(state)\n      ? ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX\n      : ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX;\n  }\n  return state.internal?.status as InternalGatewayStatus;\n};\n\nexport const handleGatekeeperError = (state: GatewayCoreState): InternalGatewayStatus => {\n  const isRefreshFlow = !!state.inputs.gatewayToken.received;\n  if (\n    state.inputs.civicPass.received?.event === CivicPassMessageEventResult.FAILURE &&\n    state.inputs.civicPass.received?.action === CivicPassMessageAction.ERROR\n  ) {\n    return isRefreshFlow ? ExtendedGatewayStatus.RESTART_REFRESH : ExtendedGatewayStatus.RESTART;\n  }\n  return state.internal?.status as InternalGatewayStatus;\n};\n\nexport const handleUserValidationFailed = (state: GatewayCoreState): InternalGatewayStatus =>\n  state.inputs.parameters?.options?.disableAutoRestartOnValidationFailure\n    ? ExtendedGatewayStatus.USER_VALIDATION_FAILED\n    : ExtendedGatewayStatus.RESTART;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9e038fff954b698c949d91762c19d611f9dad359"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/initialisation.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/initialisation.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":134}},"2":{"start":{"line":4,"column":20},"end":{"line":4,"column":49}},"3":{"start":{"line":5,"column":16},"end":{"line":5,"column":41}},"4":{"start":{"line":6,"column":18},"end":{"line":6,"column":45}},"5":{"start":{"line":7,"column":17},"end":{"line":7,"column":36}},"6":{"start":{"line":8,"column":19},"end":{"line":8,"column":40}},"7":{"start":{"line":9,"column":40},"end":{"line":16,"column":1}},"8":{"start":{"line":11,"column":4},"end":{"line":15,"column":183}},"9":{"start":{"line":17,"column":0},"end":{"line":17,"column":74}},"10":{"start":{"line":18,"column":24},"end":{"line":30,"column":1}},"11":{"start":{"line":19,"column":4},"end":{"line":28,"column":5}},"12":{"start":{"line":20,"column":8},"end":{"line":23,"column":9}},"13":{"start":{"line":22,"column":12},"end":{"line":22,"column":49}},"14":{"start":{"line":24,"column":8},"end":{"line":27,"column":9}},"15":{"start":{"line":26,"column":12},"end":{"line":26,"column":52}},"16":{"start":{"line":29,"column":4},"end":{"line":29,"column":21}},"17":{"start":{"line":31,"column":0},"end":{"line":31,"column":42}},"18":{"start":{"line":32,"column":27},"end":{"line":37,"column":1}},"19":{"start":{"line":34,"column":4},"end":{"line":36,"column":79}},"20":{"start":{"line":38,"column":0},"end":{"line":38,"column":48}},"21":{"start":{"line":39,"column":28},"end":{"line":46,"column":1}},"22":{"start":{"line":41,"column":4},"end":{"line":45,"column":79}},"23":{"start":{"line":47,"column":0},"end":{"line":47,"column":50}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":40},"end":{"line":9,"column":41}},"loc":{"start":{"line":9,"column":51},"end":{"line":16,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":18,"column":24},"end":{"line":18,"column":25}},"loc":{"start":{"line":18,"column":35},"end":{"line":30,"column":1}},"line":18},"2":{"name":"(anonymous_2)","decl":{"start":{"line":32,"column":27},"end":{"line":32,"column":28}},"loc":{"start":{"line":32,"column":38},"end":{"line":37,"column":1}},"line":32},"3":{"name":"(anonymous_3)","decl":{"start":{"line":39,"column":28},"end":{"line":39,"column":29}},"loc":{"start":{"line":39,"column":39},"end":{"line":46,"column":1}},"line":39}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":11},"end":{"line":15,"column":182}},"type":"binary-expr","locations":[{"start":{"line":11,"column":11},"end":{"line":11,"column":144}},{"start":{"line":12,"column":9},"end":{"line":12,"column":42}},{"start":{"line":13,"column":12},"end":{"line":13,"column":80}},{"start":{"line":14,"column":13},"end":{"line":14,"column":117}},{"start":{"line":15,"column":17},"end":{"line":15,"column":54}},{"start":{"line":15,"column":58},"end":{"line":15,"column":179}}],"line":11},"1":{"loc":{"start":{"line":11,"column":12},"end":{"line":11,"column":97}},"type":"cond-expr","locations":[{"start":{"line":11,"column":79},"end":{"line":11,"column":85}},{"start":{"line":11,"column":88},"end":{"line":11,"column":97}}],"line":11},"2":{"loc":{"start":{"line":11,"column":12},"end":{"line":11,"column":76}},"type":"binary-expr","locations":[{"start":{"line":11,"column":12},"end":{"line":11,"column":59}},{"start":{"line":11,"column":63},"end":{"line":11,"column":76}}],"line":11},"3":{"loc":{"start":{"line":14,"column":15},"end":{"line":14,"column":116}},"type":"cond-expr","locations":[{"start":{"line":14,"column":74},"end":{"line":14,"column":80}},{"start":{"line":14,"column":83},"end":{"line":14,"column":116}}],"line":14},"4":{"loc":{"start":{"line":14,"column":15},"end":{"line":14,"column":71}},"type":"binary-expr","locations":[{"start":{"line":14,"column":15},"end":{"line":14,"column":54}},{"start":{"line":14,"column":58},"end":{"line":14,"column":71}}],"line":14},"5":{"loc":{"start":{"line":15,"column":59},"end":{"line":15,"column":142}},"type":"cond-expr","locations":[{"start":{"line":15,"column":124},"end":{"line":15,"column":130}},{"start":{"line":15,"column":133},"end":{"line":15,"column":142}}],"line":15},"6":{"loc":{"start":{"line":15,"column":59},"end":{"line":15,"column":121}},"type":"binary-expr","locations":[{"start":{"line":15,"column":59},"end":{"line":15,"column":104}},{"start":{"line":15,"column":108},"end":{"line":15,"column":121}}],"line":15},"7":{"loc":{"start":{"line":19,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":28,"column":5}},{"start":{"line":19,"column":4},"end":{"line":28,"column":5}}],"line":19},"8":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":93}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":38}},{"start":{"line":19,"column":42},"end":{"line":19,"column":93}}],"line":19},"9":{"loc":{"start":{"line":20,"column":8},"end":{"line":23,"column":9}},"type":"if","locations":[{"start":{"line":20,"column":8},"end":{"line":23,"column":9}},{"start":{"line":20,"column":8},"end":{"line":23,"column":9}}],"line":20},"10":{"loc":{"start":{"line":20,"column":12},"end":{"line":21,"column":74}},"type":"binary-expr","locations":[{"start":{"line":20,"column":12},"end":{"line":20,"column":78}},{"start":{"line":21,"column":12},"end":{"line":21,"column":74}}],"line":20},"11":{"loc":{"start":{"line":24,"column":8},"end":{"line":27,"column":9}},"type":"if","locations":[{"start":{"line":24,"column":8},"end":{"line":27,"column":9}},{"start":{"line":24,"column":8},"end":{"line":27,"column":9}}],"line":24},"12":{"loc":{"start":{"line":24,"column":12},"end":{"line":25,"column":80}},"type":"binary-expr","locations":[{"start":{"line":24,"column":12},"end":{"line":24,"column":84}},{"start":{"line":25,"column":12},"end":{"line":25,"column":80}}],"line":24},"13":{"loc":{"start":{"line":34,"column":11},"end":{"line":36,"column":78}},"type":"binary-expr","locations":[{"start":{"line":34,"column":11},"end":{"line":34,"column":62}},{"start":{"line":35,"column":8},"end":{"line":35,"column":43}},{"start":{"line":36,"column":9},"end":{"line":36,"column":77}}],"line":34},"14":{"loc":{"start":{"line":36,"column":9},"end":{"line":36,"column":77}},"type":"cond-expr","locations":[{"start":{"line":36,"column":59},"end":{"line":36,"column":65}},{"start":{"line":36,"column":68},"end":{"line":36,"column":77}}],"line":36},"15":{"loc":{"start":{"line":36,"column":9},"end":{"line":36,"column":56}},"type":"binary-expr","locations":[{"start":{"line":36,"column":9},"end":{"line":36,"column":39}},{"start":{"line":36,"column":43},"end":{"line":36,"column":56}}],"line":36},"16":{"loc":{"start":{"line":41,"column":11},"end":{"line":45,"column":78}},"type":"binary-expr","locations":[{"start":{"line":41,"column":11},"end":{"line":41,"column":46}},{"start":{"line":42,"column":8},"end":{"line":42,"column":61}},{"start":{"line":43,"column":8},"end":{"line":43,"column":59}},{"start":{"line":44,"column":8},"end":{"line":44,"column":52}},{"start":{"line":45,"column":9},"end":{"line":45,"column":77}}],"line":41},"17":{"loc":{"start":{"line":45,"column":9},"end":{"line":45,"column":77}},"type":"cond-expr","locations":[{"start":{"line":45,"column":59},"end":{"line":45,"column":65}},{"start":{"line":45,"column":68},"end":{"line":45,"column":77}}],"line":45},"18":{"loc":{"start":{"line":45,"column":9},"end":{"line":45,"column":56}},"type":"binary-expr","locations":[{"start":{"line":45,"column":9},"end":{"line":45,"column":39}},{"start":{"line":45,"column":43},"end":{"line":45,"column":56}}],"line":45}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":113,"9":1,"10":1,"11":1256,"12":1248,"13":3,"14":1245,"15":566,"16":687,"17":1,"18":1,"19":608,"20":1,"21":1,"22":650,"23":1},"f":{"0":113,"1":1256,"2":608,"3":650},"b":{"0":[113,111,111,99,99,12],"1":[2,111],"2":[113,111],"3":[0,99],"4":[99,99],"5":[0,12],"6":[12,12],"7":[1248,8],"8":[1256,113],"9":[3,1245],"10":[1248,1246],"11":[566,679],"12":[1245,808],"13":[608,606,490],"14":[0,490],"15":[490,490],"16":[650,197,187,176,0],"17":[0,0],"18":[0,0]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/initialisation.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/initialisation.ts"],"names":[],"mappings":";;;AAAA,kDAA4D;AAC5D,0CAA6C;AAC7C,8CAAiD;AAEjD,qCAKkB;AAClB,yCAAkF;AAM3E,MAAM,+BAA+B,GAAG,CAAC,KAAuB,EAAE,EAAE;;IACzE,OAAA,CAAA,MAAA,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,0CAAE,MAAM,MAAK,kCAAsB,CAAC,MAAM;QACzE,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM;YAChC,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,KAAK,mBAAW,CAAC,WAAW;YAC5D,CAAC,CAAC,CAAA,MAAA,KAAK,CAAC,MAAM,CAAC,UAAU,0CAAE,8BAA8B,CAAA;gBACvD,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,IAAI,CAAA,MAAA,KAAK,CAAC,MAAM,CAAC,gBAAgB,0CAAE,MAAM,MAAK,mBAAW,CAAC,WAAW,CAAC,CAAC,CAAC,CAAA;CAAA,CAAC;AALxG,QAAA,+BAA+B,mCAKyE;AAE9G,MAAM,eAAe,GAAG,CAAC,KAAuB,EAAmC,EAAE;IAC1F,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,IAAI,IAAA,uCAA+B,EAAC,KAAK,CAAC,EAAE,CAAC;QAC7E,IACE,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,KAAK,mBAAW,CAAC,KAAK;YAC1D,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,KAAK,mBAAW,CAAC,KAAK,EACtD,CAAC;YACD,OAAO,uBAAa,CAAC,KAAK,CAAC;QAC7B,CAAC;QACD,IACE,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,KAAK,mBAAW,CAAC,WAAW;YAChE,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,KAAK,mBAAW,CAAC,WAAW,EAC5D,CAAC;YACD,OAAO,uBAAa,CAAC,QAAQ,CAAC;QAChC,CAAC;IACH,CAAC;IAED,OAAO,SAAS,CAAC;AACnB,CAAC,CAAC;AAjBW,QAAA,eAAe,mBAiB1B;AACK,MAAM,kBAAkB,GAAG,CAAC,KAAuB,EAA+C,EAAE;;IACzG,OAAA,IAAA,uCAA8B,EAAC,KAAK,CAAC;QACrC,IAAA,uBAAe,EAAC,KAAK,CAAC;SACrB,MAAA,KAAK,CAAC,QAAQ,0CAAE,MAAsD,CAAA,CAAA;CAAA,CAAC;AAH7D,QAAA,kBAAkB,sBAG2C;AAQnE,MAAM,mBAAmB,GAAG,CAAC,KAAuB,EAA2B,EAAE;;IACtF,OAAA,IAAA,uBAAe,EAAC,KAAK,CAAC;QACtB,IAAA,yCAAgC,EAAC,KAAK,CAAC;QACvC,IAAA,uCAA8B,EAAC,KAAK,CAAC;QACrC,IAAA,gCAAqB,EAAC,KAAK,CAAC;SAC3B,MAAA,KAAK,CAAC,QAAQ,0CAAE,MAAkC,CAAA,CAAA;CAAA,CAAC;AALzC,QAAA,mBAAmB,uBAKsB","sourcesContent":["import { CivicPassMessageAction } from '../types/civicPass';\nimport { InputStatus } from '../types/fetch';\nimport { GatewayStatus } from '../types/gateway';\nimport { GatewayCoreState } from '../types/gatewayCore';\nimport {\n  GatewayTokenCheckType,\n  statusFromGatewayTokenIfExists,\n  statusIfGatekeeperRecordRejected,\n  StatusIfGatekeeperRecordRejectedType,\n} from './common';\nimport { CalculateIssuanceStatusReturn, computeIssuanceStatus } from './issuance';\n\nexport type ComputeCheckingType = GatewayStatus.ERROR | GatewayStatus.CHECKING;\n// returns true if:\n// - the civicPass status action is STATUS\n// AND the gatewayToken or gatekeeperRecord calls are still in progress\nexport const civicPassStatusLookupInProgress = (state: GatewayCoreState) =>\n  state.inputs.civicPass.received?.action === CivicPassMessageAction.STATUS &&\n  (!state.inputs.gatewayToken.status ||\n    state.inputs.gatewayToken.status === InputStatus.IN_PROGRESS ||\n    (!state.inputs.parameters?.disableInitialGatekeeperLookup &&\n      (!state.inputs.gatekeeperRecord.status || state.inputs.gatekeeperRecord?.status === InputStatus.IN_PROGRESS)));\n\nexport const computeChecking = (state: GatewayCoreState): ComputeCheckingType | undefined => {\n  if (!state.inputs.civicPass.status || civicPassStatusLookupInProgress(state)) {\n    if (\n      state.inputs.gatekeeperRecord.status === InputStatus.ERROR ||\n      state.inputs.gatewayToken.status === InputStatus.ERROR\n    ) {\n      return GatewayStatus.ERROR;\n    }\n    if (\n      state.inputs.gatekeeperRecord.status === InputStatus.IN_PROGRESS ||\n      state.inputs.gatewayToken.status === InputStatus.IN_PROGRESS\n    ) {\n      return GatewayStatus.CHECKING;\n    }\n  }\n\n  return undefined;\n};\nexport const checkForInProgress = (state: GatewayCoreState): GatewayTokenCheckType | ComputeCheckingType =>\n  statusFromGatewayTokenIfExists(state) ||\n  computeChecking(state) ||\n  (state.internal?.status as GatewayTokenCheckType | ComputeCheckingType);\n\nexport type ComputeInitialStateType =\n  | StatusIfGatekeeperRecordRejectedType\n  | ComputeCheckingType\n  | GatewayTokenCheckType\n  | CalculateIssuanceStatusReturn;\n\nexport const computeInitialState = (state: GatewayCoreState): ComputeInitialStateType =>\n  computeChecking(state) ||\n  statusIfGatekeeperRecordRejected(state) ||\n  statusFromGatewayTokenIfExists(state) ||\n  computeIssuanceStatus(state) ||\n  (state.internal?.status as ComputeInitialStateType);\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4375843c32f274814aafd09b0318f500e6e317f1"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/issuance.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/issuance.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":653}},"2":{"start":{"line":4,"column":18},"end":{"line":4,"column":45}},"3":{"start":{"line":5,"column":17},"end":{"line":5,"column":43}},"4":{"start":{"line":6,"column":17},"end":{"line":6,"column":36}},"5":{"start":{"line":7,"column":16},"end":{"line":7,"column":41}},"6":{"start":{"line":8,"column":20},"end":{"line":8,"column":49}},"7":{"start":{"line":9,"column":24},"end":{"line":9,"column":57}},"8":{"start":{"line":10,"column":24},"end":{"line":10,"column":57}},"9":{"start":{"line":11,"column":53},"end":{"line":21,"column":1}},"10":{"start":{"line":13,"column":27},"end":{"line":13,"column":105}},"11":{"start":{"line":14,"column":4},"end":{"line":20,"column":5}},"12":{"start":{"line":17,"column":8},"end":{"line":19,"column":95}},"13":{"start":{"line":22,"column":0},"end":{"line":22,"column":100}},"14":{"start":{"line":23,"column":51},"end":{"line":30,"column":1}},"15":{"start":{"line":25,"column":4},"end":{"line":29,"column":156}},"16":{"start":{"line":31,"column":0},"end":{"line":31,"column":96}},"17":{"start":{"line":32,"column":26},"end":{"line":34,"column":1}},"18":{"start":{"line":33,"column":4},"end":{"line":33,"column":90}},"19":{"start":{"line":35,"column":0},"end":{"line":35,"column":46}},"20":{"start":{"line":36,"column":31},"end":{"line":39,"column":1}},"21":{"start":{"line":38,"column":4},"end":{"line":38,"column":234}},"22":{"start":{"line":40,"column":0},"end":{"line":40,"column":56}},"23":{"start":{"line":41,"column":45},"end":{"line":47,"column":1}},"24":{"start":{"line":43,"column":4},"end":{"line":46,"column":5}},"25":{"start":{"line":45,"column":8},"end":{"line":45,"column":67}},"26":{"start":{"line":48,"column":0},"end":{"line":48,"column":84}},"27":{"start":{"line":49,"column":38},"end":{"line":80,"column":1}},"28":{"start":{"line":51,"column":27},"end":{"line":51,"column":105}},"29":{"start":{"line":52,"column":29},"end":{"line":52,"column":58}},"30":{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},"31":{"start":{"line":54,"column":8},"end":{"line":54,"column":37}},"32":{"start":{"line":56,"column":4},"end":{"line":58,"column":5}},"33":{"start":{"line":57,"column":8},"end":{"line":57,"column":71}},"34":{"start":{"line":59,"column":4},"end":{"line":78,"column":5}},"35":{"start":{"line":60,"column":8},"end":{"line":64,"column":9}},"36":{"start":{"line":63,"column":12},"end":{"line":63,"column":84}},"37":{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},"38":{"start":{"line":66,"column":12},"end":{"line":66,"column":84}},"39":{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},"40":{"start":{"line":69,"column":12},"end":{"line":69,"column":75}},"41":{"start":{"line":71,"column":8},"end":{"line":76,"column":9}},"42":{"start":{"line":72,"column":12},"end":{"line":74,"column":13}},"43":{"start":{"line":73,"column":16},"end":{"line":73,"column":90}},"44":{"start":{"line":75,"column":12},"end":{"line":75,"column":98}},"45":{"start":{"line":77,"column":8},"end":{"line":77,"column":25}},"46":{"start":{"line":79,"column":4},"end":{"line":79,"column":76}},"47":{"start":{"line":81,"column":0},"end":{"line":81,"column":70}},"48":{"start":{"line":82,"column":49},"end":{"line":93,"column":1}},"49":{"start":{"line":84,"column":27},"end":{"line":84,"column":105}},"50":{"start":{"line":85,"column":29},"end":{"line":85,"column":58}},"51":{"start":{"line":86,"column":4},"end":{"line":92,"column":5}},"52":{"start":{"line":89,"column":8},"end":{"line":91,"column":48}},"53":{"start":{"line":94,"column":0},"end":{"line":94,"column":92}},"54":{"start":{"line":95,"column":56},"end":{"line":117,"column":1}},"55":{"start":{"line":97,"column":27},"end":{"line":97,"column":105}},"56":{"start":{"line":98,"column":4},"end":{"line":100,"column":5}},"57":{"start":{"line":99,"column":8},"end":{"line":99,"column":70}},"58":{"start":{"line":101,"column":47},"end":{"line":101,"column":230}},"59":{"start":{"line":102,"column":4},"end":{"line":109,"column":5}},"60":{"start":{"line":105,"column":8},"end":{"line":107,"column":9}},"61":{"start":{"line":106,"column":12},"end":{"line":106,"column":135}},"62":{"start":{"line":108,"column":8},"end":{"line":108,"column":50}},"63":{"start":{"line":110,"column":4},"end":{"line":113,"column":5}},"64":{"start":{"line":112,"column":8},"end":{"line":112,"column":66}},"65":{"start":{"line":114,"column":4},"end":{"line":116,"column":5}},"66":{"start":{"line":115,"column":8},"end":{"line":115,"column":105}},"67":{"start":{"line":118,"column":0},"end":{"line":118,"column":106}},"68":{"start":{"line":119,"column":45},"end":{"line":124,"column":1}},"69":{"start":{"line":121,"column":4},"end":{"line":123,"column":79}},"70":{"start":{"line":125,"column":0},"end":{"line":125,"column":84}},"71":{"start":{"line":126,"column":33},"end":{"line":131,"column":1}},"72":{"start":{"line":128,"column":4},"end":{"line":130,"column":79}},"73":{"start":{"line":132,"column":0},"end":{"line":132,"column":60}},"74":{"start":{"line":133,"column":44},"end":{"line":138,"column":1}},"75":{"start":{"line":135,"column":4},"end":{"line":137,"column":79}},"76":{"start":{"line":139,"column":0},"end":{"line":139,"column":82}},"77":{"start":{"line":140,"column":32},"end":{"line":146,"column":1}},"78":{"start":{"line":142,"column":4},"end":{"line":145,"column":79}},"79":{"start":{"line":147,"column":0},"end":{"line":147,"column":58}},"80":{"start":{"line":148,"column":32},"end":{"line":190,"column":1}},"81":{"start":{"line":150,"column":27},"end":{"line":150,"column":105}},"82":{"start":{"line":151,"column":29},"end":{"line":151,"column":58}},"83":{"start":{"line":152,"column":4},"end":{"line":154,"column":5}},"84":{"start":{"line":153,"column":8},"end":{"line":153,"column":70}},"85":{"start":{"line":155,"column":4},"end":{"line":158,"column":5}},"86":{"start":{"line":157,"column":8},"end":{"line":157,"column":66}},"87":{"start":{"line":159,"column":4},"end":{"line":168,"column":5}},"88":{"start":{"line":160,"column":8},"end":{"line":166,"column":9}},"89":{"start":{"line":161,"column":55},"end":{"line":161,"column":238}},"90":{"start":{"line":162,"column":12},"end":{"line":164,"column":13}},"91":{"start":{"line":163,"column":16},"end":{"line":163,"column":61}},"92":{"start":{"line":165,"column":12},"end":{"line":165,"column":109}},"93":{"start":{"line":167,"column":8},"end":{"line":167,"column":53}},"94":{"start":{"line":169,"column":4},"end":{"line":189,"column":5}},"95":{"start":{"line":170,"column":8},"end":{"line":175,"column":9}},"96":{"start":{"line":171,"column":12},"end":{"line":173,"column":13}},"97":{"start":{"line":172,"column":16},"end":{"line":172,"column":90}},"98":{"start":{"line":174,"column":12},"end":{"line":174,"column":100}},"99":{"start":{"line":176,"column":8},"end":{"line":178,"column":9}},"100":{"start":{"line":177,"column":12},"end":{"line":177,"column":75}},"101":{"start":{"line":179,"column":8},"end":{"line":188,"column":9}},"102":{"start":{"line":180,"column":12},"end":{"line":184,"column":13}},"103":{"start":{"line":183,"column":16},"end":{"line":183,"column":88}},"104":{"start":{"line":187,"column":12},"end":{"line":187,"column":84}},"105":{"start":{"line":191,"column":0},"end":{"line":191,"column":58}},"106":{"start":{"line":192,"column":30},"end":{"line":197,"column":1}},"107":{"start":{"line":194,"column":4},"end":{"line":196,"column":79}},"108":{"start":{"line":198,"column":0},"end":{"line":198,"column":54}},"109":{"start":{"line":199,"column":51},"end":{"line":204,"column":1}},"110":{"start":{"line":201,"column":4},"end":{"line":203,"column":79}},"111":{"start":{"line":205,"column":0},"end":{"line":205,"column":96}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":11,"column":53},"end":{"line":11,"column":54}},"loc":{"start":{"line":11,"column":64},"end":{"line":21,"column":1}},"line":11},"1":{"name":"(anonymous_1)","decl":{"start":{"line":23,"column":51},"end":{"line":23,"column":52}},"loc":{"start":{"line":23,"column":71},"end":{"line":30,"column":1}},"line":23},"2":{"name":"(anonymous_2)","decl":{"start":{"line":32,"column":26},"end":{"line":32,"column":27}},"loc":{"start":{"line":32,"column":48},"end":{"line":34,"column":1}},"line":32},"3":{"name":"(anonymous_3)","decl":{"start":{"line":36,"column":31},"end":{"line":36,"column":32}},"loc":{"start":{"line":36,"column":53},"end":{"line":39,"column":1}},"line":36},"4":{"name":"(anonymous_4)","decl":{"start":{"line":41,"column":45},"end":{"line":41,"column":46}},"loc":{"start":{"line":41,"column":56},"end":{"line":47,"column":1}},"line":41},"5":{"name":"(anonymous_5)","decl":{"start":{"line":49,"column":38},"end":{"line":49,"column":39}},"loc":{"start":{"line":49,"column":49},"end":{"line":80,"column":1}},"line":49},"6":{"name":"(anonymous_6)","decl":{"start":{"line":82,"column":49},"end":{"line":82,"column":50}},"loc":{"start":{"line":82,"column":60},"end":{"line":93,"column":1}},"line":82},"7":{"name":"(anonymous_7)","decl":{"start":{"line":95,"column":56},"end":{"line":95,"column":57}},"loc":{"start":{"line":95,"column":67},"end":{"line":117,"column":1}},"line":95},"8":{"name":"(anonymous_8)","decl":{"start":{"line":119,"column":45},"end":{"line":119,"column":46}},"loc":{"start":{"line":119,"column":56},"end":{"line":124,"column":1}},"line":119},"9":{"name":"(anonymous_9)","decl":{"start":{"line":126,"column":33},"end":{"line":126,"column":34}},"loc":{"start":{"line":126,"column":44},"end":{"line":131,"column":1}},"line":126},"10":{"name":"(anonymous_10)","decl":{"start":{"line":133,"column":44},"end":{"line":133,"column":45}},"loc":{"start":{"line":133,"column":55},"end":{"line":138,"column":1}},"line":133},"11":{"name":"(anonymous_11)","decl":{"start":{"line":140,"column":32},"end":{"line":140,"column":33}},"loc":{"start":{"line":140,"column":43},"end":{"line":146,"column":1}},"line":140},"12":{"name":"(anonymous_12)","decl":{"start":{"line":148,"column":32},"end":{"line":148,"column":33}},"loc":{"start":{"line":148,"column":43},"end":{"line":190,"column":1}},"line":148},"13":{"name":"(anonymous_13)","decl":{"start":{"line":192,"column":30},"end":{"line":192,"column":31}},"loc":{"start":{"line":192,"column":41},"end":{"line":197,"column":1}},"line":192},"14":{"name":"(anonymous_14)","decl":{"start":{"line":199,"column":51},"end":{"line":199,"column":52}},"loc":{"start":{"line":199,"column":62},"end":{"line":204,"column":1}},"line":199}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":27},"end":{"line":13,"column":105}},"type":"cond-expr","locations":[{"start":{"line":13,"column":85},"end":{"line":13,"column":91}},{"start":{"line":13,"column":94},"end":{"line":13,"column":105}}],"line":13},"1":{"loc":{"start":{"line":13,"column":27},"end":{"line":13,"column":82}},"type":"binary-expr","locations":[{"start":{"line":13,"column":27},"end":{"line":13,"column":65}},{"start":{"line":13,"column":69},"end":{"line":13,"column":82}}],"line":13},"2":{"loc":{"start":{"line":14,"column":4},"end":{"line":20,"column":5}},"type":"if","locations":[{"start":{"line":14,"column":4},"end":{"line":20,"column":5}},{"start":{"line":14,"column":4},"end":{"line":20,"column":5}}],"line":14},"3":{"loc":{"start":{"line":14,"column":8},"end":{"line":16,"column":110}},"type":"binary-expr","locations":[{"start":{"line":14,"column":8},"end":{"line":14,"column":165}},{"start":{"line":15,"column":8},"end":{"line":15,"column":146}},{"start":{"line":16,"column":8},"end":{"line":16,"column":110}}],"line":14},"4":{"loc":{"start":{"line":14,"column":9},"end":{"line":14,"column":94}},"type":"cond-expr","locations":[{"start":{"line":14,"column":64},"end":{"line":14,"column":70}},{"start":{"line":14,"column":73},"end":{"line":14,"column":94}}],"line":14},"5":{"loc":{"start":{"line":14,"column":9},"end":{"line":14,"column":61}},"type":"binary-expr","locations":[{"start":{"line":14,"column":9},"end":{"line":14,"column":32}},{"start":{"line":14,"column":36},"end":{"line":14,"column":61}}],"line":14},"6":{"loc":{"start":{"line":15,"column":9},"end":{"line":15,"column":93}},"type":"cond-expr","locations":[{"start":{"line":15,"column":64},"end":{"line":15,"column":70}},{"start":{"line":15,"column":73},"end":{"line":15,"column":93}}],"line":15},"7":{"loc":{"start":{"line":15,"column":9},"end":{"line":15,"column":61}},"type":"binary-expr","locations":[{"start":{"line":15,"column":9},"end":{"line":15,"column":32}},{"start":{"line":15,"column":36},"end":{"line":15,"column":61}}],"line":15},"8":{"loc":{"start":{"line":16,"column":9},"end":{"line":16,"column":95}},"type":"cond-expr","locations":[{"start":{"line":16,"column":64},"end":{"line":16,"column":70}},{"start":{"line":16,"column":73},"end":{"line":16,"column":95}}],"line":16},"9":{"loc":{"start":{"line":16,"column":9},"end":{"line":16,"column":61}},"type":"binary-expr","locations":[{"start":{"line":16,"column":9},"end":{"line":16,"column":32}},{"start":{"line":16,"column":36},"end":{"line":16,"column":61}}],"line":16},"10":{"loc":{"start":{"line":17,"column":15},"end":{"line":19,"column":94}},"type":"cond-expr","locations":[{"start":{"line":18,"column":14},"end":{"line":18,"column":82}},{"start":{"line":19,"column":14},"end":{"line":19,"column":94}}],"line":17},"11":{"loc":{"start":{"line":25,"column":11},"end":{"line":29,"column":155}},"type":"binary-expr","locations":[{"start":{"line":25,"column":12},"end":{"line":25,"column":145}},{"start":{"line":26,"column":8},"end":{"line":26,"column":146}},{"start":{"line":27,"column":8},"end":{"line":27,"column":129}},{"start":{"line":28,"column":9},"end":{"line":28,"column":144}},{"start":{"line":29,"column":12},"end":{"line":29,"column":154}}],"line":25},"12":{"loc":{"start":{"line":25,"column":13},"end":{"line":25,"column":98}},"type":"cond-expr","locations":[{"start":{"line":25,"column":68},"end":{"line":25,"column":74}},{"start":{"line":25,"column":77},"end":{"line":25,"column":98}}],"line":25},"13":{"loc":{"start":{"line":25,"column":13},"end":{"line":25,"column":65}},"type":"binary-expr","locations":[{"start":{"line":25,"column":13},"end":{"line":25,"column":36}},{"start":{"line":25,"column":40},"end":{"line":25,"column":65}}],"line":25},"14":{"loc":{"start":{"line":26,"column":9},"end":{"line":26,"column":93}},"type":"cond-expr","locations":[{"start":{"line":26,"column":64},"end":{"line":26,"column":70}},{"start":{"line":26,"column":73},"end":{"line":26,"column":93}}],"line":26},"15":{"loc":{"start":{"line":26,"column":9},"end":{"line":26,"column":61}},"type":"binary-expr","locations":[{"start":{"line":26,"column":9},"end":{"line":26,"column":32}},{"start":{"line":26,"column":36},"end":{"line":26,"column":61}}],"line":26},"16":{"loc":{"start":{"line":27,"column":9},"end":{"line":27,"column":85}},"type":"cond-expr","locations":[{"start":{"line":27,"column":67},"end":{"line":27,"column":73}},{"start":{"line":27,"column":76},"end":{"line":27,"column":85}}],"line":27},"17":{"loc":{"start":{"line":27,"column":9},"end":{"line":27,"column":64}},"type":"binary-expr","locations":[{"start":{"line":27,"column":9},"end":{"line":27,"column":47}},{"start":{"line":27,"column":51},"end":{"line":27,"column":64}}],"line":27},"18":{"loc":{"start":{"line":28,"column":10},"end":{"line":28,"column":95}},"type":"cond-expr","locations":[{"start":{"line":28,"column":65},"end":{"line":28,"column":71}},{"start":{"line":28,"column":74},"end":{"line":28,"column":95}}],"line":28},"19":{"loc":{"start":{"line":28,"column":10},"end":{"line":28,"column":62}},"type":"binary-expr","locations":[{"start":{"line":28,"column":10},"end":{"line":28,"column":33}},{"start":{"line":28,"column":37},"end":{"line":28,"column":62}}],"line":28},"20":{"loc":{"start":{"line":29,"column":13},"end":{"line":29,"column":97}},"type":"cond-expr","locations":[{"start":{"line":29,"column":68},"end":{"line":29,"column":74}},{"start":{"line":29,"column":77},"end":{"line":29,"column":97}}],"line":29},"21":{"loc":{"start":{"line":29,"column":13},"end":{"line":29,"column":65}},"type":"binary-expr","locations":[{"start":{"line":29,"column":13},"end":{"line":29,"column":36}},{"start":{"line":29,"column":40},"end":{"line":29,"column":65}}],"line":29},"22":{"loc":{"start":{"line":38,"column":14},"end":{"line":38,"column":232}},"type":"cond-expr","locations":[{"start":{"line":38,"column":198},"end":{"line":38,"column":204}},{"start":{"line":38,"column":207},"end":{"line":38,"column":232}}],"line":38},"23":{"loc":{"start":{"line":38,"column":14},"end":{"line":38,"column":195}},"type":"binary-expr","locations":[{"start":{"line":38,"column":14},"end":{"line":38,"column":178}},{"start":{"line":38,"column":182},"end":{"line":38,"column":195}}],"line":38},"24":{"loc":{"start":{"line":38,"column":20},"end":{"line":38,"column":168}},"type":"cond-expr","locations":[{"start":{"line":38,"column":149},"end":{"line":38,"column":155}},{"start":{"line":38,"column":158},"end":{"line":38,"column":168}}],"line":38},"25":{"loc":{"start":{"line":38,"column":20},"end":{"line":38,"column":146}},"type":"binary-expr","locations":[{"start":{"line":38,"column":20},"end":{"line":38,"column":129}},{"start":{"line":38,"column":133},"end":{"line":38,"column":146}}],"line":38},"26":{"loc":{"start":{"line":38,"column":26},"end":{"line":38,"column":119}},"type":"cond-expr","locations":[{"start":{"line":38,"column":85},"end":{"line":38,"column":91}},{"start":{"line":38,"column":94},"end":{"line":38,"column":119}}],"line":38},"27":{"loc":{"start":{"line":38,"column":26},"end":{"line":38,"column":82}},"type":"binary-expr","locations":[{"start":{"line":38,"column":26},"end":{"line":38,"column":51}},{"start":{"line":38,"column":55},"end":{"line":38,"column":82}}],"line":38},"28":{"loc":{"start":{"line":43,"column":4},"end":{"line":46,"column":5}},"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":46,"column":5}},{"start":{"line":43,"column":4},"end":{"line":46,"column":5}}],"line":43},"29":{"loc":{"start":{"line":43,"column":9},"end":{"line":43,"column":155}},"type":"cond-expr","locations":[{"start":{"line":43,"column":134},"end":{"line":43,"column":140}},{"start":{"line":43,"column":143},"end":{"line":43,"column":155}}],"line":43},"30":{"loc":{"start":{"line":43,"column":9},"end":{"line":43,"column":131}},"type":"binary-expr","locations":[{"start":{"line":43,"column":9},"end":{"line":43,"column":114}},{"start":{"line":43,"column":118},"end":{"line":43,"column":131}}],"line":43},"31":{"loc":{"start":{"line":43,"column":15},"end":{"line":43,"column":104}},"type":"cond-expr","locations":[{"start":{"line":43,"column":72},"end":{"line":43,"column":78}},{"start":{"line":43,"column":81},"end":{"line":43,"column":104}}],"line":43},"32":{"loc":{"start":{"line":43,"column":15},"end":{"line":43,"column":69}},"type":"binary-expr","locations":[{"start":{"line":43,"column":15},"end":{"line":43,"column":52}},{"start":{"line":43,"column":56},"end":{"line":43,"column":69}}],"line":43},"33":{"loc":{"start":{"line":51,"column":27},"end":{"line":51,"column":105}},"type":"cond-expr","locations":[{"start":{"line":51,"column":85},"end":{"line":51,"column":91}},{"start":{"line":51,"column":94},"end":{"line":51,"column":105}}],"line":51},"34":{"loc":{"start":{"line":51,"column":27},"end":{"line":51,"column":82}},"type":"binary-expr","locations":[{"start":{"line":51,"column":27},"end":{"line":51,"column":65}},{"start":{"line":51,"column":69},"end":{"line":51,"column":82}}],"line":51},"35":{"loc":{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},{"start":{"line":53,"column":4},"end":{"line":55,"column":5}}],"line":53},"36":{"loc":{"start":{"line":53,"column":9},"end":{"line":53,"column":100}},"type":"cond-expr","locations":[{"start":{"line":53,"column":68},"end":{"line":53,"column":74}},{"start":{"line":53,"column":77},"end":{"line":53,"column":100}}],"line":53},"37":{"loc":{"start":{"line":53,"column":9},"end":{"line":53,"column":65}},"type":"binary-expr","locations":[{"start":{"line":53,"column":9},"end":{"line":53,"column":34}},{"start":{"line":53,"column":38},"end":{"line":53,"column":65}}],"line":53},"38":{"loc":{"start":{"line":56,"column":4},"end":{"line":58,"column":5}},"type":"if","locations":[{"start":{"line":56,"column":4},"end":{"line":58,"column":5}},{"start":{"line":56,"column":4},"end":{"line":58,"column":5}}],"line":56},"39":{"loc":{"start":{"line":59,"column":4},"end":{"line":78,"column":5}},"type":"if","locations":[{"start":{"line":59,"column":4},"end":{"line":78,"column":5}},{"start":{"line":59,"column":4},"end":{"line":78,"column":5}}],"line":59},"40":{"loc":{"start":{"line":59,"column":8},"end":{"line":59,"column":84}},"type":"cond-expr","locations":[{"start":{"line":59,"column":67},"end":{"line":59,"column":73}},{"start":{"line":59,"column":76},"end":{"line":59,"column":84}}],"line":59},"41":{"loc":{"start":{"line":59,"column":8},"end":{"line":59,"column":64}},"type":"binary-expr","locations":[{"start":{"line":59,"column":8},"end":{"line":59,"column":47}},{"start":{"line":59,"column":51},"end":{"line":59,"column":64}}],"line":59},"42":{"loc":{"start":{"line":60,"column":8},"end":{"line":64,"column":9}},"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":64,"column":9}},{"start":{"line":60,"column":8},"end":{"line":64,"column":9}}],"line":60},"43":{"loc":{"start":{"line":60,"column":12},"end":{"line":62,"column":99}},"type":"binary-expr","locations":[{"start":{"line":60,"column":12},"end":{"line":60,"column":138}},{"start":{"line":61,"column":12},"end":{"line":61,"column":147}},{"start":{"line":62,"column":12},"end":{"line":62,"column":99}}],"line":60},"44":{"loc":{"start":{"line":60,"column":13},"end":{"line":60,"column":104}},"type":"cond-expr","locations":[{"start":{"line":60,"column":72},"end":{"line":60,"column":78}},{"start":{"line":60,"column":81},"end":{"line":60,"column":104}}],"line":60},"45":{"loc":{"start":{"line":60,"column":13},"end":{"line":60,"column":69}},"type":"binary-expr","locations":[{"start":{"line":60,"column":13},"end":{"line":60,"column":38}},{"start":{"line":60,"column":42},"end":{"line":60,"column":69}}],"line":60},"46":{"loc":{"start":{"line":61,"column":13},"end":{"line":61,"column":98}},"type":"cond-expr","locations":[{"start":{"line":61,"column":68},"end":{"line":61,"column":74}},{"start":{"line":61,"column":77},"end":{"line":61,"column":98}}],"line":61},"47":{"loc":{"start":{"line":61,"column":13},"end":{"line":61,"column":65}},"type":"binary-expr","locations":[{"start":{"line":61,"column":13},"end":{"line":61,"column":36}},{"start":{"line":61,"column":40},"end":{"line":61,"column":65}}],"line":61},"48":{"loc":{"start":{"line":62,"column":14},"end":{"line":62,"column":98}},"type":"cond-expr","locations":[{"start":{"line":62,"column":75},"end":{"line":62,"column":81}},{"start":{"line":62,"column":84},"end":{"line":62,"column":98}}],"line":62},"49":{"loc":{"start":{"line":62,"column":14},"end":{"line":62,"column":72}},"type":"binary-expr","locations":[{"start":{"line":62,"column":14},"end":{"line":62,"column":55}},{"start":{"line":62,"column":59},"end":{"line":62,"column":72}}],"line":62},"50":{"loc":{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},"type":"if","locations":[{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},{"start":{"line":65,"column":8},"end":{"line":67,"column":9}}],"line":65},"51":{"loc":{"start":{"line":65,"column":12},"end":{"line":65,"column":146}},"type":"cond-expr","locations":[{"start":{"line":65,"column":126},"end":{"line":65,"column":132}},{"start":{"line":65,"column":135},"end":{"line":65,"column":146}}],"line":65},"52":{"loc":{"start":{"line":65,"column":12},"end":{"line":65,"column":123}},"type":"binary-expr","locations":[{"start":{"line":65,"column":12},"end":{"line":65,"column":106}},{"start":{"line":65,"column":110},"end":{"line":65,"column":123}}],"line":65},"53":{"loc":{"start":{"line":65,"column":18},"end":{"line":65,"column":96}},"type":"cond-expr","locations":[{"start":{"line":65,"column":68},"end":{"line":65,"column":74}},{"start":{"line":65,"column":77},"end":{"line":65,"column":96}}],"line":65},"54":{"loc":{"start":{"line":65,"column":18},"end":{"line":65,"column":65}},"type":"binary-expr","locations":[{"start":{"line":65,"column":18},"end":{"line":65,"column":48}},{"start":{"line":65,"column":52},"end":{"line":65,"column":65}}],"line":65},"55":{"loc":{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},"type":"if","locations":[{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},{"start":{"line":68,"column":8},"end":{"line":70,"column":9}}],"line":68},"56":{"loc":{"start":{"line":68,"column":12},"end":{"line":68,"column":143}},"type":"cond-expr","locations":[{"start":{"line":68,"column":126},"end":{"line":68,"column":132}},{"start":{"line":68,"column":135},"end":{"line":68,"column":143}}],"line":68},"57":{"loc":{"start":{"line":68,"column":12},"end":{"line":68,"column":123}},"type":"binary-expr","locations":[{"start":{"line":68,"column":12},"end":{"line":68,"column":106}},{"start":{"line":68,"column":110},"end":{"line":68,"column":123}}],"line":68},"58":{"loc":{"start":{"line":68,"column":18},"end":{"line":68,"column":96}},"type":"cond-expr","locations":[{"start":{"line":68,"column":68},"end":{"line":68,"column":74}},{"start":{"line":68,"column":77},"end":{"line":68,"column":96}}],"line":68},"59":{"loc":{"start":{"line":68,"column":18},"end":{"line":68,"column":65}},"type":"binary-expr","locations":[{"start":{"line":68,"column":18},"end":{"line":68,"column":48}},{"start":{"line":68,"column":52},"end":{"line":68,"column":65}}],"line":68},"60":{"loc":{"start":{"line":71,"column":8},"end":{"line":76,"column":9}},"type":"if","locations":[{"start":{"line":71,"column":8},"end":{"line":76,"column":9}},{"start":{"line":71,"column":8},"end":{"line":76,"column":9}}],"line":71},"61":{"loc":{"start":{"line":71,"column":12},"end":{"line":71,"column":96}},"type":"cond-expr","locations":[{"start":{"line":71,"column":73},"end":{"line":71,"column":79}},{"start":{"line":71,"column":82},"end":{"line":71,"column":96}}],"line":71},"62":{"loc":{"start":{"line":71,"column":12},"end":{"line":71,"column":70}},"type":"binary-expr","locations":[{"start":{"line":71,"column":12},"end":{"line":71,"column":53}},{"start":{"line":71,"column":57},"end":{"line":71,"column":70}}],"line":71},"63":{"loc":{"start":{"line":72,"column":12},"end":{"line":74,"column":13}},"type":"if","locations":[{"start":{"line":72,"column":12},"end":{"line":74,"column":13}},{"start":{"line":72,"column":12},"end":{"line":74,"column":13}}],"line":72},"64":{"loc":{"start":{"line":84,"column":27},"end":{"line":84,"column":105}},"type":"cond-expr","locations":[{"start":{"line":84,"column":85},"end":{"line":84,"column":91}},{"start":{"line":84,"column":94},"end":{"line":84,"column":105}}],"line":84},"65":{"loc":{"start":{"line":84,"column":27},"end":{"line":84,"column":82}},"type":"binary-expr","locations":[{"start":{"line":84,"column":27},"end":{"line":84,"column":65}},{"start":{"line":84,"column":69},"end":{"line":84,"column":82}}],"line":84},"66":{"loc":{"start":{"line":86,"column":4},"end":{"line":92,"column":5}},"type":"if","locations":[{"start":{"line":86,"column":4},"end":{"line":92,"column":5}},{"start":{"line":86,"column":4},"end":{"line":92,"column":5}}],"line":86},"67":{"loc":{"start":{"line":86,"column":8},"end":{"line":88,"column":142}},"type":"binary-expr","locations":[{"start":{"line":86,"column":8},"end":{"line":86,"column":22}},{"start":{"line":87,"column":9},"end":{"line":87,"column":207}},{"start":{"line":88,"column":12},"end":{"line":88,"column":141}}],"line":86},"68":{"loc":{"start":{"line":87,"column":10},"end":{"line":87,"column":156}},"type":"cond-expr","locations":[{"start":{"line":87,"column":139},"end":{"line":87,"column":145}},{"start":{"line":87,"column":148},"end":{"line":87,"column":156}}],"line":87},"69":{"loc":{"start":{"line":87,"column":10},"end":{"line":87,"column":136}},"type":"binary-expr","locations":[{"start":{"line":87,"column":10},"end":{"line":87,"column":119}},{"start":{"line":87,"column":123},"end":{"line":87,"column":136}}],"line":87},"70":{"loc":{"start":{"line":87,"column":16},"end":{"line":87,"column":109}},"type":"cond-expr","locations":[{"start":{"line":87,"column":75},"end":{"line":87,"column":81}},{"start":{"line":87,"column":84},"end":{"line":87,"column":109}}],"line":87},"71":{"loc":{"start":{"line":87,"column":16},"end":{"line":87,"column":72}},"type":"binary-expr","locations":[{"start":{"line":87,"column":16},"end":{"line":87,"column":41}},{"start":{"line":87,"column":45},"end":{"line":87,"column":72}}],"line":87},"72":{"loc":{"start":{"line":88,"column":13},"end":{"line":88,"column":104}},"type":"cond-expr","locations":[{"start":{"line":88,"column":72},"end":{"line":88,"column":78}},{"start":{"line":88,"column":81},"end":{"line":88,"column":104}}],"line":88},"73":{"loc":{"start":{"line":88,"column":13},"end":{"line":88,"column":69}},"type":"binary-expr","locations":[{"start":{"line":88,"column":13},"end":{"line":88,"column":38}},{"start":{"line":88,"column":42},"end":{"line":88,"column":69}}],"line":88},"74":{"loc":{"start":{"line":89,"column":15},"end":{"line":91,"column":47}},"type":"cond-expr","locations":[{"start":{"line":90,"column":14},"end":{"line":90,"column":77}},{"start":{"line":91,"column":14},"end":{"line":91,"column":47}}],"line":89},"75":{"loc":{"start":{"line":89,"column":15},"end":{"line":89,"column":136}},"type":"binary-expr","locations":[{"start":{"line":89,"column":16},"end":{"line":89,"column":92}},{"start":{"line":89,"column":97},"end":{"line":89,"column":136}}],"line":89},"76":{"loc":{"start":{"line":89,"column":16},"end":{"line":89,"column":92}},"type":"cond-expr","locations":[{"start":{"line":89,"column":75},"end":{"line":89,"column":81}},{"start":{"line":89,"column":84},"end":{"line":89,"column":92}}],"line":89},"77":{"loc":{"start":{"line":89,"column":16},"end":{"line":89,"column":72}},"type":"binary-expr","locations":[{"start":{"line":89,"column":16},"end":{"line":89,"column":55}},{"start":{"line":89,"column":59},"end":{"line":89,"column":72}}],"line":89},"78":{"loc":{"start":{"line":97,"column":27},"end":{"line":97,"column":105}},"type":"cond-expr","locations":[{"start":{"line":97,"column":85},"end":{"line":97,"column":91}},{"start":{"line":97,"column":94},"end":{"line":97,"column":105}}],"line":97},"79":{"loc":{"start":{"line":97,"column":27},"end":{"line":97,"column":82}},"type":"binary-expr","locations":[{"start":{"line":97,"column":27},"end":{"line":97,"column":65}},{"start":{"line":97,"column":69},"end":{"line":97,"column":82}}],"line":97},"80":{"loc":{"start":{"line":98,"column":4},"end":{"line":100,"column":5}},"type":"if","locations":[{"start":{"line":98,"column":4},"end":{"line":100,"column":5}},{"start":{"line":98,"column":4},"end":{"line":100,"column":5}}],"line":98},"81":{"loc":{"start":{"line":98,"column":9},"end":{"line":98,"column":93}},"type":"cond-expr","locations":[{"start":{"line":98,"column":64},"end":{"line":98,"column":70}},{"start":{"line":98,"column":73},"end":{"line":98,"column":93}}],"line":98},"82":{"loc":{"start":{"line":98,"column":9},"end":{"line":98,"column":61}},"type":"binary-expr","locations":[{"start":{"line":98,"column":9},"end":{"line":98,"column":32}},{"start":{"line":98,"column":36},"end":{"line":98,"column":61}}],"line":98},"83":{"loc":{"start":{"line":101,"column":89},"end":{"line":101,"column":229}},"type":"cond-expr","locations":[{"start":{"line":101,"column":211},"end":{"line":101,"column":217}},{"start":{"line":101,"column":220},"end":{"line":101,"column":229}}],"line":101},"84":{"loc":{"start":{"line":101,"column":89},"end":{"line":101,"column":208}},"type":"binary-expr","locations":[{"start":{"line":101,"column":89},"end":{"line":101,"column":191}},{"start":{"line":101,"column":195},"end":{"line":101,"column":208}}],"line":101},"85":{"loc":{"start":{"line":101,"column":95},"end":{"line":101,"column":181}},"type":"cond-expr","locations":[{"start":{"line":101,"column":150},"end":{"line":101,"column":156}},{"start":{"line":101,"column":159},"end":{"line":101,"column":181}}],"line":101},"86":{"loc":{"start":{"line":101,"column":95},"end":{"line":101,"column":147}},"type":"binary-expr","locations":[{"start":{"line":101,"column":95},"end":{"line":101,"column":118}},{"start":{"line":101,"column":122},"end":{"line":101,"column":147}}],"line":101},"87":{"loc":{"start":{"line":102,"column":4},"end":{"line":109,"column":5}},"type":"if","locations":[{"start":{"line":102,"column":4},"end":{"line":109,"column":5}},{"start":{"line":102,"column":4},"end":{"line":109,"column":5}}],"line":102},"88":{"loc":{"start":{"line":102,"column":8},"end":{"line":104,"column":42}},"type":"binary-expr","locations":[{"start":{"line":102,"column":8},"end":{"line":102,"column":141}},{"start":{"line":103,"column":8},"end":{"line":103,"column":146}},{"start":{"line":104,"column":8},"end":{"line":104,"column":42}}],"line":102},"89":{"loc":{"start":{"line":102,"column":9},"end":{"line":102,"column":94}},"type":"cond-expr","locations":[{"start":{"line":102,"column":64},"end":{"line":102,"column":70}},{"start":{"line":102,"column":73},"end":{"line":102,"column":94}}],"line":102},"90":{"loc":{"start":{"line":102,"column":9},"end":{"line":102,"column":61}},"type":"binary-expr","locations":[{"start":{"line":102,"column":9},"end":{"line":102,"column":32}},{"start":{"line":102,"column":36},"end":{"line":102,"column":61}}],"line":102},"91":{"loc":{"start":{"line":103,"column":9},"end":{"line":103,"column":93}},"type":"cond-expr","locations":[{"start":{"line":103,"column":64},"end":{"line":103,"column":70}},{"start":{"line":103,"column":73},"end":{"line":103,"column":93}}],"line":103},"92":{"loc":{"start":{"line":103,"column":9},"end":{"line":103,"column":61}},"type":"binary-expr","locations":[{"start":{"line":103,"column":9},"end":{"line":103,"column":32}},{"start":{"line":103,"column":36},"end":{"line":103,"column":61}}],"line":103},"93":{"loc":{"start":{"line":105,"column":8},"end":{"line":107,"column":9}},"type":"if","locations":[{"start":{"line":105,"column":8},"end":{"line":107,"column":9}},{"start":{"line":105,"column":8},"end":{"line":107,"column":9}}],"line":105},"94":{"loc":{"start":{"line":106,"column":19},"end":{"line":106,"column":134}},"type":"cond-expr","locations":[{"start":{"line":106,"column":44},"end":{"line":106,"column":94}},{"start":{"line":106,"column":97},"end":{"line":106,"column":134}}],"line":106},"95":{"loc":{"start":{"line":110,"column":4},"end":{"line":113,"column":5}},"type":"if","locations":[{"start":{"line":110,"column":4},"end":{"line":113,"column":5}},{"start":{"line":110,"column":4},"end":{"line":113,"column":5}}],"line":110},"96":{"loc":{"start":{"line":110,"column":8},"end":{"line":111,"column":146}},"type":"binary-expr","locations":[{"start":{"line":110,"column":8},"end":{"line":110,"column":143}},{"start":{"line":111,"column":8},"end":{"line":111,"column":146}}],"line":110},"97":{"loc":{"start":{"line":110,"column":9},"end":{"line":110,"column":94}},"type":"cond-expr","locations":[{"start":{"line":110,"column":64},"end":{"line":110,"column":70}},{"start":{"line":110,"column":73},"end":{"line":110,"column":94}}],"line":110},"98":{"loc":{"start":{"line":110,"column":9},"end":{"line":110,"column":61}},"type":"binary-expr","locations":[{"start":{"line":110,"column":9},"end":{"line":110,"column":32}},{"start":{"line":110,"column":36},"end":{"line":110,"column":61}}],"line":110},"99":{"loc":{"start":{"line":111,"column":9},"end":{"line":111,"column":93}},"type":"cond-expr","locations":[{"start":{"line":111,"column":64},"end":{"line":111,"column":70}},{"start":{"line":111,"column":73},"end":{"line":111,"column":93}}],"line":111},"100":{"loc":{"start":{"line":111,"column":9},"end":{"line":111,"column":61}},"type":"binary-expr","locations":[{"start":{"line":111,"column":9},"end":{"line":111,"column":32}},{"start":{"line":111,"column":36},"end":{"line":111,"column":61}}],"line":111},"101":{"loc":{"start":{"line":114,"column":4},"end":{"line":116,"column":5}},"type":"if","locations":[{"start":{"line":114,"column":4},"end":{"line":116,"column":5}},{"start":{"line":114,"column":4},"end":{"line":116,"column":5}}],"line":114},"102":{"loc":{"start":{"line":115,"column":15},"end":{"line":115,"column":104}},"type":"binary-expr","locations":[{"start":{"line":115,"column":15},"end":{"line":115,"column":49}},{"start":{"line":115,"column":53},"end":{"line":115,"column":104}}],"line":115},"103":{"loc":{"start":{"line":121,"column":11},"end":{"line":123,"column":78}},"type":"binary-expr","locations":[{"start":{"line":121,"column":11},"end":{"line":121,"column":62}},{"start":{"line":122,"column":8},"end":{"line":122,"column":75}},{"start":{"line":123,"column":9},"end":{"line":123,"column":77}}],"line":121},"104":{"loc":{"start":{"line":123,"column":9},"end":{"line":123,"column":77}},"type":"cond-expr","locations":[{"start":{"line":123,"column":59},"end":{"line":123,"column":65}},{"start":{"line":123,"column":68},"end":{"line":123,"column":77}}],"line":123},"105":{"loc":{"start":{"line":123,"column":9},"end":{"line":123,"column":56}},"type":"binary-expr","locations":[{"start":{"line":123,"column":9},"end":{"line":123,"column":39}},{"start":{"line":123,"column":43},"end":{"line":123,"column":56}}],"line":123},"106":{"loc":{"start":{"line":128,"column":11},"end":{"line":130,"column":78}},"type":"binary-expr","locations":[{"start":{"line":128,"column":11},"end":{"line":128,"column":62}},{"start":{"line":129,"column":8},"end":{"line":129,"column":68}},{"start":{"line":130,"column":9},"end":{"line":130,"column":77}}],"line":128},"107":{"loc":{"start":{"line":130,"column":9},"end":{"line":130,"column":77}},"type":"cond-expr","locations":[{"start":{"line":130,"column":59},"end":{"line":130,"column":65}},{"start":{"line":130,"column":68},"end":{"line":130,"column":77}}],"line":130},"108":{"loc":{"start":{"line":130,"column":9},"end":{"line":130,"column":56}},"type":"binary-expr","locations":[{"start":{"line":130,"column":9},"end":{"line":130,"column":39}},{"start":{"line":130,"column":43},"end":{"line":130,"column":56}}],"line":130},"109":{"loc":{"start":{"line":135,"column":11},"end":{"line":137,"column":78}},"type":"binary-expr","locations":[{"start":{"line":135,"column":11},"end":{"line":135,"column":62}},{"start":{"line":136,"column":8},"end":{"line":136,"column":64}},{"start":{"line":137,"column":9},"end":{"line":137,"column":77}}],"line":135},"110":{"loc":{"start":{"line":137,"column":9},"end":{"line":137,"column":77}},"type":"cond-expr","locations":[{"start":{"line":137,"column":59},"end":{"line":137,"column":65}},{"start":{"line":137,"column":68},"end":{"line":137,"column":77}}],"line":137},"111":{"loc":{"start":{"line":137,"column":9},"end":{"line":137,"column":56}},"type":"binary-expr","locations":[{"start":{"line":137,"column":9},"end":{"line":137,"column":39}},{"start":{"line":137,"column":43},"end":{"line":137,"column":56}}],"line":137},"112":{"loc":{"start":{"line":142,"column":11},"end":{"line":145,"column":78}},"type":"binary-expr","locations":[{"start":{"line":142,"column":11},"end":{"line":142,"column":62}},{"start":{"line":143,"column":8},"end":{"line":143,"column":61}},{"start":{"line":144,"column":8},"end":{"line":144,"column":57}},{"start":{"line":145,"column":9},"end":{"line":145,"column":77}}],"line":142},"113":{"loc":{"start":{"line":145,"column":9},"end":{"line":145,"column":77}},"type":"cond-expr","locations":[{"start":{"line":145,"column":59},"end":{"line":145,"column":65}},{"start":{"line":145,"column":68},"end":{"line":145,"column":77}}],"line":145},"114":{"loc":{"start":{"line":145,"column":9},"end":{"line":145,"column":56}},"type":"binary-expr","locations":[{"start":{"line":145,"column":9},"end":{"line":145,"column":39}},{"start":{"line":145,"column":43},"end":{"line":145,"column":56}}],"line":145},"115":{"loc":{"start":{"line":150,"column":27},"end":{"line":150,"column":105}},"type":"cond-expr","locations":[{"start":{"line":150,"column":85},"end":{"line":150,"column":91}},{"start":{"line":150,"column":94},"end":{"line":150,"column":105}}],"line":150},"116":{"loc":{"start":{"line":150,"column":27},"end":{"line":150,"column":82}},"type":"binary-expr","locations":[{"start":{"line":150,"column":27},"end":{"line":150,"column":65}},{"start":{"line":150,"column":69},"end":{"line":150,"column":82}}],"line":150},"117":{"loc":{"start":{"line":152,"column":4},"end":{"line":154,"column":5}},"type":"if","locations":[{"start":{"line":152,"column":4},"end":{"line":154,"column":5}},{"start":{"line":152,"column":4},"end":{"line":154,"column":5}}],"line":152},"118":{"loc":{"start":{"line":152,"column":9},"end":{"line":152,"column":93}},"type":"cond-expr","locations":[{"start":{"line":152,"column":64},"end":{"line":152,"column":70}},{"start":{"line":152,"column":73},"end":{"line":152,"column":93}}],"line":152},"119":{"loc":{"start":{"line":152,"column":9},"end":{"line":152,"column":61}},"type":"binary-expr","locations":[{"start":{"line":152,"column":9},"end":{"line":152,"column":32}},{"start":{"line":152,"column":36},"end":{"line":152,"column":61}}],"line":152},"120":{"loc":{"start":{"line":155,"column":4},"end":{"line":158,"column":5}},"type":"if","locations":[{"start":{"line":155,"column":4},"end":{"line":158,"column":5}},{"start":{"line":155,"column":4},"end":{"line":158,"column":5}}],"line":155},"121":{"loc":{"start":{"line":155,"column":8},"end":{"line":156,"column":146}},"type":"binary-expr","locations":[{"start":{"line":155,"column":8},"end":{"line":155,"column":143}},{"start":{"line":156,"column":8},"end":{"line":156,"column":146}}],"line":155},"122":{"loc":{"start":{"line":155,"column":9},"end":{"line":155,"column":94}},"type":"cond-expr","locations":[{"start":{"line":155,"column":64},"end":{"line":155,"column":70}},{"start":{"line":155,"column":73},"end":{"line":155,"column":94}}],"line":155},"123":{"loc":{"start":{"line":155,"column":9},"end":{"line":155,"column":61}},"type":"binary-expr","locations":[{"start":{"line":155,"column":9},"end":{"line":155,"column":32}},{"start":{"line":155,"column":36},"end":{"line":155,"column":61}}],"line":155},"124":{"loc":{"start":{"line":156,"column":9},"end":{"line":156,"column":93}},"type":"cond-expr","locations":[{"start":{"line":156,"column":64},"end":{"line":156,"column":70}},{"start":{"line":156,"column":73},"end":{"line":156,"column":93}}],"line":156},"125":{"loc":{"start":{"line":156,"column":9},"end":{"line":156,"column":61}},"type":"binary-expr","locations":[{"start":{"line":156,"column":9},"end":{"line":156,"column":32}},{"start":{"line":156,"column":36},"end":{"line":156,"column":61}}],"line":156},"126":{"loc":{"start":{"line":159,"column":4},"end":{"line":168,"column":5}},"type":"if","locations":[{"start":{"line":159,"column":4},"end":{"line":168,"column":5}},{"start":{"line":159,"column":4},"end":{"line":168,"column":5}}],"line":159},"127":{"loc":{"start":{"line":159,"column":8},"end":{"line":159,"column":310}},"type":"binary-expr","locations":[{"start":{"line":159,"column":8},"end":{"line":159,"column":104}},{"start":{"line":159,"column":108},"end":{"line":159,"column":310}}],"line":159},"128":{"loc":{"start":{"line":159,"column":10},"end":{"line":159,"column":103}},"type":"cond-expr","locations":[{"start":{"line":159,"column":69},"end":{"line":159,"column":75}},{"start":{"line":159,"column":78},"end":{"line":159,"column":103}}],"line":159},"129":{"loc":{"start":{"line":159,"column":10},"end":{"line":159,"column":66}},"type":"binary-expr","locations":[{"start":{"line":159,"column":10},"end":{"line":159,"column":35}},{"start":{"line":159,"column":39},"end":{"line":159,"column":66}}],"line":159},"130":{"loc":{"start":{"line":159,"column":109},"end":{"line":159,"column":255}},"type":"cond-expr","locations":[{"start":{"line":159,"column":238},"end":{"line":159,"column":244}},{"start":{"line":159,"column":247},"end":{"line":159,"column":255}}],"line":159},"131":{"loc":{"start":{"line":159,"column":109},"end":{"line":159,"column":235}},"type":"binary-expr","locations":[{"start":{"line":159,"column":109},"end":{"line":159,"column":218}},{"start":{"line":159,"column":222},"end":{"line":159,"column":235}}],"line":159},"132":{"loc":{"start":{"line":159,"column":115},"end":{"line":159,"column":208}},"type":"cond-expr","locations":[{"start":{"line":159,"column":174},"end":{"line":159,"column":180}},{"start":{"line":159,"column":183},"end":{"line":159,"column":208}}],"line":159},"133":{"loc":{"start":{"line":159,"column":115},"end":{"line":159,"column":171}},"type":"binary-expr","locations":[{"start":{"line":159,"column":115},"end":{"line":159,"column":140}},{"start":{"line":159,"column":144},"end":{"line":159,"column":171}}],"line":159},"134":{"loc":{"start":{"line":160,"column":8},"end":{"line":166,"column":9}},"type":"if","locations":[{"start":{"line":160,"column":8},"end":{"line":166,"column":9}},{"start":{"line":160,"column":8},"end":{"line":166,"column":9}}],"line":160},"135":{"loc":{"start":{"line":161,"column":97},"end":{"line":161,"column":237}},"type":"cond-expr","locations":[{"start":{"line":161,"column":219},"end":{"line":161,"column":225}},{"start":{"line":161,"column":228},"end":{"line":161,"column":237}}],"line":161},"136":{"loc":{"start":{"line":161,"column":97},"end":{"line":161,"column":216}},"type":"binary-expr","locations":[{"start":{"line":161,"column":97},"end":{"line":161,"column":199}},{"start":{"line":161,"column":203},"end":{"line":161,"column":216}}],"line":161},"137":{"loc":{"start":{"line":161,"column":103},"end":{"line":161,"column":189}},"type":"cond-expr","locations":[{"start":{"line":161,"column":158},"end":{"line":161,"column":164}},{"start":{"line":161,"column":167},"end":{"line":161,"column":189}}],"line":161},"138":{"loc":{"start":{"line":161,"column":103},"end":{"line":161,"column":155}},"type":"binary-expr","locations":[{"start":{"line":161,"column":103},"end":{"line":161,"column":126}},{"start":{"line":161,"column":130},"end":{"line":161,"column":155}}],"line":161},"139":{"loc":{"start":{"line":162,"column":12},"end":{"line":164,"column":13}},"type":"if","locations":[{"start":{"line":162,"column":12},"end":{"line":164,"column":13}},{"start":{"line":162,"column":12},"end":{"line":164,"column":13}}],"line":162},"140":{"loc":{"start":{"line":165,"column":19},"end":{"line":165,"column":108}},"type":"binary-expr","locations":[{"start":{"line":165,"column":19},"end":{"line":165,"column":53}},{"start":{"line":165,"column":57},"end":{"line":165,"column":108}}],"line":165},"141":{"loc":{"start":{"line":169,"column":4},"end":{"line":189,"column":5}},"type":"if","locations":[{"start":{"line":169,"column":4},"end":{"line":189,"column":5}},{"start":{"line":169,"column":4},"end":{"line":189,"column":5}}],"line":169},"142":{"loc":{"start":{"line":169,"column":9},"end":{"line":169,"column":155}},"type":"cond-expr","locations":[{"start":{"line":169,"column":138},"end":{"line":169,"column":144}},{"start":{"line":169,"column":147},"end":{"line":169,"column":155}}],"line":169},"143":{"loc":{"start":{"line":169,"column":9},"end":{"line":169,"column":135}},"type":"binary-expr","locations":[{"start":{"line":169,"column":9},"end":{"line":169,"column":118}},{"start":{"line":169,"column":122},"end":{"line":169,"column":135}}],"line":169},"144":{"loc":{"start":{"line":169,"column":15},"end":{"line":169,"column":108}},"type":"cond-expr","locations":[{"start":{"line":169,"column":74},"end":{"line":169,"column":80}},{"start":{"line":169,"column":83},"end":{"line":169,"column":108}}],"line":169},"145":{"loc":{"start":{"line":169,"column":15},"end":{"line":169,"column":71}},"type":"binary-expr","locations":[{"start":{"line":169,"column":15},"end":{"line":169,"column":40}},{"start":{"line":169,"column":44},"end":{"line":169,"column":71}}],"line":169},"146":{"loc":{"start":{"line":170,"column":8},"end":{"line":175,"column":9}},"type":"if","locations":[{"start":{"line":170,"column":8},"end":{"line":175,"column":9}},{"start":{"line":170,"column":8},"end":{"line":175,"column":9}}],"line":170},"147":{"loc":{"start":{"line":171,"column":12},"end":{"line":173,"column":13}},"type":"if","locations":[{"start":{"line":171,"column":12},"end":{"line":173,"column":13}},{"start":{"line":171,"column":12},"end":{"line":173,"column":13}}],"line":171},"148":{"loc":{"start":{"line":176,"column":8},"end":{"line":178,"column":9}},"type":"if","locations":[{"start":{"line":176,"column":8},"end":{"line":178,"column":9}},{"start":{"line":176,"column":8},"end":{"line":178,"column":9}}],"line":176},"149":{"loc":{"start":{"line":179,"column":8},"end":{"line":188,"column":9}},"type":"if","locations":[{"start":{"line":179,"column":8},"end":{"line":188,"column":9}},{"start":{"line":179,"column":8},"end":{"line":188,"column":9}}],"line":179},"150":{"loc":{"start":{"line":179,"column":12},"end":{"line":179,"column":88}},"type":"cond-expr","locations":[{"start":{"line":179,"column":71},"end":{"line":179,"column":77}},{"start":{"line":179,"column":80},"end":{"line":179,"column":88}}],"line":179},"151":{"loc":{"start":{"line":179,"column":12},"end":{"line":179,"column":68}},"type":"binary-expr","locations":[{"start":{"line":179,"column":12},"end":{"line":179,"column":51}},{"start":{"line":179,"column":55},"end":{"line":179,"column":68}}],"line":179},"152":{"loc":{"start":{"line":180,"column":12},"end":{"line":184,"column":13}},"type":"if","locations":[{"start":{"line":180,"column":12},"end":{"line":184,"column":13}},{"start":{"line":180,"column":12},"end":{"line":184,"column":13}}],"line":180},"153":{"loc":{"start":{"line":180,"column":16},"end":{"line":182,"column":103}},"type":"binary-expr","locations":[{"start":{"line":180,"column":16},"end":{"line":180,"column":142}},{"start":{"line":181,"column":16},"end":{"line":181,"column":151}},{"start":{"line":182,"column":16},"end":{"line":182,"column":103}}],"line":180},"154":{"loc":{"start":{"line":180,"column":17},"end":{"line":180,"column":108}},"type":"cond-expr","locations":[{"start":{"line":180,"column":76},"end":{"line":180,"column":82}},{"start":{"line":180,"column":85},"end":{"line":180,"column":108}}],"line":180},"155":{"loc":{"start":{"line":180,"column":17},"end":{"line":180,"column":73}},"type":"binary-expr","locations":[{"start":{"line":180,"column":17},"end":{"line":180,"column":42}},{"start":{"line":180,"column":46},"end":{"line":180,"column":73}}],"line":180},"156":{"loc":{"start":{"line":181,"column":17},"end":{"line":181,"column":102}},"type":"cond-expr","locations":[{"start":{"line":181,"column":72},"end":{"line":181,"column":78}},{"start":{"line":181,"column":81},"end":{"line":181,"column":102}}],"line":181},"157":{"loc":{"start":{"line":181,"column":17},"end":{"line":181,"column":69}},"type":"binary-expr","locations":[{"start":{"line":181,"column":17},"end":{"line":181,"column":40}},{"start":{"line":181,"column":44},"end":{"line":181,"column":69}}],"line":181},"158":{"loc":{"start":{"line":182,"column":18},"end":{"line":182,"column":102}},"type":"cond-expr","locations":[{"start":{"line":182,"column":79},"end":{"line":182,"column":85}},{"start":{"line":182,"column":88},"end":{"line":182,"column":102}}],"line":182},"159":{"loc":{"start":{"line":182,"column":18},"end":{"line":182,"column":76}},"type":"binary-expr","locations":[{"start":{"line":182,"column":18},"end":{"line":182,"column":59}},{"start":{"line":182,"column":63},"end":{"line":182,"column":76}}],"line":182},"160":{"loc":{"start":{"line":194,"column":11},"end":{"line":196,"column":78}},"type":"binary-expr","locations":[{"start":{"line":194,"column":11},"end":{"line":194,"column":62}},{"start":{"line":195,"column":8},"end":{"line":195,"column":51}},{"start":{"line":196,"column":9},"end":{"line":196,"column":77}}],"line":194},"161":{"loc":{"start":{"line":196,"column":9},"end":{"line":196,"column":77}},"type":"cond-expr","locations":[{"start":{"line":196,"column":59},"end":{"line":196,"column":65}},{"start":{"line":196,"column":68},"end":{"line":196,"column":77}}],"line":196},"162":{"loc":{"start":{"line":196,"column":9},"end":{"line":196,"column":56}},"type":"binary-expr","locations":[{"start":{"line":196,"column":9},"end":{"line":196,"column":39}},{"start":{"line":196,"column":43},"end":{"line":196,"column":56}}],"line":196},"163":{"loc":{"start":{"line":201,"column":11},"end":{"line":203,"column":78}},"type":"binary-expr","locations":[{"start":{"line":201,"column":11},"end":{"line":201,"column":62}},{"start":{"line":202,"column":8},"end":{"line":202,"column":72}},{"start":{"line":203,"column":9},"end":{"line":203,"column":77}}],"line":201},"164":{"loc":{"start":{"line":203,"column":9},"end":{"line":203,"column":77}},"type":"cond-expr","locations":[{"start":{"line":203,"column":59},"end":{"line":203,"column":65}},{"start":{"line":203,"column":68},"end":{"line":203,"column":77}}],"line":203},"165":{"loc":{"start":{"line":203,"column":9},"end":{"line":203,"column":56}},"type":"binary-expr","locations":[{"start":{"line":203,"column":9},"end":{"line":203,"column":39}},{"start":{"line":203,"column":43},"end":{"line":203,"column":56}}],"line":203}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":3,"11":3,"12":1,"13":1,"14":1,"15":307,"16":1,"17":1,"18":59,"19":1,"20":1,"21":48,"22":1,"23":1,"24":6,"25":2,"26":1,"27":1,"28":76,"29":76,"30":76,"31":24,"32":52,"33":4,"34":48,"35":42,"36":1,"37":41,"38":7,"39":34,"40":6,"41":28,"42":27,"43":26,"44":1,"45":1,"46":6,"47":1,"48":1,"49":28,"50":28,"51":28,"52":25,"53":1,"54":1,"55":12,"56":12,"57":1,"58":11,"59":11,"60":5,"61":1,"62":4,"63":6,"64":2,"65":4,"66":2,"67":1,"68":1,"69":0,"70":1,"71":1,"72":23,"73":1,"74":1,"75":10,"76":1,"77":1,"78":87,"79":1,"80":1,"81":382,"82":382,"83":382,"84":3,"85":379,"86":24,"87":355,"88":294,"89":36,"90":36,"91":5,"92":31,"93":258,"94":61,"95":7,"96":3,"97":2,"98":1,"99":4,"100":2,"101":2,"102":1,"103":1,"104":1,"105":1,"106":1,"107":363,"108":1,"109":1,"110":3,"111":1},"f":{"0":3,"1":307,"2":59,"3":48,"4":6,"5":76,"6":28,"7":12,"8":0,"9":23,"10":10,"11":87,"12":382,"13":363,"14":3},"b":{"0":[0,3],"1":[3,3],"2":[1,2],"3":[3,1,1],"4":[2,1],"5":[3,1],"6":[0,1],"7":[1,1],"8":[0,1],"9":[1,1],"10":[1,0],"11":[307,129,129,276,14],"12":[164,143],"13":[307,145],"14":[0,129],"15":[129,129],"16":[0,129],"17":[129,129],"18":[164,112],"19":[276,114],"20":[0,14],"21":[14,14],"22":[7,41],"23":[48,48],"24":[2,46],"25":[48,48],"26":[2,46],"27":[48,48],"28":[2,4],"29":[4,2],"30":[6,3],"31":[1,5],"32":[6,6],"33":[5,71],"34":[76,76],"35":[24,52],"36":[3,73],"37":[76,76],"38":[4,48],"39":[42,6],"40":[0,48],"41":[48,48],"42":[1,41],"43":[42,40,34],"44":[2,40],"45":[42,42],"46":[31,9],"47":[40,11],"48":[0,34],"49":[34,34],"50":[7,34],"51":[10,31],"52":[41,41],"53":[3,38],"54":[41,41],"55":[6,28],"56":[10,24],"57":[34,34],"58":[3,31],"59":[34,34],"60":[27,1],"61":[0,28],"62":[28,28],"63":[26,1],"64":[0,28],"65":[28,28],"66":[25,3],"67":[28,27,25],"68":[22,5],"69":[27,5],"70":[0,27],"71":[27,27],"72":[0,25],"73":[25,25],"74":[12,13],"75":[25,14],"76":[0,25],"77":[25,25],"78":[1,11],"79":[12,12],"80":[1,11],"81":[1,11],"82":[12,12],"83":[4,7],"84":[11,11],"85":[1,10],"86":[11,11],"87":[5,6],"88":[11,6,6],"89":[1,10],"90":[11,11],"91":[0,6],"92":[6,6],"93":[1,4],"94":[1,0],"95":[2,4],"96":[6,4],"97":[1,5],"98":[6,6],"99":[0,4],"100":[4,4],"101":[2,2],"102":[2,1],"103":[0,0,0],"104":[0,0],"105":[0,0],"106":[23,23,2],"107":[0,2],"108":[2,2],"109":[10,4,3],"110":[0,3],"111":[3,3],"112":[87,82,69,0],"113":[0,0],"114":[0,0],"115":[3,379],"116":[382,382],"117":[3,379],"118":[172,210],"119":[382,213],"120":[24,355],"121":[379,35],"122":[172,207],"123":[379,210],"124":[0,35],"125":[35,35],"126":[294,61],"127":[355,245],"128":[1,354],"129":[355,355],"130":[0,245],"131":[245,245],"132":[0,245],"133":[245,245],"134":[36,258],"135":[0,36],"136":[36,36],"137":[0,36],"138":[36,36],"139":[5,31],"140":[31,6],"141":[7,54],"142":[0,61],"143":[61,61],"144":[0,61],"145":[61,61],"146":[3,4],"147":[2,1],"148":[2,2],"149":[1,1],"150":[1,1],"151":[2,2],"152":[1,0],"153":[1,1,1],"154":[0,1],"155":[1,1],"156":[0,1],"157":[1,1],"158":[0,1],"159":[1,1],"160":[363,363,54],"161":[0,54],"162":[54,54],"163":[3,3,2],"164":[0,2],"165":[2,2]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/issuance.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/issuance.ts"],"names":[],"mappings":"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","sourcesContent":["import { GatewayCoreState, GatewayInput } from '../types/gatewayCore';\nimport { ExtendedGatewayStatus, GatewayStatus, InternalGatewayStatus } from '../types/gateway';\nimport { ChainConfirmationTimeout, ErrorCode } from '../utils/errors';\nimport {\n  statusIfGatekeeperRecordRejected,\n  statusFromGatewayTokenIfExists,\n  validationProcessToGatewayStatus,\n  payerIsWalletOwner,\n  GatewayTokenCheckType,\n  StatusIfGatekeeperRecordRejectedType,\n  ValidationGatewayStatusType,\n  CheckValidationStatusType,\n} from './common';\nimport { InputStatus } from '../types/fetch';\nimport {\n  CivicPassMessageAction,\n  CivicPassMessageEventResult,\n  CivicPassMessageResponse,\n  ValidationStatus,\n} from '../types/civicPass';\nimport { GatekeeperAPIStatus, GatekeeperRecordResponse } from '../types/gatekeeperApi';\nimport { getPendingRequestFromGatekeeperRecord } from '../utils/partnerReview';\n\n// we're waiting on a civic pass to provide us with a payload to send to the gatekeeper\n// when we get the issuance payload, then return ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX\nexport const calculateIssuanceStartPreApprovedTransaction = (\n  state: GatewayCoreState\n):\n  | ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX\n  | ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX\n  | undefined => {\n  const civicPassEvent = state.inputs.civicPass?.received;\n  if (\n    civicPassEvent?.action === CivicPassMessageAction.START_PRE_APPROVED_TRANSACTION &&\n    civicPassEvent?.event === CivicPassMessageEventResult.SUCCESS &&\n    civicPassEvent?.payload !== undefined\n  ) {\n    return payerIsWalletOwner(state)\n      ? ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX\n      : ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX;\n  }\n};\n\n// Civic pass emits a data-collection status event for longer-running data-collection processes\n// to give more granular data-collection status updates\nexport const hasExistingDataCollectionProcessInProgress = (civicPassEvent: CivicPassMessageResponse | null): boolean =>\n  (civicPassEvent?.action === CivicPassMessageAction.STATUS &&\n    civicPassEvent?.event === CivicPassMessageEventResult.SUCCESS &&\n    civicPassEvent.payload?.status !== ValidationStatus.NOT_FOUND) ||\n  (civicPassEvent?.action === CivicPassMessageAction.ISSUANCE &&\n    civicPassEvent?.event === CivicPassMessageEventResult.IN_PROGRESS);\n\nexport const isInPartnerReview = (gatekeeperRecord: GatewayInput<GatekeeperRecordResponse> | undefined): boolean => {\n  return !!getPendingRequestFromGatekeeperRecord(gatekeeperRecord);\n};\n\nexport const preApprovedTxAvailable = (\n  gatekeeperRecord: GatewayInput<GatekeeperRecordResponse> | undefined\n): boolean => {\n  return !!gatekeeperRecord?.received?.payload?.preApprovedTxAvailable;\n};\n\nexport type CalculateFromIssuanceAwaitingOnChainReturn = ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR;\nexport const calculateFromIssuanceAwaitingOnChain = (\n  state: GatewayCoreState\n): CalculateFromIssuanceAwaitingOnChainReturn | undefined => {\n  if (\n    (state.internal.errors?.expectedOnChainToken as ChainConfirmationTimeout)?.errorCode ===\n    ErrorCode.CHAIN_CONFIRMATION_TIMEOUT_ERROR\n  ) {\n    return ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR;\n  }\n};\n\nexport type CalculateFromIssuanceInReviewReturn = InternalGatewayStatus;\n\nexport const calculateFromIssuanceInReview = (\n  state: GatewayCoreState\n): CalculateFromIssuanceInReviewReturn | undefined => {\n  const civicPassEvent = state.inputs.civicPass?.received;\n  const gatekeeperRecord = state.inputs.gatekeeperRecord;\n\n  if (gatekeeperRecord?.status === InputStatus.IN_PROGRESS) {\n    return state.internal.status as InternalGatewayStatus;\n  }\n  if (isInPartnerReview(gatekeeperRecord)) {\n    return ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW;\n  }\n\n  if (state.inputs.parameters?.payer) {\n    // this is the case where we're restarting a flow and we need a new transaction, so we need to check if we have proof\n    // otherwise restart the flow\n    if (\n      gatekeeperRecord?.status === InputStatus.COMPLETE &&\n      civicPassEvent?.action !== CivicPassMessageAction.ISSUANCE &&\n      !gatekeeperRecord.received?.transaction\n    ) {\n      return ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION;\n    }\n    if (state.internal?.chainTransaction?.sentTxId) {\n      return ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN;\n    }\n    if (state.internal?.chainTransaction?.error) {\n      return ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR;\n    }\n    if (gatekeeperRecord.received?.transaction) {\n      if (payerIsWalletOwner(state)) {\n        return ExtendedGatewayStatus.ISSUANCE_AWAITING_TRANSACTION_SEND;\n      }\n      return ExtendedGatewayStatus.ISSUANCE_AWAITING_THIRD_PARTY_TRANSACTION_SEND;\n    }\n    return undefined;\n  }\n  // civic-sends case\n  return ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN;\n};\n\nexport type CalculateFromGatekeeperIssuanceRequestedReturn =\n  | ExtendedGatewayStatus.ISSUANCE_CLIENT_PAYER_REQUESTED\n  | GatewayStatus.IN_REVIEW;\nexport const calculateFromGatekeeperIssuanceRequested = (\n  state: GatewayCoreState\n): CalculateFromGatekeeperIssuanceRequestedReturn | undefined => {\n  const civicPassEvent = state.inputs.civicPass?.received;\n  const gatekeeperRecord = state.inputs.gatekeeperRecord;\n  // post-gatekeeper-issuance request\n  if (\n    civicPassEvent && // we need a civic pass event to know data collection is complete\n    (gatekeeperRecord?.received?.state === GatekeeperAPIStatus.REQUESTED ||\n      gatekeeperRecord?.status === InputStatus.IN_PROGRESS)\n  ) {\n    return state.inputs.parameters?.payer && payerIsWalletOwner(state)\n      ? ExtendedGatewayStatus.ISSUANCE_CLIENT_PAYER_REQUESTED\n      : GatewayStatus.IN_REVIEW;\n  }\n};\n\nexport type CalculateIssuanceRequestedDataCollectionRestartReturn =\n  | ExtendedGatewayStatus.RESTART\n  | InternalGatewayStatus\n  | GatewayStatus.USER_INFORMATION_VALIDATED\n  | GatewayStatus.COLLECTING_USER_INFORMATION;\nexport const calculateIssuanceRequestedDataCollectionRestart = (\n  state: GatewayCoreState\n): CalculateIssuanceRequestedDataCollectionRestartReturn | undefined => {\n  const civicPassEvent = state.inputs.civicPass?.received;\n  // handle the case where the user has an expired validation process\n  // TODO check the action when the iframe is updated to send the correct action\n  if (civicPassEvent?.event === CivicPassMessageEventResult.FAILURE) {\n    return ExtendedGatewayStatus.USER_VALIDATION_FAILED;\n  }\n  const gatewayStatusFromValidationProcess =\n    validationProcessToGatewayStatus[civicPassEvent?.payload?.status as CheckValidationStatusType];\n  if (\n    civicPassEvent?.action === CivicPassMessageAction.STATUS &&\n    civicPassEvent?.event === CivicPassMessageEventResult.SUCCESS &&\n    gatewayStatusFromValidationProcess\n  ) {\n    // check that we have a payload before returning USER_INFORMATION_VALIDATED\n    // otherwise restart the flow by returning NOT_REQUESTED\n    if (gatewayStatusFromValidationProcess === GatewayStatus.USER_INFORMATION_VALIDATED) {\n      return civicPassEvent.payload ? GatewayStatus.USER_INFORMATION_VALIDATED : GatewayStatus.NOT_REQUESTED;\n    }\n    return gatewayStatusFromValidationProcess;\n  }\n  if (\n    civicPassEvent?.action === CivicPassMessageAction.ISSUANCE &&\n    civicPassEvent?.event === CivicPassMessageEventResult.SUCCESS\n  ) {\n    return GatewayStatus.USER_INFORMATION_VALIDATED;\n  }\n  if (hasExistingDataCollectionProcessInProgress(civicPassEvent)) {\n    return gatewayStatusFromValidationProcess || GatewayStatus.COLLECTING_USER_INFORMATION;\n  }\n};\n\nexport type ComputeIssuanceDataCollectionRestartType =\n  | GatewayTokenCheckType\n  | CalculateIssuanceRequestedDataCollectionRestartReturn;\nexport const computeIssuanceDataCollectionRestart = (\n  state: GatewayCoreState\n): ComputeIssuanceDataCollectionRestartType =>\n  statusFromGatewayTokenIfExists(state) ||\n  calculateIssuanceRequestedDataCollectionRestart(state) ||\n  (state.internal?.status as ComputeIssuanceDataCollectionRestartType);\n\nexport type ComputeIssuanceRequestedType = GatewayTokenCheckType | CalculateFromGatekeeperIssuanceRequestedReturn;\nexport const computeIssuanceRequested = (state: GatewayCoreState): ComputeIssuanceRequestedType =>\n  statusFromGatewayTokenIfExists(state) ||\n  calculateFromGatekeeperIssuanceRequested(state) ||\n  (state.internal?.status as ComputeIssuanceRequestedType);\n\nexport const computeIssuanceAwaitingOnChainToken = (\n  state: GatewayCoreState\n): GatewayTokenCheckType | CalculateFromIssuanceAwaitingOnChainReturn =>\n  statusFromGatewayTokenIfExists(state) ||\n  calculateFromIssuanceAwaitingOnChain(state) ||\n  (state.internal?.status as GatewayTokenCheckType | CalculateFromIssuanceAwaitingOnChainReturn);\n\nexport type ComputeIssuanceInReviewType =\n  | GatewayTokenCheckType\n  | StatusIfGatekeeperRecordRejectedType\n  | CalculateFromIssuanceInReviewReturn;\n\nexport const computeIssuanceInReview = (state: GatewayCoreState): ComputeIssuanceInReviewType =>\n  statusFromGatewayTokenIfExists(state) ||\n  statusIfGatekeeperRecordRejected(state) ||\n  calculateFromIssuanceInReview(state) ||\n  (state.internal?.status as ComputeIssuanceInReviewType);\n\nexport type CalculateIssuanceStatusReturn = ValidationGatewayStatusType | InternalGatewayStatus;\n\nexport const calculateIssuanceStatus = (state: GatewayCoreState): CalculateIssuanceStatusReturn | undefined => {\n  const civicPassEvent = state.inputs.civicPass?.received;\n  const gatekeeperRecord = state.inputs.gatekeeperRecord;\n\n  if (civicPassEvent?.event === CivicPassMessageEventResult.FAILURE) {\n    return ExtendedGatewayStatus.USER_VALIDATION_FAILED;\n  }\n\n  if (\n    civicPassEvent?.action === CivicPassMessageAction.ISSUANCE &&\n    civicPassEvent?.event === CivicPassMessageEventResult.SUCCESS\n  ) {\n    return GatewayStatus.USER_INFORMATION_VALIDATED;\n  }\n\n  // pre-gatekeeper-issuance request\n  if (!gatekeeperRecord?.received || gatekeeperRecord?.received?.state === GatekeeperAPIStatus.NOT_REQUESTED) {\n    if (hasExistingDataCollectionProcessInProgress(civicPassEvent)) {\n      const gatewayStatusFromValidationProcess =\n        validationProcessToGatewayStatus[civicPassEvent?.payload?.status as CheckValidationStatusType];\n\n      // we don't currently support jumping to issuance if the data collection is still in progress\n      if (gatewayStatusFromValidationProcess === GatewayStatus.USER_INFORMATION_VALIDATED) {\n        return GatewayStatus.NOT_REQUESTED;\n      }\n      return gatewayStatusFromValidationProcess || GatewayStatus.COLLECTING_USER_INFORMATION;\n    }\n\n    return GatewayStatus.NOT_REQUESTED;\n  }\n\n  // the issuance request has been made\n  if (gatekeeperRecord?.received?.state === GatekeeperAPIStatus.REQUESTED) {\n    if (preApprovedTxAvailable(gatekeeperRecord)) {\n      if (payerIsWalletOwner(state)) {\n        return ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_START_NEW_TX;\n      }\n      return ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX;\n    }\n\n    if (isInPartnerReview(gatekeeperRecord)) {\n      return ExtendedGatewayStatus.TOKEN_IN_PARTNER_REVIEW;\n    }\n\n    if (state.inputs.parameters?.payer) {\n      // in the case where a payer has been set, a transaction is required to move forward\n      // either by the client sending themselves, or a third party sending\n      // in either case, if we don't have a transaction, we need to restart data collection to make the\n      // gatekeeper request again to get a new transaction\n      if (\n        gatekeeperRecord?.status === InputStatus.COMPLETE &&\n        civicPassEvent?.action !== CivicPassMessageAction.ISSUANCE &&\n        !gatekeeperRecord.received?.transaction\n      ) {\n        return ExtendedGatewayStatus.ISSUANCE_RESTART_DATA_COLLECTION;\n      }\n    } else {\n      // civic-sends case\n      return ExtendedGatewayStatus.ISSUANCE_AWAITING_ON_CHAIN_TOKEN;\n    }\n  }\n};\n\nexport const computeIssuanceStatus = (state: GatewayCoreState): GatewayTokenCheckType | CalculateIssuanceStatusReturn =>\n  statusFromGatewayTokenIfExists(state) ||\n  calculateIssuanceStatus(state) ||\n  (state.internal?.status as GatewayTokenCheckType | CalculateIssuanceStatusReturn);\n\nexport const computeIssuanceStartPreApprovedTransaction = (\n  state: GatewayCoreState\n):\n  | GatewayTokenCheckType\n  | ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX\n  | ExtendedGatewayStatus.ISSUANCE_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX =>\n  statusFromGatewayTokenIfExists(state) ||\n  calculateIssuanceStartPreApprovedTransaction(state) ||\n  (state.internal?.status as GatewayTokenCheckType | ExtendedGatewayStatus.ISSUANCE_CLIENT_SENDS_REQUEST_NEW_TX);\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6347bf94204591c6df0979880e0127abf6968125"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/partnerReview.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/partnerReview.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":105}},"2":{"start":{"line":4,"column":46},"end":{"line":4,"column":457}},"3":{"start":{"line":4,"column":86},"end":{"line":4,"column":455}},"4":{"start":{"line":5,"column":0},"end":{"line":5,"column":86}},"5":{"start":{"line":6,"column":48},"end":{"line":11,"column":1}},"6":{"start":{"line":8,"column":4},"end":{"line":10,"column":174}},"7":{"start":{"line":12,"column":0},"end":{"line":12,"column":90}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":46},"end":{"line":4,"column":47}},"loc":{"start":{"line":4,"column":68},"end":{"line":4,"column":457}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":6,"column":48},"end":{"line":6,"column":49}},"loc":{"start":{"line":6,"column":70},"end":{"line":11,"column":1}},"line":6}},"branchMap":{"0":{"loc":{"start":{"line":4,"column":94},"end":{"line":4,"column":453}},"type":"binary-expr","locations":[{"start":{"line":4,"column":95},"end":{"line":4,"column":298}},{"start":{"line":4,"column":304},"end":{"line":4,"column":452}}],"line":4},"1":{"loc":{"start":{"line":4,"column":95},"end":{"line":4,"column":298}},"type":"cond-expr","locations":[{"start":{"line":4,"column":279},"end":{"line":4,"column":285}},{"start":{"line":4,"column":288},"end":{"line":4,"column":298}}],"line":4},"2":{"loc":{"start":{"line":4,"column":95},"end":{"line":4,"column":276}},"type":"binary-expr","locations":[{"start":{"line":4,"column":95},"end":{"line":4,"column":259}},{"start":{"line":4,"column":263},"end":{"line":4,"column":276}}],"line":4},"3":{"loc":{"start":{"line":4,"column":101},"end":{"line":4,"column":249}},"type":"cond-expr","locations":[{"start":{"line":4,"column":230},"end":{"line":4,"column":236}},{"start":{"line":4,"column":239},"end":{"line":4,"column":249}}],"line":4},"4":{"loc":{"start":{"line":4,"column":101},"end":{"line":4,"column":227}},"type":"binary-expr","locations":[{"start":{"line":4,"column":101},"end":{"line":4,"column":210}},{"start":{"line":4,"column":214},"end":{"line":4,"column":227}}],"line":4},"5":{"loc":{"start":{"line":4,"column":107},"end":{"line":4,"column":200}},"type":"cond-expr","locations":[{"start":{"line":4,"column":166},"end":{"line":4,"column":172}},{"start":{"line":4,"column":175},"end":{"line":4,"column":200}}],"line":4},"6":{"loc":{"start":{"line":4,"column":107},"end":{"line":4,"column":163}},"type":"binary-expr","locations":[{"start":{"line":4,"column":107},"end":{"line":4,"column":132}},{"start":{"line":4,"column":136},"end":{"line":4,"column":163}}],"line":4},"7":{"loc":{"start":{"line":4,"column":304},"end":{"line":4,"column":452}},"type":"cond-expr","locations":[{"start":{"line":4,"column":433},"end":{"line":4,"column":439}},{"start":{"line":4,"column":442},"end":{"line":4,"column":452}}],"line":4},"8":{"loc":{"start":{"line":4,"column":304},"end":{"line":4,"column":430}},"type":"binary-expr","locations":[{"start":{"line":4,"column":304},"end":{"line":4,"column":413}},{"start":{"line":4,"column":417},"end":{"line":4,"column":430}}],"line":4},"9":{"loc":{"start":{"line":4,"column":310},"end":{"line":4,"column":403}},"type":"cond-expr","locations":[{"start":{"line":4,"column":369},"end":{"line":4,"column":375}},{"start":{"line":4,"column":378},"end":{"line":4,"column":403}}],"line":4},"10":{"loc":{"start":{"line":4,"column":310},"end":{"line":4,"column":366}},"type":"binary-expr","locations":[{"start":{"line":4,"column":310},"end":{"line":4,"column":335}},{"start":{"line":4,"column":339},"end":{"line":4,"column":366}}],"line":4},"11":{"loc":{"start":{"line":8,"column":12},"end":{"line":10,"column":172}},"type":"binary-expr","locations":[{"start":{"line":8,"column":13},"end":{"line":8,"column":150}},{"start":{"line":9,"column":9},"end":{"line":9,"column":226}},{"start":{"line":10,"column":9},"end":{"line":10,"column":171}}],"line":8},"12":{"loc":{"start":{"line":8,"column":13},"end":{"line":8,"column":150}},"type":"cond-expr","locations":[{"start":{"line":8,"column":117},"end":{"line":8,"column":123}},{"start":{"line":8,"column":126},"end":{"line":8,"column":150}}],"line":8},"13":{"loc":{"start":{"line":8,"column":13},"end":{"line":8,"column":114}},"type":"binary-expr","locations":[{"start":{"line":8,"column":13},"end":{"line":8,"column":97}},{"start":{"line":8,"column":101},"end":{"line":8,"column":114}}],"line":8},"14":{"loc":{"start":{"line":9,"column":9},"end":{"line":9,"column":226}},"type":"cond-expr","locations":[{"start":{"line":9,"column":193},"end":{"line":9,"column":199}},{"start":{"line":9,"column":202},"end":{"line":9,"column":226}}],"line":9},"15":{"loc":{"start":{"line":9,"column":9},"end":{"line":9,"column":190}},"type":"binary-expr","locations":[{"start":{"line":9,"column":9},"end":{"line":9,"column":173}},{"start":{"line":9,"column":177},"end":{"line":9,"column":190}}],"line":9},"16":{"loc":{"start":{"line":9,"column":15},"end":{"line":9,"column":163}},"type":"cond-expr","locations":[{"start":{"line":9,"column":144},"end":{"line":9,"column":150}},{"start":{"line":9,"column":153},"end":{"line":9,"column":163}}],"line":9},"17":{"loc":{"start":{"line":9,"column":15},"end":{"line":9,"column":141}},"type":"binary-expr","locations":[{"start":{"line":9,"column":15},"end":{"line":9,"column":124}},{"start":{"line":9,"column":128},"end":{"line":9,"column":141}}],"line":9},"18":{"loc":{"start":{"line":9,"column":21},"end":{"line":9,"column":114}},"type":"cond-expr","locations":[{"start":{"line":9,"column":80},"end":{"line":9,"column":86}},{"start":{"line":9,"column":89},"end":{"line":9,"column":114}}],"line":9},"19":{"loc":{"start":{"line":9,"column":21},"end":{"line":9,"column":77}},"type":"binary-expr","locations":[{"start":{"line":9,"column":21},"end":{"line":9,"column":46}},{"start":{"line":9,"column":50},"end":{"line":9,"column":77}}],"line":9},"20":{"loc":{"start":{"line":10,"column":9},"end":{"line":10,"column":171}},"type":"cond-expr","locations":[{"start":{"line":10,"column":138},"end":{"line":10,"column":144}},{"start":{"line":10,"column":147},"end":{"line":10,"column":171}}],"line":10},"21":{"loc":{"start":{"line":10,"column":9},"end":{"line":10,"column":135}},"type":"binary-expr","locations":[{"start":{"line":10,"column":9},"end":{"line":10,"column":118}},{"start":{"line":10,"column":122},"end":{"line":10,"column":135}}],"line":10},"22":{"loc":{"start":{"line":10,"column":15},"end":{"line":10,"column":108}},"type":"cond-expr","locations":[{"start":{"line":10,"column":74},"end":{"line":10,"column":80}},{"start":{"line":10,"column":83},"end":{"line":10,"column":108}}],"line":10},"23":{"loc":{"start":{"line":10,"column":15},"end":{"line":10,"column":71}},"type":"binary-expr","locations":[{"start":{"line":10,"column":15},"end":{"line":10,"column":40}},{"start":{"line":10,"column":44},"end":{"line":10,"column":71}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":1805,"4":1,"5":1,"6":1746,"7":1},"f":{"0":1805,"1":1746},"b":{"0":[1805,1748],"1":[1424,381],"2":[1805,1805],"3":[1222,583],"4":[1805,586],"5":[3,1802],"6":[1805,1805],"7":[1222,526],"8":[1748,529],"9":[3,1745],"10":[1748,1748],"11":[1746,1686,1686],"12":[1686,60],"13":[1746,1746],"14":[1362,324],"15":[1686,1686],"16":[1218,468],"17":[1686,468],"18":[0,1686],"19":[1686,1686],"20":[1218,468],"21":[1686,468],"22":[0,1686],"23":[1686,1686]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/partnerReview.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/partnerReview.ts"],"names":[],"mappings":";;;AAGO,MAAM,qCAAqC,GAAG,CACnD,gBAAoE,EACxC,EAAE,mBAC9B,OAAA,CAAC,CAAA,MAAA,MAAA,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAE,QAAQ,0CAAE,OAAO,0CAAE,OAAO,MAAI,MAAA,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAE,QAAQ,0CAAE,OAAO,CAAA,CAAmB,CAAA,EAAA,CAAC;AAH7F,QAAA,qCAAqC,yCAGwD;AAYnG,MAAM,uCAAuC,GAAG,CACrD,gBAAoE,EAChD,EAAE;;IACtB,OAAO,CACL,CAAA,MAAA,IAAA,6CAAqC,EAAC,gBAAgB,CAAC,0CAAE,qBAAqB;SAC7E,MAAA,MAAA,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAE,QAAQ,0CAAE,OAAO,0CAAE,qBAAgC,CAAA;SACrE,MAAA,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAE,QAAQ,0CAAE,qBAAgC,CAAA,CAC9D,CAAC;AACJ,CAAC,CAAC;AARW,QAAA,uCAAuC,2CAQlD","sourcesContent":["import { GatekeeperRecordResponse, PendingPayload } from '../types/gatekeeperApi';\nimport { GatewayInput } from '../types/gatewayCore';\n\nexport const getPendingRequestFromGatekeeperRecord = (\n  gatekeeperRecord: GatewayInput<GatekeeperRecordResponse> | undefined\n): PendingPayload | undefined =>\n  (gatekeeperRecord?.received?.payload?.pending || gatekeeperRecord?.received?.pending) as PendingPayload;\n\n/**\n * If the flow went IN_REVIEW (the 'partner approval' case), the Gatekeeper returns a 'pending' object containing the presentationRequestId.\n * That triggers the 'partner in review' state with associated UI.\n *\n * If the Gatekeeper accepted the request immediately (the 'no partner approval' case), the presentationRequestId will be at the top-level of the POST response.\n * We expose a single 'pendingRequests' object to the partner's dApp, containing whichever presentationRequestId is defined above.\n * Even though the request may not really be 'pending', we don't want to change the interface at this point as it would be a breaking change.\n * @param gatekeeperRecord\n * @returns\n */\nexport const getScopeRequestIdFromGatekeeperResponse = (\n  gatekeeperRecord: GatewayInput<GatekeeperRecordResponse> | undefined\n): string | undefined => {\n  return (\n    getPendingRequestFromGatekeeperRecord(gatekeeperRecord)?.presentationRequestId ||\n    (gatekeeperRecord?.received?.payload?.presentationRequestId as string) ||\n    (gatekeeperRecord?.received?.presentationRequestId as string)\n  );\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3ecd79e26941cd710cf94bc2c866e4f3cb6d47f5"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/refresh.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/refresh.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":549}},"2":{"start":{"line":4,"column":18},"end":{"line":4,"column":45}},"3":{"start":{"line":5,"column":17},"end":{"line":5,"column":36}},"4":{"start":{"line":6,"column":16},"end":{"line":6,"column":41}},"5":{"start":{"line":7,"column":20},"end":{"line":7,"column":49}},"6":{"start":{"line":8,"column":24},"end":{"line":8,"column":57}},"7":{"start":{"line":9,"column":17},"end":{"line":9,"column":43}},"8":{"start":{"line":10,"column":19},"end":{"line":10,"column":40}},"9":{"start":{"line":11,"column":52},"end":{"line":21,"column":1}},"10":{"start":{"line":13,"column":27},"end":{"line":13,"column":105}},"11":{"start":{"line":14,"column":4},"end":{"line":20,"column":5}},"12":{"start":{"line":17,"column":8},"end":{"line":19,"column":94}},"13":{"start":{"line":22,"column":0},"end":{"line":22,"column":98}},"14":{"start":{"line":23,"column":37},"end":{"line":43,"column":1}},"15":{"start":{"line":25,"column":29},"end":{"line":25,"column":58}},"16":{"start":{"line":26,"column":4},"end":{"line":42,"column":5}},"17":{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},"18":{"start":{"line":28,"column":12},"end":{"line":28,"column":83}},"19":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"20":{"start":{"line":31,"column":12},"end":{"line":31,"column":75}},"21":{"start":{"line":33,"column":8},"end":{"line":38,"column":9}},"22":{"start":{"line":34,"column":12},"end":{"line":36,"column":13}},"23":{"start":{"line":35,"column":16},"end":{"line":35,"column":89}},"24":{"start":{"line":37,"column":12},"end":{"line":37,"column":97}},"25":{"start":{"line":41,"column":8},"end":{"line":41,"column":79}},"26":{"start":{"line":44,"column":0},"end":{"line":44,"column":68}},"27":{"start":{"line":45,"column":48},"end":{"line":54,"column":1}},"28":{"start":{"line":47,"column":29},"end":{"line":47,"column":58}},"29":{"start":{"line":48,"column":4},"end":{"line":53,"column":5}},"30":{"start":{"line":50,"column":8},"end":{"line":52,"column":64}},"31":{"start":{"line":55,"column":0},"end":{"line":55,"column":90}},"32":{"start":{"line":56,"column":32},"end":{"line":62,"column":1}},"33":{"start":{"line":57,"column":24},"end":{"line":57,"column":75}},"34":{"start":{"line":58,"column":4},"end":{"line":61,"column":20}},"35":{"start":{"line":63,"column":0},"end":{"line":63,"column":58}},"36":{"start":{"line":64,"column":32},"end":{"line":69,"column":1}},"37":{"start":{"line":66,"column":4},"end":{"line":68,"column":79}},"38":{"start":{"line":70,"column":0},"end":{"line":70,"column":58}},"39":{"start":{"line":71,"column":31},"end":{"line":77,"column":1}},"40":{"start":{"line":73,"column":4},"end":{"line":76,"column":79}},"41":{"start":{"line":78,"column":0},"end":{"line":78,"column":56}},"42":{"start":{"line":79,"column":34},"end":{"line":82,"column":1}},"43":{"start":{"line":81,"column":4},"end":{"line":81,"column":229}},"44":{"start":{"line":83,"column":31},"end":{"line":100,"column":1}},"45":{"start":{"line":85,"column":27},"end":{"line":85,"column":105}},"46":{"start":{"line":86,"column":4},"end":{"line":91,"column":5}},"47":{"start":{"line":87,"column":8},"end":{"line":89,"column":9}},"48":{"start":{"line":88,"column":12},"end":{"line":88,"column":85}},"49":{"start":{"line":90,"column":8},"end":{"line":90,"column":95}},"50":{"start":{"line":92,"column":4},"end":{"line":95,"column":5}},"51":{"start":{"line":94,"column":8},"end":{"line":94,"column":74}},"52":{"start":{"line":96,"column":4},"end":{"line":99,"column":5}},"53":{"start":{"line":98,"column":8},"end":{"line":98,"column":82}},"54":{"start":{"line":101,"column":0},"end":{"line":101,"column":56}},"55":{"start":{"line":102,"column":41},"end":{"line":108,"column":1}},"56":{"start":{"line":104,"column":4},"end":{"line":107,"column":5}},"57":{"start":{"line":106,"column":8},"end":{"line":106,"column":80}},"58":{"start":{"line":109,"column":0},"end":{"line":109,"column":76}},"59":{"start":{"line":110,"column":29},"end":{"line":116,"column":1}},"60":{"start":{"line":112,"column":4},"end":{"line":115,"column":79}},"61":{"start":{"line":117,"column":0},"end":{"line":117,"column":52}},"62":{"start":{"line":118,"column":46},"end":{"line":124,"column":1}},"63":{"start":{"line":120,"column":4},"end":{"line":123,"column":79}},"64":{"start":{"line":125,"column":0},"end":{"line":125,"column":86}},"65":{"start":{"line":126,"column":44},"end":{"line":132,"column":1}},"66":{"start":{"line":128,"column":4},"end":{"line":131,"column":5}},"67":{"start":{"line":130,"column":8},"end":{"line":130,"column":67}},"68":{"start":{"line":133,"column":0},"end":{"line":133,"column":82}},"69":{"start":{"line":134,"column":43},"end":{"line":140,"column":1}},"70":{"start":{"line":136,"column":4},"end":{"line":139,"column":79}},"71":{"start":{"line":141,"column":0},"end":{"line":141,"column":80}},"72":{"start":{"line":142,"column":50},"end":{"line":147,"column":1}},"73":{"start":{"line":144,"column":4},"end":{"line":146,"column":79}},"74":{"start":{"line":148,"column":0},"end":{"line":148,"column":94}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":11,"column":52},"end":{"line":11,"column":53}},"loc":{"start":{"line":11,"column":63},"end":{"line":21,"column":1}},"line":11},"1":{"name":"(anonymous_1)","decl":{"start":{"line":23,"column":37},"end":{"line":23,"column":38}},"loc":{"start":{"line":23,"column":48},"end":{"line":43,"column":1}},"line":23},"2":{"name":"(anonymous_2)","decl":{"start":{"line":45,"column":48},"end":{"line":45,"column":49}},"loc":{"start":{"line":45,"column":59},"end":{"line":54,"column":1}},"line":45},"3":{"name":"(anonymous_3)","decl":{"start":{"line":56,"column":32},"end":{"line":56,"column":33}},"loc":{"start":{"line":56,"column":43},"end":{"line":62,"column":1}},"line":56},"4":{"name":"(anonymous_4)","decl":{"start":{"line":64,"column":32},"end":{"line":64,"column":33}},"loc":{"start":{"line":64,"column":43},"end":{"line":69,"column":1}},"line":64},"5":{"name":"(anonymous_5)","decl":{"start":{"line":71,"column":31},"end":{"line":71,"column":32}},"loc":{"start":{"line":71,"column":42},"end":{"line":77,"column":1}},"line":71},"6":{"name":"(anonymous_6)","decl":{"start":{"line":79,"column":34},"end":{"line":79,"column":35}},"loc":{"start":{"line":79,"column":56},"end":{"line":82,"column":1}},"line":79},"7":{"name":"(anonymous_7)","decl":{"start":{"line":83,"column":31},"end":{"line":83,"column":32}},"loc":{"start":{"line":83,"column":42},"end":{"line":100,"column":1}},"line":83},"8":{"name":"(anonymous_8)","decl":{"start":{"line":102,"column":41},"end":{"line":102,"column":42}},"loc":{"start":{"line":102,"column":52},"end":{"line":108,"column":1}},"line":102},"9":{"name":"(anonymous_9)","decl":{"start":{"line":110,"column":29},"end":{"line":110,"column":30}},"loc":{"start":{"line":110,"column":40},"end":{"line":116,"column":1}},"line":110},"10":{"name":"(anonymous_10)","decl":{"start":{"line":118,"column":46},"end":{"line":118,"column":47}},"loc":{"start":{"line":118,"column":57},"end":{"line":124,"column":1}},"line":118},"11":{"name":"(anonymous_11)","decl":{"start":{"line":126,"column":44},"end":{"line":126,"column":45}},"loc":{"start":{"line":126,"column":55},"end":{"line":132,"column":1}},"line":126},"12":{"name":"(anonymous_12)","decl":{"start":{"line":134,"column":43},"end":{"line":134,"column":44}},"loc":{"start":{"line":134,"column":54},"end":{"line":140,"column":1}},"line":134},"13":{"name":"(anonymous_13)","decl":{"start":{"line":142,"column":50},"end":{"line":142,"column":51}},"loc":{"start":{"line":142,"column":61},"end":{"line":147,"column":1}},"line":142}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":27},"end":{"line":13,"column":105}},"type":"cond-expr","locations":[{"start":{"line":13,"column":85},"end":{"line":13,"column":91}},{"start":{"line":13,"column":94},"end":{"line":13,"column":105}}],"line":13},"1":{"loc":{"start":{"line":13,"column":27},"end":{"line":13,"column":82}},"type":"binary-expr","locations":[{"start":{"line":13,"column":27},"end":{"line":13,"column":65}},{"start":{"line":13,"column":69},"end":{"line":13,"column":82}}],"line":13},"2":{"loc":{"start":{"line":14,"column":4},"end":{"line":20,"column":5}},"type":"if","locations":[{"start":{"line":14,"column":4},"end":{"line":20,"column":5}},{"start":{"line":14,"column":4},"end":{"line":20,"column":5}}],"line":14},"3":{"loc":{"start":{"line":14,"column":8},"end":{"line":16,"column":110}},"type":"binary-expr","locations":[{"start":{"line":14,"column":8},"end":{"line":14,"column":165}},{"start":{"line":15,"column":8},"end":{"line":15,"column":146}},{"start":{"line":16,"column":8},"end":{"line":16,"column":110}}],"line":14},"4":{"loc":{"start":{"line":14,"column":9},"end":{"line":14,"column":94}},"type":"cond-expr","locations":[{"start":{"line":14,"column":64},"end":{"line":14,"column":70}},{"start":{"line":14,"column":73},"end":{"line":14,"column":94}}],"line":14},"5":{"loc":{"start":{"line":14,"column":9},"end":{"line":14,"column":61}},"type":"binary-expr","locations":[{"start":{"line":14,"column":9},"end":{"line":14,"column":32}},{"start":{"line":14,"column":36},"end":{"line":14,"column":61}}],"line":14},"6":{"loc":{"start":{"line":15,"column":9},"end":{"line":15,"column":93}},"type":"cond-expr","locations":[{"start":{"line":15,"column":64},"end":{"line":15,"column":70}},{"start":{"line":15,"column":73},"end":{"line":15,"column":93}}],"line":15},"7":{"loc":{"start":{"line":15,"column":9},"end":{"line":15,"column":61}},"type":"binary-expr","locations":[{"start":{"line":15,"column":9},"end":{"line":15,"column":32}},{"start":{"line":15,"column":36},"end":{"line":15,"column":61}}],"line":15},"8":{"loc":{"start":{"line":16,"column":9},"end":{"line":16,"column":95}},"type":"cond-expr","locations":[{"start":{"line":16,"column":64},"end":{"line":16,"column":70}},{"start":{"line":16,"column":73},"end":{"line":16,"column":95}}],"line":16},"9":{"loc":{"start":{"line":16,"column":9},"end":{"line":16,"column":61}},"type":"binary-expr","locations":[{"start":{"line":16,"column":9},"end":{"line":16,"column":32}},{"start":{"line":16,"column":36},"end":{"line":16,"column":61}}],"line":16},"10":{"loc":{"start":{"line":17,"column":15},"end":{"line":19,"column":93}},"type":"cond-expr","locations":[{"start":{"line":18,"column":14},"end":{"line":18,"column":81}},{"start":{"line":19,"column":14},"end":{"line":19,"column":93}}],"line":17},"11":{"loc":{"start":{"line":26,"column":4},"end":{"line":42,"column":5}},"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":42,"column":5}},{"start":{"line":26,"column":4},"end":{"line":42,"column":5}}],"line":26},"12":{"loc":{"start":{"line":26,"column":8},"end":{"line":26,"column":84}},"type":"cond-expr","locations":[{"start":{"line":26,"column":67},"end":{"line":26,"column":73}},{"start":{"line":26,"column":76},"end":{"line":26,"column":84}}],"line":26},"13":{"loc":{"start":{"line":26,"column":8},"end":{"line":26,"column":64}},"type":"binary-expr","locations":[{"start":{"line":26,"column":8},"end":{"line":26,"column":47}},{"start":{"line":26,"column":51},"end":{"line":26,"column":64}}],"line":26},"14":{"loc":{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},"type":"if","locations":[{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},{"start":{"line":27,"column":8},"end":{"line":29,"column":9}}],"line":27},"15":{"loc":{"start":{"line":27,"column":12},"end":{"line":27,"column":146}},"type":"cond-expr","locations":[{"start":{"line":27,"column":126},"end":{"line":27,"column":132}},{"start":{"line":27,"column":135},"end":{"line":27,"column":146}}],"line":27},"16":{"loc":{"start":{"line":27,"column":12},"end":{"line":27,"column":123}},"type":"binary-expr","locations":[{"start":{"line":27,"column":12},"end":{"line":27,"column":106}},{"start":{"line":27,"column":110},"end":{"line":27,"column":123}}],"line":27},"17":{"loc":{"start":{"line":27,"column":18},"end":{"line":27,"column":96}},"type":"cond-expr","locations":[{"start":{"line":27,"column":68},"end":{"line":27,"column":74}},{"start":{"line":27,"column":77},"end":{"line":27,"column":96}}],"line":27},"18":{"loc":{"start":{"line":27,"column":18},"end":{"line":27,"column":65}},"type":"binary-expr","locations":[{"start":{"line":27,"column":18},"end":{"line":27,"column":48}},{"start":{"line":27,"column":52},"end":{"line":27,"column":65}}],"line":27},"19":{"loc":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},{"start":{"line":30,"column":8},"end":{"line":32,"column":9}}],"line":30},"20":{"loc":{"start":{"line":30,"column":12},"end":{"line":30,"column":143}},"type":"cond-expr","locations":[{"start":{"line":30,"column":126},"end":{"line":30,"column":132}},{"start":{"line":30,"column":135},"end":{"line":30,"column":143}}],"line":30},"21":{"loc":{"start":{"line":30,"column":12},"end":{"line":30,"column":123}},"type":"binary-expr","locations":[{"start":{"line":30,"column":12},"end":{"line":30,"column":106}},{"start":{"line":30,"column":110},"end":{"line":30,"column":123}}],"line":30},"22":{"loc":{"start":{"line":30,"column":18},"end":{"line":30,"column":96}},"type":"cond-expr","locations":[{"start":{"line":30,"column":68},"end":{"line":30,"column":74}},{"start":{"line":30,"column":77},"end":{"line":30,"column":96}}],"line":30},"23":{"loc":{"start":{"line":30,"column":18},"end":{"line":30,"column":65}},"type":"binary-expr","locations":[{"start":{"line":30,"column":18},"end":{"line":30,"column":48}},{"start":{"line":30,"column":52},"end":{"line":30,"column":65}}],"line":30},"24":{"loc":{"start":{"line":33,"column":8},"end":{"line":38,"column":9}},"type":"if","locations":[{"start":{"line":33,"column":8},"end":{"line":38,"column":9}},{"start":{"line":33,"column":8},"end":{"line":38,"column":9}}],"line":33},"25":{"loc":{"start":{"line":33,"column":12},"end":{"line":33,"column":96}},"type":"cond-expr","locations":[{"start":{"line":33,"column":73},"end":{"line":33,"column":79}},{"start":{"line":33,"column":82},"end":{"line":33,"column":96}}],"line":33},"26":{"loc":{"start":{"line":33,"column":12},"end":{"line":33,"column":70}},"type":"binary-expr","locations":[{"start":{"line":33,"column":12},"end":{"line":33,"column":53}},{"start":{"line":33,"column":57},"end":{"line":33,"column":70}}],"line":33},"27":{"loc":{"start":{"line":34,"column":12},"end":{"line":36,"column":13}},"type":"if","locations":[{"start":{"line":34,"column":12},"end":{"line":36,"column":13}},{"start":{"line":34,"column":12},"end":{"line":36,"column":13}}],"line":34},"28":{"loc":{"start":{"line":48,"column":4},"end":{"line":53,"column":5}},"type":"if","locations":[{"start":{"line":48,"column":4},"end":{"line":53,"column":5}},{"start":{"line":48,"column":4},"end":{"line":53,"column":5}}],"line":48},"29":{"loc":{"start":{"line":48,"column":8},"end":{"line":49,"column":137}},"type":"binary-expr","locations":[{"start":{"line":48,"column":8},"end":{"line":48,"column":206}},{"start":{"line":49,"column":8},"end":{"line":49,"column":137}}],"line":48},"30":{"loc":{"start":{"line":48,"column":9},"end":{"line":48,"column":155}},"type":"cond-expr","locations":[{"start":{"line":48,"column":138},"end":{"line":48,"column":144}},{"start":{"line":48,"column":147},"end":{"line":48,"column":155}}],"line":48},"31":{"loc":{"start":{"line":48,"column":9},"end":{"line":48,"column":135}},"type":"binary-expr","locations":[{"start":{"line":48,"column":9},"end":{"line":48,"column":118}},{"start":{"line":48,"column":122},"end":{"line":48,"column":135}}],"line":48},"32":{"loc":{"start":{"line":48,"column":15},"end":{"line":48,"column":108}},"type":"cond-expr","locations":[{"start":{"line":48,"column":74},"end":{"line":48,"column":80}},{"start":{"line":48,"column":83},"end":{"line":48,"column":108}}],"line":48},"33":{"loc":{"start":{"line":48,"column":15},"end":{"line":48,"column":71}},"type":"binary-expr","locations":[{"start":{"line":48,"column":15},"end":{"line":48,"column":40}},{"start":{"line":48,"column":44},"end":{"line":48,"column":71}}],"line":48},"34":{"loc":{"start":{"line":49,"column":9},"end":{"line":49,"column":100}},"type":"cond-expr","locations":[{"start":{"line":49,"column":68},"end":{"line":49,"column":74}},{"start":{"line":49,"column":77},"end":{"line":49,"column":100}}],"line":49},"35":{"loc":{"start":{"line":49,"column":9},"end":{"line":49,"column":65}},"type":"binary-expr","locations":[{"start":{"line":49,"column":9},"end":{"line":49,"column":34}},{"start":{"line":49,"column":38},"end":{"line":49,"column":65}}],"line":49},"36":{"loc":{"start":{"line":50,"column":15},"end":{"line":52,"column":63}},"type":"cond-expr","locations":[{"start":{"line":51,"column":14},"end":{"line":51,"column":76}},{"start":{"line":52,"column":14},"end":{"line":52,"column":63}}],"line":50},"37":{"loc":{"start":{"line":50,"column":15},"end":{"line":50,"column":136}},"type":"binary-expr","locations":[{"start":{"line":50,"column":16},"end":{"line":50,"column":92}},{"start":{"line":50,"column":97},"end":{"line":50,"column":136}}],"line":50},"38":{"loc":{"start":{"line":50,"column":16},"end":{"line":50,"column":92}},"type":"cond-expr","locations":[{"start":{"line":50,"column":75},"end":{"line":50,"column":81}},{"start":{"line":50,"column":84},"end":{"line":50,"column":92}}],"line":50},"39":{"loc":{"start":{"line":50,"column":16},"end":{"line":50,"column":72}},"type":"binary-expr","locations":[{"start":{"line":50,"column":16},"end":{"line":50,"column":55}},{"start":{"line":50,"column":59},"end":{"line":50,"column":72}}],"line":50},"40":{"loc":{"start":{"line":58,"column":11},"end":{"line":61,"column":19}},"type":"cond-expr","locations":[{"start":{"line":60,"column":10},"end":{"line":60,"column":21}},{"start":{"line":61,"column":10},"end":{"line":61,"column":19}}],"line":58},"41":{"loc":{"start":{"line":58,"column":11},"end":{"line":59,"column":144}},"type":"binary-expr","locations":[{"start":{"line":58,"column":11},"end":{"line":58,"column":22}},{"start":{"line":59,"column":8},"end":{"line":59,"column":144}}],"line":58},"42":{"loc":{"start":{"line":66,"column":11},"end":{"line":68,"column":78}},"type":"binary-expr","locations":[{"start":{"line":66,"column":11},"end":{"line":66,"column":54}},{"start":{"line":67,"column":8},"end":{"line":67,"column":67}},{"start":{"line":68,"column":9},"end":{"line":68,"column":77}}],"line":66},"43":{"loc":{"start":{"line":68,"column":9},"end":{"line":68,"column":77}},"type":"cond-expr","locations":[{"start":{"line":68,"column":59},"end":{"line":68,"column":65}},{"start":{"line":68,"column":68},"end":{"line":68,"column":77}}],"line":68},"44":{"loc":{"start":{"line":68,"column":9},"end":{"line":68,"column":56}},"type":"binary-expr","locations":[{"start":{"line":68,"column":9},"end":{"line":68,"column":39}},{"start":{"line":68,"column":43},"end":{"line":68,"column":56}}],"line":68},"45":{"loc":{"start":{"line":73,"column":11},"end":{"line":76,"column":78}},"type":"binary-expr","locations":[{"start":{"line":73,"column":11},"end":{"line":73,"column":54}},{"start":{"line":74,"column":8},"end":{"line":74,"column":61}},{"start":{"line":75,"column":8},"end":{"line":75,"column":56}},{"start":{"line":76,"column":9},"end":{"line":76,"column":77}}],"line":73},"46":{"loc":{"start":{"line":76,"column":9},"end":{"line":76,"column":77}},"type":"cond-expr","locations":[{"start":{"line":76,"column":59},"end":{"line":76,"column":65}},{"start":{"line":76,"column":68},"end":{"line":76,"column":77}}],"line":76},"47":{"loc":{"start":{"line":76,"column":9},"end":{"line":76,"column":56}},"type":"binary-expr","locations":[{"start":{"line":76,"column":9},"end":{"line":76,"column":39}},{"start":{"line":76,"column":43},"end":{"line":76,"column":56}}],"line":76},"48":{"loc":{"start":{"line":81,"column":14},"end":{"line":81,"column":227}},"type":"cond-expr","locations":[{"start":{"line":81,"column":198},"end":{"line":81,"column":204}},{"start":{"line":81,"column":207},"end":{"line":81,"column":227}}],"line":81},"49":{"loc":{"start":{"line":81,"column":14},"end":{"line":81,"column":195}},"type":"binary-expr","locations":[{"start":{"line":81,"column":14},"end":{"line":81,"column":178}},{"start":{"line":81,"column":182},"end":{"line":81,"column":195}}],"line":81},"50":{"loc":{"start":{"line":81,"column":20},"end":{"line":81,"column":168}},"type":"cond-expr","locations":[{"start":{"line":81,"column":149},"end":{"line":81,"column":155}},{"start":{"line":81,"column":158},"end":{"line":81,"column":168}}],"line":81},"51":{"loc":{"start":{"line":81,"column":20},"end":{"line":81,"column":146}},"type":"binary-expr","locations":[{"start":{"line":81,"column":20},"end":{"line":81,"column":129}},{"start":{"line":81,"column":133},"end":{"line":81,"column":146}}],"line":81},"52":{"loc":{"start":{"line":81,"column":26},"end":{"line":81,"column":119}},"type":"cond-expr","locations":[{"start":{"line":81,"column":85},"end":{"line":81,"column":91}},{"start":{"line":81,"column":94},"end":{"line":81,"column":119}}],"line":81},"53":{"loc":{"start":{"line":81,"column":26},"end":{"line":81,"column":82}},"type":"binary-expr","locations":[{"start":{"line":81,"column":26},"end":{"line":81,"column":51}},{"start":{"line":81,"column":55},"end":{"line":81,"column":82}}],"line":81},"54":{"loc":{"start":{"line":85,"column":27},"end":{"line":85,"column":105}},"type":"cond-expr","locations":[{"start":{"line":85,"column":85},"end":{"line":85,"column":91}},{"start":{"line":85,"column":94},"end":{"line":85,"column":105}}],"line":85},"55":{"loc":{"start":{"line":85,"column":27},"end":{"line":85,"column":82}},"type":"binary-expr","locations":[{"start":{"line":85,"column":27},"end":{"line":85,"column":65}},{"start":{"line":85,"column":69},"end":{"line":85,"column":82}}],"line":85},"56":{"loc":{"start":{"line":86,"column":4},"end":{"line":91,"column":5}},"type":"if","locations":[{"start":{"line":86,"column":4},"end":{"line":91,"column":5}},{"start":{"line":86,"column":4},"end":{"line":91,"column":5}}],"line":86},"57":{"loc":{"start":{"line":87,"column":8},"end":{"line":89,"column":9}},"type":"if","locations":[{"start":{"line":87,"column":8},"end":{"line":89,"column":9}},{"start":{"line":87,"column":8},"end":{"line":89,"column":9}}],"line":87},"58":{"loc":{"start":{"line":92,"column":4},"end":{"line":95,"column":5}},"type":"if","locations":[{"start":{"line":92,"column":4},"end":{"line":95,"column":5}},{"start":{"line":92,"column":4},"end":{"line":95,"column":5}}],"line":92},"59":{"loc":{"start":{"line":92,"column":8},"end":{"line":93,"column":64}},"type":"binary-expr","locations":[{"start":{"line":92,"column":8},"end":{"line":92,"column":201}},{"start":{"line":93,"column":8},"end":{"line":93,"column":64}}],"line":92},"60":{"loc":{"start":{"line":92,"column":9},"end":{"line":92,"column":131}},"type":"binary-expr","locations":[{"start":{"line":92,"column":10},"end":{"line":92,"column":124}},{"start":{"line":92,"column":129},"end":{"line":92,"column":131}}],"line":92},"61":{"loc":{"start":{"line":92,"column":10},"end":{"line":92,"column":124}},"type":"cond-expr","locations":[{"start":{"line":92,"column":106},"end":{"line":92,"column":112}},{"start":{"line":92,"column":115},"end":{"line":92,"column":124}}],"line":92},"62":{"loc":{"start":{"line":92,"column":10},"end":{"line":92,"column":103}},"type":"binary-expr","locations":[{"start":{"line":92,"column":10},"end":{"line":92,"column":86}},{"start":{"line":92,"column":90},"end":{"line":92,"column":103}}],"line":92},"63":{"loc":{"start":{"line":92,"column":16},"end":{"line":92,"column":76}},"type":"cond-expr","locations":[{"start":{"line":92,"column":53},"end":{"line":92,"column":59}},{"start":{"line":92,"column":62},"end":{"line":92,"column":76}}],"line":92},"64":{"loc":{"start":{"line":92,"column":16},"end":{"line":92,"column":50}},"type":"binary-expr","locations":[{"start":{"line":92,"column":16},"end":{"line":92,"column":30}},{"start":{"line":92,"column":34},"end":{"line":92,"column":50}}],"line":92},"65":{"loc":{"start":{"line":96,"column":4},"end":{"line":99,"column":5}},"type":"if","locations":[{"start":{"line":96,"column":4},"end":{"line":99,"column":5}},{"start":{"line":96,"column":4},"end":{"line":99,"column":5}}],"line":96},"66":{"loc":{"start":{"line":96,"column":8},"end":{"line":97,"column":146}},"type":"binary-expr","locations":[{"start":{"line":96,"column":8},"end":{"line":96,"column":142}},{"start":{"line":97,"column":8},"end":{"line":97,"column":146}}],"line":96},"67":{"loc":{"start":{"line":96,"column":9},"end":{"line":96,"column":94}},"type":"cond-expr","locations":[{"start":{"line":96,"column":64},"end":{"line":96,"column":70}},{"start":{"line":96,"column":73},"end":{"line":96,"column":94}}],"line":96},"68":{"loc":{"start":{"line":96,"column":9},"end":{"line":96,"column":61}},"type":"binary-expr","locations":[{"start":{"line":96,"column":9},"end":{"line":96,"column":32}},{"start":{"line":96,"column":36},"end":{"line":96,"column":61}}],"line":96},"69":{"loc":{"start":{"line":97,"column":9},"end":{"line":97,"column":93}},"type":"cond-expr","locations":[{"start":{"line":97,"column":64},"end":{"line":97,"column":70}},{"start":{"line":97,"column":73},"end":{"line":97,"column":93}}],"line":97},"70":{"loc":{"start":{"line":97,"column":9},"end":{"line":97,"column":61}},"type":"binary-expr","locations":[{"start":{"line":97,"column":9},"end":{"line":97,"column":32}},{"start":{"line":97,"column":36},"end":{"line":97,"column":61}}],"line":97},"71":{"loc":{"start":{"line":104,"column":4},"end":{"line":107,"column":5}},"type":"if","locations":[{"start":{"line":104,"column":4},"end":{"line":107,"column":5}},{"start":{"line":104,"column":4},"end":{"line":107,"column":5}}],"line":104},"72":{"loc":{"start":{"line":104,"column":8},"end":{"line":105,"column":97}},"type":"binary-expr","locations":[{"start":{"line":104,"column":8},"end":{"line":104,"column":153}},{"start":{"line":105,"column":8},"end":{"line":105,"column":97}}],"line":104},"73":{"loc":{"start":{"line":104,"column":9},"end":{"line":104,"column":94}},"type":"cond-expr","locations":[{"start":{"line":104,"column":76},"end":{"line":104,"column":82}},{"start":{"line":104,"column":85},"end":{"line":104,"column":94}}],"line":104},"74":{"loc":{"start":{"line":104,"column":9},"end":{"line":104,"column":73}},"type":"binary-expr","locations":[{"start":{"line":104,"column":9},"end":{"line":104,"column":56}},{"start":{"line":104,"column":60},"end":{"line":104,"column":73}}],"line":104},"75":{"loc":{"start":{"line":112,"column":11},"end":{"line":115,"column":78}},"type":"binary-expr","locations":[{"start":{"line":112,"column":11},"end":{"line":112,"column":54}},{"start":{"line":113,"column":8},"end":{"line":113,"column":61}},{"start":{"line":114,"column":8},"end":{"line":114,"column":50}},{"start":{"line":115,"column":9},"end":{"line":115,"column":77}}],"line":112},"76":{"loc":{"start":{"line":115,"column":9},"end":{"line":115,"column":77}},"type":"cond-expr","locations":[{"start":{"line":115,"column":59},"end":{"line":115,"column":65}},{"start":{"line":115,"column":68},"end":{"line":115,"column":77}}],"line":115},"77":{"loc":{"start":{"line":115,"column":9},"end":{"line":115,"column":56}},"type":"binary-expr","locations":[{"start":{"line":115,"column":9},"end":{"line":115,"column":39}},{"start":{"line":115,"column":43},"end":{"line":115,"column":56}}],"line":115},"78":{"loc":{"start":{"line":120,"column":11},"end":{"line":123,"column":78}},"type":"binary-expr","locations":[{"start":{"line":120,"column":11},"end":{"line":120,"column":54}},{"start":{"line":121,"column":8},"end":{"line":121,"column":61}},{"start":{"line":122,"column":8},"end":{"line":122,"column":60}},{"start":{"line":123,"column":9},"end":{"line":123,"column":77}}],"line":120},"79":{"loc":{"start":{"line":123,"column":9},"end":{"line":123,"column":77}},"type":"cond-expr","locations":[{"start":{"line":123,"column":59},"end":{"line":123,"column":65}},{"start":{"line":123,"column":68},"end":{"line":123,"column":77}}],"line":123},"80":{"loc":{"start":{"line":123,"column":9},"end":{"line":123,"column":56}},"type":"binary-expr","locations":[{"start":{"line":123,"column":9},"end":{"line":123,"column":39}},{"start":{"line":123,"column":43},"end":{"line":123,"column":56}}],"line":123},"81":{"loc":{"start":{"line":128,"column":4},"end":{"line":131,"column":5}},"type":"if","locations":[{"start":{"line":128,"column":4},"end":{"line":131,"column":5}},{"start":{"line":128,"column":4},"end":{"line":131,"column":5}}],"line":128},"82":{"loc":{"start":{"line":128,"column":9},"end":{"line":128,"column":155}},"type":"cond-expr","locations":[{"start":{"line":128,"column":134},"end":{"line":128,"column":140}},{"start":{"line":128,"column":143},"end":{"line":128,"column":155}}],"line":128},"83":{"loc":{"start":{"line":128,"column":9},"end":{"line":128,"column":131}},"type":"binary-expr","locations":[{"start":{"line":128,"column":9},"end":{"line":128,"column":114}},{"start":{"line":128,"column":118},"end":{"line":128,"column":131}}],"line":128},"84":{"loc":{"start":{"line":128,"column":15},"end":{"line":128,"column":104}},"type":"cond-expr","locations":[{"start":{"line":128,"column":72},"end":{"line":128,"column":78}},{"start":{"line":128,"column":81},"end":{"line":128,"column":104}}],"line":128},"85":{"loc":{"start":{"line":128,"column":15},"end":{"line":128,"column":69}},"type":"binary-expr","locations":[{"start":{"line":128,"column":15},"end":{"line":128,"column":52}},{"start":{"line":128,"column":56},"end":{"line":128,"column":69}}],"line":128},"86":{"loc":{"start":{"line":136,"column":11},"end":{"line":139,"column":78}},"type":"binary-expr","locations":[{"start":{"line":136,"column":11},"end":{"line":136,"column":54}},{"start":{"line":137,"column":8},"end":{"line":137,"column":61}},{"start":{"line":138,"column":8},"end":{"line":138,"column":63}},{"start":{"line":139,"column":9},"end":{"line":139,"column":77}}],"line":136},"87":{"loc":{"start":{"line":139,"column":9},"end":{"line":139,"column":77}},"type":"cond-expr","locations":[{"start":{"line":139,"column":59},"end":{"line":139,"column":65}},{"start":{"line":139,"column":68},"end":{"line":139,"column":77}}],"line":139},"88":{"loc":{"start":{"line":139,"column":9},"end":{"line":139,"column":56}},"type":"binary-expr","locations":[{"start":{"line":139,"column":9},"end":{"line":139,"column":39}},{"start":{"line":139,"column":43},"end":{"line":139,"column":56}}],"line":139},"89":{"loc":{"start":{"line":144,"column":11},"end":{"line":146,"column":78}},"type":"binary-expr","locations":[{"start":{"line":144,"column":11},"end":{"line":144,"column":54}},{"start":{"line":145,"column":8},"end":{"line":145,"column":71}},{"start":{"line":146,"column":9},"end":{"line":146,"column":77}}],"line":144},"90":{"loc":{"start":{"line":146,"column":9},"end":{"line":146,"column":77}},"type":"cond-expr","locations":[{"start":{"line":146,"column":59},"end":{"line":146,"column":65}},{"start":{"line":146,"column":68},"end":{"line":146,"column":77}}],"line":146},"91":{"loc":{"start":{"line":146,"column":9},"end":{"line":146,"column":56}},"type":"binary-expr","locations":[{"start":{"line":146,"column":9},"end":{"line":146,"column":39}},{"start":{"line":146,"column":43},"end":{"line":146,"column":56}}],"line":146}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":8,"11":8,"12":3,"13":1,"14":1,"15":58,"16":58,"17":53,"18":7,"19":46,"20":7,"21":39,"22":26,"23":24,"24":2,"25":5,"26":1,"27":1,"28":15,"29":15,"30":14,"31":1,"32":1,"33":115,"34":115,"35":1,"36":1,"37":10,"38":1,"39":1,"40":50,"41":1,"42":1,"43":30,"44":1,"45":41,"46":41,"47":3,"48":2,"49":1,"50":38,"51":2,"52":36,"53":11,"54":1,"55":1,"56":2,"57":2,"58":1,"59":1,"60":37,"61":1,"62":1,"63":2,"64":1,"65":1,"66":5,"67":1,"68":1,"69":1,"70":10,"71":1,"72":1,"73":3,"74":1},"f":{"0":8,"1":58,"2":15,"3":115,"4":10,"5":50,"6":30,"7":41,"8":2,"9":37,"10":2,"11":5,"12":10,"13":3},"b":{"0":[0,8],"1":[8,8],"2":[3,5],"3":[8,3,3],"4":[3,5],"5":[8,6],"6":[0,3],"7":[3,3],"8":[0,3],"9":[3,3],"10":[2,1],"11":[53,5],"12":[0,58],"13":[58,58],"14":[7,46],"15":[23,30],"16":[53,53],"17":[5,48],"18":[53,53],"19":[7,39],"20":[23,23],"21":[46,46],"22":[5,41],"23":[46,46],"24":[26,13],"25":[12,27],"26":[39,27],"27":[24,2],"28":[14,1],"29":[15,13],"30":[13,2],"31":[15,5],"32":[1,14],"33":[15,15],"34":[1,12],"35":[13,13],"36":[9,5],"37":[14,11],"38":[0,14],"39":[14,14],"40":[12,103],"41":[115,115],"42":[10,10,0],"43":[0,0],"44":[0,0],"45":[50,48,47,12],"46":[0,12],"47":[12,12],"48":[5,25],"49":[30,30],"50":[2,28],"51":[30,30],"52":[2,28],"53":[30,30],"54":[0,41],"55":[41,41],"56":[3,38],"57":[2,1],"58":[2,36],"59":[38,30],"60":[38,2],"61":[2,36],"62":[38,38],"63":[0,38],"64":[38,38],"65":[11,25],"66":[36,11],"67":[18,18],"68":[36,18],"69":[0,11],"70":[11,11],"71":[2,0],"72":[2,2],"73":[0,2],"74":[2,2],"75":[37,37,37,24],"76":[0,24],"77":[24,24],"78":[2,2,2,0],"79":[0,0],"80":[0,0],"81":[1,4],"82":[4,1],"83":[5,5],"84":[2,3],"85":[5,5],"86":[10,3,2,2],"87":[0,2],"88":[2,2],"89":[3,3,2],"90":[0,2],"91":[2,2]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/refresh.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/refresh.ts"],"names":[],"mappings":"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","sourcesContent":["import { GatewayCoreState, GatewayInput } from '../types/gatewayCore';\nimport { ExtendedGatewayStatus, GatewayStatus, InternalGatewayStatus } from '../types/gateway';\nimport {\n  statusIfGatekeeperRecordRejected,\n  statusFromGatewayTokenIfExists,\n  payerIsWalletOwner,\n  StatusIfGatekeeperRecordRejectedType,\n  GatewayTokenCheckType,\n} from './common';\nimport { InputStatus } from '../types/fetch';\nimport { CivicPassMessageAction, CivicPassMessageEventResult } from '../types/civicPass';\nimport { GatekeeperAPIStatus, GatekeeperRecordResponse } from '../types/gatekeeperApi';\nimport { ChainConfirmationTimeout, ErrorCode } from '../utils/errors';\nimport { preApprovedTxAvailable } from './issuance';\n\nexport type CalculateFromRefreshInReviewReturnType =\n  | ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN\n  | ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR\n  | ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND\n  | ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND;\n\n// we're waiting on a civic pass to provide us with a payload to send to the gatekeeper\n// when we get the refresh payload, then return REFRESH_CLIENT_SENDS_REQUEST_NEW_TX\nexport const calculateRefreshStartPreApprovedTransaction = (\n  state: GatewayCoreState\n):\n  | ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX\n  | ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX\n  | undefined => {\n  const civicPassEvent = state.inputs.civicPass?.received;\n  if (\n    civicPassEvent?.action === CivicPassMessageAction.START_PRE_APPROVED_TRANSACTION &&\n    civicPassEvent?.event === CivicPassMessageEventResult.SUCCESS &&\n    civicPassEvent?.payload !== undefined\n  ) {\n    return payerIsWalletOwner(state)\n      ? ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX\n      : ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX;\n  }\n};\n\nexport const calculateFromRefreshInReview = (\n  state: GatewayCoreState\n): CalculateFromRefreshInReviewReturnType | undefined => {\n  const gatekeeperRecord = state.inputs.gatekeeperRecord;\n\n  if (state.inputs.parameters?.payer) {\n    // this is the case where we're restarting a flow and we need a new transaction, so we need to check if we have proof\n    // otherwise restart the flow\n    if (state.internal?.chainTransaction?.sentTxId) {\n      return ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN;\n    }\n    if (state.internal?.chainTransaction?.error) {\n      return ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR;\n    }\n    if (gatekeeperRecord.received?.transaction) {\n      if (payerIsWalletOwner(state)) {\n        return ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND;\n      }\n      return ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND;\n    }\n  } else {\n    // civic-sends case\n    return ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN;\n  }\n};\n\nexport type CalculateFromGatekeeperRefreshRequestedReturnType =\n  | ExtendedGatewayStatus.REFRESH_CLIENT_PAYER_REQUESTED\n  | ExtendedGatewayStatus.REFRESH_IN_REVIEW;\n\nexport const calculateFromGatekeeperRefreshRequested = (\n  state: GatewayCoreState\n): CalculateFromGatekeeperRefreshRequestedReturnType | undefined => {\n  const gatekeeperRecord = state.inputs.gatekeeperRecord;\n  // post-gatekeeper request\n  if (\n    gatekeeperRecord?.received?.state === GatekeeperAPIStatus.REQUESTED ||\n    gatekeeperRecord?.status === InputStatus.IN_PROGRESS\n  ) {\n    return state.inputs.parameters?.payer && payerIsWalletOwner(state)\n      ? ExtendedGatewayStatus.REFRESH_CLIENT_PAYER_REQUESTED\n      : ExtendedGatewayStatus.REFRESH_IN_REVIEW;\n  }\n};\n\nexport type TokenNotRefreshRequiredReturnType =\n  | GatewayTokenCheckType\n  | ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN\n  | GatewayStatus.REFRESH_TOKEN_REQUIRED;\n\nexport const tokenNotRefreshRequired = (state: GatewayCoreState): TokenNotRefreshRequiredReturnType | undefined => {\n  const tokenStatus = statusFromGatewayTokenIfExists(state);\n  return tokenStatus &&\n    // we don't want to trigger a change to active until the gatewayToken expiry changes\n    ![ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN, GatewayStatus.REFRESH_TOKEN_REQUIRED].includes(tokenStatus)\n    ? tokenStatus\n    : undefined;\n};\n\nexport type ComputeRefreshRequestedReturnType = InternalGatewayStatus;\n\nexport const computeRefreshRequested = (state: GatewayCoreState): ComputeRefreshRequestedReturnType =>\n  tokenNotRefreshRequired(state) ||\n  calculateFromGatekeeperRefreshRequested(state) ||\n  (state.internal?.status as InternalGatewayStatus);\n\nexport type ComputeRefreshInReviewReturnType =\n  | InternalGatewayStatus\n  | ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN\n  | ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR\n  | ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND\n  | ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND;\n\nexport const computeRefreshInReview = (state: GatewayCoreState): ComputeRefreshInReviewReturnType =>\n  tokenNotRefreshRequired(state) ||\n  statusIfGatekeeperRecordRejected(state) ||\n  calculateFromRefreshInReview(state) ||\n  (state.internal?.status as InternalGatewayStatus);\n\nexport type CalculateRefreshStatusReturnType = InternalGatewayStatus;\n\nconst refreshCredentialRequired = (gatekeeperRecord: GatewayInput<GatekeeperRecordResponse> | undefined): boolean => {\n  return !!gatekeeperRecord?.received?.payload?.credentialExpired;\n};\n\nexport const calculateRefreshStatus = (state: GatewayCoreState): CalculateRefreshStatusReturnType | undefined => {\n  const civicPassEvent = state.inputs.civicPass?.received;\n  if (preApprovedTxAvailable(state.inputs.gatekeeperRecord)) {\n    if (payerIsWalletOwner(state)) {\n      return ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_START_NEW_TX;\n    }\n    return ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX;\n  }\n\n  // Once we're in REFRESH_CREDENTIAL_EXPIRED_START status we don't want to go back to REFRESH_CREDENTIAL_EXPIRED\n  if (\n    (state?.internal?.status || '') !== ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED_START &&\n    refreshCredentialRequired(state.inputs.gatekeeperRecord)\n  ) {\n    return ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED;\n  }\n\n  if (\n    civicPassEvent?.action === CivicPassMessageAction.REFRESH &&\n    civicPassEvent?.event === CivicPassMessageEventResult.SUCCESS\n  ) {\n    return ExtendedGatewayStatus.REFRESH_USER_INFORMATION_VALIDATED;\n  }\n};\n\nexport type CredentialExpiredRefreshRequiredReturnType =\n  | GatewayTokenCheckType\n  | ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED\n  | ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED_START;\n\nexport const calculateExpiredCredentialStatus = (\n  state: GatewayCoreState\n): CredentialExpiredRefreshRequiredReturnType | undefined => {\n  if (\n    state.inputs.civicPass.received?.action === CivicPassMessageAction.CREDENTIAL_EXPIRED &&\n    state.inputs.civicPass.received.event === CivicPassMessageEventResult.SUCCESS\n  ) {\n    return ExtendedGatewayStatus.REFRESH_CREDENTIAL_EXPIRED_START;\n  }\n};\n\nexport type ComputeRefreshStatusReturnType =\n  | InternalGatewayStatus\n  | ExtendedGatewayStatus.REFRESH_AWAITING_ON_CHAIN_TOKEN\n  | ExtendedGatewayStatus.CHAIN_TRANSACTION_ERROR\n  | ExtendedGatewayStatus.REFRESH_AWAITING_TRANSACTION_SEND\n  | ExtendedGatewayStatus.REFRESH_AWAITING_THIRD_PARTY_TRANSACTION_SEND\n  | ExtendedGatewayStatus.REFRESH_USER_INFORMATION_VALIDATED;\n\nexport const computeRefreshStatus = (state: GatewayCoreState): ComputeRefreshStatusReturnType =>\n  tokenNotRefreshRequired(state) ||\n  statusIfGatekeeperRecordRejected(state) ||\n  calculateRefreshStatus(state) ||\n  (state.internal?.status as InternalGatewayStatus);\n\nexport const computeRefreshCredentialExpiredStatus = (state: GatewayCoreState): ComputeRefreshStatusReturnType =>\n  tokenNotRefreshRequired(state) ||\n  statusIfGatekeeperRecordRejected(state) ||\n  calculateExpiredCredentialStatus(state) ||\n  (state.internal?.status as InternalGatewayStatus);\n\nexport type CalculateFromRefreshAwaitingOnChainReturnType =\n  | InternalGatewayStatus\n  | ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR;\n\nexport const calculateFromRefreshAwaitingOnChain = (\n  state: GatewayCoreState\n): CalculateFromRefreshAwaitingOnChainReturnType | undefined => {\n  if (\n    (state.internal.errors?.expectedOnChainToken as ChainConfirmationTimeout)?.errorCode ===\n    ErrorCode.CHAIN_CONFIRMATION_TIMEOUT_ERROR\n  ) {\n    return ExtendedGatewayStatus.CHAIN_TIMEOUT_ERROR;\n  }\n};\n\nexport type ComputeRefreshAwaitingOnChainTokenReturnType =\n  | TokenNotRefreshRequiredReturnType\n  | StatusIfGatekeeperRecordRejectedType\n  | CalculateFromRefreshAwaitingOnChainReturnType;\n\nexport const computeRefreshAwaitingOnChainToken = (\n  state: GatewayCoreState\n): ComputeRefreshAwaitingOnChainTokenReturnType =>\n  tokenNotRefreshRequired(state) ||\n  statusIfGatekeeperRecordRejected(state) ||\n  calculateFromRefreshAwaitingOnChain(state) ||\n  (state.internal?.status as InternalGatewayStatus);\n\nexport const computeRefreshStartPreApprovedTransaction = (\n  state: GatewayCoreState\n):\n  | TokenNotRefreshRequiredReturnType\n  | ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX\n  | ExtendedGatewayStatus.REFRESH_CLIENT_THIRD_PARTY_SENDS_REQUEST_NEW_TX =>\n  tokenNotRefreshRequired(state) ||\n  calculateRefreshStartPreApprovedTransaction(state) ||\n  (state.internal?.status as\n    | TokenNotRefreshRequiredReturnType\n    | ExtendedGatewayStatus.REFRESH_CLIENT_SENDS_REQUEST_NEW_TX);\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3959def53b1eddd4ea31b6828189a3b3a06f0259"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/flowParameters.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/flowParameters.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":39}},"2":{"start":{"line":4,"column":18},"end":{"line":4,"column":45}},"3":{"start":{"line":5,"column":23},"end":{"line":5,"column":48}},"4":{"start":{"line":6,"column":15},"end":{"line":6,"column":39}},"5":{"start":{"line":7,"column":17},"end":{"line":7,"column":36}},"6":{"start":{"line":8,"column":17},"end":{"line":8,"column":43}},"7":{"start":{"line":9,"column":18},"end":{"line":9,"column":46}},"8":{"start":{"line":10,"column":30},"end":{"line":57,"column":1}},"9":{"start":{"line":12,"column":4},"end":{"line":15,"column":5}},"10":{"start":{"line":14,"column":8},"end":{"line":14,"column":20}},"11":{"start":{"line":16,"column":22},"end":{"line":20,"column":142}},"12":{"start":{"line":21,"column":19},"end":{"line":21,"column":88}},"13":{"start":{"line":22,"column":19},"end":{"line":22,"column":71}},"14":{"start":{"line":23,"column":20},"end":{"line":25,"column":166}},"15":{"start":{"line":26,"column":23},"end":{"line":26,"column":117}},"16":{"start":{"line":27,"column":30},"end":{"line":28,"column":160}},"17":{"start":{"line":29,"column":30},"end":{"line":29,"column":223}},"18":{"start":{"line":30,"column":4},"end":{"line":56,"column":6}},"19":{"start":{"line":58,"column":0},"end":{"line":58,"column":54}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":10,"column":30},"end":{"line":10,"column":31}},"loc":{"start":{"line":10,"column":65},"end":{"line":57,"column":1}},"line":10}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":4},"end":{"line":15,"column":5}},"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":15,"column":5}},{"start":{"line":12,"column":4},"end":{"line":15,"column":5}}],"line":12},"1":{"loc":{"start":{"line":12,"column":8},"end":{"line":13,"column":108}},"type":"binary-expr","locations":[{"start":{"line":12,"column":8},"end":{"line":12,"column":258}},{"start":{"line":13,"column":8},"end":{"line":13,"column":108}}],"line":12},"2":{"loc":{"start":{"line":12,"column":10},"end":{"line":12,"column":257}},"type":"binary-expr","locations":[{"start":{"line":12,"column":11},"end":{"line":12,"column":88}},{"start":{"line":12,"column":94},"end":{"line":12,"column":178}},{"start":{"line":12,"column":184},"end":{"line":12,"column":256}}],"line":12},"3":{"loc":{"start":{"line":12,"column":11},"end":{"line":12,"column":88}},"type":"cond-expr","locations":[{"start":{"line":12,"column":70},"end":{"line":12,"column":76}},{"start":{"line":12,"column":79},"end":{"line":12,"column":88}}],"line":12},"4":{"loc":{"start":{"line":12,"column":11},"end":{"line":12,"column":67}},"type":"binary-expr","locations":[{"start":{"line":12,"column":11},"end":{"line":12,"column":50}},{"start":{"line":12,"column":54},"end":{"line":12,"column":67}}],"line":12},"5":{"loc":{"start":{"line":12,"column":94},"end":{"line":12,"column":178}},"type":"cond-expr","locations":[{"start":{"line":12,"column":157},"end":{"line":12,"column":163}},{"start":{"line":12,"column":166},"end":{"line":12,"column":178}}],"line":12},"6":{"loc":{"start":{"line":12,"column":94},"end":{"line":12,"column":154}},"type":"binary-expr","locations":[{"start":{"line":12,"column":94},"end":{"line":12,"column":137}},{"start":{"line":12,"column":141},"end":{"line":12,"column":154}}],"line":12},"7":{"loc":{"start":{"line":12,"column":184},"end":{"line":12,"column":256}},"type":"cond-expr","locations":[{"start":{"line":12,"column":234},"end":{"line":12,"column":240}},{"start":{"line":12,"column":243},"end":{"line":12,"column":256}}],"line":12},"8":{"loc":{"start":{"line":12,"column":184},"end":{"line":12,"column":231}},"type":"binary-expr","locations":[{"start":{"line":12,"column":184},"end":{"line":12,"column":214}},{"start":{"line":12,"column":218},"end":{"line":12,"column":231}}],"line":12},"9":{"loc":{"start":{"line":16,"column":22},"end":{"line":20,"column":142}},"type":"binary-expr","locations":[{"start":{"line":16,"column":23},"end":{"line":16,"column":178}},{"start":{"line":17,"column":9},"end":{"line":17,"column":150}},{"start":{"line":18,"column":9},"end":{"line":18,"column":151}},{"start":{"line":19,"column":9},"end":{"line":19,"column":206}},{"start":{"line":20,"column":9},"end":{"line":20,"column":141}}],"line":16},"10":{"loc":{"start":{"line":16,"column":23},"end":{"line":16,"column":178}},"type":"cond-expr","locations":[{"start":{"line":16,"column":157},"end":{"line":16,"column":163}},{"start":{"line":16,"column":166},"end":{"line":16,"column":178}}],"line":16},"11":{"loc":{"start":{"line":16,"column":23},"end":{"line":16,"column":154}},"type":"binary-expr","locations":[{"start":{"line":16,"column":23},"end":{"line":16,"column":137}},{"start":{"line":16,"column":141},"end":{"line":16,"column":154}}],"line":16},"12":{"loc":{"start":{"line":16,"column":29},"end":{"line":16,"column":127}},"type":"cond-expr","locations":[{"start":{"line":16,"column":86},"end":{"line":16,"column":92}},{"start":{"line":16,"column":95},"end":{"line":16,"column":127}}],"line":16},"13":{"loc":{"start":{"line":16,"column":29},"end":{"line":16,"column":83}},"type":"binary-expr","locations":[{"start":{"line":16,"column":29},"end":{"line":16,"column":66}},{"start":{"line":16,"column":70},"end":{"line":16,"column":83}}],"line":16},"14":{"loc":{"start":{"line":17,"column":9},"end":{"line":17,"column":150}},"type":"cond-expr","locations":[{"start":{"line":17,"column":129},"end":{"line":17,"column":135}},{"start":{"line":17,"column":138},"end":{"line":17,"column":150}}],"line":17},"15":{"loc":{"start":{"line":17,"column":9},"end":{"line":17,"column":126}},"type":"binary-expr","locations":[{"start":{"line":17,"column":9},"end":{"line":17,"column":109}},{"start":{"line":17,"column":113},"end":{"line":17,"column":126}}],"line":17},"16":{"loc":{"start":{"line":17,"column":15},"end":{"line":17,"column":99}},"type":"cond-expr","locations":[{"start":{"line":17,"column":82},"end":{"line":17,"column":88}},{"start":{"line":17,"column":91},"end":{"line":17,"column":99}}],"line":17},"17":{"loc":{"start":{"line":17,"column":15},"end":{"line":17,"column":79}},"type":"binary-expr","locations":[{"start":{"line":17,"column":15},"end":{"line":17,"column":62}},{"start":{"line":17,"column":66},"end":{"line":17,"column":79}}],"line":17},"18":{"loc":{"start":{"line":18,"column":9},"end":{"line":18,"column":151}},"type":"cond-expr","locations":[{"start":{"line":18,"column":130},"end":{"line":18,"column":136}},{"start":{"line":18,"column":139},"end":{"line":18,"column":151}}],"line":18},"19":{"loc":{"start":{"line":18,"column":9},"end":{"line":18,"column":127}},"type":"binary-expr","locations":[{"start":{"line":18,"column":9},"end":{"line":18,"column":110}},{"start":{"line":18,"column":114},"end":{"line":18,"column":127}}],"line":18},"20":{"loc":{"start":{"line":18,"column":15},"end":{"line":18,"column":100}},"type":"cond-expr","locations":[{"start":{"line":18,"column":80},"end":{"line":18,"column":86}},{"start":{"line":18,"column":89},"end":{"line":18,"column":100}}],"line":18},"21":{"loc":{"start":{"line":18,"column":15},"end":{"line":18,"column":77}},"type":"binary-expr","locations":[{"start":{"line":18,"column":15},"end":{"line":18,"column":60}},{"start":{"line":18,"column":64},"end":{"line":18,"column":77}}],"line":18},"22":{"loc":{"start":{"line":19,"column":9},"end":{"line":19,"column":206}},"type":"cond-expr","locations":[{"start":{"line":19,"column":185},"end":{"line":19,"column":191}},{"start":{"line":19,"column":194},"end":{"line":19,"column":206}}],"line":19},"23":{"loc":{"start":{"line":19,"column":9},"end":{"line":19,"column":182}},"type":"binary-expr","locations":[{"start":{"line":19,"column":9},"end":{"line":19,"column":165}},{"start":{"line":19,"column":169},"end":{"line":19,"column":182}}],"line":19},"24":{"loc":{"start":{"line":19,"column":15},"end":{"line":19,"column":155}},"type":"cond-expr","locations":[{"start":{"line":19,"column":136},"end":{"line":19,"column":142}},{"start":{"line":19,"column":145},"end":{"line":19,"column":155}}],"line":19},"25":{"loc":{"start":{"line":19,"column":15},"end":{"line":19,"column":133}},"type":"binary-expr","locations":[{"start":{"line":19,"column":15},"end":{"line":19,"column":116}},{"start":{"line":19,"column":120},"end":{"line":19,"column":133}}],"line":19},"26":{"loc":{"start":{"line":19,"column":21},"end":{"line":19,"column":106}},"type":"cond-expr","locations":[{"start":{"line":19,"column":86},"end":{"line":19,"column":92}},{"start":{"line":19,"column":95},"end":{"line":19,"column":106}}],"line":19},"27":{"loc":{"start":{"line":19,"column":21},"end":{"line":19,"column":83}},"type":"binary-expr","locations":[{"start":{"line":19,"column":21},"end":{"line":19,"column":66}},{"start":{"line":19,"column":70},"end":{"line":19,"column":83}}],"line":19},"28":{"loc":{"start":{"line":20,"column":9},"end":{"line":20,"column":141}},"type":"cond-expr","locations":[{"start":{"line":20,"column":120},"end":{"line":20,"column":126}},{"start":{"line":20,"column":129},"end":{"line":20,"column":141}}],"line":20},"29":{"loc":{"start":{"line":20,"column":9},"end":{"line":20,"column":117}},"type":"binary-expr","locations":[{"start":{"line":20,"column":9},"end":{"line":20,"column":100}},{"start":{"line":20,"column":104},"end":{"line":20,"column":117}}],"line":20},"30":{"loc":{"start":{"line":20,"column":15},"end":{"line":20,"column":90}},"type":"cond-expr","locations":[{"start":{"line":20,"column":73},"end":{"line":20,"column":79}},{"start":{"line":20,"column":82},"end":{"line":20,"column":90}}],"line":20},"31":{"loc":{"start":{"line":20,"column":15},"end":{"line":20,"column":70}},"type":"binary-expr","locations":[{"start":{"line":20,"column":15},"end":{"line":20,"column":53}},{"start":{"line":20,"column":57},"end":{"line":20,"column":70}}],"line":20},"32":{"loc":{"start":{"line":23,"column":20},"end":{"line":25,"column":166}},"type":"cond-expr","locations":[{"start":{"line":24,"column":10},"end":{"line":24,"column":19}},{"start":{"line":25,"column":10},"end":{"line":25,"column":166}}],"line":23},"33":{"loc":{"start":{"line":23,"column":48},"end":{"line":23,"column":188}},"type":"cond-expr","locations":[{"start":{"line":23,"column":169},"end":{"line":23,"column":175}},{"start":{"line":23,"column":178},"end":{"line":23,"column":188}}],"line":23},"34":{"loc":{"start":{"line":23,"column":48},"end":{"line":23,"column":166}},"type":"binary-expr","locations":[{"start":{"line":23,"column":48},"end":{"line":23,"column":149}},{"start":{"line":23,"column":153},"end":{"line":23,"column":166}}],"line":23},"35":{"loc":{"start":{"line":23,"column":54},"end":{"line":23,"column":139}},"type":"cond-expr","locations":[{"start":{"line":23,"column":119},"end":{"line":23,"column":125}},{"start":{"line":23,"column":128},"end":{"line":23,"column":139}}],"line":23},"36":{"loc":{"start":{"line":23,"column":54},"end":{"line":23,"column":116}},"type":"binary-expr","locations":[{"start":{"line":23,"column":54},"end":{"line":23,"column":99}},{"start":{"line":23,"column":103},"end":{"line":23,"column":116}}],"line":23},"37":{"loc":{"start":{"line":25,"column":25},"end":{"line":25,"column":165}},"type":"cond-expr","locations":[{"start":{"line":25,"column":146},"end":{"line":25,"column":152}},{"start":{"line":25,"column":155},"end":{"line":25,"column":165}}],"line":25},"38":{"loc":{"start":{"line":25,"column":25},"end":{"line":25,"column":143}},"type":"binary-expr","locations":[{"start":{"line":25,"column":25},"end":{"line":25,"column":126}},{"start":{"line":25,"column":130},"end":{"line":25,"column":143}}],"line":25},"39":{"loc":{"start":{"line":25,"column":31},"end":{"line":25,"column":116}},"type":"cond-expr","locations":[{"start":{"line":25,"column":96},"end":{"line":25,"column":102}},{"start":{"line":25,"column":105},"end":{"line":25,"column":116}}],"line":25},"40":{"loc":{"start":{"line":25,"column":31},"end":{"line":25,"column":93}},"type":"binary-expr","locations":[{"start":{"line":25,"column":31},"end":{"line":25,"column":76}},{"start":{"line":25,"column":80},"end":{"line":25,"column":93}}],"line":25},"41":{"loc":{"start":{"line":26,"column":23},"end":{"line":26,"column":117}},"type":"binary-expr","locations":[{"start":{"line":26,"column":23},"end":{"line":26,"column":74}},{"start":{"line":26,"column":78},"end":{"line":26,"column":117}}],"line":26},"42":{"loc":{"start":{"line":27,"column":30},"end":{"line":28,"column":160}},"type":"binary-expr","locations":[{"start":{"line":27,"column":31},"end":{"line":27,"column":236}},{"start":{"line":28,"column":9},"end":{"line":28,"column":159}}],"line":27},"43":{"loc":{"start":{"line":27,"column":31},"end":{"line":27,"column":236}},"type":"cond-expr","locations":[{"start":{"line":27,"column":207},"end":{"line":27,"column":213}},{"start":{"line":27,"column":216},"end":{"line":27,"column":236}}],"line":27},"44":{"loc":{"start":{"line":27,"column":31},"end":{"line":27,"column":204}},"type":"binary-expr","locations":[{"start":{"line":27,"column":31},"end":{"line":27,"column":187}},{"start":{"line":27,"column":191},"end":{"line":27,"column":204}}],"line":27},"45":{"loc":{"start":{"line":27,"column":37},"end":{"line":27,"column":177}},"type":"cond-expr","locations":[{"start":{"line":27,"column":158},"end":{"line":27,"column":164}},{"start":{"line":27,"column":167},"end":{"line":27,"column":177}}],"line":27},"46":{"loc":{"start":{"line":27,"column":37},"end":{"line":27,"column":155}},"type":"binary-expr","locations":[{"start":{"line":27,"column":37},"end":{"line":27,"column":138}},{"start":{"line":27,"column":142},"end":{"line":27,"column":155}}],"line":27},"47":{"loc":{"start":{"line":27,"column":43},"end":{"line":27,"column":128}},"type":"cond-expr","locations":[{"start":{"line":27,"column":108},"end":{"line":27,"column":114}},{"start":{"line":27,"column":117},"end":{"line":27,"column":128}}],"line":27},"48":{"loc":{"start":{"line":27,"column":43},"end":{"line":27,"column":105}},"type":"binary-expr","locations":[{"start":{"line":27,"column":43},"end":{"line":27,"column":88}},{"start":{"line":27,"column":92},"end":{"line":27,"column":105}}],"line":27},"49":{"loc":{"start":{"line":28,"column":9},"end":{"line":28,"column":159}},"type":"cond-expr","locations":[{"start":{"line":28,"column":130},"end":{"line":28,"column":136}},{"start":{"line":28,"column":139},"end":{"line":28,"column":159}}],"line":28},"50":{"loc":{"start":{"line":28,"column":9},"end":{"line":28,"column":127}},"type":"binary-expr","locations":[{"start":{"line":28,"column":9},"end":{"line":28,"column":110}},{"start":{"line":28,"column":114},"end":{"line":28,"column":127}}],"line":28},"51":{"loc":{"start":{"line":28,"column":15},"end":{"line":28,"column":100}},"type":"cond-expr","locations":[{"start":{"line":28,"column":80},"end":{"line":28,"column":86}},{"start":{"line":28,"column":89},"end":{"line":28,"column":100}}],"line":28},"52":{"loc":{"start":{"line":28,"column":15},"end":{"line":28,"column":77}},"type":"binary-expr","locations":[{"start":{"line":28,"column":15},"end":{"line":28,"column":60}},{"start":{"line":28,"column":64},"end":{"line":28,"column":77}}],"line":28},"53":{"loc":{"start":{"line":29,"column":30},"end":{"line":29,"column":223}},"type":"cond-expr","locations":[{"start":{"line":29,"column":64},"end":{"line":29,"column":81}},{"start":{"line":29,"column":84},"end":{"line":29,"column":223}}],"line":29},"54":{"loc":{"start":{"line":29,"column":84},"end":{"line":29,"column":223}},"type":"cond-expr","locations":[{"start":{"line":29,"column":194},"end":{"line":29,"column":200}},{"start":{"line":29,"column":203},"end":{"line":29,"column":223}}],"line":29},"55":{"loc":{"start":{"line":29,"column":84},"end":{"line":29,"column":191}},"type":"binary-expr","locations":[{"start":{"line":29,"column":84},"end":{"line":29,"column":174}},{"start":{"line":29,"column":178},"end":{"line":29,"column":191}}],"line":29},"56":{"loc":{"start":{"line":29,"column":90},"end":{"line":29,"column":164}},"type":"cond-expr","locations":[{"start":{"line":29,"column":138},"end":{"line":29,"column":144}},{"start":{"line":29,"column":147},"end":{"line":29,"column":164}}],"line":29},"57":{"loc":{"start":{"line":29,"column":90},"end":{"line":29,"column":135}},"type":"binary-expr","locations":[{"start":{"line":29,"column":90},"end":{"line":29,"column":118}},{"start":{"line":29,"column":122},"end":{"line":29,"column":135}}],"line":29},"58":{"loc":{"start":{"line":36,"column":12},"end":{"line":36,"column":38}},"type":"cond-expr","locations":[{"start":{"line":36,"column":22},"end":{"line":36,"column":33}},{"start":{"line":36,"column":36},"end":{"line":36,"column":38}}],"line":36},"59":{"loc":{"start":{"line":37,"column":21},"end":{"line":37,"column":103}},"type":"cond-expr","locations":[{"start":{"line":37,"column":80},"end":{"line":37,"column":86}},{"start":{"line":37,"column":89},"end":{"line":37,"column":103}}],"line":37},"60":{"loc":{"start":{"line":37,"column":21},"end":{"line":37,"column":77}},"type":"binary-expr","locations":[{"start":{"line":37,"column":21},"end":{"line":37,"column":60}},{"start":{"line":37,"column":64},"end":{"line":37,"column":77}}],"line":37},"61":{"loc":{"start":{"line":38,"column":24},"end":{"line":38,"column":112}},"type":"cond-expr","locations":[{"start":{"line":38,"column":83},"end":{"line":38,"column":89}},{"start":{"line":38,"column":92},"end":{"line":38,"column":112}}],"line":38},"62":{"loc":{"start":{"line":38,"column":24},"end":{"line":38,"column":80}},"type":"binary-expr","locations":[{"start":{"line":38,"column":24},"end":{"line":38,"column":63}},{"start":{"line":38,"column":67},"end":{"line":38,"column":80}}],"line":38},"63":{"loc":{"start":{"line":40,"column":15},"end":{"line":40,"column":99}},"type":"cond-expr","locations":[{"start":{"line":40,"column":78},"end":{"line":40,"column":84}},{"start":{"line":40,"column":87},"end":{"line":40,"column":99}}],"line":40},"64":{"loc":{"start":{"line":40,"column":15},"end":{"line":40,"column":75}},"type":"binary-expr","locations":[{"start":{"line":40,"column":15},"end":{"line":40,"column":58}},{"start":{"line":40,"column":62},"end":{"line":40,"column":75}}],"line":40},"65":{"loc":{"start":{"line":41,"column":22},"end":{"line":41,"column":109}},"type":"cond-expr","locations":[{"start":{"line":41,"column":85},"end":{"line":41,"column":91}},{"start":{"line":41,"column":94},"end":{"line":41,"column":109}}],"line":41},"66":{"loc":{"start":{"line":41,"column":22},"end":{"line":41,"column":82}},"type":"binary-expr","locations":[{"start":{"line":41,"column":22},"end":{"line":41,"column":65}},{"start":{"line":41,"column":69},"end":{"line":41,"column":82}}],"line":41},"67":{"loc":{"start":{"line":42,"column":13},"end":{"line":42,"column":87}},"type":"cond-expr","locations":[{"start":{"line":42,"column":73},"end":{"line":42,"column":79}},{"start":{"line":42,"column":82},"end":{"line":42,"column":87}}],"line":42},"68":{"loc":{"start":{"line":42,"column":13},"end":{"line":42,"column":70}},"type":"binary-expr","locations":[{"start":{"line":42,"column":13},"end":{"line":42,"column":53}},{"start":{"line":42,"column":57},"end":{"line":42,"column":70}}],"line":42},"69":{"loc":{"start":{"line":48,"column":27},"end":{"line":50,"column":23}},"type":"cond-expr","locations":[{"start":{"line":49,"column":14},"end":{"line":49,"column":110}},{"start":{"line":50,"column":14},"end":{"line":50,"column":23}}],"line":48},"70":{"loc":{"start":{"line":48,"column":27},"end":{"line":48,"column":132}},"type":"binary-expr","locations":[{"start":{"line":48,"column":27},"end":{"line":48,"column":56}},{"start":{"line":48,"column":60},"end":{"line":48,"column":132}}],"line":48},"71":{"loc":{"start":{"line":49,"column":14},"end":{"line":49,"column":110}},"type":"cond-expr","locations":[{"start":{"line":49,"column":81},"end":{"line":49,"column":87}},{"start":{"line":49,"column":90},"end":{"line":49,"column":110}}],"line":49},"72":{"loc":{"start":{"line":49,"column":14},"end":{"line":49,"column":78}},"type":"binary-expr","locations":[{"start":{"line":49,"column":14},"end":{"line":49,"column":61}},{"start":{"line":49,"column":65},"end":{"line":49,"column":78}}],"line":49},"73":{"loc":{"start":{"line":51,"column":18},"end":{"line":51,"column":152}},"type":"cond-expr","locations":[{"start":{"line":51,"column":132},"end":{"line":51,"column":138}},{"start":{"line":51,"column":141},"end":{"line":51,"column":152}}],"line":51},"74":{"loc":{"start":{"line":51,"column":18},"end":{"line":51,"column":129}},"type":"binary-expr","locations":[{"start":{"line":51,"column":18},"end":{"line":51,"column":112}},{"start":{"line":51,"column":116},"end":{"line":51,"column":129}}],"line":51},"75":{"loc":{"start":{"line":51,"column":24},"end":{"line":51,"column":102}},"type":"cond-expr","locations":[{"start":{"line":51,"column":74},"end":{"line":51,"column":80}},{"start":{"line":51,"column":83},"end":{"line":51,"column":102}}],"line":51},"76":{"loc":{"start":{"line":51,"column":24},"end":{"line":51,"column":71}},"type":"binary-expr","locations":[{"start":{"line":51,"column":24},"end":{"line":51,"column":54}},{"start":{"line":51,"column":58},"end":{"line":51,"column":71}}],"line":51},"77":{"loc":{"start":{"line":52,"column":21},"end":{"line":52,"column":183}},"type":"binary-expr","locations":[{"start":{"line":52,"column":22},"end":{"line":52,"column":161}},{"start":{"line":52,"column":166},"end":{"line":52,"column":183}}],"line":52},"78":{"loc":{"start":{"line":52,"column":22},"end":{"line":52,"column":161}},"type":"cond-expr","locations":[{"start":{"line":52,"column":130},"end":{"line":52,"column":136}},{"start":{"line":52,"column":139},"end":{"line":52,"column":161}}],"line":52},"79":{"loc":{"start":{"line":52,"column":22},"end":{"line":52,"column":127}},"type":"binary-expr","locations":[{"start":{"line":52,"column":22},"end":{"line":52,"column":109}},{"start":{"line":52,"column":113},"end":{"line":52,"column":127}}],"line":52},"80":{"loc":{"start":{"line":52,"column":29},"end":{"line":52,"column":99}},"type":"cond-expr","locations":[{"start":{"line":52,"column":77},"end":{"line":52,"column":83}},{"start":{"line":52,"column":86},"end":{"line":52,"column":99}}],"line":52},"81":{"loc":{"start":{"line":52,"column":29},"end":{"line":52,"column":74}},"type":"binary-expr","locations":[{"start":{"line":52,"column":29},"end":{"line":52,"column":57}},{"start":{"line":52,"column":61},"end":{"line":52,"column":74}}],"line":52},"82":{"loc":{"start":{"line":53,"column":15},"end":{"line":53,"column":144}},"type":"cond-expr","locations":[{"start":{"line":53,"column":126},"end":{"line":53,"column":132}},{"start":{"line":53,"column":135},"end":{"line":53,"column":144}}],"line":53},"83":{"loc":{"start":{"line":53,"column":15},"end":{"line":53,"column":123}},"type":"binary-expr","locations":[{"start":{"line":53,"column":15},"end":{"line":53,"column":105}},{"start":{"line":53,"column":109},"end":{"line":53,"column":123}}],"line":53},"84":{"loc":{"start":{"line":53,"column":22},"end":{"line":53,"column":95}},"type":"cond-expr","locations":[{"start":{"line":53,"column":72},"end":{"line":53,"column":78}},{"start":{"line":53,"column":81},"end":{"line":53,"column":95}}],"line":53},"85":{"loc":{"start":{"line":53,"column":22},"end":{"line":53,"column":69}},"type":"binary-expr","locations":[{"start":{"line":53,"column":22},"end":{"line":53,"column":51}},{"start":{"line":53,"column":55},"end":{"line":53,"column":69}}],"line":53},"86":{"loc":{"start":{"line":54,"column":30},"end":{"line":54,"column":244}},"type":"cond-expr","locations":[{"start":{"line":54,"column":214},"end":{"line":54,"column":220}},{"start":{"line":54,"column":223},"end":{"line":54,"column":244}}],"line":54},"87":{"loc":{"start":{"line":54,"column":30},"end":{"line":54,"column":211}},"type":"binary-expr","locations":[{"start":{"line":54,"column":30},"end":{"line":54,"column":193}},{"start":{"line":54,"column":197},"end":{"line":54,"column":211}}],"line":54},"88":{"loc":{"start":{"line":54,"column":37},"end":{"line":54,"column":183}},"type":"cond-expr","locations":[{"start":{"line":54,"column":163},"end":{"line":54,"column":169}},{"start":{"line":54,"column":172},"end":{"line":54,"column":183}}],"line":54},"89":{"loc":{"start":{"line":54,"column":37},"end":{"line":54,"column":160}},"type":"binary-expr","locations":[{"start":{"line":54,"column":37},"end":{"line":54,"column":142}},{"start":{"line":54,"column":146},"end":{"line":54,"column":160}}],"line":54},"90":{"loc":{"start":{"line":54,"column":44},"end":{"line":54,"column":132}},"type":"cond-expr","locations":[{"start":{"line":54,"column":111},"end":{"line":54,"column":117}},{"start":{"line":54,"column":120},"end":{"line":54,"column":132}}],"line":54},"91":{"loc":{"start":{"line":54,"column":44},"end":{"line":54,"column":108}},"type":"binary-expr","locations":[{"start":{"line":54,"column":44},"end":{"line":54,"column":90}},{"start":{"line":54,"column":94},"end":{"line":54,"column":108}}],"line":54},"92":{"loc":{"start":{"line":55,"column":12},"end":{"line":55,"column":91}},"type":"cond-expr","locations":[{"start":{"line":55,"column":46},"end":{"line":55,"column":86}},{"start":{"line":55,"column":89},"end":{"line":55,"column":91}}],"line":55}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1760,"10":1060,"11":700,"12":700,"13":700,"14":700,"15":700,"16":700,"17":700,"18":700,"19":1},"f":{"0":1760},"b":{"0":[1060,700],"1":[1760,1445],"2":[1760,1445,1445],"3":[308,1452],"4":[1760,1452],"5":[0,1445],"6":[1445,1445],"7":[0,1445],"8":[1445,1445],"9":[700,698,698,671,657],"10":[698,2],"11":[700,700],"12":[11,689],"13":[700,700],"14":[676,22],"15":[698,698],"16":[599,99],"17":[698,698],"18":[202,496],"19":[698,507],"20":[11,687],"21":[698,698],"22":[340,331],"23":[671,671],"24":[202,469],"25":[671,480],"26":[11,660],"27":[671,671],"28":[657,0],"29":[657,371],"30":[11,646],"31":[657,657],"32":[572,128],"33":[202,498],"34":[700,509],"35":[11,689],"36":[700,700],"37":[0,128],"38":[128,128],"39":[0,128],"40":[128,128],"41":[700,339],"42":[700,700],"43":[340,360],"44":[700,700],"45":[202,498],"46":[700,509],"47":[11,689],"48":[700,700],"49":[202,498],"50":[700,509],"51":[11,689],"52":[700,700],"53":[0,700],"54":[198,502],"55":[700,700],"56":[11,689],"57":[700,700],"58":[128,572],"59":[0,700],"60":[700,700],"61":[0,700],"62":[700,700],"63":[0,700],"64":[700,700],"65":[0,700],"66":[700,700],"67":[11,689],"68":[700,700],"69":[1,699],"70":[700,330],"71":[0,1],"72":[1,1],"73":[601,99],"74":[700,700],"75":[0,700],"76":[700,700],"77":[700,697],"78":[0,700],"79":[700,700],"80":[0,700],"81":[700,700],"82":[0,700],"83":[700,700],"84":[0,700],"85":[700,700],"86":[340,360],"87":[700,700],"88":[202,498],"89":[700,509],"90":[11,689],"91":[700,700],"92":[0,700]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/flowParameters.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/flowParameters.ts"],"names":[],"mappings":"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","sourcesContent":["import { FlowParameters, GatewayCoreState } from '../types/gatewayCore';\nimport { GatewayStatus, InternalGatewayStatus } from '../types/gateway';\nimport { gatewayStatusToCivicPassAction } from './stateMapping';\nimport { flowTypeFromState, getFlowId } from '../utils/flow';\nimport { ChainError } from '../utils/errors';\nimport { payerIsWalletOwner } from './common';\nimport { isEmptyObject } from '../utils/object';\n// version.ts is auto-generated from package.json by running 'yarn generate-version',\n// currently done on postinstall and prebuild.\nimport { VERSION as CORE_VERSION } from '../../src/version';\n\nexport const computeFlowParameters = (\n  state: GatewayCoreState,\n  computedInternalStatus: InternalGatewayStatus\n): FlowParameters | null => {\n  if (\n    !(state.inputs.parameters?.wallet && state.internal.chainDetails?.chainType && state.internal?.instanceId) ||\n    [GatewayStatus.UNKNOWN, GatewayStatus.CHECKING].includes(computedInternalStatus as GatewayStatus)\n  ) {\n    return null;\n  }\n\n  // errors can be on civicSign or gatekeeperRecord\n  const errorCode =\n    state.internal.errors?.expectedTokenGatekeeperRecord?.errorCode ||\n    (state.internal.chainTransaction?.error as ChainError)?.errorCode ||\n    (state.inputs.gatekeeperRecord?.received?.errorCode as string | undefined) ||\n    (state.inputs.gatekeeperRecord?.received?.payload?.errorCode as string | undefined) ||\n    (state.inputs.civicSign?.error as ChainError)?.errorCode;\n  const action = gatewayStatusToCivicPassAction[computedInternalStatus];\n  const flowId = getFlowId(state, computedInternalStatus);\n  const payload = isEmptyObject(state.inputs.gatekeeperRecord?.received?.payload)\n    ? undefined\n    : JSON.stringify(state.inputs.gatekeeperRecord?.received?.payload);\n  const ownerSigns = !state.inputs.parameters.gatekeeperSendsTransaction && payerIsWalletOwner(state);\n\n  const feeFromGatekeeper =\n    state.inputs.gatekeeperRecord?.received?.payload?.feeAmountUSDCents ||\n    state.inputs.gatekeeperRecord?.received?.feeAmountUSDCents;\n  const feeAmountUSDCents =\n    feeFromGatekeeper !== undefined ? feeFromGatekeeper : state.output?.flowParameters?.feeAmountUSDCents;\n\n  return {\n    // computed\n    action,\n    flowId,\n    ownerSigns,\n    errorCode,\n    flowType: flowTypeFromState(state, computedInternalStatus),\n\n    ...(payload ? { payload } : {}),\n    // from parameters\n    // TODO consider not returning these and just adding them in the gateway-client-react\n    redirectUrl: state.inputs.parameters?.redirectUrl,\n    networkAddress: state.inputs.parameters?.gatekeeperNetwork,\n    wallet: state.inputs.parameters.wallet.address,\n    chain: state.internal.chainDetails?.chainType,\n    chainNetwork: state.internal.chainDetails?.chainNetwork,\n    did: state.internal.ownerDids?.[0],\n    gatekeeperSendsTransaction: state.inputs.parameters.gatekeeperSendsTransaction,\n    partnerAppId: state.inputs.parameters.partnerAppId,\n    referrer: state.inputs.parameters.referrer,\n    domain: state.inputs.parameters.domain,\n    instanceId: state.internal.instanceId,\n    // Never hide POWO screens in cases where the owner pays. For 3rd party pays, it's configurable by the integrator\n    hideWalletPrompts:\n      state.inputs.parameters.payer && state.inputs.parameters.payer !== state.inputs.parameters.wallet.address\n        ? state.inputs.parameters.options?.hideWalletPrompts\n        : undefined,\n\n    // from gatekeeper record response\n    signedTx: state.internal?.chainTransaction?.sentTxId,\n    // So the iframe can include the client-version in analytics events it sends.\n    civicClient: state.inputs?.parameters?.xCivicClientHeader || CORE_VERSION,\n    stage: state.inputs?.parameters?.stage,\n    credentialExpired: !!state.inputs.gatekeeperRecord?.received?.payload?.credentialExpired, // track this so we can set the correct flowType to make the iframe do a document rescan to \"refresh\"\n    ...(feeAmountUSDCents !== undefined ? { feeAmountUSDCents: feeAmountUSDCents as string } : {}),\n  };\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e1fbb8e25f75442bf7cc57a37ade3cca01c5fb68"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/object.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/object.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":31}},"2":{"start":{"line":4,"column":22},"end":{"line":4,"column":97}},"3":{"start":{"line":4,"column":31},"end":{"line":4,"column":97}},"4":{"start":{"line":5,"column":0},"end":{"line":5,"column":38}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":22},"end":{"line":4,"column":23}},"loc":{"start":{"line":4,"column":31},"end":{"line":4,"column":97}},"line":4}},"branchMap":{"0":{"loc":{"start":{"line":4,"column":31},"end":{"line":4,"column":97}},"type":"binary-expr","locations":[{"start":{"line":4,"column":31},"end":{"line":4,"column":43}},{"start":{"line":4,"column":47},"end":{"line":4,"column":64}},{"start":{"line":4,"column":68},"end":{"line":4,"column":97}}],"line":4}},"s":{"0":1,"1":1,"2":1,"3":704,"4":1},"f":{"0":704},"b":{"0":[704,703,362]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/object.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/object.ts"],"names":[],"mappings":";;;AAAO,MAAM,aAAa,GAAG,CAAC,GAA+C,EAAE,EAAE,CAC/E,GAAG,KAAK,IAAI,IAAI,GAAG,KAAK,SAAS,IAAI,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC;AADxD,QAAA,aAAa,iBAC2C","sourcesContent":["export const isEmptyObject = (obj: Record<string, unknown> | null | undefined) =>\n  obj === null || obj === undefined || Object.keys(obj).length === 0;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9aee0021cc4dc6d890d3cf33442f2cbe906eeb05"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/version.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/version.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":60}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1},"f":{},"b":{},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/version.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/version.ts"],"names":[],"mappings":";;;AAEa,QAAA,OAAO,GAAG,yCAAyC,CAAC","sourcesContent":["// This is an auto-generated file. Do not edit.\n\nexport const VERSION = '@civic/gateway-client-core:1.1.3-beta.3';\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9ba42214568e9a83a0ccc3870381ef496254c68d"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/ui.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/ui.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":32}},"2":{"start":{"line":4,"column":14},"end":{"line":4,"column":37}},"3":{"start":{"line":5,"column":17},"end":{"line":5,"column":37}},"4":{"start":{"line":6,"column":15},"end":{"line":6,"column":39}},"5":{"start":{"line":7,"column":26},"end":{"line":7,"column":61}},"6":{"start":{"line":8,"column":15},"end":{"line":20,"column":1}},"7":{"start":{"line":10,"column":4},"end":{"line":12,"column":5}},"8":{"start":{"line":11,"column":8},"end":{"line":11,"column":25}},"9":{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},"10":{"start":{"line":14,"column":8},"end":{"line":14,"column":25}},"11":{"start":{"line":16,"column":16},"end":{"line":16,"column":90}},"12":{"start":{"line":17,"column":22},"end":{"line":17,"column":72}},"13":{"start":{"line":18,"column":22},"end":{"line":18,"column":52}},"14":{"start":{"line":19,"column":4},"end":{"line":19,"column":49}},"15":{"start":{"line":21,"column":23},"end":{"line":44,"column":1}},"16":{"start":{"line":23,"column":20},"end":{"line":23,"column":98}},"17":{"start":{"line":24,"column":30},"end":{"line":24,"column":153}},"18":{"start":{"line":25,"column":4},"end":{"line":32,"column":5}},"19":{"start":{"line":27,"column":8},"end":{"line":27,"column":36}},"20":{"start":{"line":29,"column":9},"end":{"line":32,"column":5}},"21":{"start":{"line":31,"column":8},"end":{"line":31,"column":35}},"22":{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},"23":{"start":{"line":34,"column":8},"end":{"line":34,"column":35}},"24":{"start":{"line":36,"column":16},"end":{"line":36,"column":45}},"25":{"start":{"line":37,"column":22},"end":{"line":37,"column":145}},"26":{"start":{"line":38,"column":4},"end":{"line":43,"column":6}},"27":{"start":{"line":45,"column":0},"end":{"line":45,"column":40}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":8,"column":15},"end":{"line":8,"column":16}},"loc":{"start":{"line":8,"column":42},"end":{"line":20,"column":1}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":21,"column":23},"end":{"line":21,"column":24}},"loc":{"start":{"line":21,"column":62},"end":{"line":44,"column":1}},"line":21}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":4},"end":{"line":12,"column":5}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":12,"column":5}},{"start":{"line":10,"column":4},"end":{"line":12,"column":5}}],"line":10},"1":{"loc":{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},"type":"if","locations":[{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},{"start":{"line":13,"column":4},"end":{"line":15,"column":5}}],"line":13},"2":{"loc":{"start":{"line":13,"column":10},"end":{"line":13,"column":133}},"type":"cond-expr","locations":[{"start":{"line":13,"column":116},"end":{"line":13,"column":122}},{"start":{"line":13,"column":125},"end":{"line":13,"column":133}}],"line":13},"3":{"loc":{"start":{"line":13,"column":10},"end":{"line":13,"column":113}},"type":"binary-expr","locations":[{"start":{"line":13,"column":10},"end":{"line":13,"column":96}},{"start":{"line":13,"column":100},"end":{"line":13,"column":113}}],"line":13},"4":{"loc":{"start":{"line":13,"column":16},"end":{"line":13,"column":86}},"type":"cond-expr","locations":[{"start":{"line":13,"column":64},"end":{"line":13,"column":70}},{"start":{"line":13,"column":73},"end":{"line":13,"column":86}}],"line":13},"5":{"loc":{"start":{"line":13,"column":16},"end":{"line":13,"column":61}},"type":"binary-expr","locations":[{"start":{"line":13,"column":16},"end":{"line":13,"column":44}},{"start":{"line":13,"column":48},"end":{"line":13,"column":61}}],"line":13},"6":{"loc":{"start":{"line":17,"column":51},"end":{"line":17,"column":71}},"type":"binary-expr","locations":[{"start":{"line":17,"column":51},"end":{"line":17,"column":65}},{"start":{"line":17,"column":69},"end":{"line":17,"column":71}}],"line":17},"7":{"loc":{"start":{"line":23,"column":20},"end":{"line":23,"column":98}},"type":"cond-expr","locations":[{"start":{"line":23,"column":79},"end":{"line":23,"column":85}},{"start":{"line":23,"column":88},"end":{"line":23,"column":98}}],"line":23},"8":{"loc":{"start":{"line":23,"column":20},"end":{"line":23,"column":76}},"type":"binary-expr","locations":[{"start":{"line":23,"column":20},"end":{"line":23,"column":59}},{"start":{"line":23,"column":63},"end":{"line":23,"column":76}}],"line":23},"9":{"loc":{"start":{"line":24,"column":33},"end":{"line":24,"column":152}},"type":"cond-expr","locations":[{"start":{"line":24,"column":131},"end":{"line":24,"column":137}},{"start":{"line":24,"column":140},"end":{"line":24,"column":152}}],"line":24},"10":{"loc":{"start":{"line":24,"column":33},"end":{"line":24,"column":128}},"type":"binary-expr","locations":[{"start":{"line":24,"column":33},"end":{"line":24,"column":111}},{"start":{"line":24,"column":115},"end":{"line":24,"column":128}}],"line":24},"11":{"loc":{"start":{"line":24,"column":39},"end":{"line":24,"column":101}},"type":"cond-expr","locations":[{"start":{"line":24,"column":87},"end":{"line":24,"column":93}},{"start":{"line":24,"column":96},"end":{"line":24,"column":101}}],"line":24},"12":{"loc":{"start":{"line":24,"column":39},"end":{"line":24,"column":84}},"type":"binary-expr","locations":[{"start":{"line":24,"column":39},"end":{"line":24,"column":67}},{"start":{"line":24,"column":71},"end":{"line":24,"column":84}}],"line":24},"13":{"loc":{"start":{"line":25,"column":4},"end":{"line":32,"column":5}},"type":"if","locations":[{"start":{"line":25,"column":4},"end":{"line":32,"column":5}},{"start":{"line":25,"column":4},"end":{"line":32,"column":5}}],"line":25},"14":{"loc":{"start":{"line":25,"column":8},"end":{"line":26,"column":194}},"type":"binary-expr","locations":[{"start":{"line":25,"column":8},"end":{"line":25,"column":49}},{"start":{"line":26,"column":8},"end":{"line":26,"column":194}}],"line":25},"15":{"loc":{"start":{"line":26,"column":9},"end":{"line":26,"column":140}},"type":"cond-expr","locations":[{"start":{"line":26,"column":122},"end":{"line":26,"column":128}},{"start":{"line":26,"column":131},"end":{"line":26,"column":140}}],"line":26},"16":{"loc":{"start":{"line":26,"column":9},"end":{"line":26,"column":119}},"type":"binary-expr","locations":[{"start":{"line":26,"column":9},"end":{"line":26,"column":102}},{"start":{"line":26,"column":106},"end":{"line":26,"column":119}}],"line":26},"17":{"loc":{"start":{"line":26,"column":15},"end":{"line":26,"column":92}},"type":"cond-expr","locations":[{"start":{"line":26,"column":65},"end":{"line":26,"column":71}},{"start":{"line":26,"column":74},"end":{"line":26,"column":92}}],"line":26},"18":{"loc":{"start":{"line":26,"column":15},"end":{"line":26,"column":62}},"type":"binary-expr","locations":[{"start":{"line":26,"column":15},"end":{"line":26,"column":45}},{"start":{"line":26,"column":49},"end":{"line":26,"column":62}}],"line":26},"19":{"loc":{"start":{"line":29,"column":9},"end":{"line":32,"column":5}},"type":"if","locations":[{"start":{"line":29,"column":9},"end":{"line":32,"column":5}},{"start":{"line":29,"column":9},"end":{"line":32,"column":5}}],"line":29},"20":{"loc":{"start":{"line":29,"column":13},"end":{"line":30,"column":52}},"type":"binary-expr","locations":[{"start":{"line":29,"column":13},"end":{"line":29,"column":198}},{"start":{"line":30,"column":8},"end":{"line":30,"column":52}}],"line":29},"21":{"loc":{"start":{"line":29,"column":14},"end":{"line":29,"column":145}},"type":"cond-expr","locations":[{"start":{"line":29,"column":127},"end":{"line":29,"column":133}},{"start":{"line":29,"column":136},"end":{"line":29,"column":145}}],"line":29},"22":{"loc":{"start":{"line":29,"column":14},"end":{"line":29,"column":124}},"type":"binary-expr","locations":[{"start":{"line":29,"column":14},"end":{"line":29,"column":107}},{"start":{"line":29,"column":111},"end":{"line":29,"column":124}}],"line":29},"23":{"loc":{"start":{"line":29,"column":20},"end":{"line":29,"column":97}},"type":"cond-expr","locations":[{"start":{"line":29,"column":70},"end":{"line":29,"column":76}},{"start":{"line":29,"column":79},"end":{"line":29,"column":97}}],"line":29},"24":{"loc":{"start":{"line":29,"column":20},"end":{"line":29,"column":67}},"type":"binary-expr","locations":[{"start":{"line":29,"column":20},"end":{"line":29,"column":50}},{"start":{"line":29,"column":54},"end":{"line":29,"column":67}}],"line":29},"25":{"loc":{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},"type":"if","locations":[{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},{"start":{"line":33,"column":4},"end":{"line":35,"column":5}}],"line":33},"26":{"loc":{"start":{"line":33,"column":8},"end":{"line":33,"column":124}},"type":"binary-expr","locations":[{"start":{"line":33,"column":8},"end":{"line":33,"column":47}},{"start":{"line":33,"column":52},"end":{"line":33,"column":123}}],"line":33},"27":{"loc":{"start":{"line":33,"column":52},"end":{"line":33,"column":123}},"type":"cond-expr","locations":[{"start":{"line":33,"column":93},"end":{"line":33,"column":99}},{"start":{"line":33,"column":102},"end":{"line":33,"column":123}}],"line":33},"28":{"loc":{"start":{"line":33,"column":52},"end":{"line":33,"column":90}},"type":"binary-expr","locations":[{"start":{"line":33,"column":52},"end":{"line":33,"column":68}},{"start":{"line":33,"column":72},"end":{"line":33,"column":90}}],"line":33},"29":{"loc":{"start":{"line":37,"column":23},"end":{"line":37,"column":136}},"type":"cond-expr","locations":[{"start":{"line":37,"column":121},"end":{"line":37,"column":127}},{"start":{"line":37,"column":130},"end":{"line":37,"column":136}}],"line":37},"30":{"loc":{"start":{"line":37,"column":23},"end":{"line":37,"column":118}},"type":"binary-expr","locations":[{"start":{"line":37,"column":23},"end":{"line":37,"column":101}},{"start":{"line":37,"column":105},"end":{"line":37,"column":118}}],"line":37},"31":{"loc":{"start":{"line":37,"column":29},"end":{"line":37,"column":91}},"type":"cond-expr","locations":[{"start":{"line":37,"column":77},"end":{"line":37,"column":83}},{"start":{"line":37,"column":86},"end":{"line":37,"column":91}}],"line":37},"32":{"loc":{"start":{"line":37,"column":29},"end":{"line":37,"column":74}},"type":"binary-expr","locations":[{"start":{"line":37,"column":29},"end":{"line":37,"column":57}},{"start":{"line":37,"column":61},"end":{"line":37,"column":74}}],"line":37},"33":{"loc":{"start":{"line":39,"column":11},"end":{"line":39,"column":73}},"type":"cond-expr","locations":[{"start":{"line":39,"column":59},"end":{"line":39,"column":65}},{"start":{"line":39,"column":68},"end":{"line":39,"column":73}}],"line":39},"34":{"loc":{"start":{"line":39,"column":11},"end":{"line":39,"column":56}},"type":"binary-expr","locations":[{"start":{"line":39,"column":11},"end":{"line":39,"column":39}},{"start":{"line":39,"column":43},"end":{"line":39,"column":56}}],"line":39}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1758,"8":1064,"9":694,"10":0,"11":694,"12":694,"13":694,"14":694,"15":1,"16":1758,"17":1758,"18":1758,"19":33,"20":1725,"21":174,"22":1758,"23":1,"24":1758,"25":1758,"26":1758,"27":1},"f":{"0":1758,"1":1758},"b":{"0":[1064,694],"1":[0,694],"2":[0,694],"3":[694,694],"4":[0,694],"5":[694,694],"6":[694,0],"7":[308,1450],"8":[1758,1450],"9":[266,1492],"10":[1758,1758],"11":[3,1755],"12":[1758,1758],"13":[33,1725],"14":[1758,1726],"15":[3,1723],"16":[1726,1726],"17":[3,1723],"18":[1726,1726],"19":[174,1551],"20":[1725,1552],"21":[3,1722],"22":[1725,1725],"23":[3,1722],"24":[1725,1725],"25":[1,1757],"26":[1758,184],"27":[131,53],"28":[184,184],"29":[266,1492],"30":[1758,1758],"31":[3,1755],"32":[1758,1758],"33":[3,1755],"34":[1758,1758]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/ui.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/state/ui.ts"],"names":[],"mappings":";;;AAAA,sCAAiD;AACjD,sCAAiD;AACjD,wCAA2C;AAG3C,8DAAiE;AAEjE,MAAM,MAAM,GAAG,CAAC,KAAuB,EAAE,cAA0C,EAAsB,EAAE;;IACzG,IAAI,CAAC,cAAc,EAAE,CAAC;QACpB,OAAO,SAAS,CAAC;IACnB,CAAC;IACD,IAAI,CAAC,CAAA,MAAA,MAAA,KAAK,CAAC,MAAM,0CAAE,UAAU,0CAAE,KAAK,CAAA,EAAE,CAAC;QACrC,OAAO,SAAS,CAAC;IACnB,CAAC;IACD,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,IAAA,6BAAoB,EAAC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC;IACzE,MAAM,SAAS,GAAG,IAAA,uBAAiB,EAAC,cAAc,IAAI,EAAE,CAAC,CAAC;IAC1D,MAAM,SAAS,GAAG,IAAI,eAAe,CAAC,SAAS,CAAC,CAAC;IACjD,OAAO,GAAG,GAAG,CAAC,IAAI,IAAI,SAAS,CAAC,QAAQ,EAAE,EAAE,CAAC;AAC/C,CAAC,CAAC;AAEK,MAAM,cAAc,GAAG,CAC5B,KAAuB,EACvB,UAAkC,EAClC,cAA0C,EACvB,EAAE;;IACrB,MAAM,OAAO,GAAG,MAAA,KAAK,CAAC,MAAM,CAAC,UAAU,0CAAE,OAAO,CAAC;IACjD,IAAI,mBAAmB,GAAG,CAAC,CAAC,CAAA,MAAA,MAAA,KAAK,CAAC,MAAM,0CAAE,EAAE,0CAAE,SAAS,CAAA,CAAC;IACxD,IACE,UAAU,KAAK,iBAAU,CAAC,QAAQ;QAClC,CAAA,MAAA,MAAA,KAAK,CAAC,QAAQ,0CAAE,eAAe,0CAAE,MAAM,MAAK,uCAAqB,CAAC,QAAQ,EAC1E,CAAC;QACD,mBAAmB,GAAG,KAAK,CAAC;IAC9B,CAAC;SAAM,IACL,CAAA,MAAA,MAAA,KAAK,CAAC,QAAQ,0CAAE,eAAe,0CAAE,MAAM,MAAK,uCAAqB,CAAC,OAAO;QACzE,UAAU,KAAK,iBAAU,CAAC,WAAW,EACrC,CAAC;QACD,mBAAmB,GAAG,IAAI,CAAC;IAC7B,CAAC;IAGD,IAAI,UAAU,KAAK,iBAAU,CAAC,MAAM,KAAI,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,aAAa,CAAA,EAAE,CAAC;QAC/D,mBAAmB,GAAG,IAAI,CAAC;IAC7B,CAAC;IACD,MAAM,GAAG,GAAG,MAAM,CAAC,KAAK,EAAE,cAAc,CAAC,CAAC;IAC1C,MAAM,SAAS,GAAG,CAAA,MAAA,MAAA,KAAK,CAAC,MAAM,0CAAE,EAAE,0CAAE,GAAG,MAAK,GAAG,CAAC;IAChD,OAAO;QACL,GAAG,MAAA,KAAK,CAAC,MAAM,0CAAE,EAAE;QACnB,SAAS;QACT,GAAG;QACH,SAAS,EAAE,CAAC,CAAC,mBAAmB;KACjC,CAAC;AACJ,CAAC,CAAC;AA/BW,QAAA,cAAc,kBA+BzB","sourcesContent":["import { objectToURLParams } from '../utils/url';\nimport { getCivicPassEndpoint } from '../config';\nimport { FlowStatus } from '../types/flow';\nimport { FlowParameters, GatewayCoreState } from '../types/gatewayCore';\nimport { UIOutput } from '../types/ui';\nimport { UserInteractionStatus } from '../types/userInteraction';\n\nconst getUrl = (state: GatewayCoreState, flowParameters: FlowParameters | undefined): string | undefined => {\n  if (!flowParameters) {\n    return undefined;\n  }\n  if (!state.inputs?.parameters?.stage) {\n    return undefined;\n  }\n  const url = new URL(getCivicPassEndpoint(state.inputs.parameters.stage));\n  const urlParams = objectToURLParams(flowParameters || {});\n  const getParams = new URLSearchParams(urlParams);\n  return `${url.href}?${getParams.toString()}`;\n};\n\nexport const computeUiState = (\n  state: GatewayCoreState,\n  flowStatus: FlowStatus | undefined,\n  flowParameters: FlowParameters | undefined\n): Partial<UIOutput> => {\n  const options = state.inputs.parameters?.options;\n  let calculatedIsVisible = !!state.output?.ui?.isVisible;\n  if (\n    flowStatus === FlowStatus.FINISHED ||\n    state.internal?.userInteraction?.status === UserInteractionStatus.FINISHED\n  ) {\n    calculatedIsVisible = false;\n  } else if (\n    state.internal?.userInteraction?.status === UserInteractionStatus.STARTED ||\n    flowStatus === FlowStatus.IN_PROGRESS\n  ) {\n    calculatedIsVisible = true;\n  }\n\n  // override the visibility if the flow is finished and autoShowModal is true\n  if (flowStatus === FlowStatus.RESULT && options?.autoShowModal) {\n    calculatedIsVisible = true;\n  }\n  const url = getUrl(state, flowParameters);\n  const isLoading = state.output?.ui?.url !== url;\n  return {\n    ...state.output?.ui,\n    isLoading,\n    url,\n    isVisible: !!calculatedIsVisible,\n  };\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"be3c5110031da0d2efe745020a507641a6bbed97"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/ui.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/ui.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"2":{"start":{"line":4,"column":18},"end":{"line":4,"column":44}},"3":{"start":{"line":5,"column":26},"end":{"line":5,"column":60}},"4":{"start":{"line":6,"column":17},"end":{"line":6,"column":36}},"5":{"start":{"line":7,"column":22},"end":{"line":7,"column":93}},"6":{"start":{"line":10,"column":8},"end":{"line":10,"column":49}},"7":{"start":{"line":11,"column":8},"end":{"line":11,"column":59}},"8":{"start":{"line":14,"column":8},"end":{"line":14,"column":33}},"9":{"start":{"line":15,"column":8},"end":{"line":21,"column":11}},"10":{"start":{"line":17,"column":12},"end":{"line":17,"column":94}},"11":{"start":{"line":18,"column":12},"end":{"line":18,"column":119}},"12":{"start":{"line":19,"column":12},"end":{"line":19,"column":45}},"13":{"start":{"line":20,"column":12},"end":{"line":20,"column":100}},"14":{"start":{"line":24,"column":8},"end":{"line":24,"column":33}},"15":{"start":{"line":25,"column":8},"end":{"line":31,"column":11}},"16":{"start":{"line":27,"column":12},"end":{"line":27,"column":94}},"17":{"start":{"line":28,"column":12},"end":{"line":28,"column":119}},"18":{"start":{"line":29,"column":12},"end":{"line":29,"column":46}},"19":{"start":{"line":30,"column":12},"end":{"line":30,"column":101}},"20":{"start":{"line":34,"column":8},"end":{"line":34,"column":33}},"21":{"start":{"line":35,"column":8},"end":{"line":41,"column":11}},"22":{"start":{"line":37,"column":12},"end":{"line":37,"column":94}},"23":{"start":{"line":38,"column":12},"end":{"line":38,"column":119}},"24":{"start":{"line":39,"column":12},"end":{"line":39,"column":46}},"25":{"start":{"line":40,"column":12},"end":{"line":40,"column":44}},"26":{"start":{"line":44,"column":0},"end":{"line":44,"column":30}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":4},"end":{"line":9,"column":5}},"loc":{"start":{"line":9,"column":34},"end":{"line":12,"column":5}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":13},"end":{"line":22,"column":5}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":39},"end":{"line":15,"column":40}},"loc":{"start":{"line":15,"column":50},"end":{"line":21,"column":9}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":23,"column":4},"end":{"line":23,"column":5}},"loc":{"start":{"line":23,"column":13},"end":{"line":32,"column":5}},"line":23},"4":{"name":"(anonymous_4)","decl":{"start":{"line":25,"column":39},"end":{"line":25,"column":40}},"loc":{"start":{"line":25,"column":50},"end":{"line":31,"column":9}},"line":25},"5":{"name":"(anonymous_5)","decl":{"start":{"line":33,"column":4},"end":{"line":33,"column":5}},"loc":{"start":{"line":33,"column":13},"end":{"line":42,"column":5}},"line":33},"6":{"name":"(anonymous_6)","decl":{"start":{"line":35,"column":39},"end":{"line":35,"column":40}},"loc":{"start":{"line":35,"column":50},"end":{"line":41,"column":9}},"line":35}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":27},"end":{"line":17,"column":93}},"type":"binary-expr","locations":[{"start":{"line":17,"column":27},"end":{"line":17,"column":39}},{"start":{"line":17,"column":43},"end":{"line":17,"column":93}}],"line":17},"1":{"loc":{"start":{"line":18,"column":30},"end":{"line":18,"column":118}},"type":"binary-expr","locations":[{"start":{"line":18,"column":31},"end":{"line":18,"column":93}},{"start":{"line":18,"column":98},"end":{"line":18,"column":118}}],"line":18},"2":{"loc":{"start":{"line":18,"column":31},"end":{"line":18,"column":93}},"type":"cond-expr","locations":[{"start":{"line":18,"column":79},"end":{"line":18,"column":85}},{"start":{"line":18,"column":88},"end":{"line":18,"column":93}}],"line":18},"3":{"loc":{"start":{"line":18,"column":31},"end":{"line":18,"column":76}},"type":"binary-expr","locations":[{"start":{"line":18,"column":31},"end":{"line":18,"column":59}},{"start":{"line":18,"column":63},"end":{"line":18,"column":76}}],"line":18},"4":{"loc":{"start":{"line":27,"column":27},"end":{"line":27,"column":93}},"type":"binary-expr","locations":[{"start":{"line":27,"column":27},"end":{"line":27,"column":39}},{"start":{"line":27,"column":43},"end":{"line":27,"column":93}}],"line":27},"5":{"loc":{"start":{"line":28,"column":30},"end":{"line":28,"column":118}},"type":"binary-expr","locations":[{"start":{"line":28,"column":31},"end":{"line":28,"column":93}},{"start":{"line":28,"column":98},"end":{"line":28,"column":118}}],"line":28},"6":{"loc":{"start":{"line":28,"column":31},"end":{"line":28,"column":93}},"type":"cond-expr","locations":[{"start":{"line":28,"column":79},"end":{"line":28,"column":85}},{"start":{"line":28,"column":88},"end":{"line":28,"column":93}}],"line":28},"7":{"loc":{"start":{"line":28,"column":31},"end":{"line":28,"column":76}},"type":"binary-expr","locations":[{"start":{"line":28,"column":31},"end":{"line":28,"column":59}},{"start":{"line":28,"column":63},"end":{"line":28,"column":76}}],"line":28},"8":{"loc":{"start":{"line":37,"column":27},"end":{"line":37,"column":93}},"type":"binary-expr","locations":[{"start":{"line":37,"column":27},"end":{"line":37,"column":39}},{"start":{"line":37,"column":43},"end":{"line":37,"column":93}}],"line":37},"9":{"loc":{"start":{"line":38,"column":30},"end":{"line":38,"column":118}},"type":"binary-expr","locations":[{"start":{"line":38,"column":31},"end":{"line":38,"column":93}},{"start":{"line":38,"column":98},"end":{"line":38,"column":118}}],"line":38},"10":{"loc":{"start":{"line":38,"column":31},"end":{"line":38,"column":93}},"type":"cond-expr","locations":[{"start":{"line":38,"column":79},"end":{"line":38,"column":85}},{"start":{"line":38,"column":88},"end":{"line":38,"column":93}}],"line":38},"11":{"loc":{"start":{"line":38,"column":31},"end":{"line":38,"column":76}},"type":"binary-expr","locations":[{"start":{"line":38,"column":31},"end":{"line":38,"column":59}},{"start":{"line":38,"column":63},"end":{"line":38,"column":76}}],"line":38}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":108,"7":108,"8":4,"9":4,"10":4,"11":4,"12":4,"13":4,"14":3,"15":3,"16":3,"17":3,"18":3,"19":3,"20":2,"21":2,"22":2,"23":2,"24":2,"25":2,"26":1},"f":{"0":108,"1":4,"2":4,"3":3,"4":3,"5":2,"6":2},"b":{"0":[4,0],"1":[4,0],"2":[0,4],"3":[4,4],"4":[3,0],"5":[3,0],"6":[0,3],"7":[3,3],"8":[2,0],"9":[2,0],"10":[0,2],"11":[2,2]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/ui.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/ui.ts"],"names":[],"mappings":";;;AACA,6CAAgD;AAChD,6DAAgE;AAChE,qCAAwC;AAGxC,MAAM,aAAa,GAAG,EAAE,SAAS,EAAE,KAAK,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,EAAE,SAAS,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;AAC9F,MAAa,SAAS;IAGpB,YAAqB,gBAAuB;QAAvB,qBAAgB,GAAhB,gBAAgB,CAAO;QAC1C,IAAI,CAAC,GAAG,GAAG,IAAA,qBAAY,EAAC,WAAW,CAAC,CAAC;IACvC,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QACzB,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,EAAE;;YACvC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,IAAI,EAAE,aAAa,EAAE,uBAAa,CAAC,OAAO,EAAE,CAAC;YACxE,KAAK,CAAC,MAAM,CAAC,EAAE,GAAG,CAAA,MAAA,KAAK,CAAC,MAAM,0CAAE,EAAE,KAAI,EAAE,GAAG,aAAa,EAAE,CAAC;YAC3D,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,GAAG,IAAI,CAAC;YACjC,KAAK,CAAC,QAAQ,CAAC,eAAe,CAAC,MAAM,GAAG,uCAAqB,CAAC,OAAO,CAAC;QACxE,CAAC,CAAC,CAAC;IACL,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QACzB,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,EAAE;;YACvC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,IAAI,EAAE,aAAa,EAAE,uBAAa,CAAC,OAAO,EAAE,CAAC;YACxE,KAAK,CAAC,MAAM,CAAC,EAAE,GAAG,CAAA,MAAA,KAAK,CAAC,MAAM,0CAAE,EAAE,KAAI,EAAE,GAAG,aAAa,EAAE,CAAC;YAC3D,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,GAAG,KAAK,CAAC;YAClC,KAAK,CAAC,QAAQ,CAAC,eAAe,CAAC,MAAM,GAAG,uCAAqB,CAAC,QAAQ,CAAC;QACzE,CAAC,CAAC,CAAC;IACL,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QACzB,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,EAAE;;YACvC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,IAAI,EAAE,aAAa,EAAE,uBAAa,CAAC,OAAO,EAAE,CAAC;YACxE,KAAK,CAAC,MAAM,CAAC,EAAE,GAAG,CAAA,MAAA,KAAK,CAAC,MAAM,0CAAE,EAAE,KAAI,EAAE,GAAG,aAAa,EAAE,CAAC;YAC3D,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,GAAG,KAAK,CAAC;YAClC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,QAAQ,GAAG,IAAI,CAAC;QAClC,CAAC,CAAC,CAAC;IACL,CAAC;CACF;AApCD,8BAoCC","sourcesContent":["import { Store } from './state/state';\nimport { GatewayStatus } from './types/gateway';\nimport { UserInteractionStatus } from './types/userInteraction';\nimport { prefixLogger } from './logger';\nimport { LoggingInterface } from './logger/provider.logger';\n\nconst defaultValues = { isVisible: false, isLoading: false, url: undefined, isLoaded: false };\nexport class UIManager {\n  private log: LoggingInterface;\n\n  constructor(readonly gatewayCoreStore: Store) {\n    this.log = prefixLogger(`UIManager`);\n  }\n\n  onShow() {\n    this.log.debug('onShow');\n    this.gatewayCoreStore.setState((state) => {\n      state.output = state.output || { gatewayStatus: GatewayStatus.UNKNOWN };\n      state.output.ui = state.output?.ui || { ...defaultValues };\n      state.output.ui.isVisible = true;\n      state.internal.userInteraction.status = UserInteractionStatus.STARTED;\n    });\n  }\n\n  onHide() {\n    this.log.debug('onHide');\n    this.gatewayCoreStore.setState((state) => {\n      state.output = state.output || { gatewayStatus: GatewayStatus.UNKNOWN };\n      state.output.ui = state.output?.ui || { ...defaultValues };\n      state.output.ui.isVisible = false;\n      state.internal.userInteraction.status = UserInteractionStatus.FINISHED;\n    });\n  }\n\n  onLoad() {\n    this.log.debug('onLoad');\n    this.gatewayCoreStore.setState((state) => {\n      state.output = state.output || { gatewayStatus: GatewayStatus.UNKNOWN };\n      state.output.ui = state.output?.ui || { ...defaultValues };\n      state.output.ui.isLoading = false;\n      state.output.ui.isLoaded = true;\n    });\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d930c8a9424cb40e534cd974440592d4f96c6790"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/eventInterface.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/eventInterface.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}}},"fnMap":{},"branchMap":{},"s":{"0":1},"f":{},"b":{},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/eventInterface.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/types/eventInterface.ts"],"names":[],"mappings":"","sourcesContent":["export type MessageEventInterface = {\n  addMessageEventListener: <T>(handler: (response: T) => void) => void;\n  removeMessageEventListener: <T>(handler: (response: T) => void) => void;\n};\n\nexport type PostMessageFn = <T>(message: T, targetOrigin: string) => void;\nexport type PostMessageInterface = {\n  postMessage: PostMessageFn;\n};\nexport type PostMessageTargetCallback = (instanceId: string) => PostMessageInterface;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b9228a033b4edb695c859e8fa3ef60a5b2f062ba"},"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/analytics.ts":{"path":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/analytics.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":108}},"4":{"start":{"line":7,"column":17},"end":{"line":7,"column":54}},"5":{"start":{"line":8,"column":18},"end":{"line":8,"column":46}},"6":{"start":{"line":9,"column":17},"end":{"line":9,"column":36}},"7":{"start":{"line":10,"column":0},"end":{"line":16,"column":2}},"8":{"start":{"line":17,"column":27},"end":{"line":42,"column":1}},"9":{"start":{"line":18,"column":16},"end":{"line":18,"column":56}},"10":{"start":{"line":19,"column":4},"end":{"line":22,"column":5}},"11":{"start":{"line":20,"column":8},"end":{"line":20,"column":86}},"12":{"start":{"line":21,"column":8},"end":{"line":21,"column":15}},"13":{"start":{"line":23,"column":27},"end":{"line":23,"column":65}},"14":{"start":{"line":24,"column":28},"end":{"line":28,"column":5}},"15":{"start":{"line":29,"column":4},"end":{"line":41,"column":5}},"16":{"start":{"line":30,"column":8},"end":{"line":30,"column":101}},"17":{"start":{"line":31,"column":8},"end":{"line":31,"column":57}},"18":{"start":{"line":32,"column":8},"end":{"line":32,"column":77}},"19":{"start":{"line":35,"column":8},"end":{"line":35,"column":104}},"20":{"start":{"line":36,"column":8},"end":{"line":40,"column":11}},"21":{"start":{"line":43,"column":0},"end":{"line":43,"column":48}},"22":{"start":{"line":44,"column":34},"end":{"line":72,"column":1}},"23":{"start":{"line":45,"column":4},"end":{"line":71,"column":5}},"24":{"start":{"line":46,"column":8},"end":{"line":46,"column":128}},"25":{"start":{"line":47,"column":22},"end":{"line":62,"column":9}},"26":{"start":{"line":63,"column":8},"end":{"line":66,"column":9}},"27":{"start":{"line":64,"column":12},"end":{"line":64,"column":81}},"28":{"start":{"line":65,"column":12},"end":{"line":65,"column":19}},"29":{"start":{"line":67,"column":8},"end":{"line":67,"column":87}},"30":{"start":{"line":70,"column":8},"end":{"line":70,"column":95}},"31":{"start":{"line":73,"column":0},"end":{"line":73,"column":62}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":17,"column":27},"end":{"line":17,"column":28}},"loc":{"start":{"line":17,"column":63},"end":{"line":42,"column":1}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":44,"column":34},"end":{"line":44,"column":35}},"loc":{"start":{"line":44,"column":87},"end":{"line":72,"column":1}},"line":44}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":19,"column":4},"end":{"line":22,"column":5}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":22,"column":5}},{"start":{"line":19,"column":4},"end":{"line":22,"column":5}}],"line":19},"4":{"loc":{"start":{"line":23,"column":27},"end":{"line":23,"column":65}},"type":"binary-expr","locations":[{"start":{"line":23,"column":27},"end":{"line":23,"column":44}},{"start":{"line":23,"column":48},"end":{"line":23,"column":65}}],"line":23},"5":{"loc":{"start":{"line":29,"column":4},"end":{"line":41,"column":5}},"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":41,"column":5}},{"start":{"line":29,"column":4},"end":{"line":41,"column":5}}],"line":29},"6":{"loc":{"start":{"line":45,"column":4},"end":{"line":71,"column":5}},"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":71,"column":5}},{"start":{"line":45,"column":4},"end":{"line":71,"column":5}}],"line":45},"7":{"loc":{"start":{"line":48,"column":17},"end":{"line":48,"column":41}},"type":"binary-expr","locations":[{"start":{"line":48,"column":17},"end":{"line":48,"column":35}},{"start":{"line":48,"column":39},"end":{"line":48,"column":41}}],"line":48},"8":{"loc":{"start":{"line":49,"column":28},"end":{"line":49,"column":63}},"type":"binary-expr","locations":[{"start":{"line":49,"column":28},"end":{"line":49,"column":57}},{"start":{"line":49,"column":61},"end":{"line":49,"column":63}}],"line":49},"9":{"loc":{"start":{"line":50,"column":19},"end":{"line":50,"column":45}},"type":"binary-expr","locations":[{"start":{"line":50,"column":19},"end":{"line":50,"column":39}},{"start":{"line":50,"column":43},"end":{"line":50,"column":45}}],"line":50},"10":{"loc":{"start":{"line":51,"column":26},"end":{"line":51,"column":59}},"type":"binary-expr","locations":[{"start":{"line":51,"column":26},"end":{"line":51,"column":53}},{"start":{"line":51,"column":57},"end":{"line":51,"column":59}}],"line":51},"11":{"loc":{"start":{"line":52,"column":24},"end":{"line":52,"column":68}},"type":"cond-expr","locations":[{"start":{"line":52,"column":52},"end":{"line":52,"column":58}},{"start":{"line":52,"column":61},"end":{"line":52,"column":68}}],"line":52},"12":{"loc":{"start":{"line":53,"column":20},"end":{"line":53,"column":47}},"type":"binary-expr","locations":[{"start":{"line":53,"column":20},"end":{"line":53,"column":41}},{"start":{"line":53,"column":45},"end":{"line":53,"column":47}}],"line":53},"13":{"loc":{"start":{"line":54,"column":20},"end":{"line":54,"column":47}},"type":"binary-expr","locations":[{"start":{"line":54,"column":20},"end":{"line":54,"column":41}},{"start":{"line":54,"column":45},"end":{"line":54,"column":47}}],"line":54},"14":{"loc":{"start":{"line":55,"column":22},"end":{"line":55,"column":51}},"type":"binary-expr","locations":[{"start":{"line":55,"column":22},"end":{"line":55,"column":45}},{"start":{"line":55,"column":49},"end":{"line":55,"column":51}}],"line":55},"15":{"loc":{"start":{"line":58,"column":20},"end":{"line":58,"column":47}},"type":"binary-expr","locations":[{"start":{"line":58,"column":20},"end":{"line":58,"column":41}},{"start":{"line":58,"column":45},"end":{"line":58,"column":47}}],"line":58},"16":{"loc":{"start":{"line":59,"column":22},"end":{"line":59,"column":51}},"type":"binary-expr","locations":[{"start":{"line":59,"column":22},"end":{"line":59,"column":45}},{"start":{"line":59,"column":49},"end":{"line":59,"column":51}}],"line":59},"17":{"loc":{"start":{"line":63,"column":8},"end":{"line":66,"column":9}},"type":"if","locations":[{"start":{"line":63,"column":8},"end":{"line":66,"column":9}},{"start":{"line":63,"column":8},"end":{"line":66,"column":9}}],"line":63}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":9,"10":9,"11":2,"12":2,"13":7,"14":7,"15":7,"16":5,"17":5,"18":5,"19":2,"20":2,"21":1,"22":1,"23":6,"24":5,"25":5,"26":5,"27":1,"28":1,"29":4,"30":1,"31":1},"f":{"0":1,"1":9,"2":6},"b":{"0":[1,1,1],"1":[1,0],"2":[1,1],"3":[2,7],"4":[7,6],"5":[5,2],"6":[5,1],"7":[5,1],"8":[5,1],"9":[5,1],"10":[5,1],"11":[4,1],"12":[5,1],"13":[5,1],"14":[5,1],"15":[5,1],"16":[5,1],"17":[1,4]},"inputSourceMap":{"version":3,"file":"/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/analytics.ts","sources":["/Users/daneel/work/ociv-gatekeeper/packages/gateway-client-core/src/utils/analytics.ts"],"names":[],"mappings":"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","sourcesContent":["import logger from '../logger';\nimport { Stage } from '../types/parameters';\n// Auto-generated by 'yarn generate-version' from package.json\n// Done on prepublish and pretest\nimport { VERSION as CORE_VERSION } from '../../src/version';\nimport { FlowParameters } from '../../src/types/gatewayCore';\nimport { ErrorCode } from './errors';\n\nexport type CivicAnalyticsEvent = {\n  did: string;\n  validationId?: string;\n  networkAddress: string;\n  referrer?: string;\n  redirectUrl?: string;\n  wallet: string;\n  domain: string;\n  action: string;\n  chainNetwork: string;\n  chain: string;\n  ownerSigns: string;\n  flowId: string;\n  flowType: string;\n  errorCode?: string;\n  partnerAppId?: string;\n  signedTx?: string;\n  civicClient?: string;\n  instanceId?: string;\n  provider?: string;\n  hideWalletPrompts?: string;\n};\n\nexport type SendBeaconFn = (url: string | URL, data?: BodyInit | null | undefined) => boolean;\n\nexport const CIVIC_ANALYTICS_ENDPOINTS: Record<Stage, string | null> = {\n  local: null, // Disabled for local\n  test: null, // Disabled for tests\n  dev: 'https://dev.api.civic.com/analytics-dev/events',\n  preprod: 'https://dev.api.civic.com/analytics-preprod/events',\n  prod: 'https://api.civic.com/analytics/events',\n};\n\n/*\n * Sends an event into the Civic analytics pipeline, using the Beacon API (if available) with no-cors.\n * If the browser does not support Beacon, try fetch,\n * but fetch is not guaranteed to complete when the tab is being closed like Beacon is.\n *\n * If no clientPackageVersion is passed in, the core package version will be used.\n */\nexport const sendAnalyticsEvent = async (\n  stage: Stage,\n  event: CivicAnalyticsEvent,\n  sendBeacon?: SendBeaconFn\n): Promise<void> => {\n  const url = CIVIC_ANALYTICS_ENDPOINTS[stage];\n  if (!url) {\n    logger.warn(`No analytics endpoint configured for stage ${stage}.`);\n    return;\n  }\n  const packageVersion = event.civicClient || CORE_VERSION;\n  const eventWithSource = {\n    ...event,\n    source: `passApi_${stage}`,\n    civicClient: packageVersion,\n  };\n  if (sendBeacon) {\n    logger.debug('Beacon API supported. Using it to send analytics event.', { event });\n    // The call is queued by the browser and sent asap, even when the page is unloaded.\n    // By default this uses text/plain, and uses no-cors.\n    sendBeacon(url, JSON.stringify(eventWithSource));\n    logger.debug('Analytics event sent.', { eventWithSource });\n  } else {\n    logger.debug('Beacon API not supported. Falling back to fetch.', { eventWithSource });\n    await fetch(url, {\n      method: 'POST',\n      // So the analytics server doesn't have to allowlist all the possible dApp endpoints,\n      // and preflight is not needed, minimizing the risk of losing a request on tab close.\n      mode: 'no-cors',\n      body: JSON.stringify(eventWithSource),\n    });\n  }\n};\n\n/**\n * Checks the chain implementation to see if a tx is pending.\n * If it is, emit a BROWSER_CLOSED_WHILE_TRANSACTION_PENDING event to analytics.\n *\n * This is called from the core 'destroy()' function, which is called from the\n * 'page closed' hooks in the various framework-specific components.\n */\nexport const sendOnCloseAnalyticsEvent = async (\n  flowParameters: FlowParameters,\n  pendingTxHash?: string,\n  sendBeacon?: SendBeaconFn\n) => {\n  if (pendingTxHash) {\n    logger.debug('Abort received while tx is still pending on the chainImplementation. Sending analytics event.');\n    const event: CivicAnalyticsEvent = {\n      did: flowParameters.did || '',\n      networkAddress: flowParameters.networkAddress || '',\n      chain: flowParameters.chain || '',\n      chainNetwork: flowParameters.chainNetwork || '',\n      ownerSigns: flowParameters.ownerSigns ? 'true' : 'false',\n      wallet: flowParameters.wallet || '',\n      domain: flowParameters.domain || '',\n      referrer: flowParameters.referrer || '',\n      action: 'CHAIN_ERROR',\n      errorCode: ErrorCode.BROWSER_CLOSED_WHILE_TRANSACTION_PENDING,\n      flowId: flowParameters.flowId || '',\n      flowType: flowParameters.flowType || '',\n      signedTx: pendingTxHash,\n      civicClient: flowParameters.civicClient,\n    };\n    if (!flowParameters.stage) {\n      logger.error('Unknown stage. Cannot send analytics event');\n      return;\n    }\n    // This uses the Beacon API if the browser supports it, to guarantee delivery after the tab has closed.\n    // Also, no-cors is used so events can be sent from any dApp origin.\n    await sendAnalyticsEvent(flowParameters.stage as Stage, event, sendBeacon);\n  } else {\n    logger.debug('No pending tx in abort analytics handler. Not sending event.');\n  }\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"100c7dc45c5c459259b147fb0146110ec2fb0ea3"}}